(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[179],{185:(_y,Lu,Bu)=>{"use strict";function ql(e){return"function"==typeof e}let Tp=!1;const ba={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){const t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else Tp&&console.log("RxJS: Back to a better error behavior. Thank you. <3");Tp=e},get useDeprecatedSynchronousErrorHandling(){return Tp}};function f(e){setTimeout(()=>{throw e},0)}const at={closed:!0,next(e){},error(e){if(ba.useDeprecatedSynchronousErrorHandling)throw e;f(e)},complete(){}},Vr=Array.isArray||(e=>e&&"number"==typeof e.length);function Po(e){return null!==e&&"object"==typeof e}const yn=(()=>{function e(t){return Error.call(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,n)=>`${n+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t,this}return e.prototype=Object.create(Error.prototype),e})();class un{constructor(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}unsubscribe(){let t;if(this.closed)return;let{_parentOrParents:i,_ctorUnsubscribe:n,_unsubscribe:r,_subscriptions:s}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,i instanceof un)i.remove(this);else if(null!==i)for(let d=0;d<i.length;++d)i[d].remove(this);if(ql(r)){n&&(this._unsubscribe=void 0);try{r.call(this)}catch(d){t=d instanceof yn?ro(d.errors):[d]}}if(Vr(s)){let d=-1,m=s.length;for(;++d<m;){const b=s[d];if(Po(b))try{b.unsubscribe()}catch(E){t=t||[],E instanceof yn?t=t.concat(ro(E.errors)):t.push(E)}}}if(t)throw new yn(t)}add(t){let i=t;if(!t)return un.EMPTY;switch(typeof t){case"function":i=new un(t);case"object":if(i===this||i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;if(!(i instanceof un)){const s=i;i=new un,i._subscriptions=[s]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}let{_parentOrParents:n}=i;if(null===n)i._parentOrParents=this;else if(n instanceof un){if(n===this)return i;i._parentOrParents=[n,this]}else{if(-1!==n.indexOf(this))return i;n.push(this)}const r=this._subscriptions;return null===r?this._subscriptions=[i]:r.push(i),i}remove(t){const i=this._subscriptions;if(i){const n=i.indexOf(t);-1!==n&&i.splice(n,1)}}}var e;function ro(e){return e.reduce((t,i)=>t.concat(i instanceof yn?i.errors:i),[])}un.EMPTY=((e=new un).closed=!0,e);const Yo="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class Gn extends un{constructor(t,i,n){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=at;break;case 1:if(!t){this.destination=at;break}if("object"==typeof t){t instanceof Gn?(this.syncErrorThrowable=t.syncErrorThrowable,this.destination=t,t.add(this)):(this.syncErrorThrowable=!0,this.destination=new Wl(this,t));break}default:this.syncErrorThrowable=!0,this.destination=new Wl(this,t,i,n)}}[Yo](){return this}static create(t,i,n){const r=new Gn(t,i,n);return r.syncErrorThrowable=!1,r}next(t){this.isStopped||this._next(t)}error(t){this.isStopped||(this.isStopped=!0,this._error(t))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(t){this.destination.next(t)}_error(t){this.destination.error(t),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:t}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this}}class Wl extends Gn{constructor(t,i,n,r){super(),this._parentSubscriber=t;let s,d=this;ql(i)?s=i:i&&(s=i.next,n=i.error,r=i.complete,i!==at&&(d=Object.create(i),ql(d.unsubscribe)&&this.add(d.unsubscribe.bind(d)),d.unsubscribe=this.unsubscribe.bind(this))),this._context=d,this._next=s,this._error=n,this._complete=r}next(t){if(!this.isStopped&&this._next){const{_parentSubscriber:i}=this;ba.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable?this.__tryOrSetError(i,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}error(t){if(!this.isStopped){const{_parentSubscriber:i}=this,{useDeprecatedSynchronousErrorHandling:n}=ba;if(this._error)n&&i.syncErrorThrowable?(this.__tryOrSetError(i,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(i.syncErrorThrowable)n?(i.syncErrorValue=t,i.syncErrorThrown=!0):f(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;f(t)}}}complete(){if(!this.isStopped){const{_parentSubscriber:t}=this;if(this._complete){const i=()=>this._complete.call(this._context);ba.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,i),this.unsubscribe()):(this.__tryOrUnsub(i),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(t,i){try{t.call(this._context,i)}catch(n){if(this.unsubscribe(),ba.useDeprecatedSynchronousErrorHandling)throw n;f(n)}}__tryOrSetError(t,i,n){if(!ba.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{i.call(this._context,n)}catch(r){return ba.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(f(r),!0)}return!1}_unsubscribe(){const{_parentSubscriber:t}=this;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}const oo="function"==typeof Symbol&&Symbol.observable||"@@observable";function Us(e){return e}function Xo(e){return 0===e.length?Us:1===e.length?e[0]:function(i){return e.reduce((n,r)=>r(n),i)}}let ot=(()=>{class e{constructor(i){this._isScalar=!1,i&&(this._subscribe=i)}lift(i){const n=new e;return n.source=this,n.operator=i,n}subscribe(i,n,r){const{operator:s}=this,d=function Gc(e,t,i){if(e){if(e instanceof Gn)return e;if(e[Yo])return e[Yo]()}return e||t||i?new Gn(e,t,i):new Gn(at)}(i,n,r);if(d.add(s?s.call(d,this.source):this.source||ba.useDeprecatedSynchronousErrorHandling&&!d.syncErrorThrowable?this._subscribe(d):this._trySubscribe(d)),ba.useDeprecatedSynchronousErrorHandling&&d.syncErrorThrowable&&(d.syncErrorThrowable=!1,d.syncErrorThrown))throw d.syncErrorValue;return d}_trySubscribe(i){try{return this._subscribe(i)}catch(n){ba.useDeprecatedSynchronousErrorHandling&&(i.syncErrorThrown=!0,i.syncErrorValue=n),function ms(e){for(;e;){const{closed:t,destination:i,isStopped:n}=e;if(t||n)return!1;e=i&&i instanceof Gn?i:null}return!0}(i)?i.error(n):console.warn(n)}}forEach(i,n){return new(n=zu(n))((r,s)=>{let d;d=this.subscribe(m=>{try{i(m)}catch(b){s(b),d&&d.unsubscribe()}},s,r)})}_subscribe(i){const{source:n}=this;return n&&n.subscribe(i)}[oo](){return this}pipe(...i){return 0===i.length?this:Xo(i)(this)}toPromise(i){return new(i=zu(i))((n,r)=>{let s;this.subscribe(d=>s=d,d=>r(d),()=>n(s))})}}return e.create=t=>new e(t),e})();function zu(e){if(e||(e=ba.Promise||Promise),!e)throw new Error("no Promise impl found");return e}const mn=(()=>{function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e})();class yr extends un{constructor(t,i){super(),this.subject=t,this.subscriber=i,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const t=this.subject,i=t.observers;if(this.subject=null,!i||0===i.length||t.isStopped||t.closed)return;const n=i.indexOf(this.subscriber);-1!==n&&i.splice(n,1)}}class Vu extends Gn{constructor(t){super(t),this.destination=t}}let vn=(()=>{class e extends ot{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[Yo](){return new Vu(this)}lift(i){const n=new qc(this,this);return n.operator=i,n}next(i){if(this.closed)throw new mn;if(!this.isStopped){const{observers:n}=this,r=n.length,s=n.slice();for(let d=0;d<r;d++)s[d].next(i)}}error(i){if(this.closed)throw new mn;this.hasError=!0,this.thrownError=i,this.isStopped=!0;const{observers:n}=this,r=n.length,s=n.slice();for(let d=0;d<r;d++)s[d].error(i);this.observers.length=0}complete(){if(this.closed)throw new mn;this.isStopped=!0;const{observers:i}=this,n=i.length,r=i.slice();for(let s=0;s<n;s++)r[s].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(i){if(this.closed)throw new mn;return super._trySubscribe(i)}_subscribe(i){if(this.closed)throw new mn;return this.hasError?(i.error(this.thrownError),un.EMPTY):this.isStopped?(i.complete(),un.EMPTY):(this.observers.push(i),new yr(this,i))}asObservable(){const i=new ot;return i.source=this,i}}return e.create=(t,i)=>new qc(t,i),e})();class qc extends vn{constructor(t,i){super(),this.destination=t,this.source=i}next(t){const{destination:i}=this;i&&i.next&&i.next(t)}error(t){const{destination:i}=this;i&&i.error&&this.destination.error(t)}complete(){const{destination:t}=this;t&&t.complete&&this.destination.complete()}_subscribe(t){const{source:i}=this;return i?this.source.subscribe(t):un.EMPTY}}class jr extends vn{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const i=super._subscribe(t);return i&&!i.closed&&t.next(this._value),i}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new mn;return this._value}next(t){super.next(this._value=t)}}function hn(e){return e&&"function"==typeof e.schedule}function Xt(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new lr(e,t))}}class lr{constructor(t,i){this.project=t,this.thisArg=i}call(t,i){return i.subscribe(new vr(t,this.project,this.thisArg))}}class vr extends Gn{constructor(t,i,n){super(t),this.project=i,this.count=0,this.thisArg=n||this}_next(t){let i;try{i=this.project.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(i)}}const xa=e=>t=>{for(let i=0,n=e.length;i<n&&!t.closed;i++)t.next(e[i]);t.complete()},Oo=function el(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}(),tl=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Xl(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}const Dn=e=>{if(e&&"function"==typeof e[oo])return(e=>t=>{const i=e[oo]();if("function"!=typeof i.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return i.subscribe(t)})(e);if(tl(e))return xa(e);if(Xl(e))return(e=>t=>(e.then(i=>{t.closed||(t.next(i),t.complete())},i=>t.error(i)).then(null,f),t))(e);if(e&&"function"==typeof e[Oo])return(e=>t=>{const i=e[Oo]();for(;;){let n;try{n=i.next()}catch(r){return t.error(r),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof i.return&&t.add(()=>{i.return&&i.return()}),t})(e);{const i=`You provided ${Po(e)?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(i)}};function Kl(e,t){return new ot(i=>{const n=new un;let r=0;return n.add(t.schedule(function(){r!==e.length?(i.next(e[r++]),i.closed||n.add(this.schedule())):i.complete()})),n})}function ei(e,t){return t?function Ca(e,t){if(null!=e){if(function Ko(e){return e&&"function"==typeof e[oo]}(e))return function Wc(e,t){return new ot(i=>{const n=new un;return n.add(t.schedule(()=>{const r=e[oo]();n.add(r.subscribe({next(s){n.add(t.schedule(()=>i.next(s)))},error(s){n.add(t.schedule(()=>i.error(s)))},complete(){n.add(t.schedule(()=>i.complete()))}}))})),n})}(e,t);if(Xl(e))return function Fo(e,t){return new ot(i=>{const n=new un;return n.add(t.schedule(()=>e.then(r=>{n.add(t.schedule(()=>{i.next(r),n.add(t.schedule(()=>i.complete()))}))},r=>{n.add(t.schedule(()=>i.error(r)))}))),n})}(e,t);if(tl(e))return Kl(e,t);if(function Uu(e){return e&&"function"==typeof e[Oo]}(e)||"string"==typeof e)return function Ei(e,t){if(!e)throw new Error("Iterable cannot be null");return new ot(i=>{const n=new un;let r;return n.add(()=>{r&&"function"==typeof r.return&&r.return()}),n.add(t.schedule(()=>{r=e[Oo](),n.add(t.schedule(function(){if(i.closed)return;let s,d;try{const m=r.next();s=m.value,d=m.done}catch(m){return void i.error(m)}d?i.complete():(i.next(s),this.schedule())}))})),n})}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof ot?e:new ot(Dn(e))}class $s extends Gn{constructor(t){super(),this.parent=t}_next(t){this.parent.notifyNext(t)}_error(t){this.parent.notifyError(t),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class Hs extends Gn{notifyNext(t){this.destination.next(t)}notifyError(t){this.destination.error(t)}notifyComplete(){this.destination.complete()}}function _s(e,t){if(t.closed)return;if(e instanceof ot)return e.subscribe(t);let i;try{i=Dn(e)(t)}catch(n){t.error(n)}return i}function er(e,t,i=Number.POSITIVE_INFINITY){return"function"==typeof t?n=>n.pipe(er((r,s)=>ei(e(r,s)).pipe(Xt((d,m)=>t(r,d,s,m))),i)):("number"==typeof t&&(i=t),n=>n.lift(new $u(e,i)))}class $u{constructor(t,i=Number.POSITIVE_INFINITY){this.project=t,this.concurrent=i}call(t,i){return i.subscribe(new Qo(t,this.project,this.concurrent))}}class Qo extends Hs{constructor(t,i,n=Number.POSITIVE_INFINITY){super(t),this.project=i,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)}_tryNext(t){let i;const n=this.index++;try{i=this.project(t,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(i)}_innerSub(t){const i=new $s(this),n=this.destination;n.add(i);const r=_s(t,i);r!==i&&n.add(r)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(t){this.destination.next(t)}notifyComplete(){const t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function Gs(e=Number.POSITIVE_INFINITY){return er(Us,e)}function gs(e,t){return t?Kl(e,t):new ot(xa(e))}function Da(...e){let t=Number.POSITIVE_INFINITY,i=null,n=e[e.length-1];return hn(n)?(i=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof n&&(t=e.pop()),null===i&&1===e.length&&e[0]instanceof ot?e[0]:Gs(t)(gs(e,i))}function Vt(...e){let t=e[e.length-1];return hn(t)?(e.pop(),Kl(e,t)):gs(e)}function qs(){return function(t){return t.lift(new nl(t))}}class nl{constructor(t){this.connectable=t}call(t,i){const{connectable:n}=this;n._refCount++;const r=new ec(t,n),s=i.subscribe(r);return r.closed||(r.connection=n.connect()),s}}class ec extends Gn{constructor(t,i){super(t),this.connectable=i}_unsubscribe(){const{connectable:t}=this;if(!t)return void(this.connection=null);this.connectable=null;const i=t._refCount;if(i<=0)return void(this.connection=null);if(t._refCount=i-1,i>1)return void(this.connection=null);const{connection:n}=this,r=t._connection;this.connection=null,r&&(!n||r===n)&&r.unsubscribe()}}class Ea extends ot{constructor(t,i){super(),this.source=t,this.subjectFactory=i,this._refCount=0,this._isComplete=!1}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let t=this._connection;return t||(this._isComplete=!1,t=this._connection=new un,t.add(this.source.subscribe(new Hu(this.getSubject(),this))),t.closed&&(this._connection=null,t=un.EMPTY)),t}refCount(){return qs()(this)}}const Zc=(()=>{const e=Ea.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}})();class Hu extends Vu{constructor(t,i){super(t),this.connectable=i}_error(t){this._unsubscribe(),super._error(t)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const t=this.connectable;if(t){this.connectable=null;const i=t._connection;t._refCount=0,t._subject=null,t._connection=null,i&&i.unsubscribe()}}}class fe{constructor(t,i){this.subjectFactory=t,this.selector=i}call(t,i){const{selector:n}=this,r=this.subjectFactory(),s=n(r).subscribe(t);return s.add(i.subscribe(r)),s}}function we(){return new vn}function Me(){return e=>qs()(function X(e,t){return function(n){let r;if(r="function"==typeof e?e:function(){return e},"function"==typeof t)return n.lift(new fe(r,t));const s=Object.create(n,Zc);return s.source=n,s.subjectFactory=r,s}}(we)(e))}function Fe(e,t){return"function"==typeof t?i=>i.pipe(Fe((n,r)=>ei(e(n,r)).pipe(Xt((s,d)=>t(n,s,r,d))))):i=>i.lift(new Ne(e))}class Ne{constructor(t){this.project=t}call(t,i){return i.subscribe(new Ae(t,this.project))}}class Ae extends Hs{constructor(t,i){super(t),this.project=i,this.index=0}_next(t){let i;const n=this.index++;try{i=this.project(t,n)}catch(r){return void this.destination.error(r)}this._innerSub(i)}_innerSub(t){const i=this.innerSubscription;i&&i.unsubscribe();const n=new $s(this),r=this.destination;r.add(n),this.innerSubscription=_s(t,n),this.innerSubscription!==n&&r.add(this.innerSubscription)}_complete(){const{innerSubscription:t}=this;(!t||t.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(t){this.destination.next(t)}}function Ue(e,t){return i=>i.lift(new ht(e,t))}class ht{constructor(t,i){this.compare=t,this.keySelector=i}call(t,i){return i.subscribe(new _t(t,this.compare,this.keySelector))}}class _t extends Gn{constructor(t,i,n){super(t),this.keySelector=n,this.hasKey=!1,"function"==typeof i&&(this.compare=i)}compare(t,i){return t===i}_next(t){let i;try{const{keySelector:r}=this;i=r?r(t):t}catch(r){return this.destination.error(r)}let n=!1;if(this.hasKey)try{const{compare:r}=this;n=r(this.key,i)}catch(r){return this.destination.error(r)}else this.hasKey=!0;n||(this.key=i,this.destination.next(t))}}function Xe(e){for(let t in e)if(e[t]===Xe)return t;throw Error("Could not find renamed property on target object.")}function Kt(e,t){for(const i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=t[i])}function Ut(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Ut).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const i=t.indexOf("\n");return-1===i?t:t.substring(0,i)}function tn(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const bn=Xe({__forward_ref__:Xe});function wt(e){return e.__forward_ref__=wt,e.toString=function(){return Ut(this())},e}function Pt(e){return Fi(e)?e():e}function Fi(e){return"function"==typeof e&&e.hasOwnProperty(bn)&&e.__forward_ref__===wt}function br(e){return e&&!!e.\u0275providers}const ys="https://g.co/ng/security#xss";class He extends Error{constructor(t,i){super(function xr(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,i)),this.code=t}}function nn(e){return"string"==typeof e?e:null==e?"":String(e)}function tc(e,t){throw new He(-201,!1)}function No(e,t){null==e&&function qt(e,t,i,n){throw new Error(`ASSERTION ERROR: ${e}`+(null==n?"":` [Expected=> ${i} ${n} ${t} <=Actual]`))}(t,e,null,"!=")}function Re(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function yt(e){return{providers:e.providers||[],imports:e.imports||[]}}function Ur(e){return xn(e,Zs)||xn(e,_i)}function xn(e,t){return e.hasOwnProperty(t)?e[t]:null}function sl(e){return e&&(e.hasOwnProperty(vo)||e.hasOwnProperty($m))?e[vo]:null}const Zs=Xe({\u0275prov:Xe}),vo=Xe({\u0275inj:Xe}),_i=Xe({ngInjectableDef:Xe}),$m=Xe({ngInjectorDef:Xe});var pn=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(pn||{});let nc;function $r(e){const t=nc;return nc=e,t}function Ap(e,t,i){const n=Ur(e);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:i&pn.Optional?null:void 0!==t?t:void tc(Ut(e))}const Kn=globalThis,bs={},dr="__NG_DI_FLAG__",Kc="ngTempTokenPath",Sa=/\n/gm,zd="__source";let Qc;function Bo(e){const t=Qc;return Qc=e,t}function Ys(e,t=pn.Default){if(void 0===Qc)throw new He(-203,!1);return null===Qc?Ap(e,void 0,t):Qc.get(e,t&pn.Optional?null:void 0,t)}function je(e,t=pn.Default){return(function Xc(){return nc}()||Ys)(Pt(e),t)}function ft(e,t=pn.Default){return je(e,cl(t))}function cl(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function xs(e){const t=[];for(let i=0;i<e.length;i++){const n=Pt(e[i]);if(Array.isArray(n)){if(0===n.length)throw new He(900,!1);let r,s=pn.Default;for(let d=0;d<n.length;d++){const m=n[d],b=Jc(m);"number"==typeof b?-1===b?r=m.token:s|=b:r=m}t.push(je(r,s))}else t.push(je(n))}return t}function dl(e,t){return e[dr]=t,e.prototype[dr]=t,e}function Jc(e){return e[dr]}function Jo(e){return{toString:e}.toString()}var ed=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(ed||{}),wo=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(wo||{});const ao={},jt=[],Xu=Xe({\u0275cmp:Xe}),jd=Xe({\u0275dir:Xe}),Ku=Xe({\u0275pipe:Xe}),Qu=Xe({\u0275mod:Xe}),Xs=Xe({\u0275fac:Xe}),ic=Xe({__NG_ELEMENT_ID__:Xe}),rc=Xe({__NG_ENV_ID__:Xe});function Ud(e,t,i){let n=e.length;for(;;){const r=e.indexOf(t,i);if(-1===r)return r;if(0===r||e.charCodeAt(r-1)<=32){const s=t.length;if(r+s===n||e.charCodeAt(r+s)<=32)return r}i=r+1}}function ul(e,t,i){let n=0;for(;n<i.length;){const r=i[n];if("number"==typeof r){if(0!==r)break;n++;const s=i[n++],d=i[n++],m=i[n++];e.setAttribute(t,d,m,s)}else{const s=r,d=i[++n];hl(s)?e.setProperty(t,s,d):e.setAttribute(t,s,d),n++}}return n}function Ks(e){return 3===e||4===e||6===e}function hl(e){return 64===e.charCodeAt(0)}function pl(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let i=-1;for(let n=0;n<t.length;n++){const r=t[n];"number"==typeof r?i=r:0===i||Pp(e,i,r,null,-1===i||2===i?t[++n]:null)}}return e}function Pp(e,t,i,n,r){let s=0,d=e.length;if(-1===t)d=-1;else for(;s<e.length;){const m=e[s++];if("number"==typeof m){if(m===t){d=-1;break}if(m>t){d=s-1;break}}}for(;s<e.length;){const m=e[s];if("number"==typeof m)break;if(m===i){if(null===n)return void(null!==r&&(e[s+1]=r));if(n===e[s+1])return void(e[s+2]=r)}s++,null!==n&&s++,null!==r&&s++}-1!==d&&(e.splice(d,0,t),s=d+1),e.splice(s++,0,i),null!==n&&e.splice(s++,0,n),null!==r&&e.splice(s++,0,r)}const td="ng-template";function Op(e,t,i){let n=0,r=!0;for(;n<e.length;){let s=e[n++];if("string"==typeof s&&r){const d=e[n++];if(i&&"class"===s&&-1!==Ud(d.toLowerCase(),t,0))return!0}else{if(1===s){for(;n<e.length&&"string"==typeof(s=e[n++]);)if(s.toLowerCase()===t)return!0;return!1}"number"==typeof s&&(r=!1)}}return!1}function Ju(e){return 4===e.type&&e.value!==td}function eh(e,t,i){return t===(4!==e.type||i?e.value:td)}function th(e,t,i){let n=4;const r=e.attrs||[],s=function Fp(e){for(let t=0;t<e.length;t++)if(Ks(e[t]))return t;return e.length}(r);let d=!1;for(let m=0;m<t.length;m++){const b=t[m];if("number"!=typeof b){if(!d)if(4&n){if(n=2|1&n,""!==b&&!eh(e,b,i)||""===b&&1===t.length){if(zo(n))return!1;d=!0}}else{const E=8&n?b:t[++m];if(8&n&&null!==e.attrs){if(!Op(e.attrs,E,i)){if(zo(n))return!1;d=!0}continue}const O=Ln(8&n?"class":b,r,Ju(e),i);if(-1===O){if(zo(n))return!1;d=!0;continue}if(""!==E){let q;q=O>s?"":r[O+1].toLowerCase();const Y=8&n?q:null;if(Y&&-1!==Ud(Y,E,0)||2&n&&E!==q){if(zo(n))return!1;d=!0}}}}else{if(!d&&!zo(n)&&!zo(b))return!1;if(d&&zo(b))continue;d=!1,n=b|1&n}}return zo(n)||d}function zo(e){return 0==(1&e)}function Ln(e,t,i,n){if(null===t)return-1;let r=0;if(n||!i){let s=!1;for(;r<t.length;){const d=t[r];if(d===e)return r;if(3===d||6===d)s=!0;else{if(1===d||2===d){let m=t[++r];for(;"string"==typeof m;)m=t[++r];continue}if(4===d)break;if(0===d){r+=4;continue}}r+=s?1:2}return-1}return function Wm(e,t){let i=e.indexOf(4);if(i>-1)for(i++;i<e.length;){const n=e[i];if("number"==typeof n)return-1;if(n===t)return i;i++}return-1}(t,e)}function nd(e,t,i=!1){for(let n=0;n<t.length;n++)if(th(e,t[n],i))return!0;return!1}function oc(e,t){e:for(let i=0;i<t.length;i++){const n=t[i];if(e.length===n.length){for(let r=0;r<e.length;r++)if(e[r]!==n[r])continue e;return!0}}return!1}function nh(e,t){return e?":not("+t.trim()+")":t}function vy(e){let t=e[0],i=1,n=2,r="",s=!1;for(;i<e.length;){let d=e[i];if("string"==typeof d)if(2&n){const m=e[++i];r+="["+d+(m.length>0?'="'+m+'"':"")+"]"}else 8&n?r+="."+d:4&n&&(r+=" "+d);else""!==r&&!zo(d)&&(t+=nh(s,r),r=""),n=d,s=s||!zo(n);i++}return""!==r&&(t+=nh(s,r)),t}function In(e){return Jo(()=>{const t=rh(e),i={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===ed.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||wo.Emulated,styles:e.styles||jt,_:null,schemas:e.schemas||null,tView:null,id:""};$d(i);const n=e.dependencies;return i.directiveDefs=Hd(n,!1),i.pipeDefs=Hd(n,!0),i.id=function wy(e){let t=0;const i=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const r of i)t=Math.imul(31,t)+r.charCodeAt(0)<<0;return t+=2147483648,"c"+t}(i),i})}function Lp(e){return zn(e)||qi(e)}function ih(e){return null!==e}function Qt(e){return Jo(()=>({type:e.type,bootstrap:e.bootstrap||jt,declarations:e.declarations||jt,imports:e.imports||jt,exports:e.exports||jt,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function Ym(e,t){if(null==e)return ao;const i={};for(const n in e)if(e.hasOwnProperty(n)){let r=e[n],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),i[r]=n,t&&(t[r]=s)}return i}function gt(e){return Jo(()=>{const t=rh(e);return $d(t),t})}function tr(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function zn(e){return e[Xu]||null}function qi(e){return e[jd]||null}function Mr(e){return e[Ku]||null}function Gr(e,t){const i=e[Qu]||null;if(!i&&!0===t)throw new Error(`Type ${Ut(e)} does not have '\u0275mod' property.`);return i}function rh(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||ao,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||jt,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Ym(e.inputs,t),outputs:Ym(e.outputs)}}function $d(e){e.features?.forEach(t=>t(e))}function Hd(e,t){if(!e)return null;const i=t?Mr:Lp;return()=>("function"==typeof e?e():e).map(n=>i(n)).filter(ih)}const Ni=0,It=1,an=2,Ti=3,Vo=4,Gd=5,wr=6,sc=7,Si=8,Ma=9,Aa=10,fn=11,Qs=12,Xm=13,id=14,Wi=15,qd=16,rd=17,ws=18,fl=19,ac=20,Ia=21,Js=22,es=23,lc=24,ln=25,sh=1,ml=2,co=7,Ra=9,Zi=11;function Ar(e){return Array.isArray(e)&&"object"==typeof e[sh]}function ur(e){return Array.isArray(e)&&!0===e[sh]}function ah(e){return 0!=(4&e.flags)}function ea(e){return e.componentOffset>-1}function ts(e){return 1==(1&e.flags)}function ns(e){return!!e.template}function od(e){return 0!=(512&e[an])}function _l(e,t){return e.hasOwnProperty(Xs)?e[Xs]:null}let Qd=Kn.WeakRef??class hh{constructor(t){this.ref=t}deref(){return this.ref}},n_=0,is=null,eu=!1;function Mi(e){const t=is;return is=e,t}class Hp{constructor(){this.id=n_++,this.ref=function Jd(e){return new Qd(e)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[t,i]of this.producers){const n=i.producerNode.deref();if(null!=n&&i.atTrackingVersion===this.trackingVersion){if(n.producerPollStatus(i.seenValueVersion))return!0}else this.producers.delete(t),n?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const t=eu;eu=!0;try{for(const[i,n]of this.consumers){const r=n.consumerNode.deref();null!=r&&r.trackingVersion===n.atTrackingVersion?r.onConsumerDependencyMayHaveChanged():(this.consumers.delete(i),r?.producers.delete(this.id))}}finally{eu=t}}producerAccessed(){if(eu)throw new Error("");if(null===is)return;let t=is.producers.get(this.id);void 0===t?(t={consumerNode:is.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:is.trackingVersion},is.producers.set(this.id,t),this.consumers.set(is.id,t)):(t.seenValueVersion=this.valueVersion,t.atTrackingVersion=is.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==is?.consumerAllowSignalWrites}producerPollStatus(t){return this.valueVersion!==t||(this.onProducerUpdateValueVersion(),this.valueVersion!==t)}}let Rr=null;const rs=()=>{};class na extends Hp{constructor(t,i,n){super(),this.watch=t,this.schedule=i,this.dirty=!1,this.cleanupFn=rs,this.registerOnCleanup=r=>{this.cleanupFn=r},this.consumerAllowSignalWrites=n}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const t=Mi(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=rs,this.watch(this.registerOnCleanup)}finally{Mi(t)}}cleanup(){this.cleanupFn()}}class uc{constructor(t,i,n){this.previousValue=t,this.currentValue=i,this.firstChange=n}isFirstChange(){return this.firstChange}}function Ci(){return Et}function Et(e){return e.type.prototype.ngOnChanges&&(e.setInput=Zp),Wp}function Wp(){const e=gl(this),t=e?.current;if(t){const i=e.previous;if(i===ao)e.previous=t;else for(let n in t)i[n]=t[n];e.current=null,this.ngOnChanges(t)}}function Zp(e,t,i,n){const r=this.declaredInputs[i],s=gl(e)||function xt(e,t){return e[hc]=t}(e,{previous:ao,current:null}),d=s.current||(s.current={}),m=s.previous,b=m[r];d[r]=new uc(b&&b.currentValue,t,m===ao),e[n]=t}Ci.ngInherit=!0;const hc="__ngSimpleChanges__";function gl(e){return e[hc]||null}const Ds=function(e,t,i){};function gi(e){for(;Array.isArray(e);)e=e[Ni];return e}function _h(e,t){return gi(t[e])}function qr(e,t){return gi(t[e.index])}function gh(e,t){return e.data[t]}function Es(e,t){return e[t]}function _(e,t){const i=t[e];return Ar(i)?i:i[Ni]}function x(e,t){return null==t?null:e[t]}function C(e){e[rd]=0}function S(e){1024&e[an]||(e[an]|=1024,k(e,1))}function M(e){1024&e[an]&&(e[an]&=-1025,k(e,-1))}function k(e,t){let i=e[Ti];if(null===i)return;i[Gd]+=t;let n=i;for(i=i[Ti];null!==i&&(1===t&&1===n[Gd]||-1===t&&0===n[Gd]);)i[Gd]+=t,n=i,i=i[Ti]}const V={lFrame:Vn(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function U(){return V.bindingsEnabled}function J(){return null!==V.skipHydrationRootTNode}function ce(){return V.lFrame.lView}function De(){return V.lFrame.tView}function _e(e){return V.lFrame.contextLView=e,e[Si]}function Ie(e){return V.lFrame.contextLView=null,e}function Pe(){let e=Ke();for(;null!==e&&64===e.type;)e=e.parent;return e}function Ke(){return V.lFrame.currentTNode}function et(e,t){const i=V.lFrame;i.currentTNode=e,i.isParent=t}function Be(){return V.lFrame.isParent}function Ye(){V.lFrame.isParent=!1}function Tt(){const e=V.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function Lt(){return V.lFrame.bindingIndex++}function Jt(e){const t=V.lFrame,i=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,i}function Wn(e,t){const i=V.lFrame;i.bindingIndex=i.bindingRootIndex=e,Yn(t)}function Yn(e){V.lFrame.currentDirectiveIndex=e}function kr(){return V.lFrame.currentQueryIndex}function nr(e){V.lFrame.currentQueryIndex=e}function os(e){const t=e[It];return 2===t.type?t.declTNode:1===t.type?e[wr]:null}function Ts(e,t,i){if(i&pn.SkipSelf){let r=t,s=e;for(;!(r=r.parent,null!==r||i&pn.Host||(r=os(s),null===r||(s=s[id],10&r.type))););if(null===r)return!1;t=r,e=s}const n=V.lFrame=Qn();return n.currentTNode=t,n.lView=e,!0}function fi(e){const t=Qn(),i=e[It];V.lFrame=t,t.currentTNode=i.firstChild,t.lView=e,t.tView=i,t.contextLView=e,t.bindingIndex=i.bindingStartIndex,t.inI18n=!1}function Qn(){const e=V.lFrame,t=null===e?null:e.child;return null===t?Vn(e):t}function Vn(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function zi(){const e=V.lFrame;return V.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Wr=zi;function ai(){const e=zi();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Yi(){return V.lFrame.selectedIndex}function Ss(e){V.lFrame.selectedIndex=e}function Jn(){const e=V.lFrame;return gh(e.tView,e.selectedIndex)}let Ry=!0;function Kp(){return Ry}function cd(e){Ry=e}function ru(e,t){for(let i=t.directiveStart,n=t.directiveEnd;i<n;i++){const s=e.data[i].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:m,ngAfterViewInit:b,ngAfterViewChecked:E,ngOnDestroy:I}=s;d&&(e.contentHooks??=[]).push(-i,d),m&&((e.contentHooks??=[]).push(i,m),(e.contentCheckHooks??=[]).push(i,m)),b&&(e.viewHooks??=[]).push(-i,b),E&&((e.viewHooks??=[]).push(i,E),(e.viewCheckHooks??=[]).push(i,E)),null!=I&&(e.destroyHooks??=[]).push(i,I)}}function Qp(e,t,i){yl(e,t,3,i)}function bh(e,t,i,n){(3&e[an])===i&&yl(e,t,i,n)}function xh(e,t){let i=e[an];(3&i)===t&&(i&=8191,i+=1,e[an]=i)}function yl(e,t,i,n){const s=n??-1,d=t.length-1;let m=0;for(let b=void 0!==n?65535&e[rd]:0;b<d;b++)if("number"==typeof t[b+1]){if(m=t[b],null!=n&&m>=n)break}else t[b]<0&&(e[rd]+=65536),(m<s||-1==s)&&(cb(e,i,t,b),e[rd]=(4294901760&e[rd])+b+2),b++}function Jp(e,t){Ds(4,e,t);const i=Mi(null);try{t.call(e)}finally{Mi(i),Ds(5,e,t)}}function cb(e,t,i,n){const r=i[n]<0,s=i[n+1],m=e[r?-i[n]:i[n]];r?e[an]>>13<e[rd]>>16&&(3&e[an])===t&&(e[an]+=8192,Jp(m,s)):Jp(m,s)}const ou=-1;class ef{constructor(t,i,n){this.factory=t,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=n}}function bl(e){return e!==ou}function Pa(e){return 32767&e}function nf(e,t){let i=function dC(e){return e>>16}(e),n=t;for(;i>0;)n=n[id],i--;return n}let Py=!0;function a_(e){const t=Py;return Py=e,t}const Oy=255,ia=5;let hC=0;const xl={};function Bt(e,t){const i=rf(e,t);if(-1!==i)return i;const n=t[It];n.firstCreatePass&&(e.injectorIndex=t.length,wl(n.data,e),wl(t,null),wl(n.blueprint,null));const r=uo(e,t),s=e.injectorIndex;if(bl(r)){const d=Pa(r),m=nf(r,t),b=m[It].data;for(let E=0;E<8;E++)t[s+E]=m[d+E]|b[d+E]}return t[s+8]=r,s}function wl(e,t){e.push(0,0,0,0,0,0,0,0,t)}function rf(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function uo(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let i=0,n=null,r=t;for(;null!==r;){if(n=Th(r),null===n)return ou;if(i++,r=r[id],-1!==n.injectorIndex)return n.injectorIndex|i<<16}return ou}function l_(e,t,i){!function Xi(e,t,i){let n;"string"==typeof i?n=i.charCodeAt(0)||0:i.hasOwnProperty(ic)&&(n=i[ic]),null==n&&(n=i[ic]=hC++);const r=n&Oy;t.data[e+(r>>ia)]|=1<<r}(e,t,i)}function ra(e,t,i){if(i&pn.Optional||void 0!==e)return e;tc()}function c_(e,t,i,n){if(i&pn.Optional&&void 0===n&&(n=null),!(i&(pn.Self|pn.Host))){const r=e[Ma],s=$r(void 0);try{return r?r.get(t,n,i&pn.Optional):Ap(t,n,i&pn.Optional)}finally{$r(s)}}return ra(n,0,i)}function dd(e,t,i,n=pn.Default,r){if(null!==e){if(2048&t[an]&&!(n&pn.Self)){const d=function fb(e,t,i,n,r){let s=e,d=t;for(;null!==s&&null!==d&&2048&d[an]&&!(512&d[an]);){const m=Ch(s,d,i,n|pn.Self,xl);if(m!==xl)return m;let b=s.parent;if(!b){const E=d[ac];if(E){const I=E.get(i,xl,n);if(I!==xl)return I}b=Th(d),d=d[id]}s=b}return r}(e,t,i,n,xl);if(d!==xl)return d}const s=Ch(e,t,i,n,xl);if(s!==xl)return s}return c_(t,i,n,r)}function Ch(e,t,i,n,r){const s=function ub(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(ic)?e[ic]:void 0;return"number"==typeof t?t>=0?t&Oy:Eh:t}(i);if("function"==typeof s){if(!Ts(t,e,n))return n&pn.Host?ra(r,0,n):c_(t,i,n,r);try{let d;if(d=s(n),null!=d||n&pn.Optional)return d;tc()}finally{Wr()}}else if("number"==typeof s){let d=null,m=rf(e,t),b=ou,E=n&pn.Host?t[Wi][wr]:null;for((-1===m||n&pn.SkipSelf)&&(b=-1===m?uo(e,t):t[m+8],b!==ou&&hb(n,!1)?(d=t[It],m=Pa(b),t=nf(b,t)):m=-1);-1!==m;){const I=t[It];if(Fy(s,m,I.data)){const O=au(m,t,i,d,n,E);if(O!==xl)return O}b=t[m+8],b!==ou&&hb(n,t[It].data[m+8]===E)&&Fy(s,m,t)?(d=I,m=Pa(b),t=nf(b,t)):m=-1}}return r}function au(e,t,i,n,r,s){const d=t[It],m=d.data[e+8],I=Dh(m,d,i,null==n?ea(m)&&Py:n!=d&&0!=(3&m.type),r&pn.Host&&s===m);return null!==I?Cl(t,d,I,m):xl}function Dh(e,t,i,n,r){const s=e.providerIndexes,d=t.data,m=1048575&s,b=e.directiveStart,I=s>>20,q=r?m+I:e.directiveEnd;for(let Y=n?m:m+I;Y<q;Y++){const pe=d[Y];if(Y<b&&i===pe||Y>=b&&pe.type===i)return Y}if(r){const Y=d[b];if(Y&&ns(Y)&&Y.type===i)return b}return null}function Cl(e,t,i,n){let r=e[i];const s=t.data;if(function cC(e){return e instanceof ef}(r)){const d=r;d.resolving&&function Vm(e,t){const i=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new He(-200,`Circular dependency in DI detected for ${e}${i}`)}(function ti(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():nn(e)}(s[i]));const m=a_(d.canSeeViewProviders);d.resolving=!0;const E=d.injectImpl?$r(d.injectImpl):null;Ts(e,n,pn.Default);try{r=e[i]=d.factory(void 0,s,e,n),t.firstCreatePass&&i>=n.directiveStart&&function ky(e,t,i){const{ngOnChanges:n,ngOnInit:r,ngDoCheck:s}=t.type.prototype;if(n){const d=Et(t);(i.preOrderHooks??=[]).push(e,d),(i.preOrderCheckHooks??=[]).push(e,d)}r&&(i.preOrderHooks??=[]).push(0-e,r),s&&((i.preOrderHooks??=[]).push(e,s),(i.preOrderCheckHooks??=[]).push(e,s))}(i,s[i],t)}finally{null!==E&&$r(E),a_(m),d.resolving=!1,Wr()}}return r}function Fy(e,t,i){return!!(i[t+(e>>ia)]&1<<e)}function hb(e,t){return!(e&pn.Self||e&pn.Host&&t)}class Pr{constructor(t,i){this._tNode=t,this._lView=i}get(t,i,n){return dd(this._tNode,this._lView,t,cl(n),i)}}function Eh(){return new Pr(Pe(),ce())}function mi(e){return Jo(()=>{const t=e.prototype.constructor,i=t[Xs]||sf(t),n=Object.prototype;let r=Object.getPrototypeOf(e.prototype).constructor;for(;r&&r!==n;){const s=r[Xs]||sf(r);if(s&&s!==i)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function sf(e){return Fi(e)?()=>{const t=sf(Pt(e));return t&&t()}:_l(e)}function Th(e){const t=e[It],i=t.type;return 2===i?t.declTNode:1===i?e[wr]:null}function oa(e){return function db(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const i=e.attrs;if(i){const n=i.length;let r=0;for(;r<n;){const s=i[r];if(Ks(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<n&&"string"==typeof i[r];)r++;else{if(s===t)return i[r+1];r+=2}}}return null}(Pe(),e)}const Dl="__parameters__";function yi(e,t,i){return Jo(()=>{const n=function af(e){return function(...i){if(e){const n=e(...i);for(const r in n)this[r]=n[r]}}}(t);function r(...s){if(this instanceof r)return n.apply(this,s),this;const d=new r(...s);return m.annotation=d,m;function m(b,E,I){const O=b.hasOwnProperty(Dl)?b[Dl]:Object.defineProperty(b,Dl,{value:[]})[Dl];for(;O.length<=I;)O.push(null);return(O[I]=O[I]||[]).push(d),b}}return i&&(r.prototype=Object.create(i.prototype)),r.prototype.ngMetadataName=e,r.annotationCls=r,r})}function Tl(e,t){e.forEach(i=>Array.isArray(i)?Tl(i,t):t(i))}function d_(e,t,i){t>=e.length?e.push(i):e.splice(t,0,i)}function Mh(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function du(e,t){const i=[];for(let n=0;n<e;n++)i.push(t);return i}function Is(e,t,i){let n=Sl(e,t);return n>=0?e[1|n]=i:(n=~n,function vb(e,t,i,n){let r=e.length;if(r==t)e.push(i,n);else if(1===r)e.push(n,e[0]),e[0]=i;else{for(r--,e.push(e[r-1],e[r]);r>t;)e[r]=e[r-2],r--;e[t]=i,e[t+1]=n}}(e,n,t,i)),n}function _c(e,t){const i=Sl(e,t);if(i>=0)return e[1|i]}function Sl(e,t){return function Rs(e,t,i){let n=0,r=e.length>>i;for(;r!==n;){const s=n+(r-n>>1),d=e[s<<i];if(t===d)return s<<i;d>t?r=s:n=s+1}return~(r<<i)}(e,t,1)}const Al=dl(yi("Optional"),8),Il=dl(yi("SkipSelf"),4);function Rh(e){return 128==(128&e.flags)}var Fl=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Fl||{});const Ib=/^>|^->|<!--|-->|--!>|<!-$/g,Rb=/(<|>)/,_u="\u200b$1\u200b";const $y=new Map;let kh=0;const Wy="__ngContext__";function Eo(e,t){Ar(t)?(e[Wy]=t[fl],function kb(e){$y.set(e[fl],e)}(t)):e[Wy]=t}let mf;function Oh(e,t){return mf(e,t)}function Na(e){const t=e[Ti];return ur(t)?t[Ti]:t}function Nb(e){return Bb(e[Qs])}function Lb(e){return Bb(e[Vo])}function Bb(e){for(;null!==e&&!ur(e);)e=e[Vo];return e}function Fh(e,t,i,n,r){if(null!=n){let s,d=!1;ur(n)?s=n:Ar(n)&&(d=!0,n=n[Ni]);const m=gi(n);0===e&&null!==i?null==r?Jy(t,i,m):gu(t,i,m,r||null,!0):1===e&&null!==i?gu(t,i,m,r||null,!0):2===e?function A_(e,t,i){const n=T_(e,t);n&&function SC(e,t,i,n){e.removeChild(t,i,n)}(e,n,t,i)}(t,m,d):3===e&&t.destroyNode(m),null!=s&&function qb(e,t,i,n,r){const s=i[co];s!==gi(i)&&Fh(t,e,n,s,r);for(let m=Zi;m<i.length;m++){const b=i[m];Cf(b[It],b,e,t,n,s)}}(t,e,s,i,r)}}function gf(e,t){return e.createComment(function Uy(e){return e.replace(Ib,t=>t.replace(Rb,_u))}(t))}function b_(e,t,i){return e.createElement(t,i)}function yf(e,t){const i=e[Ra],n=i.indexOf(t);M(t),i.splice(n,1)}function hd(e,t){if(e.length<=Zi)return;const i=Zi+t,n=e[i];if(n){const r=n[qd];null!==r&&r!==e&&yf(r,n),t>0&&(e[i-1][Vo]=n[Vo]);const s=Mh(e,Zi+t);!function Nh(e,t){Cf(e,t,t[fn],2,null,null),t[Ni]=null,t[wr]=null}(n[It],n);const d=s[ws];null!==d&&d.detachView(s[It]),n[Ti]=null,n[Vo]=null,n[an]&=-129}return n}function C_(e,t){if(!(256&t[an])){const i=t[fn];t[es]?.destroy(),t[lc]?.destroy(),i.destroyNode&&Cf(e,t,i,3,null,null),function x_(e){let t=e[Qs];if(!t)return D_(e[It],e);for(;t;){let i=null;if(Ar(t))i=t[Qs];else{const n=t[Zi];n&&(i=n)}if(!i){for(;t&&!t[Vo]&&t!==e;)Ar(t)&&D_(t[It],t),t=t[Ti];null===t&&(t=e),Ar(t)&&D_(t[It],t),i=t&&t[Vo]}t=i}}(t)}}function D_(e,t){if(!(256&t[an])){t[an]&=-129,t[an]|=256,function Qy(e,t){let i;if(null!=e&&null!=(i=e.destroyHooks))for(let n=0;n<i.length;n+=2){const r=t[i[n]];if(!(r instanceof ef)){const s=i[n+1];if(Array.isArray(s))for(let d=0;d<s.length;d+=2){const m=r[s[d]],b=s[d+1];Ds(4,m,b);try{b.call(m)}finally{Ds(5,m,b)}}else{Ds(4,r,s);try{s.call(r)}finally{Ds(5,r,s)}}}}}(e,t),function vf(e,t){const i=e.cleanup,n=t[sc];if(null!==i)for(let s=0;s<i.length-1;s+=2)if("string"==typeof i[s]){const d=i[s+3];d>=0?n[d]():n[-d].unsubscribe(),s+=2}else i[s].call(n[i[s+1]]);null!==n&&(t[sc]=null);const r=t[Ia];if(null!==r){t[Ia]=null;for(let s=0;s<r.length;s++)(0,r[s])()}}(e,t),1===t[It].type&&t[fn].destroy();const i=t[qd];if(null!==i&&ur(t[Ti])){i!==t[Ti]&&yf(i,t);const n=t[ws];null!==n&&n.detachView(e)}!function xC(e){$y.delete(e[fl])}(t)}}function bf(e,t,i){return function E_(e,t,i){let n=t;for(;null!==n&&40&n.type;)n=(t=n).parent;if(null===n)return i[Ni];{const{componentOffset:r}=n;if(r>-1){const{encapsulation:s}=e.data[n.directiveStart+r];if(s===wo.None||s===wo.Emulated)return null}return qr(n,i)}}(e,t.parent,i)}function gu(e,t,i,n,r){e.insertBefore(t,i,n,r)}function Jy(e,t,i){e.appendChild(t,i)}function Lh(e,t,i,n,r){null!==n?gu(e,t,i,n,r):Jy(e,t,i)}function T_(e,t){return e.parentNode(t)}function S_(e,t,i){return Ub(e,t,i)}let tv,zh,R_,k_,Ub=function xf(e,t,i){return 40&e.type?qr(e,i):null};function M_(e,t,i,n){const r=bf(e,n,t),s=t[fn],m=S_(n.parent||t[wr],n,t);if(null!=r)if(Array.isArray(i))for(let b=0;b<i.length;b++)Lh(s,r,i[b],m,!1);else Lh(s,r,i,m,!1);void 0!==tv&&tv(s,n,t,i,r)}function wf(e,t){if(null!==t){const i=t.type;if(3&i)return qr(t,e);if(4&i)return Bh(-1,e[t.index]);if(8&i){const n=t.child;if(null!==n)return wf(e,n);{const r=e[t.index];return ur(r)?Bh(-1,r):gi(r)}}if(32&i)return Oh(t,e)()||gi(e[t.index]);{const n=Hb(e,t);return null!==n?Array.isArray(n)?n[0]:wf(Na(e[Wi]),n):wf(e,t.next)}}return null}function Hb(e,t){return null!==t?e[Wi][wr].projection[t.projection]:null}function Bh(e,t){const i=Zi+e+1;if(i<t.length){const n=t[i],r=n[It].firstChild;if(null!==r)return wf(n,r)}return t[co]}function pd(e,t,i,n,r,s,d){for(;null!=i;){const m=n[i.index],b=i.type;if(d&&0===t&&(m&&Eo(gi(m),n),i.flags|=2),32!=(32&i.flags))if(8&b)pd(e,t,i.child,n,r,s,!1),Fh(t,e,r,m,s);else if(32&b){const E=Oh(i,n);let I;for(;I=E();)Fh(t,e,r,I,s);Fh(t,e,r,m,s)}else 16&b?Gb(e,t,n,i,r,s):Fh(t,e,r,m,s);i=d?i.projectionNext:i.next}}function Cf(e,t,i,n,r,s){pd(i,n,e.firstChild,t,r,s,!1)}function Gb(e,t,i,n,r,s){const d=i[Wi],b=d[wr].projection[n.projection];if(Array.isArray(b))for(let E=0;E<b.length;E++)Fh(t,e,r,b[E],s);else{let E=b;const I=d[Ti];Rh(n)&&(E.flags|=128),pd(e,t,E,I,r,s,!0)}}function Zb(e,t,i){""===i?e.removeAttribute(t,"class"):e.setAttribute(t,"class",i)}function Yb(e,t,i){const{mergedAttrs:n,classes:r,styles:s}=i;null!==n&&ul(e,t,n),null!==r&&Zb(e,t,r),null!==s&&function AC(e,t,i){e.setAttribute(t,"style",i)}(e,t,s)}function vc(e){return function Vh(){if(void 0===zh&&(zh=null,Kn.trustedTypes))try{zh=Kn.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return zh}()?.createHTML(e)||e}function ov(e){return function P_(){if(void 0===k_&&(k_=null,Kn.trustedTypes))try{k_=Kn.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return k_}()?.createScriptURL(e)||e}class fd{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${ys})`}}class Xb extends fd{getTypeName(){return"HTML"}}class kC extends fd{getTypeName(){return"Style"}}class PC extends fd{getTypeName(){return"Script"}}class Kb extends fd{getTypeName(){return"URL"}}class O_ extends fd{getTypeName(){return"ResourceURL"}}function ls(e){return e instanceof fd?e.changingThisBreaksApplicationSecurity:e}function Li(e,t){const i=function Tf(e){return e instanceof fd&&e.getTypeName()||null}(e);if(null!=i&&i!==t){if("ResourceURL"===i&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${i} (see ${ys})`)}return i===t}class FC{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const i=(new window.DOMParser).parseFromString(vc(t),"text/html").body;return null===i?this.inertDocumentHelper.getInertBodyElement(t):(i.removeChild(i.firstChild),i)}catch{return null}}}class NC{constructor(t){this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(t){const i=this.inertDocument.createElement("template");return i.innerHTML=vc(t),i}}const BC=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function vu(e){return(e=String(e)).match(BC)?e:"unsafe:"+e}function bc(e){const t={};for(const i of e.split(","))t[i]=!0;return t}function Uh(...e){const t={};for(const i of e)for(const n in i)i.hasOwnProperty(n)&&(t[n]=!0);return t}const sv=bc("area,br,col,hr,img,wbr"),av=bc("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),t1=bc("rp,rt"),lv=Uh(sv,Uh(av,bc("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Uh(t1,bc("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Uh(t1,av)),F_=bc("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),sa=Uh(F_,bc("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),bc("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),cv=bc("script,style,template");class N_{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let i=t.firstChild,n=!0;for(;i;)if(i.nodeType===Node.ELEMENT_NODE?n=this.startElement(i):i.nodeType===Node.TEXT_NODE?this.chars(i.nodeValue):this.sanitizedSomething=!0,n&&i.firstChild)i=i.firstChild;else for(;i;){i.nodeType===Node.ELEMENT_NODE&&this.endElement(i);let r=this.checkClobberedElement(i,i.nextSibling);if(r){i=r;break}i=this.checkClobberedElement(i,i.parentNode)}return this.buf.join("")}startElement(t){const i=t.nodeName.toLowerCase();if(!lv.hasOwnProperty(i))return this.sanitizedSomething=!0,!cv.hasOwnProperty(i);this.buf.push("<"),this.buf.push(i);const n=t.attributes;for(let r=0;r<n.length;r++){const s=n.item(r),d=s.name,m=d.toLowerCase();if(!sa.hasOwnProperty(m)){this.sanitizedSomething=!0;continue}let b=s.value;F_[m]&&(b=vu(b)),this.buf.push(" ",d,'="',n1(b),'"')}return this.buf.push(">"),!0}endElement(t){const i=t.nodeName.toLowerCase();lv.hasOwnProperty(i)&&!sv.hasOwnProperty(i)&&(this.buf.push("</"),this.buf.push(i),this.buf.push(">"))}chars(t){this.buf.push(n1(t))}checkClobberedElement(t,i){if(i&&(t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return i}}const $h=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,zC=/([^\#-~ |!])/g;function n1(e){return e.replace(/&/g,"&amp;").replace($h,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(zC,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let md;function r1(e,t){let i=null;try{md=md||function e1(e){const t=new NC(e);return function LC(){try{return!!(new window.DOMParser).parseFromString(vc(""),"text/html")}catch{return!1}}()?new FC(t):t}(e);let n=t?String(t):"";i=md.getInertBodyElement(n);let r=5,s=n;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,n=s,s=i.innerHTML,i=md.getInertBodyElement(n)}while(n!==s);return vc((new N_).sanitizeChildren(dv(i)||i))}finally{if(i){const n=dv(i)||i;for(;n.firstChild;)n.removeChild(n.firstChild)}}}function dv(e){return"content"in e&&function o1(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var Kr=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(Kr||{});function cs(e){const t=Mf();return t?t.sanitize(Kr.URL,e)||"":Li(e,"URL")?ls(e):vu(nn(e))}function uv(e){const t=Mf();if(t)return ov(t.sanitize(Kr.RESOURCE_URL,e)||"");if(Li(e,"ResourceURL"))return ov(ls(e));throw new He(904,!1)}function Mf(){const e=ce();return e&&e[Aa].sanitizer}class mt{constructor(t,i){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof i?this.__NG_ELEMENT_ID__=i:void 0!==i&&(this.\u0275prov=Re({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Af=new mt("ENVIRONMENT_INITIALIZER"),d1=new mt("INJECTOR",-1),u1=new mt("INJECTOR_DEF_TYPES");class hv{get(t,i=bs){if(i===bs){const n=new Error(`NullInjectorError: No provider for ${Ut(t)}!`);throw n.name="NullInjectorError",n}return i}}function qh(...e){return{\u0275providers:pv(0,e),\u0275fromNgModule:!0}}function pv(e,...t){const i=[],n=new Set;let r;const s=d=>{i.push(d)};return Tl(t,d=>{const m=d;Wh(m,s,[],n)&&(r||=[],r.push(m))}),void 0!==r&&If(r,s),i}function If(e,t){for(let i=0;i<e.length;i++){const{ngModule:n,providers:r}=e[i];fv(r,s=>{t(s,n)})}}function Wh(e,t,i,n){if(!(e=Pt(e)))return!1;let r=null,s=sl(e);const d=!s&&zn(e);if(s||d){if(d&&!d.standalone)return!1;r=e}else{const b=e.ngModule;if(s=sl(b),!s)return!1;r=b}const m=n.has(r);if(d){if(m)return!1;if(n.add(r),d.dependencies){const b="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const E of b)Wh(E,t,i,n)}}else{if(!s)return!1;{if(null!=s.imports&&!m){let E;n.add(r);try{Tl(s.imports,I=>{Wh(I,t,i,n)&&(E||=[],E.push(I))})}finally{}void 0!==E&&If(E,t)}if(!m){const E=_l(r)||(()=>new r);t({provide:r,useFactory:E,deps:jt},r),t({provide:u1,useValue:r,multi:!0},r),t({provide:Af,useValue:()=>je(r),multi:!0},r)}const b=s.providers;if(null!=b&&!m){const E=e;fv(b,I=>{t(I,E)})}}}return r!==e&&void 0!==e.providers}function fv(e,t){for(let i of e)br(i)&&(i=i.\u0275providers),Array.isArray(i)?fv(i,t):t(i)}const VC=Xe({provide:String,useValue:Xe});function L_(e){return null!==e&&"object"==typeof e&&VC in e}function wc(e){return"function"==typeof e}const Uo=new mt("Set Injector scope."),Rf={},kf={};let _d;function Zh(){return void 0===_d&&(_d=new hv),_d}class Qr{}class z_ extends Qr{get destroyed(){return this._destroyed}constructor(t,i,n,r){super(),this.parent=i,this.source=n,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,j_(t,d=>this.processProvider(d)),this.records.set(d1,bu(void 0,this)),r.has("environment")&&this.records.set(Qr,bu(void 0,this));const s=this.records.get(Uo);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(u1.multi,jt,pn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of t)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const i=Bo(this),n=$r(void 0);try{return t()}finally{Bo(i),$r(n)}}get(t,i=bs,n=pn.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(rc))return t[rc](this);n=cl(n);const s=Bo(this),d=$r(void 0);try{if(!(n&pn.SkipSelf)){let b=this.records.get(t);if(void 0===b){const E=function UC(e){return"function"==typeof e||"object"==typeof e&&e instanceof mt}(t)&&Ur(t);b=E&&this.injectableDefInScope(E)?bu(V_(t),Rf):null,this.records.set(t,b)}if(null!=b)return this.hydrate(t,b)}return(n&pn.Self?Zh():this.parent).get(t,i=n&pn.Optional&&i===bs?null:i)}catch(m){if("NullInjectorError"===m.name){if((m[Kc]=m[Kc]||[]).unshift(Ut(t)),s)throw m;return function Vd(e,t,i,n){const r=e[Kc];throw t[zd]&&r.unshift(t[zd]),e.message=function Gm(e,t,i,n=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let r=Ut(t);if(Array.isArray(t))r=t.map(Ut).join(" -> ");else if("object"==typeof t){let s=[];for(let d in t)if(t.hasOwnProperty(d)){let m=t[d];s.push(d+":"+("string"==typeof m?JSON.stringify(m):Ut(m)))}r=`{${s.join(", ")}}`}return`${i}${n?"("+n+")":""}[${r}]: ${e.replace(Sa,"\n  ")}`}("\n"+e.message,r,i,n),e.ngTokenPath=r,e[Kc]=null,e}(m,t,"R3InjectorError",this.source)}throw m}finally{$r(d),Bo(s)}}resolveInjectorInitializers(){const t=Bo(this),i=$r(void 0);try{const r=this.get(Af.multi,jt,pn.Self);for(const s of r)s()}finally{Bo(t),$r(i)}}toString(){const t=[],i=this.records;for(const n of i.keys())t.push(Ut(n));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new He(205,!1)}processProvider(t){let i=wc(t=Pt(t))?t:Pt(t&&t.provide);const n=function jC(e){return L_(e)?bu(void 0,e.useValue):bu(mv(e),Rf)}(t);if(wc(t)||!0!==t.multi)this.records.get(i);else{let r=this.records.get(i);r||(r=bu(void 0,Rf,!0),r.factory=()=>xs(r.multi),this.records.set(i,r)),i=t,r.multi.push(t)}this.records.set(i,n)}hydrate(t,i){return i.value===Rf&&(i.value=kf,i.value=i.factory()),"object"==typeof i.value&&i.value&&function f1(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}injectableDefInScope(t){if(!t.providedIn)return!1;const i=Pt(t.providedIn);return"string"==typeof i?"any"===i||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(t){const i=this._onDestroyHooks.indexOf(t);-1!==i&&this._onDestroyHooks.splice(i,1)}}function V_(e){const t=Ur(e),i=null!==t?t.factory:_l(e);if(null!==i)return i;if(e instanceof mt)throw new He(204,!1);if(e instanceof Function)return function p1(e){const t=e.length;if(t>0)throw du(t,"?"),new He(204,!1);const i=function Lo(e){return e&&(e[Zs]||e[_i])||null}(e);return null!==i?()=>i.factory(e):()=>new e}(e);throw new He(204,!1)}function mv(e,t,i){let n;if(wc(e)){const r=Pt(e);return _l(r)||V_(r)}if(L_(e))n=()=>Pt(e.useValue);else if(function To(e){return!(!e||!e.useFactory)}(e))n=()=>e.useFactory(...xs(e.deps||[]));else if(function B_(e){return!(!e||!e.useExisting)}(e))n=()=>je(Pt(e.useExisting));else{const r=Pt(e&&(e.useClass||e.provide));if(!function _v(e){return!!e.deps}(e))return _l(r)||V_(r);n=()=>new r(...xs(e.deps))}return n}function bu(e,t,i=!1){return{factory:e,value:t,multi:i?[]:void 0}}function j_(e,t){for(const i of e)Array.isArray(i)?j_(i,t):i&&br(i)?j_(i.\u0275providers,t):t(i)}const aa=new mt("AppId",{providedIn:"root",factory:()=>m1}),m1="ng",gv=new mt("Platform Initializer"),Ll=new mt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),xu=new mt("AnimationModuleType"),yv=new mt("CSP nonce",{providedIn:"root",factory:()=>function yu(){if(void 0!==R_)return R_;if(typeof document<"u")return document;throw new He(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let wu=(e,t,i)=>null;function G_(e,t,i=!1){return wu(e,t,i)}class Cu{}class v1{}class Vf{resolveComponentFactory(t){throw function xd(e){const t=Error(`No component factory found for ${Ut(e)}.`);return t.ngComponent=e,t}(t)}}let Bl=(()=>{class t{}return t.NULL=new Vf,t})();function jf(){return Cc(Pe(),ce())}function Cc(e,t){return new Tn(qr(e,t))}let Tn=(()=>{class t{constructor(n){this.nativeElement=n}}return t.__NG_ELEMENT_ID__=jf,t})();function WC(e){return e instanceof Tn?e.nativeElement:e}class Ba{}let po=(()=>{class t{constructor(){this.destroyNode=null}}return t.__NG_ELEMENT_ID__=()=>function ZC(){const e=ce(),i=_(Pe().index,e);return(Ar(i)?i:e)[fn]}(),t})(),x1=(()=>{var e;class t{}return(e=t).\u0275prov=Re({token:e,providedIn:"root",factory:()=>null}),t})();class wd{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const YC=new wd("16.2.0"),K_={};function tg(e,t=null,i=null,n){const r=Dc(e,t,i,n);return r.resolveInjectorInitializers(),r}function Dc(e,t=null,i=null,n,r=new Set){const s=[i||jt,qh(e)];return n=n||("object"==typeof e?void 0:Ut(e)),new z_(s,t||Zh(),n||null,r)}let pr=(()=>{var e;class t{static create(n,r){if(Array.isArray(n))return tg({name:""},r,n,"");{const s=n.name??"";return tg({name:s},n.parent,n.providers,s)}}}return(e=t).THROW_IF_NOT_FOUND=bs,e.NULL=new hv,e.\u0275prov=Re({token:e,providedIn:"any",factory:()=>je(d1)}),e.__NG_ELEMENT_ID__=-1,t})();function S1(e){return e.ownerDocument.defaultView}function za(e){return e instanceof Function?e():e}let ng=(()=>{var e;class t{constructor(){this.callbacks=new Set,this.deferredCallbacks=new Set,this.renderDepth=0,this.runningCallbacks=!1}begin(){if(this.runningCallbacks)throw new He(102,!1);this.renderDepth++}end(){if(this.renderDepth--,0===this.renderDepth)try{this.runningCallbacks=!0;for(const n of this.callbacks)n.invoke()}finally{this.runningCallbacks=!1;for(const n of this.deferredCallbacks)this.callbacks.add(n);this.deferredCallbacks.clear()}}register(n){(this.runningCallbacks?this.deferredCallbacks:this.callbacks).add(n)}unregister(n){this.callbacks.delete(n),this.deferredCallbacks.delete(n)}ngOnDestroy(){this.callbacks.clear(),this.deferredCallbacks.clear()}}return(e=t).\u0275prov=Re({token:e,providedIn:"root",factory:()=>new e}),t})();function Gf(e){for(;e;){e[an]|=64;const t=Na(e);if(od(e)&&!t)return e;e=t}return null}function la(e){return e.ngOriginalError}class fo{constructor(){this._console=console}handleError(t){const i=this._findOriginalError(t);this._console.error("ERROR",t),i&&this._console.error("ORIGINAL ERROR",i)}_findOriginalError(t){let i=t&&la(t);for(;i&&la(i);)i=la(i);return i||null}}const qf=new mt("",{providedIn:"root",factory:()=>!1});class Tc extends Hp{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(t){this._lView=t}onConsumerDependencyMayHaveChanged(){Gf(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(t,i,n){const r=Mi(this);this.trackingVersion++;try{t(i,n)}finally{Mi(r)}}destroy(){this.trackingVersion++}}let Wf=null;function F1(){return Wf??=new Tc,Wf}function N1(e,t){return e[t]??F1()}function Zf(e,t){const i=F1();i.hasReadASignal&&(e[t]=Wf,i.lView=e,Wf=new Tc)}const En={};function G(e){ig(De(),ce(),Yi()+e,!1)}function ig(e,t,i,n){if(!n)if(3==(3&t[an])){const s=e.preOrderCheckHooks;null!==s&&Qp(t,s,i)}else{const s=e.preOrderHooks;null!==s&&bh(t,s,0,i)}Ss(i)}function oe(e,t=pn.Default){const i=ce();return null===i?je(e,t):dd(Pe(),i,Pt(e),t)}function Os(){throw new Error("invalid")}function Qh(e,t,i,n,r,s,d,m,b,E,I){const O=t.blueprint.slice();return O[Ni]=r,O[an]=140|n,(null!==E||e&&2048&e[an])&&(O[an]|=2048),C(O),O[Ti]=O[id]=e,O[Si]=i,O[Aa]=d||e&&e[Aa],O[fn]=m||e&&e[fn],O[Ma]=b||e&&e[Ma]||null,O[wr]=s,O[fl]=function y_(){return kh++}(),O[Js]=I,O[ac]=E,O[Wi]=2==t.type?e[Wi]:O,O}function So(e,t,i,n,r){let s=e.data[t];if(null===s)s=function Sc(e,t,i,n,r){const s=Ke(),d=Be(),b=e.data[t]=function $1(e,t,i,n,r,s){let d=t?t.injectorIndex:-1,m=0;return J()&&(m|=128),{type:i,index:n,insertBeforeIndex:null,injectorIndex:d,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:m,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?s:s&&s.parent,i,t,n,r);return null===e.firstChild&&(e.firstChild=b),null!==s&&(d?null==s.child&&null!==b.parent&&(s.child=b):null===s.next&&(s.next=b,b.prev=s)),b}(e,t,i,n,r),function wn(){return V.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=i,s.value=n,s.attrs=r;const d=function Ve(){const e=V.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();s.injectorIndex=null===d?-1:d.injectorIndex}return et(s,!0),s}function Jh(e,t,i,n){if(0===i)return-1;const r=t.length;for(let s=0;s<i;s++)t.push(n),e.blueprint.push(n),e.data.push(null);return r}function Iv(e,t,i,n,r){const s=N1(t,es),d=Yi(),m=2&n;try{if(Ss(-1),m&&t.length>ln&&ig(e,t,ln,!1),Ds(m?2:0,r),m)s.runInContext(i,n,r);else{const E=Mi(null);try{i(n,r)}finally{Mi(E)}}}finally{m&&null===t[es]&&Zf(t,es),Ss(d),Ds(m?3:1,r)}}function Du(e,t,i){if(ah(t)){const n=Mi(null);try{const s=t.directiveEnd;for(let d=t.directiveStart;d<s;d++){const m=e.data[d];m.contentQueries&&m.contentQueries(1,i[d],d)}}finally{Mi(n)}}}function ep(e,t,i){U()&&(function v(e,t,i,n){const r=i.directiveStart,s=i.directiveEnd;ea(i)&&function $(e,t,i){const n=qr(t,e),r=Rv(i);let d=16;i.signals?d=4096:i.onPush&&(d=64);const m=ze(e,Qh(e,r,null,d,n,t,null,e[Aa].rendererFactory.createRenderer(n,i),null,null,null));e[t.index]=m}(t,i,e.data[r+i.componentOffset]),e.firstCreatePass||Bt(i,t),Eo(n,t);const d=i.initialInputs;for(let m=r;m<s;m++){const b=e.data[m],E=Cl(t,e,m,i);Eo(E,t),null!==d&&ve(0,m-r,E,b,0,d),ns(b)&&(_(i.index,t)[Si]=Cl(t,e,m,i))}}(e,t,i,qr(i,t)),64==(64&i.flags)&&w(e,t,i))}function rg(e,t,i=qr){const n=t.localNames;if(null!==n){let r=t.index+1;for(let s=0;s<n.length;s+=2){const d=n[s+1],m=-1===d?i(t,e):e[d];e[r++]=m}}}function Rv(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=kv(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function kv(e,t,i,n,r,s,d,m,b,E,I){const O=ln+n,q=O+r,Y=function L1(e,t){const i=[];for(let n=0;n<t;n++)i.push(n<e?null:En);return i}(O,q),pe="function"==typeof E?E():E;return Y[It]={type:e,blueprint:Y,template:i,queries:null,viewQuery:m,declTNode:t,data:Y.slice().fill(null,O),bindingStartIndex:O,expandoStartIndex:q,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:b,consts:pe,incompleteFirstPass:!1,ssrId:I}}let V1=e=>null;function og(e,t,i,n){for(let r in e)if(e.hasOwnProperty(r)){i=null===i?{}:i;const s=e[r];null===n?sg(i,t,r,s):n.hasOwnProperty(r)&&sg(i,t,n[r],s)}return i}function sg(e,t,i,n){e.hasOwnProperty(i)?e[i].push(t,n):e[i]=[t,n]}function $o(e,t,i,n,r,s,d,m){const b=qr(t,i);let I,E=t.inputs;!m&&null!=E&&(I=E[n])?(it(e,i,I,n,r),ea(t)&&function G1(e,t){const i=_(t,e);16&i[an]||(i[an]|=64)}(i,t.index)):3&t.type&&(n=function Yf(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(n),r=null!=d?d(r,t.value||"",n):r,s.setProperty(b,n,r))}function l(e,t,i,n){if(U()){const r=null===n?null:{"":-1},s=function T(e,t){const i=e.directiveRegistry;let n=null,r=null;if(i)for(let s=0;s<i.length;s++){const d=i[s];if(nd(t,d.selectors,!1))if(n||(n=[]),ns(d))if(null!==d.findHostDirectiveDefs){const m=[];r=r||new Map,d.findHostDirectiveDefs(d,m,r),n.unshift(...m,d),R(e,t,m.length)}else n.unshift(d),R(e,t,0);else r=r||new Map,d.findHostDirectiveDefs?.(d,n,r),n.push(d)}return null===n?null:[n,r]}(e,i);let d,m;null===s?d=m=null:[d,m]=s,null!==d&&u(e,t,i,d,r,m),r&&function P(e,t,i){if(t){const n=e.localNames=[];for(let r=0;r<t.length;r+=2){const s=i[t[r+1]];if(null==s)throw new He(-301,!1);n.push(t[r],s)}}}(i,n,r)}i.mergedAttrs=pl(i.mergedAttrs,i.attrs)}function u(e,t,i,n,r,s){for(let E=0;E<n.length;E++)l_(Bt(i,t),e,n[E].type);!function B(e,t,i){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+i,e.providerIndexes=t}(i,e.data.length,n.length);for(let E=0;E<n.length;E++){const I=n[E];I.providersResolver&&I.providersResolver(I)}let d=!1,m=!1,b=Jh(e,t,n.length,null);for(let E=0;E<n.length;E++){const I=n[E];i.mergedAttrs=pl(i.mergedAttrs,I.hostAttrs),z(e,i,t,b,I),F(b,I,r),null!==I.contentQueries&&(i.flags|=4),(null!==I.hostBindings||null!==I.hostAttrs||0!==I.hostVars)&&(i.flags|=64);const O=I.type.prototype;!d&&(O.ngOnChanges||O.ngOnInit||O.ngDoCheck)&&((e.preOrderHooks??=[]).push(i.index),d=!0),!m&&(O.ngOnChanges||O.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(i.index),m=!0),b++}!function H1(e,t,i){const r=t.directiveEnd,s=e.data,d=t.attrs,m=[];let b=null,E=null;for(let I=t.directiveStart;I<r;I++){const O=s[I],q=i?i.get(O):null,pe=q?q.outputs:null;b=og(O.inputs,I,b,q?q.inputs:null),E=og(O.outputs,I,E,pe);const Te=null===b||null===d||Ju(t)?null:ge(b,I,d);m.push(Te)}null!==b&&(b.hasOwnProperty("class")&&(t.flags|=8),b.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=m,t.inputs=b,t.outputs=E}(e,i,s)}function w(e,t,i){const n=i.directiveStart,r=i.directiveEnd,s=i.index,d=function ni(){return V.lFrame.currentDirectiveIndex}();try{Ss(s);for(let m=n;m<r;m++){const b=e.data[m],E=t[m];Yn(m),(null!==b.hostBindings||0!==b.hostVars||null!==b.hostAttrs)&&D(b,E)}}finally{Ss(-1),Yn(d)}}function D(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function R(e,t,i){t.componentOffset=i,(e.components??=[]).push(t.index)}function F(e,t,i){if(i){if(t.exportAs)for(let n=0;n<t.exportAs.length;n++)i[t.exportAs[n]]=e;ns(t)&&(i[""]=e)}}function z(e,t,i,n,r){e.data[n]=r;const s=r.factory||(r.factory=_l(r.type)),d=new ef(s,ns(r),oe);e.blueprint[n]=d,i[n]=d,function p(e,t,i,n,r){const s=r.hostBindings;if(s){let d=e.hostBindingOpCodes;null===d&&(d=e.hostBindingOpCodes=[]);const m=~t.index;(function g(e){let t=e.length;for(;t>0;){const i=e[--t];if("number"==typeof i&&i<0)return i}return 0})(d)!=m&&d.push(m),d.push(i,n,s)}}(e,t,n,Jh(e,i,r.hostVars,En),r)}function Q(e,t,i,n,r,s){const d=qr(e,t);!function ae(e,t,i,n,r,s,d){if(null==s)e.removeAttribute(t,r,i);else{const m=null==d?nn(s):d(s,n||"",r);e.setAttribute(t,r,m,i)}}(t[fn],d,s,e.value,i,n,r)}function ve(e,t,i,n,r,s){const d=s[t];if(null!==d)for(let m=0;m<d.length;)le(n,i,d[m++],d[m++],d[m++])}function le(e,t,i,n,r){const s=Mi(null);try{const d=e.inputTransforms;null!==d&&d.hasOwnProperty(n)&&(r=d[n].call(t,r)),null!==e.setInput?e.setInput(t,r,i,n):t[n]=r}finally{Mi(s)}}function ge(e,t,i){let n=null,r=0;for(;r<i.length;){const s=i[r];if(0!==s)if(5!==s){if("number"==typeof s)break;if(e.hasOwnProperty(s)){null===n&&(n=[]);const d=e[s];for(let m=0;m<d.length;m+=2)if(d[m]===t){n.push(s,d[m+1],i[r+1]);break}}r+=2}else r+=2;else r+=4}return n}function xe(e,t,i,n){return[e,!0,!1,t,null,0,n,i,null,null,null]}function be(e,t){const i=e.contentQueries;if(null!==i)for(let n=0;n<i.length;n+=2){const s=i[n+1];if(-1!==s){const d=e.data[s];nr(i[n]),d.contentQueries(2,t[s],s)}}}function ze(e,t){return e[Qs]?e[Xm][Vo]=t:e[Qs]=t,e[Xm]=t,t}function Le(e,t,i){nr(0);const n=Mi(null);try{t(e,i)}finally{Mi(n)}}function lt(e){return e[sc]||(e[sc]=[])}function $e(e){return e.cleanup||(e.cleanup=[])}function Je(e,t){const i=e[Ma],n=i?i.get(fo,null):null;n&&n.handleError(t)}function it(e,t,i,n,r){for(let s=0;s<i.length;){const d=i[s++],m=i[s++];le(e.data[d],t[d],n,m,r)}}function st(e,t,i){const n=_h(t,e);!function zb(e,t,i){e.setValue(t,i)}(e[fn],n,i)}function qe(e,t){const i=_(t,e),n=i[It];!function vt(e,t){for(let i=t.length;i<e.blueprint.length;i++)t.push(e.blueprint[i])}(n,i);const r=i[Ni];null!==r&&null===i[Js]&&(i[Js]=G_(r,i[Ma])),St(n,i,i[Si])}function St(e,t,i){fi(t);try{const n=e.viewQuery;null!==n&&Le(1,n,i);const r=e.template;null!==r&&Iv(e,t,r,1,i),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&be(e,t),e.staticViewQueries&&Le(2,e.viewQuery,i);const s=e.components;null!==s&&function bt(e,t){for(let i=0;i<t.length;i++)qe(e,t[i])}(t,s)}catch(n){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),n}finally{t[an]&=-5,ai()}}let rn=(()=>{var e;class t{constructor(){this.all=new Set,this.queue=new Map}create(n,r,s){const d=typeof Zone>"u"?null:Zone.current,m=new na(n,I=>{this.all.has(I)&&this.queue.set(I,d)},s);let b;this.all.add(m),m.notify();const E=()=>{m.cleanup(),b?.(),this.all.delete(m),this.queue.delete(m)};return b=r?.onDestroy(E),{destroy:E}}flush(){if(0!==this.queue.size)for(const[n,r]of this.queue)this.queue.delete(n),r?r.run(()=>n.run()):n.run()}get isQueueEmpty(){return 0===this.queue.size}}return(e=t).\u0275prov=Re({token:e,providedIn:"root",factory:()=>new e}),t})();function Nt(e,t,i){let n=i?e.styles:null,r=i?e.classes:null,s=0;if(null!==t)for(let d=0;d<t.length;d++){const m=t[d];"number"==typeof m?s=m:1==s?r=tn(r,m):2==s&&(n=tn(n,m+": "+t[++d]+";"))}i?e.styles=n:e.stylesWithoutHost=n,i?e.classes=r:e.classesWithoutHost=r}function Zt(e,t,i,n,r=!1){for(;null!==i;){const s=t[i.index];if(null!==s&&n.push(gi(s)),ur(s)){for(let m=Zi;m<s.length;m++){const b=s[m],E=b[It].firstChild;null!==E&&Zt(b[It],b,E,n)}s[co]!==s[Ni]&&n.push(s[co])}const d=i.type;if(8&d)Zt(e,t,i.child,n);else if(32&d){const m=Oh(i,t);let b;for(;b=m();)n.push(b)}else if(16&d){const m=Hb(t,i);if(Array.isArray(m))n.push(...m);else{const b=Na(t[Wi]);Zt(b[It],b,m,n,!0)}}i=r?i.projectionNext:i.next}return n}function Pn(e,t,i,n=!0){const r=t[Aa],s=r.rendererFactory,d=r.afterRenderEventManager;s.begin?.(),d?.begin();try{ci(e,t,e.template,i)}catch(b){throw n&&Je(t,b),b}finally{s.end?.(),r.effectManager?.flush(),d?.end()}}function ci(e,t,i,n){const r=t[an];if(256!=(256&r)){t[Aa].effectManager?.flush(),fi(t);try{C(t),function Mt(e){return V.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==i&&Iv(e,t,i,2,n);const d=3==(3&r);if(d){const E=e.preOrderCheckHooks;null!==E&&Qp(t,E,null)}else{const E=e.preOrderHooks;null!==E&&bh(t,E,0,null),xh(t,0)}if(function dn(e){for(let t=Nb(e);null!==t;t=Lb(t)){if(!t[ml])continue;const i=t[Ra];for(let n=0;n<i.length;n++){S(i[n])}}}(t),sn(t,2),null!==e.contentQueries&&be(e,t),d){const E=e.contentCheckHooks;null!==E&&Qp(t,E)}else{const E=e.contentHooks;null!==E&&bh(t,E,1),xh(t,1)}!function Av(e,t){const i=e.hostBindingOpCodes;if(null===i)return;const n=N1(t,lc);try{for(let r=0;r<i.length;r++){const s=i[r];if(s<0)Ss(~s);else{const d=s,m=i[++r],b=i[++r];Wn(m,d),n.runInContext(b,2,t[d])}}}finally{null===t[lc]&&Zf(t,lc),Ss(-1)}}(e,t);const m=e.components;null!==m&&oi(t,m,0);const b=e.viewQuery;if(null!==b&&Le(2,b,n),d){const E=e.viewCheckHooks;null!==E&&Qp(t,E)}else{const E=e.viewHooks;null!==E&&bh(t,E,2),xh(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[an]&=-73,M(t)}finally{ai()}}}function sn(e,t){for(let i=Nb(e);null!==i;i=Lb(i))for(let n=Zi;n<i.length;n++)ri(i[n],t)}function ii(e,t,i){ri(_(t,e),i)}function ri(e,t){if(!function h(e){return 128==(128&e[an])}(e))return;const i=e[It];if(80&e[an]&&0===t||1024&e[an]||2===t)ci(i,e,i.template,e[Si]);else if(e[Gd]>0){sn(e,1);const r=e[It].components;null!==r&&oi(e,r,1)}}function oi(e,t,i){for(let n=0;n<t.length;n++)ii(e,t[n],i)}class Un{get rootNodes(){const t=this._lView,i=t[It];return Zt(i,t,i.firstChild,[])}constructor(t,i){this._lView=t,this._cdRefInjectingView=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Si]}set context(t){this._lView[Si]=t}get destroyed(){return 256==(256&this._lView[an])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[Ti];if(ur(t)){const i=t[8],n=i?i.indexOf(this):-1;n>-1&&(hd(t,n),Mh(i,n))}this._attachedToViewContainer=!1}C_(this._lView[It],this._lView)}onDestroy(t){!function L(e,t){if(256==(256&e[an]))throw new He(911,!1);null===e[Ia]&&(e[Ia]=[]),e[Ia].push(t)}(this._lView,t)}markForCheck(){Gf(this._cdRefInjectingView||this._lView)}detach(){this._lView[an]&=-129}reattach(){this._lView[an]|=128}detectChanges(){Pn(this._lView[It],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new He(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Ki(e,t){Cf(e,t,t[fn],2,null,null)}(this._lView[It],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new He(902,!1);this._appRef=t}}class Ai extends Un{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;Pn(t[It],t,t[Si],!1)}checkNoChanges(){}get context(){return null}}class Pi extends Bl{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const i=zn(t);return new Ii(i,this.ngModule)}}function Vi(e){const t=[];for(let i in e)e.hasOwnProperty(i)&&t.push({propName:e[i],templateName:i});return t}class ir{constructor(t,i){this.injector=t,this.parentInjector=i}get(t,i,n){n=cl(n);const r=this.injector.get(t,K_,n);return r!==K_||i===K_?r:this.parentInjector.get(t,i,n)}}class Ii extends v1{get inputs(){const t=this.componentDef,i=t.inputTransforms,n=Vi(t.inputs);if(null!==i)for(const r of n)i.hasOwnProperty(r.propName)&&(r.transform=i[r.propName]);return n}get outputs(){return Vi(this.componentDef.outputs)}constructor(t,i){super(),this.componentDef=t,this.ngModule=i,this.componentType=t.type,this.selector=function by(e){return e.map(vy).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!i}create(t,i,n,r){let s=(r=r||this.ngModule)instanceof Qr?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const d=s?new ir(t,s):t,m=d.get(Ba,null);if(null===m)throw new He(407,!1);const O={rendererFactory:m,sanitizer:d.get(x1,null),effectManager:d.get(rn,null),afterRenderEventManager:d.get(ng,null)},q=m.createRenderer(null,this.componentDef),Y=this.componentDef.selectors[0][0]||"div",pe=n?function B1(e,t,i,n){const s=n.get(qf,!1)||i===wo.ShadowDom,d=e.selectRootElement(t,s);return function z1(e){V1(e)}(d),d}(q,n,this.componentDef.encapsulation,d):b_(q,Y,function si(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(Y)),Ge=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let Oe=null;null!==pe&&(Oe=G_(pe,d,!0));const pt=kv(0,null,null,1,0,null,null,null,null,null,null),rt=Qh(null,pt,null,Ge,null,null,O,q,d,null,Oe);let At,Wt;fi(rt);try{const en=this.componentDef;let Mn,pi=null;en.findHostDirectiveDefs?(Mn=[],pi=new Map,en.findHostDirectiveDefs(en,Mn,pi),Mn.push(en)):Mn=[en];const wi=function jn(e,t){const i=e[It],n=ln;return e[n]=t,So(i,n,2,"#host",null)}(rt,pe),Br=function Qi(e,t,i,n,r,s,d){const m=r[It];!function di(e,t,i,n){for(const r of e)t.mergedAttrs=pl(t.mergedAttrs,r.hostAttrs);null!==t.mergedAttrs&&(Nt(t,t.mergedAttrs,!0),null!==i&&Yb(n,i,t))}(n,e,t,d);let b=null;null!==t&&(b=G_(t,r[Ma]));const E=s.rendererFactory.createRenderer(t,i);let I=16;i.signals?I=4096:i.onPush&&(I=64);const O=Qh(r,Rv(i),null,I,r[e.index],e,s,E,null,null,b);return m.firstCreatePass&&R(m,e,n.length-1),ze(r,O),r[e.index]=O}(wi,pe,en,Mn,rt,O,q);Wt=gh(pt,ln),pe&&function Ji(e,t,i,n){if(n)ul(e,i,["ng-version",YC.full]);else{const{attrs:r,classes:s}=function xy(e){const t=[],i=[];let n=1,r=2;for(;n<e.length;){let s=e[n];if("string"==typeof s)2===r?""!==s&&t.push(s,e[++n]):8===r&&i.push(s);else{if(!zo(r))break;r=s}n++}return{attrs:t,classes:i}}(t.selectors[0]);r&&ul(e,i,r),s&&s.length>0&&Zb(e,i,s.join(" "))}}(q,en,pe,n),void 0!==i&&function Or(e,t,i){const n=e.projection=[];for(let r=0;r<t.length;r++){const s=i[r];n.push(null!=s?Array.from(s):null)}}(Wt,this.ngContentSelectors,i),At=function Mo(e,t,i,n,r,s){const d=Pe(),m=r[It],b=qr(d,r);u(m,r,d,i,null,n);for(let I=0;I<i.length;I++)Eo(Cl(r,m,d.directiveStart+I,d),r);w(m,r,d),b&&Eo(b,r);const E=Cl(r,m,d.directiveStart+d.componentOffset,d);if(e[Si]=r[Si]=E,null!==s)for(const I of s)I(E,t);return Du(m,d,e),E}(Br,en,Mn,pi,rt,[Dr]),St(pt,rt,null)}finally{ai()}return new Oi(this.componentType,At,Cc(Wt,rt),rt,Wt)}}class Oi extends Cu{constructor(t,i,n,r,s){super(),this.location=n,this._rootLView=r,this._tNode=s,this.previousInputValues=null,this.instance=i,this.hostView=this.changeDetectorRef=new Ai(r),this.componentType=t}setInput(t,i){const n=this._tNode.inputs;let r;if(null!==n&&(r=n[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),i))return;const s=this._rootLView;it(s[It],s,r,t,i),this.previousInputValues.set(t,i),Gf(_(this._tNode.index,s))}}get injector(){return new Pr(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function Dr(){const e=Pe();ru(ce()[It],e)}function Yt(e){let t=function mo(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),i=!0;const n=[e];for(;t;){let r;if(ns(e))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new He(903,!1);r=t.\u0275dir}if(r){if(i){n.push(r);const d=e;d.inputs=Mc(e.inputs),d.inputTransforms=Mc(e.inputTransforms),d.declaredInputs=Mc(e.declaredInputs),d.outputs=Mc(e.outputs);const m=r.hostBindings;m&&q1(e,m);const b=r.viewQuery,E=r.contentQueries;if(b&&Xf(e,b),E&&Kf(e,E),Kt(e.inputs,r.inputs),Kt(e.declaredInputs,r.declaredInputs),Kt(e.outputs,r.outputs),null!==r.inputTransforms&&(null===d.inputTransforms&&(d.inputTransforms={}),Kt(d.inputTransforms,r.inputTransforms)),ns(r)&&r.data.animation){const I=e.data;I.animation=(I.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let d=0;d<s.length;d++){const m=s[d];m&&m.ngInherit&&m(e),m===Yt&&(i=!1)}}t=Object.getPrototypeOf(t)}!function ja(e){let t=0,i=null;for(let n=e.length-1;n>=0;n--){const r=e[n];r.hostVars=t+=r.hostVars,r.hostAttrs=pl(r.hostAttrs,i=pl(i,r.hostAttrs))}}(n)}function Mc(e){return e===ao?{}:e===jt?[]:e}function Xf(e,t){const i=e.viewQuery;e.viewQuery=i?(n,r)=>{t(n,r),i(n,r)}:t}function Kf(e,t){const i=e.contentQueries;e.contentQueries=i?(n,r,s)=>{t(n,r,s),i(n,r,s)}:t}function q1(e,t){const i=e.hostBindings;e.hostBindings=i?(n,r)=>{t(n,r),i(n,r)}:t}function cg(e){const t=e.inputConfig,i={};for(const n in t)if(t.hasOwnProperty(n)){const r=t[n];Array.isArray(r)&&r[2]&&(i[n]=r[2])}e.inputTransforms=i}function np(e){return!!Ao(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function Ao(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function ca(e,t,i){return e[t]=i}function rr(e,t,i){return!Object.is(e[t],i)&&(e[t]=i,!0)}function Jf(e,t,i,n){const r=rr(e,t,i);return rr(e,t+1,n)||r}function Fn(e,t,i,n){const r=ce();return rr(r,Lt(),t)&&(De(),Q(Jn(),r,e,t,i,n)),Fn}function ug(e,t,i,n){return rr(e,Lt(),i)?t+nn(i)+n:En}function hg(e,t,i,n,r,s){const m=Jf(e,function Ht(){return V.lFrame.bindingIndex}(),i,r);return Jt(2),m?t+nn(i)+n+nn(r)+s:En}function me(e,t,i,n,r,s,d,m){const b=ce(),E=De(),I=e+ln,O=E.firstCreatePass?function e3(e,t,i,n,r,s,d,m,b){const E=t.consts,I=So(t,e,4,d||null,x(E,m));l(t,i,I,x(E,b)),ru(t,I);const O=I.tView=kv(2,I,n,r,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,E,null);return null!==t.queries&&(t.queries.template(t,I),O.queries=t.queries.embeddedTView(I)),I}(I,E,b,t,i,n,r,s,d):E.data[I];et(O,!1);const q=FM(E,b,O,e);Kp()&&M_(E,b,q,O),Eo(q,b),ze(b,b[I]=xe(q,b,q,O)),ts(O)&&ep(E,b,O),null!=d&&rg(b,O,m)}let FM=function NM(e,t,i,n){return cd(!0),t[fn].createComment("")};function Ho(e){return Es(function ct(){return V.lFrame.contextLView}(),ln+e)}function ee(e,t,i){const n=ce();return rr(n,Lt(),t)&&$o(De(),Jn(),n,e,t,n[fn],i,!1),ee}function dD(e,t,i,n,r){const d=r?"class":"style";it(e,i,t.inputs[d],d,n)}function H(e,t,i,n){const r=ce(),s=De(),d=ln+e,m=r[fn],b=s.firstCreatePass?function o3(e,t,i,n,r,s){const d=t.consts,b=So(t,e,2,n,x(d,r));return l(t,i,b,x(d,s)),null!==b.attrs&&Nt(b,b.attrs,!1),null!==b.mergedAttrs&&Nt(b,b.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,b),b}(d,s,r,t,i,n):s.data[d],E=LM(s,r,b,m,t,e);r[d]=E;const I=ts(b);return et(b,!0),Yb(m,E,b),32!=(32&b.flags)&&Kp()&&M_(s,r,E,b),0===function re(){return V.lFrame.elementDepthCount}()&&Eo(E,r),function ie(){V.lFrame.elementDepthCount++}(),I&&(ep(s,r,b),Du(s,b,r)),null!==n&&rg(r,b),H}function j(){let e=Pe();Be()?Ye():(e=e.parent,et(e,!1));const t=e;(function de(e){return V.skipHydrationRootTNode===e})(t)&&function Ee(){V.skipHydrationRootTNode=null}(),function se(){V.lFrame.elementDepthCount--}();const i=De();return i.firstCreatePass&&(ru(i,e),ah(e)&&i.queries.elementEnd(e)),null!=t.classesWithoutHost&&function wh(e){return 0!=(8&e.flags)}(t)&&dD(i,t,ce(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function fc(e){return 0!=(16&e.flags)}(t)&&dD(i,t,ce(),t.stylesWithoutHost,!1),j}function Rt(e,t,i,n){return H(e,t,i,n),j(),Rt}let LM=(e,t,i,n,r,s)=>(cd(!0),b_(n,r,function vh(){return V.lFrame.currentNamespace}()));function tx(e,t,i){const n=ce(),r=De(),s=e+ln,d=r.firstCreatePass?function l3(e,t,i,n,r){const s=t.consts,d=x(s,n),m=So(t,e,8,"ng-container",d);return null!==d&&Nt(m,d,!0),l(t,i,m,x(s,r)),null!==t.queries&&t.queries.elementStart(t,m),m}(s,r,n,t,i):r.data[s];et(d,!0);const m=BM(r,n,d,e);return n[s]=m,Kp()&&M_(r,n,m,d),Eo(m,n),ts(d)&&(ep(r,n,d),Du(r,d,n)),null!=i&&rg(n,d),tx}function nx(){let e=Pe();const t=De();return Be()?Ye():(e=e.parent,et(e,!1)),t.firstCreatePass&&(ru(t,e),ah(e)&&t.queries.elementEnd(e)),nx}function vg(e,t,i){return tx(e,t,i),nx(),vg}let BM=(e,t,i,n)=>(cd(!0),gf(t[fn],""));function zt(){return ce()}function Lv(e){return!!e&&"function"==typeof e.then}function zM(e){return!!e&&"function"==typeof e.subscribe}function nt(e,t,i,n){const r=ce(),s=De(),d=Pe();return function jM(e,t,i,n,r,s,d){const m=ts(n),E=e.firstCreatePass&&$e(e),I=t[Si],O=lt(t);let q=!0;if(3&n.type||d){const Te=qr(n,t),ke=d?d(Te):Te,Ge=O.length,Oe=d?rt=>d(gi(rt[n.index])):n.index;let pt=null;if(!d&&m&&(pt=function u3(e,t,i,n){const r=e.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const d=r[s];if(d===i&&r[s+1]===n){const m=t[sc],b=r[s+2];return m.length>b?m[b]:null}"string"==typeof d&&(s+=2)}return null}(e,t,r,n.index)),null!==pt)(pt.__ngLastListenerFn__||pt).__ngNextListenerFn__=s,pt.__ngLastListenerFn__=s,q=!1;else{s=$M(n,t,I,s,!1);const rt=i.listen(ke,r,s);O.push(s,rt),E&&E.push(r,Oe,Ge,Ge+1)}}else s=$M(n,t,I,s,!1);const Y=n.outputs;let pe;if(q&&null!==Y&&(pe=Y[r])){const Te=pe.length;if(Te)for(let ke=0;ke<Te;ke+=2){const At=t[pe[ke]][pe[ke+1]].subscribe(s),Wt=O.length;O.push(s,At),E&&E.push(r,n.index,Wt,-(Wt+1))}}}(s,r,r[fn],d,e,t,n),nt}function UM(e,t,i,n){try{return Ds(6,t,i),!1!==i(n)}catch(r){return Je(e,r),!1}finally{Ds(7,t,i)}}function $M(e,t,i,n,r){return function s(d){if(d===Function)return n;Gf(e.componentOffset>-1?_(e.index,t):t);let b=UM(t,i,n,d),E=s.__ngNextListenerFn__;for(;E;)b=UM(t,i,E,d)&&b,E=E.__ngNextListenerFn__;return r&&!1===b&&d.preventDefault(),b}}function ue(e=1){return function Co(e){return(V.lFrame.contextLView=function yh(e,t){for(;e>0;)t=t[id],e--;return t}(e,V.lFrame.contextLView))[Si]}(e)}function h3(e,t){let i=null;const n=function qm(e){const t=e.attrs;if(null!=t){const i=t.indexOf(5);if(!(1&i))return t[i+1]}return null}(e);for(let r=0;r<t.length;r++){const s=t[r];if("*"!==s){if(null===n?nd(e,s,!0):oc(n,s))return r}else i=r}return i}function em(e){const t=ce()[Wi][wr];if(!t.projection){const n=t.projection=du(e?e.length:1,null),r=n.slice();let s=t.child;for(;null!==s;){const d=e?h3(s,e):0;null!==d&&(r[d]?r[d].projectionNext=s:n[d]=s,r[d]=s),s=s.next}}}function Su(e,t=0,i){const n=ce(),r=De(),s=So(r,ln+e,16,null,i||null);null===s.projection&&(s.projection=t),Ye(),(!n[Js]||J())&&32!=(32&s.flags)&&function MC(e,t,i){Gb(t[fn],0,t,i,bf(e,i,t),S_(i.parent||t[wr],i,t))}(r,n,s)}function bg(e,t,i){return ix(e,"",t,"",i),bg}function ix(e,t,i,n,r){const s=ce(),d=ug(s,t,i,n);return d!==En&&$o(De(),Jn(),s,e,d,s[fn],r,!1),ix}function rx(e,t){return e<<17|t<<2}function rp(e){return e>>17&32767}function uD(e){return 2|e}function tm(e){return(131068&e)>>2}function hD(e,t){return-131069&e|t<<2}function pD(e){return 1|e}function QM(e,t,i,n,r){const s=e[i+1],d=null===t;let m=n?rp(s):tm(s),b=!1;for(;0!==m&&(!1===b||d);){const I=e[m+1];y3(e[m],t)&&(b=!0,e[m+1]=n?pD(I):uD(I)),m=n?rp(I):tm(I)}b&&(e[i+1]=n?uD(s):pD(s))}function y3(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&Sl(e,t)>=0}const _o={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function JM(e){return e.substring(_o.key,_o.keyEnd)}function v3(e){return e.substring(_o.value,_o.valueEnd)}function eA(e,t){const i=_o.textEnd;return i===t?-1:(t=_o.keyEnd=function w3(e,t,i){for(;t<i&&e.charCodeAt(t)>32;)t++;return t}(e,_o.key=t,i),xg(e,t,i))}function tA(e,t){const i=_o.textEnd;let n=_o.key=xg(e,t,i);return i===n?-1:(n=_o.keyEnd=function C3(e,t,i){let n;for(;t<i&&(45===(n=e.charCodeAt(t))||95===n||(-33&n)>=65&&(-33&n)<=90||n>=48&&n<=57);)t++;return t}(e,n,i),n=iA(e,n,i),n=_o.value=xg(e,n,i),n=_o.valueEnd=function D3(e,t,i){let n=-1,r=-1,s=-1,d=t,m=d;for(;d<i;){const b=e.charCodeAt(d++);if(59===b)return m;34===b||39===b?m=d=rA(e,b,d,i):t===d-4&&85===s&&82===r&&76===n&&40===b?m=d=rA(e,41,d,i):b>32&&(m=d),s=r,r=n,n=-33&b}return m}(e,n,i),iA(e,n,i))}function nA(e){_o.key=0,_o.keyEnd=0,_o.value=0,_o.valueEnd=0,_o.textEnd=e.length}function xg(e,t,i){for(;t<i&&e.charCodeAt(t)<=32;)t++;return t}function iA(e,t,i,n){return(t=xg(e,t,i))<i&&t++,t}function rA(e,t,i,n){let r=-1,s=i;for(;s<n;){const d=e.charCodeAt(s++);if(d==t&&92!==r)return s;r=92==d&&92===r?0:d}throw new Error}function wg(e,t,i){return Ac(e,t,i,!1),wg}function kn(e,t){return Ac(e,t,null,!0),kn}function Jr(e){Ic(aA,E3,e,!1)}function E3(e,t){for(let i=function x3(e){return nA(e),tA(e,xg(e,0,_o.textEnd))}(t);i>=0;i=tA(t,i))aA(e,JM(t),v3(t))}function Er(e){Ic(R3,Cd,e,!0)}function Cd(e,t){for(let i=function b3(e){return nA(e),eA(e,xg(e,0,_o.textEnd))}(t);i>=0;i=eA(t,i))Is(e,JM(t),!0)}function Ac(e,t,i,n){const r=ce(),s=De(),d=Jt(2);s.firstUpdatePass&&sA(s,e,d,n),t!==En&&rr(r,d,t)&&lA(s,s.data[Yi()],r,r[fn],e,r[d+1]=function P3(e,t){return null==e||""===e||("string"==typeof t?e+=t:"object"==typeof e&&(e=Ut(ls(e)))),e}(t,i),n,d)}function Ic(e,t,i,n){const r=De(),s=Jt(2);r.firstUpdatePass&&sA(r,null,s,n);const d=ce();if(i!==En&&rr(d,s,i)){const m=r.data[Yi()];if(dA(m,n)&&!oA(r,s)){let b=n?m.classesWithoutHost:m.stylesWithoutHost;null!==b&&(i=tn(b,i||"")),dD(r,m,d,i,n)}else!function k3(e,t,i,n,r,s,d,m){r===En&&(r=jt);let b=0,E=0,I=0<r.length?r[0]:null,O=0<s.length?s[0]:null;for(;null!==I||null!==O;){const q=b<r.length?r[b+1]:void 0,Y=E<s.length?s[E+1]:void 0;let Te,pe=null;I===O?(b+=2,E+=2,q!==Y&&(pe=O,Te=Y)):null===O||null!==I&&I<O?(b+=2,pe=I):(E+=2,pe=O,Te=Y),null!==pe&&lA(e,t,i,n,pe,Te,d,m),I=b<r.length?r[b]:null,O=E<s.length?s[E]:null}}(r,m,d,d[fn],d[s+1],d[s+1]=function I3(e,t,i){if(null==i||""===i)return jt;const n=[],r=ls(i);if(Array.isArray(r))for(let s=0;s<r.length;s++)e(n,r[s],!0);else if("object"==typeof r)for(const s in r)r.hasOwnProperty(s)&&e(n,s,r[s]);else"string"==typeof r&&t(n,r);return n}(e,t,i),n,s)}}function oA(e,t){return t>=e.expandoStartIndex}function sA(e,t,i,n){const r=e.data;if(null===r[i+1]){const s=r[Yi()],d=oA(e,i);dA(s,n)&&null===t&&!d&&(t=!1),t=function T3(e,t,i,n){const r=function Xn(e){const t=V.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let s=n?t.residualClasses:t.residualStyles;if(null===r)0===(n?t.classBindings:t.styleBindings)&&(i=Bv(i=fD(null,e,t,i,n),t.attrs,n),s=null);else{const d=t.directiveStylingLast;if(-1===d||e[d]!==r)if(i=fD(r,e,t,i,n),null===s){let b=function S3(e,t,i){const n=i?t.classBindings:t.styleBindings;if(0!==tm(n))return e[rp(n)]}(e,t,n);void 0!==b&&Array.isArray(b)&&(b=fD(null,e,t,b[1],n),b=Bv(b,t.attrs,n),function M3(e,t,i,n){e[rp(i?t.classBindings:t.styleBindings)]=n}(e,t,n,b))}else s=function A3(e,t,i){let n;const r=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<r;s++)n=Bv(n,e[s].hostAttrs,i);return Bv(n,t.attrs,i)}(e,t,n)}return void 0!==s&&(n?t.residualClasses=s:t.residualStyles=s),i}(r,s,t,n),function _3(e,t,i,n,r,s){let d=s?t.classBindings:t.styleBindings,m=rp(d),b=tm(d);e[n]=i;let I,E=!1;if(Array.isArray(i)?(I=i[1],(null===I||Sl(i,I)>0)&&(E=!0)):I=i,r)if(0!==b){const q=rp(e[m+1]);e[n+1]=rx(q,m),0!==q&&(e[q+1]=hD(e[q+1],n)),e[m+1]=function f3(e,t){return 131071&e|t<<17}(e[m+1],n)}else e[n+1]=rx(m,0),0!==m&&(e[m+1]=hD(e[m+1],n)),m=n;else e[n+1]=rx(b,0),0===m?m=n:e[b+1]=hD(e[b+1],n),b=n;E&&(e[n+1]=uD(e[n+1])),QM(e,I,n,!0),QM(e,I,n,!1),function g3(e,t,i,n,r){const s=r?e.residualClasses:e.residualStyles;null!=s&&"string"==typeof t&&Sl(s,t)>=0&&(i[n+1]=pD(i[n+1]))}(t,I,e,n,s),d=rx(m,b),s?t.classBindings=d:t.styleBindings=d}(r,s,t,i,d,n)}}function fD(e,t,i,n,r){let s=null;const d=i.directiveEnd;let m=i.directiveStylingLast;for(-1===m?m=i.directiveStart:m++;m<d&&(s=t[m],n=Bv(n,s.hostAttrs,r),s!==e);)m++;return null!==e&&(i.directiveStylingLast=m),n}function Bv(e,t,i){const n=i?1:2;let r=-1;if(null!==t)for(let s=0;s<t.length;s++){const d=t[s];"number"==typeof d?r=d:r===n&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Is(e,d,!!i||t[++s]))}return void 0===e?null:e}function aA(e,t,i){Is(e,t,ls(i))}function R3(e,t,i){const n=String(t);""!==n&&!n.includes(" ")&&Is(e,n,i)}function lA(e,t,i,n,r,s,d,m){if(!(3&t.type))return;const b=e.data,E=b[m+1],I=function m3(e){return 1==(1&e)}(E)?cA(b,t,i,r,tm(E),d):void 0;ox(I)||(ox(s)||function p3(e){return 2==(2&e)}(E)&&(s=cA(b,null,i,r,m,d)),function Wb(e,t,i,n,r){if(t)r?e.addClass(i,n):e.removeClass(i,n);else{let s=-1===n.indexOf("-")?void 0:Fl.DashCase;null==r?e.removeStyle(i,n,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=Fl.Important),e.setStyle(i,n,r,s))}}(n,d,_h(Yi(),i),r,s))}function cA(e,t,i,n,r,s){const d=null===t;let m;for(;r>0;){const b=e[r],E=Array.isArray(b),I=E?b[1]:b,O=null===I;let q=i[r+1];q===En&&(q=O?jt:void 0);let Y=O?_c(q,n):I===n?q:void 0;if(E&&!ox(Y)&&(Y=_c(b,n)),ox(Y)&&(m=Y,d))return m;const pe=e[r+1];r=d?rp(pe):tm(pe)}if(null!==t){let b=s?t.residualClasses:t.residualStyles;null!=b&&(m=_c(b,n))}return m}function ox(e){return void 0!==e}function dA(e,t){return 0!=(e.flags&(t?8:16))}function ne(e,t=""){const i=ce(),n=De(),r=e+ln,s=n.firstCreatePass?So(n,r,1,t,null):n.data[r],d=uA(n,i,s,t,e);i[r]=d,Kp()&&M_(n,i,d,s),et(s,!1)}let uA=(e,t,i,n,r)=>(cd(!0),function v_(e,t){return e.createText(t)}(t[fn],n));function Cn(e){return Ft("",e,""),Cn}function Ft(e,t,i){const n=ce(),r=ug(n,e,t,i);return r!==En&&st(n,Yi(),r),Ft}function Cg(e,t,i,n,r){const s=ce(),d=hg(s,e,t,i,n,r);return d!==En&&st(s,Yi(),d),Cg}function Fs(e,t,i){const n=ce();return rr(n,Lt(),t)&&$o(De(),Jn(),n,e,t,n[fn],i,!0),Fs}const Eg="en-US";let RA=Eg;function gD(e,t,i,n,r){if(e=Pt(e),Array.isArray(e))for(let s=0;s<e.length;s++)gD(e[s],t,i,n,r);else{const s=De(),d=ce(),m=Pe();let b=wc(e)?e:Pt(e.provide);const E=mv(e),I=1048575&m.providerIndexes,O=m.directiveStart,q=m.providerIndexes>>20;if(wc(e)||!e.multi){const Y=new ef(E,r,oe),pe=vD(b,t,r?I:I+q,O);-1===pe?(l_(Bt(m,d),s,b),yD(s,e,t.length),t.push(b),m.directiveStart++,m.directiveEnd++,r&&(m.providerIndexes+=1048576),i.push(Y),d.push(Y)):(i[pe]=Y,d[pe]=Y)}else{const Y=vD(b,t,I+q,O),pe=vD(b,t,I,I+q),ke=pe>=0&&i[pe];if(r&&!ke||!r&&!(Y>=0&&i[Y])){l_(Bt(m,d),s,b);const Ge=function JB(e,t,i,n,r){const s=new ef(e,i,oe);return s.multi=[],s.index=t,s.componentProviders=0,nI(s,r,n&&!i),s}(r?QB:KB,i.length,r,n,E);!r&&ke&&(i[pe].providerFactory=Ge),yD(s,e,t.length,0),t.push(b),m.directiveStart++,m.directiveEnd++,r&&(m.providerIndexes+=1048576),i.push(Ge),d.push(Ge)}else yD(s,e,Y>-1?Y:pe,nI(i[r?pe:Y],E,!r&&n));!r&&n&&ke&&i[pe].componentProviders++}}}function yD(e,t,i,n){const r=wc(t),s=function h1(e){return!!e.useClass}(t);if(r||s){const b=(s?Pt(t.useClass):t).prototype.ngOnDestroy;if(b){const E=e.destroyHooks||(e.destroyHooks=[]);if(!r&&t.multi){const I=E.indexOf(i);-1===I?E.push(i,[n,b]):E[I+1].push(n,b)}else E.push(i,b)}}}function nI(e,t,i){return i&&e.componentProviders++,e.multi.push(t)-1}function vD(e,t,i,n){for(let r=i;r<n;r++)if(t[r]===e)return r;return-1}function KB(e,t,i,n){return bD(this.multi,[])}function QB(e,t,i,n){const r=this.multi;let s;if(this.providerFactory){const d=this.providerFactory.componentProviders,m=Cl(i,i[It],this.providerFactory.index,n);s=m.slice(0,d),bD(r,s);for(let b=d;b<m.length;b++)s.push(m[b])}else s=[],bD(r,s);return s}function bD(e,t){for(let i=0;i<e.length;i++)t.push((0,e[i])());return t}function vi(e,t=[]){return i=>{i.providersResolver=(n,r)=>function XB(e,t,i){const n=De();if(n.firstCreatePass){const r=ns(e);gD(i,n.data,n.blueprint,r,!0),gD(t,n.data,n.blueprint,r,!1)}}(n,r?r(e):e,t)}}class im{}class iI{}class xD extends im{constructor(t,i,n){super(),this._parent=i,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Pi(this);const r=Gr(t);this._bootstrapComponents=za(r.bootstrap),this._r3Injector=Dc(t,i,[{provide:im,useValue:this},{provide:Bl,useValue:this.componentFactoryResolver},...n],Ut(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class wD extends iI{constructor(t){super(),this.moduleType=t}create(t){return new xD(this.moduleType,t,[])}}class rI extends im{constructor(t){super(),this.componentFactoryResolver=new Pi(this),this.instance=null;const i=new z_([...t.providers,{provide:im,useValue:this},{provide:Bl,useValue:this.componentFactoryResolver}],t.parent||Zh(),t.debugName,new Set(["environment"]));this.injector=i,t.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function CD(e,t,i=null){return new rI({providers:e,parent:t,debugName:i,runEnvironmentInitializers:!0}).injector}let nz=(()=>{var e;class t{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n)){const r=pv(0,n.type),s=r.length>0?CD([r],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n,s)}return this.cachedInjectors.get(n)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return(e=t).\u0275prov=Re({token:e,providedIn:"environment",factory:()=>new e(je(Qr))}),t})();function ua(e){e.getStandaloneInjector=t=>t.get(nz).getOrCreateStandaloneInjector(e)}function Tg(e,t,i){const n=Tt()+e,r=ce();return r[n]===En?ca(r,n,i?t.call(i):t()):function ip(e,t){return e[t]}(r,n)}function $a(e,t,i,n){return uI(ce(),Tt(),e,t,i,n)}function qv(e,t){const i=e[t];return i===En?void 0:i}function uI(e,t,i,n,r,s){const d=t+i;return rr(e,d,r)?ca(e,d+1,s?n.call(s,r):n(r)):qv(e,d+1)}function TD(e,t){const i=De();let n;const r=e+ln;i.firstCreatePass?(n=function gz(e,t){if(t)for(let i=t.length-1;i>=0;i--){const n=t[i];if(e===n.name)return n}}(t,i.pipeRegistry),i.data[r]=n,n.onDestroy&&(i.destroyHooks??=[]).push(r,n.onDestroy)):n=i.data[r];const s=n.factory||(n.factory=_l(n.type)),m=$r(oe);try{const b=a_(!1),E=s();return a_(b),function r3(e,t,i,n){i>=e.data.length&&(e.data[i]=null,e.blueprint[i]=null),t[i]=n}(i,ce(),r,E),E}finally{$r(m)}}function gI(e,t,i,n){const r=e+ln,s=ce(),d=Es(s,r);return Wv(s,r)?function hI(e,t,i,n,r,s,d){const m=t+i;return Jf(e,m,r,s)?ca(e,m+2,d?n.call(d,r,s):n(r,s)):qv(e,m+2)}(s,Tt(),t,d.transform,i,n,d):d.transform(i,n)}function Wv(e,t){return e[It].data[t].pure}function SD(e){return t=>{setTimeout(e,void 0,t)}}const Ct=class xz extends vn{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,i,n){let r=t,s=i||(()=>null),d=n;if(t&&"object"==typeof t){const b=t;r=b.next?.bind(b),s=b.error?.bind(b),d=b.complete?.bind(b)}this.__isAsync&&(s=SD(s),r&&(r=SD(r)),d&&(d=SD(d)));const m=super.subscribe({next:r,error:s,complete:d});return t instanceof un&&t.add(m),m}};function wz(){return this._results[Symbol.iterator]()}class MD{get changes(){return this._changes||(this._changes=new Ct)}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const i=MD.prototype;i[Symbol.iterator]||(i[Symbol.iterator]=wz)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,i){return this._results.reduce(t,i)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,i){const n=this;n.dirty=!1;const r=function As(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function gb(e,t,i){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){let r=e[n],s=t[n];if(i&&(r=i(r),s=i(s)),s!==r)return!1}return!0}(n._results,r,i))&&(n._results=r,n.length=r.length,n.last=r[this.length-1],n.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function Dz(e,t,i,n=!0){const r=t[It];if(function Vb(e,t,i,n){const r=Zi+n,s=i.length;n>0&&(i[r-1][Vo]=t),n<s-Zi?(t[Vo]=i[r],d_(i,Zi+n,t)):(i.push(t),t[Vo]=null),t[Ti]=i;const d=t[qd];null!==d&&i!==d&&function w_(e,t){const i=e[Ra];t[Wi]!==t[Ti][Ti][Wi]&&(e[ml]=!0),null===i?e[Ra]=[t]:i.push(t)}(d,t);const m=t[ws];null!==m&&m.insertView(e),t[an]|=128}(r,t,e,i),n){const s=Bh(i,e),d=t[fn],m=T_(d,e[co]);null!==m&&function TC(e,t,i,n,r,s){n[Ni]=r,n[wr]=t,Cf(e,n,i,1,r,s)}(r,e[wr],d,t,m,s)}}let Ui=(()=>{class t{}return t.__NG_ELEMENT_ID__=Sz,t})();const Ez=Ui,Tz=class extends Ez{constructor(t,i,n){super(),this._declarationLView=t,this._declarationTContainer=i,this.elementRef=n}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,i){return this.createEmbeddedViewImpl(t,i)}createEmbeddedViewImpl(t,i,n){const r=function Cz(e,t,i,n){const r=t.tView,m=Qh(e,r,i,4096&e[an]?4096:16,null,t,null,null,null,n?.injector??null,n?.hydrationInfo??null);m[qd]=e[t.index];const E=e[ws];return null!==E&&(m[ws]=E.createEmbeddedView(r)),St(r,m,i),m}(this._declarationLView,this._declarationTContainer,t,{injector:i,hydrationInfo:n});return new Un(r)}};function Sz(){return dx(Pe(),ce())}function dx(e,t){return 4&e.type?new Tz(t,e,Cc(e,t)):null}let ha=(()=>{class t{}return t.__NG_ELEMENT_ID__=Pz,t})();function Pz(){return DI(Pe(),ce())}const Oz=ha,wI=class extends Oz{constructor(t,i,n){super(),this._lContainer=t,this._hostTNode=i,this._hostLView=n}get element(){return Cc(this._hostTNode,this._hostLView)}get injector(){return new Pr(this._hostTNode,this._hostLView)}get parentInjector(){const t=uo(this._hostTNode,this._hostLView);if(bl(t)){const i=nf(t,this._hostLView),n=Pa(t);return new Pr(i[It].data[n+8],i)}return new Pr(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const i=CI(this._lContainer);return null!==i&&i[t]||null}get length(){return this._lContainer.length-Zi}createEmbeddedView(t,i,n){let r,s;"number"==typeof n?r=n:null!=n&&(r=n.index,s=n.injector);const m=t.createEmbeddedViewImpl(i||{},s,null);return this.insertImpl(m,r,false),m}createComponent(t,i,n,r,s){const d=t&&!function cf(e){return"function"==typeof e}(t);let m;if(d)m=i;else{const Te=i||{};m=Te.index,n=Te.injector,r=Te.projectableNodes,s=Te.environmentInjector||Te.ngModuleRef}const b=d?t:new Ii(zn(t)),E=n||this.parentInjector;if(!s&&null==b.ngModule){const ke=(d?E:this.parentInjector).get(Qr,null);ke&&(s=ke)}zn(b.componentType??{});const Y=b.create(E,r,null,s);return this.insertImpl(Y.hostView,m,false),Y}insert(t,i){return this.insertImpl(t,i,!1)}insertImpl(t,i,n){const r=t._lView;if(function y(e){return ur(e[Ti])}(r)){const b=this.indexOf(t);if(-1!==b)this.detach(b);else{const E=r[Ti],I=new wI(E,E[wr],E[Ti]);I.detach(I.indexOf(t))}}const d=this._adjustIndex(i),m=this._lContainer;return Dz(m,r,d,!n),t.attachToViewContainerRef(),d_(AD(m),d,t),t}move(t,i){return this.insert(t,i)}indexOf(t){const i=CI(this._lContainer);return null!==i?i.indexOf(t):-1}remove(t){const i=this._adjustIndex(t,-1),n=hd(this._lContainer,i);n&&(Mh(AD(this._lContainer),i),C_(n[It],n))}detach(t){const i=this._adjustIndex(t,-1),n=hd(this._lContainer,i);return n&&null!=Mh(AD(this._lContainer),i)?new Un(n):null}_adjustIndex(t,i=0){return t??this.length+i}};function CI(e){return e[8]}function AD(e){return e[8]||(e[8]=[])}function DI(e,t){let i;const n=t[e.index];return ur(n)?i=n:(i=xe(n,t,null,e),t[e.index]=i,ze(t,i)),EI(i,t,e,n),new wI(i,e,t)}let EI=function TI(e,t,i,n){if(e[co])return;let r;r=8&i.type?gi(n):function Fz(e,t){const i=e[fn],n=i.createComment(""),r=qr(t,e);return gu(i,T_(i,r),n,function ev(e,t){return e.nextSibling(t)}(i,r),!1),n}(t,i),e[co]=r};class ID{constructor(t){this.queryList=t,this.matches=null}clone(){return new ID(this.queryList)}setDirty(){this.queryList.setDirty()}}class RD{constructor(t=[]){this.queries=t}createEmbeddedView(t){const i=t.queries;if(null!==i){const n=null!==t.contentQueries?t.contentQueries[0]:i.length,r=[];for(let s=0;s<n;s++){const d=i.getByIndex(s);r.push(this.queries[d.indexInDeclarationView].clone())}return new RD(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let i=0;i<this.queries.length;i++)null!==RI(t,i).matches&&this.queries[i].setDirty()}}class SI{constructor(t,i,n=null){this.predicate=t,this.flags=i,this.read=n}}class kD{constructor(t=[]){this.queries=t}elementStart(t,i){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(t,i)}elementEnd(t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(t)}embeddedTView(t){let i=null;for(let n=0;n<this.length;n++){const r=null!==i?i.length:0,s=this.getByIndex(n).embeddedTView(t,r);s&&(s.indexInDeclarationView=n,null!==i?i.push(s):i=[s])}return null!==i?new kD(i):null}template(t,i){for(let n=0;n<this.queries.length;n++)this.queries[n].template(t,i)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class PD{constructor(t,i=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=i}elementStart(t,i){this.isApplyingToNode(i)&&this.matchTNode(t,i)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,i){this.elementStart(t,i)}embeddedTView(t,i){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,i),new PD(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const i=this._declarationNodeIndex;let n=t.parent;for(;null!==n&&8&n.type&&n.index!==i;)n=n.parent;return i===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(t,i){const n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){const s=n[r];this.matchTNodeWithReadOption(t,i,Bz(i,s)),this.matchTNodeWithReadOption(t,i,Dh(i,t,s,!1,!1))}else n===Ui?4&i.type&&this.matchTNodeWithReadOption(t,i,-1):this.matchTNodeWithReadOption(t,i,Dh(i,t,n,!1,!1))}matchTNodeWithReadOption(t,i,n){if(null!==n){const r=this.metadata.read;if(null!==r)if(r===Tn||r===ha||r===Ui&&4&i.type)this.addMatch(i.index,-2);else{const s=Dh(i,t,r,!1,!1);null!==s&&this.addMatch(i.index,s)}else this.addMatch(i.index,n)}}addMatch(t,i){null===this.matches?this.matches=[t,i]:this.matches.push(t,i)}}function Bz(e,t){const i=e.localNames;if(null!==i)for(let n=0;n<i.length;n+=2)if(i[n]===t)return i[n+1];return null}function Vz(e,t,i,n){return-1===i?function zz(e,t){return 11&e.type?Cc(e,t):4&e.type?dx(e,t):null}(t,e):-2===i?function jz(e,t,i){return i===Tn?Cc(t,e):i===Ui?dx(t,e):i===ha?DI(t,e):void 0}(e,t,n):Cl(e,e[It],i,t)}function MI(e,t,i,n){const r=t[ws].queries[n];if(null===r.matches){const s=e.data,d=i.matches,m=[];for(let b=0;b<d.length;b+=2){const E=d[b];m.push(E<0?null:Vz(t,s[E],d[b+1],i.metadata.read))}r.matches=m}return r.matches}function OD(e,t,i,n){const r=e.queries.getByIndex(i),s=r.matches;if(null!==s){const d=MI(e,t,r,i);for(let m=0;m<s.length;m+=2){const b=s[m];if(b>0)n.push(d[m/2]);else{const E=s[m+1],I=t[-b];for(let O=Zi;O<I.length;O++){const q=I[O];q[qd]===q[Ti]&&OD(q[It],q,E,n)}if(null!==I[Ra]){const O=I[Ra];for(let q=0;q<O.length;q++){const Y=O[q];OD(Y[It],Y,E,n)}}}}}return n}function $n(e){const t=ce(),i=De(),n=kr();nr(n+1);const r=RI(i,n);if(e.dirty&&function c(e){return 4==(4&e[an])}(t)===(2==(2&r.metadata.flags))){if(null===r.matches)e.reset([]);else{const s=r.crossesNgTemplate?OD(i,t,n,[]):MI(i,t,r,n);e.reset(s,WC),e.notifyOnChanges()}return!0}return!1}function Ls(e,t,i){const n=De();n.firstCreatePass&&(II(n,new SI(e,t,i),-1),2==(2&t)&&(n.staticViewQueries=!0)),AI(n,ce(),t)}function Hn(){return function Uz(e,t){return e[ws].queries[t].queryList}(ce(),kr())}function AI(e,t,i){const n=new MD(4==(4&i));(function U1(e,t,i,n){const r=lt(t);r.push(i),e.firstCreatePass&&$e(e).push(n,r.length-1)})(e,t,n,n.destroy),null===t[ws]&&(t[ws]=new RD),t[ws].queries.push(new ID(n))}function II(e,t,i){null===e.queries&&(e.queries=new kD),e.queries.track(new PD(t,i))}function RI(e,t){return e.queries.getByIndex(t)}function us(e,t){return dx(e,t)}const VD=new mt("Application Initializer");let jD=(()=>{var e;class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,r)=>{this.resolve=n,this.reject=r}),this.appInits=ft(VD,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const n=[];for(const s of this.appInits){const d=s();if(Lv(d))n.push(d);else if(zM(d)){const m=new Promise((b,E)=>{d.subscribe({complete:b,error:E})});n.push(m)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{r()}).catch(s=>{this.reject(s)}),0===n.length&&r(),this.initialized=!0}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),ZI=(()=>{var e;class t{log(n){console.log(n)}warn(n){console.warn(n)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"platform"}),t})();const Vl=new mt("LocaleId",{providedIn:"root",factory:()=>ft(Vl,pn.Optional|pn.SkipSelf)||function dV(){return typeof $localize<"u"&&$localize.locale||Eg}()});let px=(()=>{var e;class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new jr(!1)}add(){this.hasPendingTasks.next(!0);const n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();class pV{constructor(t,i){this.ngModuleFactory=t,this.componentFactories=i}}let YI=(()=>{var e;class t{compileModuleSync(n){return new wD(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const r=this.compileModuleSync(n),d=za(Gr(n).declarations).reduce((m,b)=>{const E=zn(b);return E&&m.push(new Ii(E)),m},[]);return new pV(r,d)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function JI(...e){}class _n{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ct(!1),this.onMicrotaskEmpty=new Ct(!1),this.onStable=new Ct(!1),this.onError=new Ct(!1),typeof Zone>"u")throw new He(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!n&&i,r.shouldCoalesceRunChangeDetection=n,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function PV(){const e="function"==typeof Kn.requestAnimationFrame;let t=Kn[e?"requestAnimationFrame":"setTimeout"],i=Kn[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&t&&i){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const r=i[Zone.__symbol__("OriginalDelegate")];r&&(i=r)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:i}}().nativeRequestAnimationFrame,function NV(e){const t=()=>{!function FV(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Kn,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,GD(e),e.isCheckStableRunning=!0,HD(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),GD(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,n,r,s,d,m)=>{try{return e2(e),i.invokeTask(r,s,d,m)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||e.shouldCoalesceRunChangeDetection)&&t(),t2(e)}},onInvoke:(i,n,r,s,d,m,b)=>{try{return e2(e),i.invoke(r,s,d,m,b)}finally{e.shouldCoalesceRunChangeDetection&&t(),t2(e)}},onHasTask:(i,n,r,s)=>{i.hasTask(r,s),n===r&&("microTask"==s.change?(e._hasPendingMicrotasks=s.microTask,GD(e),HD(e)):"macroTask"==s.change&&(e.hasPendingMacrotasks=s.macroTask))},onHandleError:(i,n,r,s)=>(i.handleError(r,s),e.runOutsideAngular(()=>e.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!_n.isInAngularZone())throw new He(909,!1)}static assertNotInAngularZone(){if(_n.isInAngularZone())throw new He(909,!1)}run(t,i,n){return this._inner.run(t,i,n)}runTask(t,i,n,r){const s=this._inner,d=s.scheduleEventTask("NgZoneEvent: "+r,t,OV,JI,JI);try{return s.runTask(d,i,n)}finally{s.cancelTask(d)}}runGuarded(t,i,n){return this._inner.runGuarded(t,i,n)}runOutsideAngular(t){return this._outer.run(t)}}const OV={};function HD(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function GD(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function e2(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function t2(e){e._nesting--,HD(e)}class LV{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ct,this.onMicrotaskEmpty=new Ct,this.onStable=new Ct,this.onError=new Ct}run(t,i,n){return t.apply(i,n)}runGuarded(t,i,n){return t.apply(i,n)}runOutsideAngular(t){return t()}runTask(t,i,n,r){return t.apply(i,n)}}const n2=new mt("",{providedIn:"root",factory:r2});function r2(){const e=ft(_n);let t=!0;return Da(new ot(r=>{t=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{r.next(t),r.complete()})}),new ot(r=>{let s;e.runOutsideAngular(()=>{s=e.onStable.subscribe(()=>{_n.assertNotInAngularZone(),queueMicrotask(()=>{!t&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(t=!0,r.next(!0))})})});const d=e.onUnstable.subscribe(()=>{_n.assertInAngularZone(),t&&(t=!1,e.runOutsideAngular(()=>{r.next(!1)}))});return()=>{s.unsubscribe(),d.unsubscribe()}}).pipe(Me()))}const o2=new mt(""),mx=new mt("");let ZD,qD=(()=>{var e;class t{constructor(n,r,s){this._ngZone=n,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,ZD||(function BV(e){ZD=e}(s),s.addToWindow(r)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{_n.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(n)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,s){let d=-1;r&&r>0&&(d=setTimeout(()=>{this._callbacks=this._callbacks.filter(m=>m.timeoutId!==d),n(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:n,timeoutId:d,updateCb:s})}whenStable(n,r,s){if(s&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,s),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,r,s){return[]}}return(e=t).\u0275fac=function(n){return new(n||e)(je(_n),je(WD),je(mx))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})(),WD=(()=>{var e;class t{constructor(){this._applications=new Map}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return ZD?.findTestabilityInTree(this,n,r)??null}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"platform"}),t})(),op=null;const s2=new mt("AllowMultipleToken"),YD=new mt("PlatformDestroyListeners"),XD=new mt("appBootstrapListener");class l2{constructor(t,i){this.name=t,this.token=i}}function d2(e,t,i=[]){const n=`Platform: ${t}`,r=new mt(n);return(s=[])=>{let d=KD();if(!d||d.injector.get(s2,!1)){const m=[...i,...s,{provide:r,useValue:!0}];e?e(m):function jV(e){if(op&&!op.get(s2,!1))throw new He(400,!1);(function a2(){!function r_(e){Rr=e}(()=>{throw new He(600,!1)})})(),op=e;const t=e.get(h2);(function c2(e){e.get(gv,null)?.forEach(i=>i())})(e)}(function u2(e=[],t){return pr.create({name:t,providers:[{provide:Uo,useValue:"platform"},{provide:YD,useValue:new Set([()=>op=null])},...e]})}(m,n))}return function $V(e){const t=KD();if(!t)throw new He(401,!1);return t}()}}function KD(){return op?.get(h2)??null}let h2=(()=>{var e;class t{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){const s=function HV(e="zone.js",t){return"noop"===e?new LV:"zone.js"===e?new _n(t):e}(r?.ngZone,function p2(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return s.run(()=>{const d=function tz(e,t,i){return new xD(e,t,i)}(n.moduleType,this.injector,function y2(e){return[{provide:_n,useFactory:e},{provide:Af,multi:!0,useFactory:()=>{const t=ft(qV,{optional:!0});return()=>t.initialize()}},{provide:g2,useFactory:GV},{provide:n2,useFactory:r2}]}(()=>s)),m=d.injector.get(fo,null);return s.runOutsideAngular(()=>{const b=s.onError.subscribe({next:E=>{m.handleError(E)}});d.onDestroy(()=>{_x(this._modules,d),b.unsubscribe()})}),function f2(e,t,i){try{const n=i();return Lv(n)?n.catch(r=>{throw t.runOutsideAngular(()=>e.handleError(r)),r}):n}catch(n){throw t.runOutsideAngular(()=>e.handleError(n)),n}}(m,s,()=>{const b=d.injector.get(jD);return b.runInitializers(),b.donePromise.then(()=>(function kA(e){No(e,"Expected localeId to be defined"),"string"==typeof e&&(RA=e.toLowerCase().replace(/_/g,"-"))}(d.injector.get(Vl,Eg)||Eg),this._moduleDoBootstrap(d),d))})})}bootstrapModule(n,r=[]){const s=m2({},r);return function zV(e,t,i){const n=new wD(i);return Promise.resolve(n)}(0,0,n).then(d=>this.bootstrapModuleFactory(d,s))}_moduleDoBootstrap(n){const r=n.injector.get(Rc);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(s=>r.bootstrap(s));else{if(!n.instance.ngDoBootstrap)throw new He(-403,!1);n.instance.ngDoBootstrap(r)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new He(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const n=this._injector.get(YD,null);n&&(n.forEach(r=>r()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return(e=t).\u0275fac=function(n){return new(n||e)(je(pr))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"platform"}),t})();function m2(e,t){return Array.isArray(t)?t.reduce(m2,e):{...e,...t}}let Rc=(()=>{var e;class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=ft(g2),this.zoneIsStable=ft(n2),this.componentTypes=[],this.components=[],this.isStable=ft(px).hasPendingTasks.pipe(Fe(n=>n?Vt(!1):this.zoneIsStable),Ue(),Me()),this._injector=ft(Qr)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,r){const s=n instanceof v1;if(!this._injector.get(jD).done)throw!s&&function lo(e){const t=zn(e)||qi(e)||Mr(e);return null!==t&&t.standalone}(n),new He(405,!1);let m;m=s?n:this._injector.get(Bl).resolveComponentFactory(n),this.componentTypes.push(m.componentType);const b=function VV(e){return e.isBoundToModule}(m)?void 0:this._injector.get(im),I=m.create(pr.NULL,[],r||m.selector,b),O=I.location.nativeElement,q=I.injector.get(o2,null);return q?.registerApplication(O),I.onDestroy(()=>{this.detachView(I.hostView),_x(this.components,I),q?.unregisterApplication(O)}),this._loadComponent(I),I}tick(){if(this._runningTick)throw new He(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this.internalErrorHandler(n)}finally{this._runningTick=!1}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;_x(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const r=this._injector.get(XD,[]);r.push(...this._bootstrapListeners),r.forEach(s=>s(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>_x(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new He(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function _x(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}const g2=new mt("",{providedIn:"root",factory:()=>ft(fo).handleError.bind(void 0)});function GV(){const e=ft(_n),t=ft(fo);return i=>e.runOutsideAngular(()=>t.handleError(i))}let qV=(()=>{var e;class t{constructor(){this.zone=ft(_n),this.applicationRef=ft(Rc)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();let Io=(()=>{class t{}return t.__NG_ELEMENT_ID__=ZV,t})();function ZV(e){return function YV(e,t,i){if(ea(e)&&!i){const n=_(e.index,t);return new Un(n,n)}return 47&e.type?new Un(t[Wi],t):null}(Pe(),ce(),16==(16&e))}class w2{constructor(){}supports(t){return np(t)}create(t){return new t4(t)}}const e4=(e,t)=>t;class t4{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||e4}forEachItem(t){let i;for(i=this._itHead;null!==i;i=i._next)t(i)}forEachOperation(t){let i=this._itHead,n=this._removalsHead,r=0,s=null;for(;i||n;){const d=!n||i&&i.currentIndex<D2(n,r,s)?i:n,m=D2(d,r,s),b=d.currentIndex;if(d===n)r--,n=n._nextRemoved;else if(i=i._next,null==d.previousIndex)r++;else{s||(s=[]);const E=m-r,I=b-r;if(E!=I){for(let q=0;q<E;q++){const Y=q<s.length?s[q]:s[q]=0,pe=Y+q;I<=pe&&pe<E&&(s[q]=Y+1)}s[d.previousIndex]=I-E}}m!==b&&t(d,m,b)}}forEachPreviousItem(t){let i;for(i=this._previousItHead;null!==i;i=i._nextPrevious)t(i)}forEachAddedItem(t){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)t(i)}forEachMovedItem(t){let i;for(i=this._movesHead;null!==i;i=i._nextMoved)t(i)}forEachRemovedItem(t){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)t(i)}forEachIdentityChange(t){let i;for(i=this._identityChangesHead;null!==i;i=i._nextIdentityChange)t(i)}diff(t){if(null==t&&(t=[]),!np(t))throw new He(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,s,d,i=this._itHead,n=!1;if(Array.isArray(t)){this.length=t.length;for(let m=0;m<this.length;m++)s=t[m],d=this._trackByFn(m,s),null!==i&&Object.is(i.trackById,d)?(n&&(i=this._verifyReinsertion(i,s,d,m)),Object.is(i.item,s)||this._addIdentityChange(i,s)):(i=this._mismatch(i,s,d,m),n=!0),i=i._next}else r=0,function ds(e,t){if(Array.isArray(e))for(let i=0;i<e.length;i++)t(e[i]);else{const i=e[Symbol.iterator]();let n;for(;!(n=i.next()).done;)t(n.value)}}(t,m=>{d=this._trackByFn(r,m),null!==i&&Object.is(i.trackById,d)?(n&&(i=this._verifyReinsertion(i,m,d,r)),Object.is(i.item,m)||this._addIdentityChange(i,m)):(i=this._mismatch(i,m,d,r),n=!0),i=i._next,r++}),this.length=r;return this._truncate(i),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,i,n,r){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._reinsertAfter(t,s,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._moveAfter(t,s,r)):t=this._addAfter(new n4(i,n),s,r),t}_verifyReinsertion(t,i,n,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==s?t=this._reinsertAfter(s,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const i=t._next;this._addToRemovals(this._unlink(t)),t=i}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,i,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,s=t._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(t,i,n),this._addToMoves(t,n),t}_moveAfter(t,i,n){return this._unlink(t),this._insertAfter(t,i,n),this._addToMoves(t,n),t}_addAfter(t,i,n){return this._insertAfter(t,i,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,i,n){const r=null===i?this._itHead:i._next;return t._next=r,t._prev=i,null===r?this._itTail=t:r._prev=t,null===i?this._itHead=t:i._next=t,null===this._linkedRecords&&(this._linkedRecords=new C2),this._linkedRecords.put(t),t.currentIndex=n,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const i=t._prev,n=t._next;return null===i?this._itHead=n:i._next=n,null===n?this._itTail=i:n._prev=i,t}_addToMoves(t,i){return t.previousIndex===i||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new C2),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,i){return t.item=i,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class n4{constructor(t,i){this.item=t,this.trackById=i,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class r4{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,i){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===i||i<=n.currentIndex)&&Object.is(n.trackById,t))return n;return null}remove(t){const i=t._prevDup,n=t._nextDup;return null===i?this._head=n:i._nextDup=n,null===n?this._tail=i:n._prevDup=i,null===this._head}}class C2{constructor(){this.map=new Map}put(t){const i=t.trackById;let n=this.map.get(i);n||(n=new r4,this.map.set(i,n)),n.add(t)}get(t,i){const r=this.map.get(t);return r?r.get(t,i):null}remove(t){const i=t.trackById;return this.map.get(i).remove(t)&&this.map.delete(i),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function D2(e,t,i){const n=e.previousIndex;if(null===n)return n;let r=0;return i&&n<i.length&&(r=i[n]),n+t+r}class E2{constructor(){}supports(t){return t instanceof Map||Ao(t)}create(){return new o4}}class o4{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let i;for(i=this._mapHead;null!==i;i=i._next)t(i)}forEachPreviousItem(t){let i;for(i=this._previousMapHead;null!==i;i=i._nextPrevious)t(i)}forEachChangedItem(t){let i;for(i=this._changesHead;null!==i;i=i._nextChanged)t(i)}forEachAddedItem(t){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)t(i)}forEachRemovedItem(t){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)t(i)}diff(t){if(t){if(!(t instanceof Map||Ao(t)))throw new He(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let i=this._mapHead;if(this._appendAfter=null,this._forEach(t,(n,r)=>{if(i&&i.key===r)this._maybeAddToChanges(i,n),this._appendAfter=i,i=i._next;else{const s=this._getOrCreateRecordForKey(r,n);i=this._insertBeforeOrAppend(i,s)}}),i){i._prev&&(i._prev._next=null),this._removalsHead=i;for(let n=i;null!==n;n=n._nextRemoved)n===this._mapHead&&(this._mapHead=null),this._records.delete(n.key),n._nextRemoved=n._next,n.previousValue=n.currentValue,n.currentValue=null,n._prev=null,n._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,i){if(t){const n=t._prev;return i._next=t,i._prev=n,t._prev=i,n&&(n._next=i),t===this._mapHead&&(this._mapHead=i),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=i,i._prev=this._appendAfter):this._mapHead=i,this._appendAfter=i,null}_getOrCreateRecordForKey(t,i){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,i);const s=r._prev,d=r._next;return s&&(s._next=d),d&&(d._prev=s),r._next=null,r._prev=null,r}const n=new s4(t);return this._records.set(t,n),n.currentValue=i,this._addToAdditions(n),n}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,i){Object.is(i,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=i,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,i){t instanceof Map?t.forEach(i):Object.keys(t).forEach(n=>i(t[n],n))}}class s4{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function T2(){return new vx([new w2])}let vx=(()=>{var e;class t{constructor(n){this.factories=n}static create(n,r){if(null!=r){const s=r.factories.slice();n=n.concat(s)}return new t(n)}static extend(n){return{provide:t,useFactory:r=>t.create(n,r||T2()),deps:[[t,new Il,new Al]]}}find(n){const r=this.factories.find(s=>s.supports(n));if(null!=r)return r;throw new He(901,!1)}}return(e=t).\u0275prov=Re({token:e,providedIn:"root",factory:T2}),t})();function S2(){return new Xv([new E2])}let Xv=(()=>{var e;class t{constructor(n){this.factories=n}static create(n,r){if(r){const s=r.factories.slice();n=n.concat(s)}return new t(n)}static extend(n){return{provide:t,useFactory:r=>t.create(n,r||S2()),deps:[[t,new Il,new Al]]}}find(n){const r=this.factories.find(s=>s.supports(n));if(r)return r;throw new He(901,!1)}}return(e=t).\u0275prov=Re({token:e,providedIn:"root",factory:S2}),t})();const c4=d2(null,"core",[]);let d4=(()=>{var e;class t{constructor(n){}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Rc))},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})();function Ag(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}function iE(e,t){const i=zn(e),n=t.elementInjector||Zh();return new Ii(i).create(n,t.projectableNodes,t.hostElement,t.environmentInjector)}let rE=null;function sp(){return rE}class D4{}const Sn=new mt("DocumentToken");let oE=(()=>{var e;class t{historyGo(n){throw new Error("Not implemented")}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:function(){return ft(T4)},providedIn:"platform"}),t})();const E4=new mt("Location Initialized");let T4=(()=>{var e;class t extends oE{constructor(){super(),this._doc=ft(Sn),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return sp().getBaseHref(this._doc)}onPopState(n){const r=sp().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){const r=sp().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,r,s){this._history.pushState(n,r,s)}replaceState(n,r,s){this._history.replaceState(n,r,s)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:function(){return new e},providedIn:"platform"}),t})();function sE(e,t){if(0==e.length)return t;if(0==t.length)return e;let i=0;return e.endsWith("/")&&i++,t.startsWith("/")&&i++,2==i?e+t.substring(1):1==i?e+t:e+"/"+t}function F2(e){const t=e.match(/#|\?|$/),i=t&&t.index||e.length;return e.slice(0,i-("/"===e[i-1]?1:0))+e.slice(i)}function Mu(e){return e&&"?"!==e[0]?"?"+e:e}let om=(()=>{var e;class t{historyGo(n){throw new Error("Not implemented")}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:function(){return ft(L2)},providedIn:"root"}),t})();const N2=new mt("appBaseHref");let L2=(()=>{var e;class t extends om{constructor(n,r){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??ft(Sn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return sE(this._baseHref,n)}path(n=!1){const r=this._platformLocation.pathname+Mu(this._platformLocation.search),s=this._platformLocation.hash;return s&&n?`${r}${s}`:r}pushState(n,r,s,d){const m=this.prepareExternalUrl(s+Mu(d));this._platformLocation.pushState(n,r,m)}replaceState(n,r,s,d){const m=this.prepareExternalUrl(s+Mu(d));this._platformLocation.replaceState(n,r,m)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(oE),je(N2,8))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),S4=(()=>{var e;class t extends om{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(n){const r=sE(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,s,d){let m=this.prepareExternalUrl(s+Mu(d));0==m.length&&(m=this._platformLocation.pathname),this._platformLocation.pushState(n,r,m)}replaceState(n,r,s,d){let m=this.prepareExternalUrl(s+Mu(d));0==m.length&&(m=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,m)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(oE),je(N2,8))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})(),Kv=(()=>{var e;class t{constructor(n){this._subject=new Ct,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const r=this._locationStrategy.getBaseHref();this._basePath=function I4(e){if(new RegExp("^(https?:)?//").test(e)){const[,i]=e.split(/\/\/[^\/]+/);return i}return e}(F2(B2(r))),this._locationStrategy.onPopState(s=>{this._subject.emit({url:this.path(!0),pop:!0,state:s.state,type:s.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+Mu(r))}normalize(n){return t.stripTrailingSlash(function A4(e,t){if(!e||!t.startsWith(e))return t;const i=t.substring(e.length);return""===i||["/",";","?","#"].includes(i[0])?i:t}(this._basePath,B2(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",s=null){this._locationStrategy.pushState(s,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Mu(r)),s)}replaceState(n,r="",s=null){this._locationStrategy.replaceState(s,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Mu(r)),s)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(s=>s(n,r))}subscribe(n,r,s){return this._subject.subscribe({next:n,error:r,complete:s})}}return(e=t).normalizeQueryParams=Mu,e.joinWithSlash=sE,e.stripTrailingSlash=F2,e.\u0275fac=function(n){return new(n||e)(je(om))},e.\u0275prov=Re({token:e,factory:function(){return function M4(){return new Kv(je(om))}()},providedIn:"root"}),t})();function B2(e){return e.replace(/\/index.html$/,"")}function Y2(e,t){t=encodeURIComponent(t);for(const i of e.split(";")){const n=i.indexOf("="),[r,s]=-1==n?[i,""]:[i.slice(0,n),i.slice(n+1)];if(r.trim()===t)return decodeURIComponent(s)}return null}const gE=/\s+/,X2=[];let K2=(()=>{var e;class t{constructor(n,r,s,d){this._iterableDiffers=n,this._keyValueDiffers=r,this._ngEl=s,this._renderer=d,this.initialClasses=X2,this.stateMap=new Map}set klass(n){this.initialClasses=null!=n?n.trim().split(gE):X2}set ngClass(n){this.rawClass="string"==typeof n?n.trim().split(gE):n}ngDoCheck(){for(const r of this.initialClasses)this._updateState(r,!0);const n=this.rawClass;if(Array.isArray(n)||n instanceof Set)for(const r of n)this._updateState(r,!0);else if(null!=n)for(const r of Object.keys(n))this._updateState(r,!!n[r]);this._applyStateDiff()}_updateState(n,r){const s=this.stateMap.get(n);void 0!==s?(s.enabled!==r&&(s.changed=!0,s.enabled=r),s.touched=!0):this.stateMap.set(n,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(const n of this.stateMap){const r=n[0],s=n[1];s.changed?(this._toggleClass(r,s.enabled),s.changed=!1):s.touched||(s.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),s.touched=!1}}_toggleClass(n,r){(n=n.trim()).length>0&&n.split(gE).forEach(s=>{r?this._renderer.addClass(this._ngEl.nativeElement,s):this._renderer.removeClass(this._ngEl.nativeElement,s)})}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(vx),oe(Xv),oe(Tn),oe(po))},e.\u0275dir=gt({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),t})();class p5{constructor(t,i,n,r){this.$implicit=t,this.ngForOf=i,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let to=(()=>{var e;class t{set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}constructor(n,r,s){this._viewContainer=n,this._template=r,this._differs=s,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const r=this._viewContainer;n.forEachOperation((s,d,m)=>{if(null==s.previousIndex)r.createEmbeddedView(this._template,new p5(s.item,this._ngForOf,-1,-1),null===m?void 0:m);else if(null==m)r.remove(null===d?void 0:d);else if(null!==d){const b=r.get(d);r.move(b,m),J2(b,s)}});for(let s=0,d=r.length;s<d;s++){const b=r.get(s).context;b.index=s,b.count=d,b.ngForOf=this._ngForOf}n.forEachIdentityChange(s=>{J2(r.get(s.currentIndex),s)})}static ngTemplateContextGuard(n,r){return!0}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(ha),oe(Ui),oe(vx))},e.\u0275dir=gt({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),t})();function J2(e,t){e.context.$implicit=t.item}let fr=(()=>{var e;class t{constructor(n,r){this._viewContainer=n,this._context=new f5,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){eR("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){eR("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,r){return!0}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(ha),oe(Ui))},e.\u0275dir=gt({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),t})();class f5{constructor(){this.$implicit=null,this.ngIf=null}}function eR(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${Ut(t)}'.`)}class yE{constructor(t,i){this._viewContainerRef=t,this._templateRef=i,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let Rx=(()=>{var e;class t{constructor(){this._defaultViews=[],this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(n){this._ngSwitch=n,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(n){this._defaultViews.push(n)}_matchCase(n){const r=n==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||r,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),r}_updateDefaultCases(n){if(this._defaultViews.length>0&&n!==this._defaultUsed){this._defaultUsed=n;for(const r of this._defaultViews)r.enforceState(n)}}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275dir=gt({type:e,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),t})(),tR=(()=>{var e;class t{constructor(n,r,s){this.ngSwitch=s,s._addCase(),this._view=new yE(n,r)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(ha),oe(Ui),oe(Rx,9))},e.\u0275dir=gt({type:e,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),t})(),Dd=(()=>{var e;class t{constructor(n){this._viewContainerRef=n,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(n){if(n.ngTemplateOutlet||n.ngTemplateOutletInjector){const r=this._viewContainerRef;if(this._viewRef&&r.remove(r.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:s,ngTemplateOutletContext:d,ngTemplateOutletInjector:m}=this;this._viewRef=r.createEmbeddedView(s,d,m?{injector:m}:void 0)}else this._viewRef=null}else this._viewRef&&n.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(ha))},e.\u0275dir=gt({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Ci]}),t})(),iR=(()=>{var e;class t{constructor(n){this.differs=n,this.keyValues=[],this.compareFn=rR}transform(n,r=rR){if(!n||!(n instanceof Map)&&"object"!=typeof n)return null;this.differ||(this.differ=this.differs.find(n).create());const s=this.differ.diff(n),d=r!==this.compareFn;return s&&(this.keyValues=[],s.forEachItem(m=>{this.keyValues.push(function F5(e,t){return{key:e,value:t}}(m.key,m.currentValue))})),(s||d)&&(this.keyValues.sort(r),this.compareFn=r),this.keyValues}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Xv,16))},e.\u0275pipe=tr({name:"keyvalue",type:e,pure:!1,standalone:!0}),t})();function rR(e,t){const i=e.key,n=t.key;if(i===n)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(null===i)return 1;if(null===n)return-1;if("string"==typeof i&&"string"==typeof n)return i<n?-1:1;if("number"==typeof i&&"number"==typeof n)return i-n;if("boolean"==typeof i&&"boolean"==typeof n)return i<n?-1:1;const r=String(i),s=String(n);return r==s?0:r<s?-1:1}let oR=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})();const sR="browser";function aR(e){return e===sR}function lR(e){return"server"===e}let U5=(()=>{var e;class t{}return(e=t).\u0275prov=Re({token:e,providedIn:"root",factory:()=>new $5(je(Sn),window)}),t})();class $5{constructor(t,i){this.document=t,this.window=i,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const i=function H5(e,t){const i=e.getElementById(t)||e.getElementsByName(t)[0];if(i)return i;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const n=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let r=n.currentNode;for(;r;){const s=r.shadowRoot;if(s){const d=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(d)return d}r=n.nextNode()}}return null}(this.document,t);i&&(this.scrollToElement(i),i.focus())}setHistoryScrollRestoration(t){this.supportsScrolling()&&(this.window.history.scrollRestoration=t)}scrollToElement(t){const i=t.getBoundingClientRect(),n=i.left+this.window.pageXOffset,r=i.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(n-s[0],r-s[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class cR{}class pj extends D4{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class CE extends pj{static makeCurrent(){!function C4(e){rE||(rE=e)}(new CE)}onAndCancel(t,i,n){return t.addEventListener(i,n),()=>{t.removeEventListener(i,n)}}dispatchEvent(t,i){t.dispatchEvent(i)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,i){return(i=i||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,i){return"window"===i?window:"document"===i?t:"body"===i?t.body:null}getBaseHref(t){const i=function fj(){return t0=t0||document.querySelector("base"),t0?t0.getAttribute("href"):null}();return null==i?null:function mj(e){Ox=Ox||document.createElement("a"),Ox.setAttribute("href",e);const t=Ox.pathname;return"/"===t.charAt(0)?t:`/${t}`}(i)}resetBaseElement(){t0=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return Y2(document.cookie,t)}}let Ox,t0=null,gj=(()=>{var e;class t{build(){return new XMLHttpRequest}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();const DE=new mt("EventManagerPlugins");let fR=(()=>{var e;class t{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(s=>{s.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,r,s){return this._findPluginFor(r).addEventListener(n,r,s)}getZone(){return this._zone}_findPluginFor(n){let r=this._eventNameToPlugin.get(n);if(r)return r;if(r=this._plugins.find(d=>d.supports(n)),!r)throw new He(5101,!1);return this._eventNameToPlugin.set(n,r),r}}return(e=t).\u0275fac=function(n){return new(n||e)(je(DE),je(_n))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();class mR{constructor(t){this._doc=t}}const EE="ng-app-id";let _R=(()=>{var e;class t{constructor(n,r,s,d={}){this.doc=n,this.appId=r,this.nonce=s,this.platformId=d,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=lR(d),this.resetHostNodes()}addStyles(n){for(const r of n)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(n){for(const r of n)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const n=this.styleNodesInDOM;n&&(n.forEach(r=>r.remove()),n.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const r of this.getAllStyles())this.addStyleToHost(n,r)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(const r of this.hostNodes)this.addStyleToHost(r,n)}onStyleRemoved(n){const r=this.styleRef;r.get(n)?.elements?.forEach(s=>s.remove()),r.delete(n)}collectServerRenderedStyles(){const n=this.doc.head?.querySelectorAll(`style[${EE}="${this.appId}"]`);if(n?.length){const r=new Map;return n.forEach(s=>{null!=s.textContent&&r.set(s.textContent,s)}),r}return null}changeUsageCount(n,r){const s=this.styleRef;if(s.has(n)){const d=s.get(n);return d.usage+=r,d.usage}return s.set(n,{usage:r,elements:[]}),r}getStyleElement(n,r){const s=this.styleNodesInDOM,d=s?.get(r);if(d?.parentNode===n)return s.delete(r),d.removeAttribute(EE),d;{const m=this.doc.createElement("style");return this.nonce&&m.setAttribute("nonce",this.nonce),m.textContent=r,this.platformIsServer&&m.setAttribute(EE,this.appId),m}}addStyleToHost(n,r){const s=this.getStyleElement(n,r);n.appendChild(s);const d=this.styleRef,m=d.get(r)?.elements;m?m.push(s):d.set(r,{elements:[s],usage:1})}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn),je(aa),je(yv,8),je(Ll))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();const TE={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},SE=/%COMP%/g,xj=new mt("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function yR(e,t){return t.map(i=>i.replace(SE,e))}let ME=(()=>{var e;class t{constructor(n,r,s,d,m,b,E,I=null){this.eventManager=n,this.sharedStylesHost=r,this.appId=s,this.removeStylesOnCompDestroy=d,this.doc=m,this.platformId=b,this.ngZone=E,this.nonce=I,this.rendererByCompId=new Map,this.platformIsServer=lR(b),this.defaultRenderer=new AE(n,m,E,this.platformIsServer)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===wo.ShadowDom&&(r={...r,encapsulation:wo.Emulated});const s=this.getOrCreateRenderer(n,r);return s instanceof bR?s.applyToHost(n):s instanceof IE&&s.applyStyles(),s}getOrCreateRenderer(n,r){const s=this.rendererByCompId;let d=s.get(r.id);if(!d){const m=this.doc,b=this.ngZone,E=this.eventManager,I=this.sharedStylesHost,O=this.removeStylesOnCompDestroy,q=this.platformIsServer;switch(r.encapsulation){case wo.Emulated:d=new bR(E,I,r,this.appId,O,m,b,q);break;case wo.ShadowDom:return new Ej(E,I,n,r,m,b,this.nonce,q);default:d=new IE(E,I,r,O,m,b,q)}s.set(r.id,d)}return d}ngOnDestroy(){this.rendererByCompId.clear()}}return(e=t).\u0275fac=function(n){return new(n||e)(je(fR),je(_R),je(aa),je(xj),je(Sn),je(Ll),je(_n),je(yv))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();class AE{constructor(t,i,n,r){this.eventManager=t,this.doc=i,this.ngZone=n,this.platformIsServer=r,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,i){return i?this.doc.createElementNS(TE[i]||i,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,i){(vR(t)?t.content:t).appendChild(i)}insertBefore(t,i,n){t&&(vR(t)?t.content:t).insertBefore(i,n)}removeChild(t,i){t&&t.removeChild(i)}selectRootElement(t,i){let n="string"==typeof t?this.doc.querySelector(t):t;if(!n)throw new He(-5104,!1);return i||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,i,n,r){if(r){i=r+":"+i;const s=TE[r];s?t.setAttributeNS(s,i,n):t.setAttribute(i,n)}else t.setAttribute(i,n)}removeAttribute(t,i,n){if(n){const r=TE[n];r?t.removeAttributeNS(r,i):t.removeAttribute(`${n}:${i}`)}else t.removeAttribute(i)}addClass(t,i){t.classList.add(i)}removeClass(t,i){t.classList.remove(i)}setStyle(t,i,n,r){r&(Fl.DashCase|Fl.Important)?t.style.setProperty(i,n,r&Fl.Important?"important":""):t.style[i]=n}removeStyle(t,i,n){n&Fl.DashCase?t.style.removeProperty(i):t.style[i]=""}setProperty(t,i,n){t[i]=n}setValue(t,i){t.nodeValue=i}listen(t,i,n){if("string"==typeof t&&!(t=sp().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${i}`);return this.eventManager.addEventListener(t,i,this.decoratePreventDefault(n))}decoratePreventDefault(t){return i=>{if("__ngUnwrap__"===i)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(i)):t(i))&&i.preventDefault()}}}function vR(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class Ej extends AE{constructor(t,i,n,r,s,d,m,b){super(t,s,d,b),this.sharedStylesHost=i,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const E=yR(r.id,r.styles);for(const I of E){const O=document.createElement("style");m&&O.setAttribute("nonce",m),O.textContent=I,this.shadowRoot.appendChild(O)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,i){return super.appendChild(this.nodeOrShadowRoot(t),i)}insertBefore(t,i,n){return super.insertBefore(this.nodeOrShadowRoot(t),i,n)}removeChild(t,i){return super.removeChild(this.nodeOrShadowRoot(t),i)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class IE extends AE{constructor(t,i,n,r,s,d,m,b){super(t,s,d,m),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=r,this.styles=b?yR(b,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class bR extends IE{constructor(t,i,n,r,s,d,m,b){const E=r+"-"+n.id;super(t,i,n,s,d,m,b,E),this.contentAttr=function wj(e){return"_ngcontent-%COMP%".replace(SE,e)}(E),this.hostAttr=function Cj(e){return"_nghost-%COMP%".replace(SE,e)}(E)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,i){const n=super.createElement(t,i);return super.setAttribute(n,this.contentAttr,""),n}}let Tj=(()=>{var e;class t extends mR{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,s){return n.addEventListener(r,s,!1),()=>this.removeEventListener(n,r,s)}removeEventListener(n,r,s){return n.removeEventListener(r,s)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();const xR=["alt","control","meta","shift"],Sj={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Mj={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let Aj=(()=>{var e;class t extends mR{constructor(n){super(n)}supports(n){return null!=t.parseEventName(n)}addEventListener(n,r,s){const d=t.parseEventName(r),m=t.eventCallback(d.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>sp().onAndCancel(n,d.domEventName,m))}static parseEventName(n){const r=n.toLowerCase().split("."),s=r.shift();if(0===r.length||"keydown"!==s&&"keyup"!==s)return null;const d=t._normalizeKey(r.pop());let m="",b=r.indexOf("code");if(b>-1&&(r.splice(b,1),m="code."),xR.forEach(I=>{const O=r.indexOf(I);O>-1&&(r.splice(O,1),m+=I+".")}),m+=d,0!=r.length||0===d.length)return null;const E={};return E.domEventName=s,E.fullKey=m,E}static matchEventFullKeyCode(n,r){let s=Sj[n.key]||n.key,d="";return r.indexOf("code.")>-1&&(s=n.code,d="code."),!(null==s||!s)&&(s=s.toLowerCase()," "===s?s="space":"."===s&&(s="dot"),xR.forEach(m=>{m!==s&&(0,Mj[m])(n)&&(d+=m+".")}),d+=s,d===r)}static eventCallback(n,r,s){return d=>{t.matchEventFullKeyCode(d,n)&&s.runGuarded(()=>r(d))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();const CR=[{provide:Ll,useValue:sR},{provide:gv,useValue:function Ij(){CE.makeCurrent()},multi:!0},{provide:Sn,useFactory:function kj(){return function Ef(e){R_=e}(document),document},deps:[]}],Pj=d2(c4,"browser",CR),Oj=new mt(""),DR=[{provide:mx,useClass:class _j{addToWindow(t){Kn.getAngularTestability=(n,r=!0)=>{const s=t.findTestabilityInTree(n,r);if(null==s)throw new He(5103,!1);return s},Kn.getAllAngularTestabilities=()=>t.getAllTestabilities(),Kn.getAllAngularRootElements=()=>t.getAllRootElements(),Kn.frameworkStabilizers||(Kn.frameworkStabilizers=[]),Kn.frameworkStabilizers.push(n=>{const r=Kn.getAllAngularTestabilities();let s=r.length,d=!1;const m=function(b){d=d||b,s--,0==s&&n(d)};r.forEach(b=>{b.whenStable(m)})})}findTestabilityInTree(t,i,n){return null==i?null:t.getTestability(i)??(n?sp().isShadowRoot(i)?this.findTestabilityInTree(t,i.host,!0):this.findTestabilityInTree(t,i.parentElement,!0):null)}},deps:[]},{provide:o2,useClass:qD,deps:[_n,WD,mx]},{provide:qD,useClass:qD,deps:[_n,WD,mx]}],ER=[{provide:Uo,useValue:"root"},{provide:fo,useFactory:function Rj(){return new fo},deps:[]},{provide:DE,useClass:Tj,multi:!0,deps:[Sn,_n,Ll]},{provide:DE,useClass:Aj,multi:!0,deps:[Sn]},ME,_R,fR,{provide:Ba,useExisting:ME},{provide:cR,useClass:gj,deps:[]},[]];let Rg=(()=>{var e;class t{constructor(n){}static withServerTransition(n){return{ngModule:t,providers:[{provide:aa,useValue:n.appId}]}}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Oj,12))},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({providers:[...ER,...DR],imports:[oR,d4]}),t})(),TR=(()=>{var e;class t{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn))},e.\u0275prov=Re({token:e,factory:function(n){let r=null;return r=n?new n:function Nj(){return new TR(je(Sn))}(),r},providedIn:"root"}),t})();typeof window<"u"&&window;let kE=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:function(n){let r=null;return r=n?new(n||e):je(AR),r},providedIn:"root"}),t})(),AR=(()=>{var e;class t extends kE{constructor(n){super(),this._doc=n}sanitize(n,r){if(null==r)return null;switch(n){case Kr.NONE:return r;case Kr.HTML:return Li(r,"HTML")?ls(r):r1(this._doc,String(r)).toString();case Kr.STYLE:return Li(r,"Style")?ls(r):r;case Kr.SCRIPT:if(Li(r,"Script"))return ls(r);throw new He(5200,!1);case Kr.URL:return Li(r,"URL")?ls(r):vu(String(r));case Kr.RESOURCE_URL:if(Li(r,"ResourceURL"))return ls(r);throw new He(5201,!1);default:throw new He(5202,!1)}}bypassSecurityTrustHtml(n){return function jh(e){return new Xb(e)}(n)}bypassSecurityTrustStyle(n){return function Sf(e){return new kC(e)}(n)}bypassSecurityTrustScript(n){return function Qb(e){return new PC(e)}(n)}bypassSecurityTrustUrl(n){return function Jb(e){return new Kb(e)}(n)}bypassSecurityTrustResourceUrl(n){return function OC(e){return new O_(e)}(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn))},e.\u0275prov=Re({token:e,factory:function(n){let r=null;return r=n?new n:function Vj(e){return new AR(e.get(Sn))}(je(pr)),r},providedIn:"root"}),t})();class PE extends Gn{notifyNext(t,i,n,r,s){this.destination.next(i)}notifyError(t,i){this.destination.error(t)}notifyComplete(t){this.destination.complete()}}class Uj extends Gn{constructor(t,i,n){super(),this.parent=t,this.outerValue=i,this.outerIndex=n,this.index=0}_next(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)}_error(t){this.parent.notifyError(t,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function OE(e,t,i,n,r=new Uj(e,i,n)){if(!r.closed)return t instanceof ot?t.subscribe(r):Dn(t)(r)}const RR={};function Fx(...e){let t,i;return hn(e[e.length-1])&&(i=e.pop()),"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&Vr(e[0])&&(e=e[0]),gs(e,i).lift(new $j(t))}class $j{constructor(t){this.resultSelector=t}call(t,i){return i.subscribe(new Hj(t,this.resultSelector))}}class Hj extends PE{constructor(t,i){super(t),this.resultSelector=i,this.active=0,this.values=[],this.observables=[]}_next(t){this.values.push(RR),this.observables.push(t)}_complete(){const t=this.observables,i=t.length;if(0===i)this.destination.complete();else{this.active=i,this.toRespond=i;for(let n=0;n<i;n++)this.add(OE(this,t[n],void 0,n))}}notifyComplete(t){0==(this.active-=1)&&this.destination.complete()}notifyNext(t,i,n){const r=this.values,d=this.toRespond?r[n]===RR?--this.toRespond:this.toRespond:0;r[n]=i,0===d&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))}_tryResultSelector(t){let i;try{i=this.resultSelector.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(i)}}const Nx=(()=>{function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e})();function n0(...e){return function Gj(){return Gs(1)}()(Vt(...e))}const lp=new ot(e=>e.complete());function Lx(e){return e?function qj(e){return new ot(t=>e.schedule(()=>t.complete()))}(e):lp}function kR(e){return new ot(t=>{let i;try{i=e()}catch(r){return void t.error(r)}return(i?ei(i):Lx()).subscribe(t)})}function sm(e,t){return new ot(t?i=>t.schedule(Wj,0,{error:e,subscriber:i}):i=>i.error(e))}function Wj({error:e,subscriber:t}){t.error(e)}const PR=(()=>{function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e})();function no(e){return t=>0===e?Lx():t.lift(new Zj(e))}class Zj{constructor(t){if(this.total=t,this.total<0)throw new PR}call(t,i){return i.subscribe(new Yj(t,this.total))}}class Yj extends Gn{constructor(t,i){super(t),this.total=i,this.count=0}_next(t){const i=this.total,n=++this.count;n<=i&&(this.destination.next(t),n===i&&(this.destination.complete(),this.unsubscribe()))}}function kg(...e){const t=e[e.length-1];return hn(t)?(e.pop(),i=>n0(e,i,t)):i=>n0(e,i)}function sr(e,t){return function(n){return n.lift(new Xj(e,t))}}class Xj{constructor(t,i){this.predicate=t,this.thisArg=i}call(t,i){return i.subscribe(new Kj(t,this.predicate,this.thisArg))}}class Kj extends Gn{constructor(t,i,n){super(t),this.predicate=i,this.thisArg=n,this.count=0}_next(t){let i;try{i=this.predicate.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}i&&this.destination.next(t)}}function Bx(e=null){return t=>t.lift(new Qj(e))}class Qj{constructor(t){this.defaultValue=t}call(t,i){return i.subscribe(new Jj(t,this.defaultValue))}}class Jj extends Gn{constructor(t,i){super(t),this.defaultValue=i,this.isEmpty=!0}_next(t){this.isEmpty=!1,this.destination.next(t)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function OR(e=nU){return t=>t.lift(new eU(e))}class eU{constructor(t){this.errorFactory=t}call(t,i){return i.subscribe(new tU(t,this.errorFactory))}}class tU extends Gn{constructor(t,i){super(t),this.errorFactory=i,this.hasValue=!1}_next(t){this.hasValue=!0,this.destination.next(t)}_complete(){if(this.hasValue)return this.destination.complete();{let t;try{t=this.errorFactory()}catch(i){t=i}this.destination.error(t)}}}function nU(){return new Nx}function am(e,t){const i=arguments.length>=2;return n=>n.pipe(e?sr((r,s)=>e(r,s,n)):Us,no(1),i?Bx(t):OR(()=>new Nx))}function Pg(e,t){return er(e,t,1)}function cp(){}function Nr(e,t,i){return function(r){return r.lift(new iU(e,t,i))}}class iU{constructor(t,i,n){this.nextOrObserver=t,this.error=i,this.complete=n}call(t,i){return i.subscribe(new rU(t,this.nextOrObserver,this.error,this.complete))}}class rU extends Gn{constructor(t,i,n,r){super(t),this._tapNext=cp,this._tapError=cp,this._tapComplete=cp,this._tapError=n||cp,this._tapComplete=r||cp,ql(i)?(this._context=this,this._tapNext=i):i&&(this._context=i,this._tapNext=i.next||cp,this._tapError=i.error||cp,this._tapComplete=i.complete||cp)}_next(t){try{this._tapNext.call(this._context,t)}catch(i){return void this.destination.error(i)}this.destination.next(t)}_error(t){try{this._tapError.call(this._context,t)}catch(i){return void this.destination.error(i)}this.destination.error(t)}_complete(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()}}function lm(e){return function(i){const n=new oU(e),r=i.lift(n);return n.caught=r}}class oU{constructor(t){this.selector=t}call(t,i){return i.subscribe(new sU(t,this.selector,this.caught))}}class sU extends Hs{constructor(t,i,n){super(t),this.selector=i,this.caught=n}error(t){if(!this.isStopped){let i;try{i=this.selector(t,this.caught)}catch(s){return void super.error(s)}this._unsubscribeAndRecycle();const n=new $s(this);this.add(n);const r=_s(i,n);r!==n&&this.add(r)}}}class lU{constructor(t,i,n=!1){this.accumulator=t,this.seed=i,this.hasSeed=n}call(t,i){return i.subscribe(new cU(t,this.accumulator,this.seed,this.hasSeed))}}class cU extends Gn{constructor(t,i,n,r){super(t),this.accumulator=i,this._seed=n,this.hasSeed=r,this.index=0}get seed(){return this._seed}set seed(t){this.hasSeed=!0,this._seed=t}_next(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)}_tryNext(t){const i=this.index++;let n;try{n=this.accumulator(this.seed,t,i)}catch(r){this.destination.error(r)}this.seed=n,this.destination.next(n)}}function FE(e){return function(i){return 0===e?Lx():i.lift(new dU(e))}}class dU{constructor(t){if(this.total=t,this.total<0)throw new PR}call(t,i){return i.subscribe(new uU(t,this.total))}}class uU extends Gn{constructor(t,i){super(t),this.total=i,this.ring=new Array,this.count=0}_next(t){const i=this.ring,n=this.total,r=this.count++;i.length<n?i.push(t):i[r%n]=t}_complete(){const t=this.destination;let i=this.count;if(i>0){const n=this.count>=this.total?this.total:this.count,r=this.ring;for(let s=0;s<n;s++){const d=i++%n;t.next(r[d])}}t.complete()}}class fU{constructor(t){this.value=t}call(t,i){return i.subscribe(new mU(t,this.value))}}class mU extends Gn{constructor(t,i){super(t),this.value=i}_next(t){this.destination.next(this.value)}}function Og(e){return t=>t.lift(new _U(e))}class _U{constructor(t){this.callback=t}call(t,i){return i.subscribe(new gU(t,this.callback))}}class gU extends Gn{constructor(t,i){super(t),this.add(new un(i))}}const Nn="primary",r0=Symbol("RouteTitle");class yU{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const i=this.params[t];return Array.isArray(i)?i[0]:i}return null}getAll(t){if(this.has(t)){const i=this.params[t];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}}function Fg(e){return new yU(e)}function vU(e,t,i){const n=i.path.split("/");if(n.length>e.length||"full"===i.pathMatch&&(t.hasChildren()||n.length<e.length))return null;const r={};for(let s=0;s<n.length;s++){const d=n[s],m=e[s];if(d.startsWith(":"))r[d.substring(1)]=m;else if(d!==m.path)return null}return{consumed:e.slice(0,n.length),posParams:r}}function Ed(e,t){const i=e?Object.keys(e):void 0,n=t?Object.keys(t):void 0;if(!i||!n||i.length!=n.length)return!1;let r;for(let s=0;s<i.length;s++)if(r=i[s],!FR(e[r],t[r]))return!1;return!0}function FR(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const i=[...e].sort(),n=[...t].sort();return i.every((r,s)=>n[s]===r)}return e===t}function NR(e){return e.length>0?e[e.length-1]:null}function dp(e){return function jj(e){return!!e&&(e instanceof ot||"function"==typeof e.lift&&"function"==typeof e.subscribe)}(e)?e:Lv(e)?ei(Promise.resolve(e)):Vt(e)}const xU={exact:function zR(e,t,i){if(!cm(e.segments,t.segments)||!zx(e.segments,t.segments,i)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const n in t.children)if(!e.children[n]||!zR(e.children[n],t.children[n],i))return!1;return!0},subset:VR},LR={exact:function wU(e,t){return Ed(e,t)},subset:function CU(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(i=>FR(e[i],t[i]))},ignored:()=>!0};function BR(e,t,i){return xU[i.paths](e.root,t.root,i.matrixParams)&&LR[i.queryParams](e.queryParams,t.queryParams)&&!("exact"===i.fragment&&e.fragment!==t.fragment)}function VR(e,t,i){return jR(e,t,t.segments,i)}function jR(e,t,i,n){if(e.segments.length>i.length){const r=e.segments.slice(0,i.length);return!(!cm(r,i)||t.hasChildren()||!zx(r,i,n))}if(e.segments.length===i.length){if(!cm(e.segments,i)||!zx(e.segments,i,n))return!1;for(const r in t.children)if(!e.children[r]||!VR(e.children[r],t.children[r],n))return!1;return!0}{const r=i.slice(0,e.segments.length),s=i.slice(e.segments.length);return!!(cm(e.segments,r)&&zx(e.segments,r,n)&&e.children[Nn])&&jR(e.children[Nn],t,s,n)}}function zx(e,t,i){return t.every((n,r)=>LR[i](e[r].parameters,n.parameters))}class Ng{constructor(t=new Ri([],{}),i={},n=null){this.root=t,this.queryParams=i,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Fg(this.queryParams)),this._queryParamMap}toString(){return TU.serialize(this)}}class Ri{constructor(t,i){this.segments=t,this.children=i,this.parent=null,Object.values(i).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Vx(this)}}class o0{constructor(t,i){this.path=t,this.parameters=i}get parameterMap(){return this._parameterMap||(this._parameterMap=Fg(this.parameters)),this._parameterMap}toString(){return HR(this)}}function cm(e,t){return e.length===t.length&&e.every((i,n)=>i.path===t[n].path)}let s0=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:function(){return new NE},providedIn:"root"}),t})();class NE{parse(t){const i=new LU(t);return new Ng(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(t){const i=`/${a0(t.root,!0)}`,n=function AU(e){const t=Object.keys(e).map(i=>{const n=e[i];return Array.isArray(n)?n.map(r=>`${jx(i)}=${jx(r)}`).join("&"):`${jx(i)}=${jx(n)}`}).filter(i=>!!i);return t.length?`?${t.join("&")}`:""}(t.queryParams),r="string"==typeof t.fragment?`#${function SU(e){return encodeURI(e)}(t.fragment)}`:"";return`${i}${n}${r}`}}const TU=new NE;function Vx(e){return e.segments.map(t=>HR(t)).join("/")}function a0(e,t){if(!e.hasChildren())return Vx(e);if(t){const i=e.children[Nn]?a0(e.children[Nn],!1):"",n=[];return Object.entries(e.children).forEach(([r,s])=>{r!==Nn&&n.push(`${r}:${a0(s,!1)}`)}),n.length>0?`${i}(${n.join("//")})`:i}{const i=function EU(e,t){let i=[];return Object.entries(e.children).forEach(([n,r])=>{n===Nn&&(i=i.concat(t(r,n)))}),Object.entries(e.children).forEach(([n,r])=>{n!==Nn&&(i=i.concat(t(r,n)))}),i}(e,(n,r)=>r===Nn?[a0(e.children[Nn],!1)]:[`${r}:${a0(n,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Nn]?`${Vx(e)}/${i[0]}`:`${Vx(e)}/(${i.join("//")})`}}function UR(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function jx(e){return UR(e).replace(/%3B/gi,";")}function LE(e){return UR(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ux(e){return decodeURIComponent(e)}function $R(e){return Ux(e.replace(/\+/g,"%20"))}function HR(e){return`${LE(e.path)}${function MU(e){return Object.keys(e).map(t=>`;${LE(t)}=${LE(e[t])}`).join("")}(e.parameters)}`}const IU=/^[^\/()?;#]+/;function BE(e){const t=e.match(IU);return t?t[0]:""}const RU=/^[^\/()?;=#]+/,PU=/^[^=?&#]+/,FU=/^[^&#]+/;class LU{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Ri([],{}):new Ri([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(i).length>0)&&(n[Nn]=new Ri(t,i)),n}parseSegment(){const t=BE(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new He(4009,!1);return this.capture(t),new o0(Ux(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const i=function kU(e){const t=e.match(RU);return t?t[0]:""}(this.remaining);if(!i)return;this.capture(i);let n="";if(this.consumeOptional("=")){const r=BE(this.remaining);r&&(n=r,this.capture(n))}t[Ux(i)]=Ux(n)}parseQueryParam(t){const i=function OU(e){const t=e.match(PU);return t?t[0]:""}(this.remaining);if(!i)return;this.capture(i);let n="";if(this.consumeOptional("=")){const d=function NU(e){const t=e.match(FU);return t?t[0]:""}(this.remaining);d&&(n=d,this.capture(n))}const r=$R(i),s=$R(n);if(t.hasOwnProperty(r)){let d=t[r];Array.isArray(d)||(d=[d],t[r]=d),d.push(s)}else t[r]=s}parseParens(t){const i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=BE(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new He(4010,!1);let s;n.indexOf(":")>-1?(s=n.slice(0,n.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=Nn);const d=this.parseChildren();i[s]=1===Object.keys(d).length?d[Nn]:new Ri([],d),this.consumeOptional("//")}return i}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new He(4011,!1)}}function GR(e){return e.segments.length>0?new Ri([],{[Nn]:e}):e}function qR(e){const t={};for(const n of Object.keys(e.children)){const s=qR(e.children[n]);if(n===Nn&&0===s.segments.length&&s.hasChildren())for(const[d,m]of Object.entries(s.children))t[d]=m;else(s.segments.length>0||s.hasChildren())&&(t[n]=s)}return function BU(e){if(1===e.numberOfChildren&&e.children[Nn]){const t=e.children[Nn];return new Ri(e.segments.concat(t.segments),t.children)}return e}(new Ri(e.segments,t))}function dm(e){return e instanceof Ng}function WR(e){let t;const r=GR(function i(s){const d={};for(const b of s.children){const E=i(b);d[b.outlet]=E}const m=new Ri(s.url,d);return s===e&&(t=m),m}(e.root));return t??r}function ZR(e,t,i,n){let r=e;for(;r.parent;)r=r.parent;if(0===t.length)return zE(r,r,r,i,n);const s=function VU(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new XR(!0,0,e);let t=0,i=!1;const n=e.reduce((r,s,d)=>{if("object"==typeof s&&null!=s){if(s.outlets){const m={};return Object.entries(s.outlets).forEach(([b,E])=>{m[b]="string"==typeof E?E.split("/"):E}),[...r,{outlets:m}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===d?(s.split("/").forEach((m,b)=>{0==b&&"."===m||(0==b&&""===m?i=!0:".."===m?t++:""!=m&&r.push(m))}),r):[...r,s]},[]);return new XR(i,t,n)}(t);if(s.toRoot())return zE(r,r,new Ri([],{}),i,n);const d=function jU(e,t,i){if(e.isAbsolute)return new Hx(t,!0,0);if(!i)return new Hx(t,!1,NaN);if(null===i.parent)return new Hx(i,!0,0);const n=$x(e.commands[0])?0:1;return function UU(e,t,i){let n=e,r=t,s=i;for(;s>r;){if(s-=r,n=n.parent,!n)throw new He(4005,!1);r=n.segments.length}return new Hx(n,!1,r-s)}(i,i.segments.length-1+n,e.numberOfDoubleDots)}(s,r,e),m=d.processChildren?c0(d.segmentGroup,d.index,s.commands):KR(d.segmentGroup,d.index,s.commands);return zE(r,d.segmentGroup,m,i,n)}function $x(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function l0(e){return"object"==typeof e&&null!=e&&e.outlets}function zE(e,t,i,n,r){let d,s={};n&&Object.entries(n).forEach(([b,E])=>{s[b]=Array.isArray(E)?E.map(I=>`${I}`):`${E}`}),d=e===t?i:YR(e,t,i);const m=GR(qR(d));return new Ng(m,s,r)}function YR(e,t,i){const n={};return Object.entries(e.children).forEach(([r,s])=>{n[r]=s===t?i:YR(s,t,i)}),new Ri(e.segments,n)}class XR{constructor(t,i,n){if(this.isAbsolute=t,this.numberOfDoubleDots=i,this.commands=n,t&&n.length>0&&$x(n[0]))throw new He(4003,!1);const r=n.find(l0);if(r&&r!==NR(n))throw new He(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Hx{constructor(t,i,n){this.segmentGroup=t,this.processChildren=i,this.index=n}}function KR(e,t,i){if(e||(e=new Ri([],{})),0===e.segments.length&&e.hasChildren())return c0(e,t,i);const n=function HU(e,t,i){let n=0,r=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<e.segments.length;){if(n>=i.length)return s;const d=e.segments[r],m=i[n];if(l0(m))break;const b=`${m}`,E=n<i.length-1?i[n+1]:null;if(r>0&&void 0===b)break;if(b&&E&&"object"==typeof E&&void 0===E.outlets){if(!JR(b,E,d))return s;n+=2}else{if(!JR(b,{},d))return s;n++}r++}return{match:!0,pathIndex:r,commandIndex:n}}(e,t,i),r=i.slice(n.commandIndex);if(n.match&&n.pathIndex<e.segments.length){const s=new Ri(e.segments.slice(0,n.pathIndex),{});return s.children[Nn]=new Ri(e.segments.slice(n.pathIndex),e.children),c0(s,0,r)}return n.match&&0===r.length?new Ri(e.segments,{}):n.match&&!e.hasChildren()?VE(e,t,i):n.match?c0(e,0,r):VE(e,t,i)}function c0(e,t,i){if(0===i.length)return new Ri(e.segments,{});{const n=function $U(e){return l0(e[0])?e[0].outlets:{[Nn]:e}}(i),r={};if(!n[Nn]&&e.children[Nn]&&1===e.numberOfChildren&&0===e.children[Nn].segments.length){const s=c0(e.children[Nn],t,i);return new Ri(e.segments,s.children)}return Object.entries(n).forEach(([s,d])=>{"string"==typeof d&&(d=[d]),null!==d&&(r[s]=KR(e.children[s],t,d))}),Object.entries(e.children).forEach(([s,d])=>{void 0===n[s]&&(r[s]=d)}),new Ri(e.segments,r)}}function VE(e,t,i){const n=e.segments.slice(0,t);let r=0;for(;r<i.length;){const s=i[r];if(l0(s)){const b=GU(s.outlets);return new Ri(n,b)}if(0===r&&$x(i[0])){n.push(new o0(e.segments[t].path,QR(i[0]))),r++;continue}const d=l0(s)?s.outlets[Nn]:`${s}`,m=r<i.length-1?i[r+1]:null;d&&m&&$x(m)?(n.push(new o0(d,QR(m))),r+=2):(n.push(new o0(d,{})),r++)}return new Ri(n,{})}function GU(e){const t={};return Object.entries(e).forEach(([i,n])=>{"string"==typeof n&&(n=[n]),null!==n&&(t[i]=VE(new Ri([],{}),0,n))}),t}function QR(e){const t={};return Object.entries(e).forEach(([i,n])=>t[i]=`${n}`),t}function JR(e,t,i){return e==i.path&&Ed(t,i.parameters)}const d0="imperative";class Td{constructor(t,i){this.id=t,this.url=i}}class jE extends Td{constructor(t,i,n="imperative",r=null){super(t,i),this.type=0,this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class um extends Td{constructor(t,i,n){super(t,i),this.urlAfterRedirects=n,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Gx extends Td{constructor(t,i,n,r){super(t,i),this.reason=n,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class u0 extends Td{constructor(t,i,n,r){super(t,i),this.reason=n,this.code=r,this.type=16}}class UE extends Td{constructor(t,i,n,r){super(t,i),this.error=n,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class qU extends Td{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class WU extends Td{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ZU extends Td{constructor(t,i,n,r,s){super(t,i),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class YU extends Td{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class XU extends Td{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class KU{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class QU{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class JU{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class e6{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class t6{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class n6{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ek{constructor(t,i,n){this.routerEvent=t,this.position=i,this.anchor=n,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class r6{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new h0,this.attachRef=null}}let h0=(()=>{var e;class t{constructor(){this.contexts=new Map}onChildOutletCreated(n,r){const s=this.getOrCreateContext(n);s.outlet=r,this.contexts.set(n,s)}onChildOutletDestroyed(n){const r=this.getContext(n);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let r=this.getContext(n);return r||(r=new r6,this.contexts.set(n,r)),r}getContext(n){return this.contexts.get(n)||null}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();class tk{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const i=this.pathFromRoot(t);return i.length>1?i[i.length-2]:null}children(t){const i=$E(t,this._root);return i?i.children.map(n=>n.value):[]}firstChild(t){const i=$E(t,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(t){const i=HE(t,this._root);return i.length<2?[]:i[i.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return HE(t,this._root).map(i=>i.value)}}function $E(e,t){if(e===t.value)return t;for(const i of t.children){const n=$E(e,i);if(n)return n}return null}function HE(e,t){if(e===t.value)return[t];for(const i of t.children){const n=HE(e,i);if(n.length)return n.unshift(t),n}return[]}class Ru{constructor(t,i){this.value=t,this.children=i}toString(){return`TreeNode(${this.value})`}}function Lg(e){const t={};return e&&e.children.forEach(i=>t[i.value.outlet]=i),t}class nk extends tk{constructor(t,i){super(t),this.snapshot=i,GE(this,t)}toString(){return this.snapshot.toString()}}function ik(e,t){const i=function o6(e,t){const d=new qx([],{},{},"",{},Nn,t,null,{});return new ok("",new Ru(d,[]))}(0,t),n=new jr([new o0("",{})]),r=new jr({}),s=new jr({}),d=new jr({}),m=new jr(""),b=new Ga(n,r,d,m,s,Nn,t,i.root);return b.snapshot=i.root,new nk(new Ru(b,[]),i)}class Ga{constructor(t,i,n,r,s,d,m,b){this.urlSubject=t,this.paramsSubject=i,this.queryParamsSubject=n,this.fragmentSubject=r,this.dataSubject=s,this.outlet=d,this.component=m,this._futureSnapshot=b,this.title=this.dataSubject?.pipe(Xt(E=>E[r0]))??Vt(void 0),this.url=t,this.params=i,this.queryParams=n,this.fragment=r,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Xt(t=>Fg(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Xt(t=>Fg(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function rk(e,t="emptyOnly"){const i=e.pathFromRoot;let n=0;if("always"!==t)for(n=i.length-1;n>=1;){const r=i[n],s=i[n-1];if(r.routeConfig&&""===r.routeConfig.path)n--;else{if(s.component)break;n--}}return function s6(e){return e.reduce((t,i)=>({params:{...t.params,...i.params},data:{...t.data,...i.data},resolve:{...i.data,...t.resolve,...i.routeConfig?.data,...i._resolvedData}}),{params:{},data:{},resolve:{}})}(i.slice(n))}class qx{get title(){return this.data?.[r0]}constructor(t,i,n,r,s,d,m,b,E){this.url=t,this.params=i,this.queryParams=n,this.fragment=r,this.data=s,this.outlet=d,this.component=m,this.routeConfig=b,this._resolve=E}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Fg(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Fg(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(n=>n.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class ok extends tk{constructor(t,i){super(i),this.url=t,GE(this,i)}toString(){return sk(this._root)}}function GE(e,t){t.value._routerState=e,t.children.forEach(i=>GE(e,i))}function sk(e){const t=e.children.length>0?` { ${e.children.map(sk).join(", ")} } `:"";return`${e.value}${t}`}function qE(e){if(e.snapshot){const t=e.snapshot,i=e._futureSnapshot;e.snapshot=i,Ed(t.queryParams,i.queryParams)||e.queryParamsSubject.next(i.queryParams),t.fragment!==i.fragment&&e.fragmentSubject.next(i.fragment),Ed(t.params,i.params)||e.paramsSubject.next(i.params),function bU(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!Ed(e[i],t[i]))return!1;return!0}(t.url,i.url)||e.urlSubject.next(i.url),Ed(t.data,i.data)||e.dataSubject.next(i.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function WE(e,t){const i=Ed(e.params,t.params)&&function DU(e,t){return cm(e,t)&&e.every((i,n)=>Ed(i.parameters,t[n].parameters))}(e.url,t.url);return i&&!(!e.parent!=!t.parent)&&(!e.parent||WE(e.parent,t.parent))}let ZE=(()=>{var e;class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=Nn,this.activateEvents=new Ct,this.deactivateEvents=new Ct,this.attachEvents=new Ct,this.detachEvents=new Ct,this.parentContexts=ft(h0),this.location=ft(ha),this.changeDetector=ft(Io),this.environmentInjector=ft(Qr),this.inputBinder=ft(Wx,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){const{firstChange:r,previousValue:s}=n.name;if(r)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new He(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new He(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new He(4012,!1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new He(4013,!1);this._activatedRoute=n;const s=this.location,m=n.snapshot.component,b=this.parentContexts.getOrCreateContext(this.name).children,E=new a6(n,b,s.injector);this.activated=s.createComponent(m,{index:s.length,injector:E,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275dir=gt({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Ci]}),t})();class a6{constructor(t,i,n){this.route=t,this.childContexts=i,this.parent=n}get(t,i){return t===Ga?this.route:t===h0?this.childContexts:this.parent.get(t,i)}}const Wx=new mt("");let ak=(()=>{var e;class t{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){const{activatedRoute:r}=n,s=Fx([r.queryParams,r.params,r.data]).pipe(Fe(([d,m,b],E)=>(b={...d,...m,...b},0===E?Vt(b):Promise.resolve(b)))).subscribe(d=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(n);const m=function w4(e){const t=zn(e);if(!t)return null;const i=new Ii(t);return{get selector(){return i.selector},get type(){return i.componentType},get inputs(){return i.inputs},get outputs(){return i.outputs},get ngContentSelectors(){return i.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}(r.component);if(m)for(const{templateName:b}of m.inputs)n.activatedComponentRef.setInput(b,d[b]);else this.unsubscribeFromRouteData(n)});this.outletDataSubscriptions.set(n,s)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();function p0(e,t,i){if(i&&e.shouldReuseRoute(t.value,i.value.snapshot)){const n=i.value;n._futureSnapshot=t.value;const r=function c6(e,t,i){return t.children.map(n=>{for(const r of i.children)if(e.shouldReuseRoute(n.value,r.value.snapshot))return p0(e,n,r);return p0(e,n)})}(e,t,i);return new Ru(n,r)}{if(e.shouldAttach(t.value)){const s=e.retrieve(t.value);if(null!==s){const d=s.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(m=>p0(e,m)),d}}const n=function d6(e){return new Ga(new jr(e.url),new jr(e.params),new jr(e.queryParams),new jr(e.fragment),new jr(e.data),e.outlet,e.component,e)}(t.value),r=t.children.map(s=>p0(e,s));return new Ru(n,r)}}const YE="ngNavigationCancelingError";function lk(e,t){const{redirectTo:i,navigationBehaviorOptions:n}=dm(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=ck(!1,0,t);return r.url=i,r.navigationBehaviorOptions=n,r}function ck(e,t,i){const n=new Error("NavigationCancelingError: "+(e||""));return n[YE]=!0,n.cancellationCode=t,i&&(n.url=i),n}function dk(e){return uk(e)&&dm(e.url)}function uk(e){return e&&e[YE]}let hk=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=In({type:e,selectors:[["ng-component"]],standalone:!0,features:[ua],decls:1,vars:0,template:function(n,r){1&n&&Rt(0,"router-outlet")},dependencies:[ZE],encapsulation:2}),t})();function XE(e){const t=e.children&&e.children.map(XE),i=t?{...e,children:t}:{...e};return!i.component&&!i.loadComponent&&(t||i.loadChildren)&&i.outlet&&i.outlet!==Nn&&(i.component=hk),i}function Oc(e){return e.outlet||Nn}function f0(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const i=t.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}class g6{constructor(t,i,n,r,s){this.routeReuseStrategy=t,this.futureState=i,this.currState=n,this.forwardEvent=r,this.inputBindingEnabled=s}activate(t){const i=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,n,t),qE(this.futureState.root),this.activateChildRoutes(i,n,t)}deactivateChildRoutes(t,i,n){const r=Lg(i);t.children.forEach(s=>{const d=s.value.outlet;this.deactivateRoutes(s,r[d],n),delete r[d]}),Object.values(r).forEach(s=>{this.deactivateRouteAndItsChildren(s,n)})}deactivateRoutes(t,i,n){const r=t.value,s=i?i.value:null;if(r===s)if(r.component){const d=n.getContext(r.outlet);d&&this.deactivateChildRoutes(t,i,d.children)}else this.deactivateChildRoutes(t,i,n);else s&&this.deactivateRouteAndItsChildren(i,n)}deactivateRouteAndItsChildren(t,i){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,i):this.deactivateRouteAndOutlet(t,i)}detachAndStoreRouteSubtree(t,i){const n=i.getContext(t.value.outlet),r=n&&t.value.component?n.children:i,s=Lg(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);if(n&&n.outlet){const d=n.outlet.detach(),m=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:m})}}deactivateRouteAndOutlet(t,i){const n=i.getContext(t.value.outlet),r=n&&t.value.component?n.children:i,s=Lg(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(t,i,n){const r=Lg(i);t.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],n),this.forwardEvent(new n6(s.value.snapshot))}),t.children.length&&this.forwardEvent(new e6(t.value.snapshot))}activateRoutes(t,i,n){const r=t.value,s=i?i.value:null;if(qE(r),r===s)if(r.component){const d=n.getOrCreateContext(r.outlet);this.activateChildRoutes(t,i,d.children)}else this.activateChildRoutes(t,i,n);else if(r.component){const d=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const m=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),d.children.onOutletReAttached(m.contexts),d.attachRef=m.componentRef,d.route=m.route.value,d.outlet&&d.outlet.attach(m.componentRef,m.route.value),qE(m.route.value),this.activateChildRoutes(t,null,d.children)}else{const m=f0(r.snapshot);d.attachRef=null,d.route=r,d.injector=m,d.outlet&&d.outlet.activateWith(r,d.injector),this.activateChildRoutes(t,null,d.children)}}else this.activateChildRoutes(t,null,n)}}class pk{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Zx{constructor(t,i){this.component=t,this.route=i}}function y6(e,t,i){const n=e._root;return m0(n,t?t._root:null,i,[n.value])}function Bg(e,t){const i=Symbol(),n=t.get(e,i);return n===i?"function"!=typeof e||function vs(e){return null!==Ur(e)}(e)?t.get(e):e:n}function m0(e,t,i,n,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Lg(t);return e.children.forEach(d=>{(function b6(e,t,i,n,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=e.value,d=t?t.value:null,m=i?i.getContext(e.value.outlet):null;if(d&&s.routeConfig===d.routeConfig){const b=function x6(e,t,i){if("function"==typeof i)return i(e,t);switch(i){case"pathParamsChange":return!cm(e.url,t.url);case"pathParamsOrQueryParamsChange":return!cm(e.url,t.url)||!Ed(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!WE(e,t)||!Ed(e.queryParams,t.queryParams);default:return!WE(e,t)}}(d,s,s.routeConfig.runGuardsAndResolvers);b?r.canActivateChecks.push(new pk(n)):(s.data=d.data,s._resolvedData=d._resolvedData),m0(e,t,s.component?m?m.children:null:i,n,r),b&&m&&m.outlet&&m.outlet.isActivated&&r.canDeactivateChecks.push(new Zx(m.outlet.component,d))}else d&&_0(t,m,r),r.canActivateChecks.push(new pk(n)),m0(e,null,s.component?m?m.children:null:i,n,r)})(d,s[d.value.outlet],i,n.concat([d.value]),r),delete s[d.value.outlet]}),Object.entries(s).forEach(([d,m])=>_0(m,i.getContext(d),r)),r}function _0(e,t,i){const n=Lg(e),r=e.value;Object.entries(n).forEach(([s,d])=>{_0(d,r.component?t?t.children.getContext(s):null:t,i)}),i.canDeactivateChecks.push(new Zx(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function g0(e){return"function"==typeof e}function fk(e){return e instanceof Nx||"EmptyError"===e?.name}const Yx=Symbol("INITIAL_VALUE");function zg(){return Fe(e=>Fx(e.map(t=>t.pipe(no(1),kg(Yx)))).pipe(Xt(t=>{for(const i of t)if(!0!==i){if(i===Yx)return Yx;if(!1===i||i instanceof Ng)return i}return!0}),sr(t=>t!==Yx),no(1)))}function mk(e){return function Zl(...e){return Xo(e)}(Nr(t=>{if(dm(t))throw lk(0,t)}),Xt(t=>!0===t))}class Xx{constructor(t){this.segmentGroup=t||null}}class _k{constructor(t){this.urlTree=t}}function Vg(e){return sm(new Xx(e))}function gk(e){return sm(new _k(e))}class j6{constructor(t,i){this.urlSerializer=t,this.urlTree=i}noMatchError(t){return new He(4002,!1)}lineralizeSegments(t,i){let n=[],r=i.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return Vt(n);if(r.numberOfChildren>1||!r.children[Nn])return sm(new He(4e3,!1));r=r.children[Nn]}}applyRedirectCommands(t,i,n){return this.applyRedirectCreateUrlTree(i,this.urlSerializer.parse(i),t,n)}applyRedirectCreateUrlTree(t,i,n,r){const s=this.createSegmentGroup(t,i.root,n,r);return new Ng(s,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(t,i){const n={};return Object.entries(t).forEach(([r,s])=>{if("string"==typeof s&&s.startsWith(":")){const m=s.substring(1);n[r]=i[m]}else n[r]=s}),n}createSegmentGroup(t,i,n,r){const s=this.createSegments(t,i.segments,n,r);let d={};return Object.entries(i.children).forEach(([m,b])=>{d[m]=this.createSegmentGroup(t,b,n,r)}),new Ri(s,d)}createSegments(t,i,n,r){return i.map(s=>s.path.startsWith(":")?this.findPosParam(t,s,r):this.findOrReturn(s,n))}findPosParam(t,i,n){const r=n[i.path.substring(1)];if(!r)throw new He(4001,!1);return r}findOrReturn(t,i){let n=0;for(const r of i){if(r.path===t.path)return i.splice(n),r;n++}return t}}const KE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function U6(e,t,i,n,r){const s=QE(e,t,i);return s.matched?(n=function u6(e,t){return e.providers&&!e._injector&&(e._injector=CD(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,n),function B6(e,t,i,n){const r=t.canMatch;return r&&0!==r.length?Vt(r.map(d=>{const m=Bg(d,e);return dp(function S6(e){return e&&g0(e.canMatch)}(m)?m.canMatch(t,i):e.runInContext(()=>m(t,i)))})).pipe(zg(),mk()):Vt(!0)}(n,t,i).pipe(Xt(d=>!0===d?s:{...KE}))):Vt(s)}function QE(e,t,i){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||i.length>0)?{...KE}:{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};const r=(t.matcher||vU)(i,e,t);if(!r)return{...KE};const s={};Object.entries(r.posParams??{}).forEach(([m,b])=>{s[m]=b.path});const d=r.consumed.length>0?{...s,...r.consumed[r.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:r.consumed,remainingSegments:i.slice(r.consumed.length),parameters:d,positionalParamSegments:r.posParams??{}}}function yk(e,t,i,n){return i.length>0&&function G6(e,t,i){return i.some(n=>Kx(e,t,n)&&Oc(n)!==Nn)}(e,i,n)?{segmentGroup:new Ri(t,H6(n,new Ri(i,e.children))),slicedSegments:[]}:0===i.length&&function q6(e,t,i){return i.some(n=>Kx(e,t,n))}(e,i,n)?{segmentGroup:new Ri(e.segments,$6(e,0,i,n,e.children)),slicedSegments:i}:{segmentGroup:new Ri(e.segments,e.children),slicedSegments:i}}function $6(e,t,i,n,r){const s={};for(const d of n)if(Kx(e,i,d)&&!r[Oc(d)]){const m=new Ri([],{});s[Oc(d)]=m}return{...r,...s}}function H6(e,t){const i={};i[Nn]=t;for(const n of e)if(""===n.path&&Oc(n)!==Nn){const r=new Ri([],{});i[Oc(n)]=r}return i}function Kx(e,t,i){return(!(e.hasChildren()||t.length>0)||"full"!==i.pathMatch)&&""===i.path}class X6{constructor(t,i,n,r,s,d,m){this.injector=t,this.configLoader=i,this.rootComponentType=n,this.config=r,this.urlTree=s,this.paramsInheritanceStrategy=d,this.urlSerializer=m,this.allowRedirects=!0,this.applyRedirects=new j6(this.urlSerializer,this.urlTree)}noMatchError(t){return new He(4002,!1)}recognize(){const t=yk(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,Nn).pipe(lm(i=>{if(i instanceof _k)return this.allowRedirects=!1,this.urlTree=i.urlTree,this.match(i.urlTree);throw i instanceof Xx?this.noMatchError(i):i}),Xt(i=>{const n=new qx([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Nn,this.rootComponentType,null,{}),r=new Ru(n,i),s=new ok("",r),d=function zU(e,t,i=null,n=null){return ZR(WR(e),t,i,n)}(n,[],this.urlTree.queryParams,this.urlTree.fragment);return d.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(d),this.inheritParamsAndData(s._root),{state:s,tree:d}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t.root,Nn).pipe(lm(n=>{throw n instanceof Xx?this.noMatchError(n):n}))}inheritParamsAndData(t){const i=t.value,n=rk(i,this.paramsInheritanceStrategy);i.params=Object.freeze(n.params),i.data=Object.freeze(n.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,i,n,r){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,i,n):this.processSegment(t,i,n,n.segments,r,!0)}processChildren(t,i,n){const r=[];for(const s of Object.keys(n.children))"primary"===s?r.unshift(s):r.push(s);return ei(r).pipe(Pg(s=>{const d=n.children[s],m=function m6(e,t){const i=e.filter(n=>Oc(n)===t);return i.push(...e.filter(n=>Oc(n)!==t)),i}(i,s);return this.processSegmentGroup(t,m,d,s)}),function aU(e,t){let i=!1;return arguments.length>=2&&(i=!0),function(r){return r.lift(new lU(e,t,i))}}((s,d)=>(s.push(...d),s)),Bx(null),function hU(e,t){const i=arguments.length>=2;return n=>n.pipe(e?sr((r,s)=>e(r,s,n)):Us,FE(1),i?Bx(t):OR(()=>new Nx))}(),er(s=>{if(null===s)return Vg(n);const d=vk(s);return function K6(e){e.sort((t,i)=>t.value.outlet===Nn?-1:i.value.outlet===Nn?1:t.value.outlet.localeCompare(i.value.outlet))}(d),Vt(d)}))}processSegment(t,i,n,r,s,d){return ei(i).pipe(Pg(m=>this.processSegmentAgainstRoute(m._injector??t,i,m,n,r,s,d).pipe(lm(b=>{if(b instanceof Xx)return Vt(null);throw b}))),am(m=>!!m),lm(m=>{if(fk(m))return function Z6(e,t,i){return 0===t.length&&!e.children[i]}(n,r,s)?Vt([]):Vg(n);throw m}))}processSegmentAgainstRoute(t,i,n,r,s,d,m){return function W6(e,t,i,n){return!!(Oc(e)===n||n!==Nn&&Kx(t,i,e))&&("**"===e.path||QE(t,e,i).matched)}(n,r,s,d)?void 0===n.redirectTo?this.matchSegmentAgainstRoute(t,r,n,s,d,m):m&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,r,i,n,s,d):Vg(r):Vg(r)}expandSegmentAgainstRouteUsingRedirect(t,i,n,r,s,d){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,i,n,r,s,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,n,r){const s=this.applyRedirects.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?gk(s):this.applyRedirects.lineralizeSegments(n,s).pipe(er(d=>{const m=new Ri(d,{});return this.processSegment(t,i,m,d,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,i,n,r,s,d){const{matched:m,consumedSegments:b,remainingSegments:E,positionalParamSegments:I}=QE(i,r,s);if(!m)return Vg(i);const O=this.applyRedirects.applyRedirectCommands(b,r.redirectTo,I);return r.redirectTo.startsWith("/")?gk(O):this.applyRedirects.lineralizeSegments(r,O).pipe(er(q=>this.processSegment(t,n,i,q.concat(E),d,!1)))}matchSegmentAgainstRoute(t,i,n,r,s,d){let m;if("**"===n.path){const b=r.length>0?NR(r).parameters:{};m=Vt({snapshot:new qx(r,b,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,bk(n),Oc(n),n.component??n._loadedComponent??null,n,xk(n)),consumedSegments:[],remainingSegments:[]}),i.children={}}else m=U6(i,n,r,t).pipe(Xt(({matched:b,consumedSegments:E,remainingSegments:I,parameters:O})=>b?{snapshot:new qx(E,O,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,bk(n),Oc(n),n.component??n._loadedComponent??null,n,xk(n)),consumedSegments:E,remainingSegments:I}:null));return m.pipe(Fe(b=>null===b?Vg(i):this.getChildConfig(t=n._injector??t,n,r).pipe(Fe(({routes:E})=>{const I=n._loadedInjector??t,{snapshot:O,consumedSegments:q,remainingSegments:Y}=b,{segmentGroup:pe,slicedSegments:Te}=yk(i,q,Y,E);if(0===Te.length&&pe.hasChildren())return this.processChildren(I,E,pe).pipe(Xt(Ge=>null===Ge?null:[new Ru(O,Ge)]));if(0===E.length&&0===Te.length)return Vt([new Ru(O,[])]);const ke=Oc(n)===s;return this.processSegment(I,E,pe,Te,ke?Nn:s,!0).pipe(Xt(Ge=>[new Ru(O,Ge)]))}))))}getChildConfig(t,i,n){return i.children?Vt({routes:i.children,injector:t}):i.loadChildren?void 0!==i._loadedRoutes?Vt({routes:i._loadedRoutes,injector:i._loadedInjector}):function L6(e,t,i,n){const r=t.canLoad;return void 0===r||0===r.length?Vt(!0):Vt(r.map(d=>{const m=Bg(d,e);return dp(function C6(e){return e&&g0(e.canLoad)}(m)?m.canLoad(t,i):e.runInContext(()=>m(t,i)))})).pipe(zg(),mk())}(t,i,n).pipe(er(r=>r?this.configLoader.loadChildren(t,i).pipe(Nr(s=>{i._loadedRoutes=s.routes,i._loadedInjector=s.injector})):function V6(e){return sm(ck(!1,3))}())):Vt({routes:[],injector:t})}}function Q6(e){const t=e.value.routeConfig;return t&&""===t.path}function vk(e){const t=[],i=new Set;for(const n of e){if(!Q6(n)){t.push(n);continue}const r=t.find(s=>n.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...n.children),i.add(r)):t.push(n)}for(const n of i){const r=vk(n.children);t.push(new Ru(n.value,r))}return t.filter(n=>!i.has(n))}function bk(e){return e.data||{}}function xk(e){return e.resolve||{}}function wk(e){return"string"==typeof e.title||null===e.title}function JE(e){return Fe(t=>{const i=e(t);return i?ei(i).pipe(Xt(()=>t)):Vt(t)})}const jg=new mt("ROUTES");let eT=(()=>{var e;class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=ft(YI)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Vt(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const r=dp(n.loadComponent()).pipe(Xt(Ck),Nr(d=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=d}),Og(()=>{this.componentLoaders.delete(n)})),s=new Ea(r,()=>new vn).pipe(qs());return this.componentLoaders.set(n,s),s}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Vt({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const d=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(Xt(b=>{this.onLoadEndListener&&this.onLoadEndListener(r);let E,I;return Array.isArray(b)?I=b:(E=b.create(n).injector,I=E.get(jg,[],pn.Self|pn.Optional).flat()),{routes:I.map(XE),injector:E}}),Og(()=>{this.childrenLoaders.delete(r)})),m=new Ea(d,()=>new vn).pipe(qs());return this.childrenLoaders.set(r,m),m}loadModuleFactoryOrRoutes(n){return dp(n()).pipe(Xt(Ck),er(r=>r instanceof iI||Array.isArray(r)?Vt(r):ei(this.compiler.compileModuleAsync(r))))}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function Ck(e){return function o8(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let Qx=(()=>{var e;class t{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new vn,this.configLoader=ft(eT),this.environmentInjector=ft(Qr),this.urlSerializer=ft(s0),this.rootContexts=ft(h0),this.inputBindingEnabled=null!==ft(Wx,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Vt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=s=>this.events.next(new QU(s)),this.configLoader.onLoadStartListener=s=>this.events.next(new KU(s))}complete(){this.transitions?.complete()}handleNavigationRequest(n){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:r})}setupNavigations(n){return this.transitions=new jr({id:0,currentUrlTree:n.currentUrlTree,currentRawUrl:n.currentUrlTree,extractedUrl:n.urlHandlingStrategy.extract(n.currentUrlTree),urlAfterRedirects:n.urlHandlingStrategy.extract(n.currentUrlTree),rawUrl:n.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:d0,restoredState:null,currentSnapshot:n.routerState.snapshot,targetSnapshot:null,currentRouterState:n.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(sr(r=>0!==r.id),Xt(r=>({...r,extractedUrl:n.urlHandlingStrategy.extract(r.rawUrl)})),Fe(r=>{let s=!1,d=!1;return Vt(r).pipe(Nr(m=>{this.currentNavigation={id:m.id,initialUrl:m.rawUrl,extractedUrl:m.extractedUrl,trigger:m.source,extras:m.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Fe(m=>{const b=n.browserUrlTree.toString(),E=!n.navigated||m.extractedUrl.toString()!==b||b!==n.currentUrlTree.toString();if(!E&&"reload"!==(m.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const O="";return this.events.next(new u0(m.id,n.serializeUrl(r.rawUrl),O,0)),n.rawUrlTree=m.rawUrl,m.resolve(null),lp}if(n.urlHandlingStrategy.shouldProcessUrl(m.rawUrl))return Dk(m.source)&&(n.browserUrlTree=m.extractedUrl),Vt(m).pipe(Fe(O=>{const q=this.transitions?.getValue();return this.events.next(new jE(O.id,this.urlSerializer.serialize(O.extractedUrl),O.source,O.restoredState)),q!==this.transitions?.getValue()?lp:Promise.resolve(O)}),function J6(e,t,i,n,r,s){return er(d=>function Y6(e,t,i,n,r,s,d="emptyOnly"){return new X6(e,t,i,n,r,d,s).recognize()}(e,t,i,n,d.extractedUrl,r,s).pipe(Xt(({state:m,tree:b})=>({...d,targetSnapshot:m,urlAfterRedirects:b}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,n.paramsInheritanceStrategy),Nr(O=>{if(r.targetSnapshot=O.targetSnapshot,r.urlAfterRedirects=O.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:O.urlAfterRedirects},"eager"===n.urlUpdateStrategy){if(!O.extras.skipLocationChange){const Y=n.urlHandlingStrategy.merge(O.urlAfterRedirects,O.rawUrl);n.setBrowserUrl(Y,O)}n.browserUrlTree=O.urlAfterRedirects}const q=new qU(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot);this.events.next(q)}));if(E&&n.urlHandlingStrategy.shouldProcessUrl(n.rawUrlTree)){const{id:O,extractedUrl:q,source:Y,restoredState:pe,extras:Te}=m,ke=new jE(O,this.urlSerializer.serialize(q),Y,pe);this.events.next(ke);const Ge=ik(0,this.rootComponentType).snapshot;return Vt(r={...m,targetSnapshot:Ge,urlAfterRedirects:q,extras:{...Te,skipLocationChange:!1,replaceUrl:!1}})}{const O="";return this.events.next(new u0(m.id,n.serializeUrl(r.extractedUrl),O,1)),n.rawUrlTree=m.rawUrl,m.resolve(null),lp}}),Nr(m=>{const b=new WU(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(b)}),Xt(m=>r={...m,guards:y6(m.targetSnapshot,m.currentSnapshot,this.rootContexts)}),function A6(e,t){return er(i=>{const{targetSnapshot:n,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:d}}=i;return 0===d.length&&0===s.length?Vt({...i,guardsResult:!0}):function I6(e,t,i,n){return ei(e).pipe(er(r=>function N6(e,t,i,n,r){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?Vt(s.map(m=>{const b=f0(t)??r,E=Bg(m,b);return dp(function T6(e){return e&&g0(e.canDeactivate)}(E)?E.canDeactivate(e,t,i,n):b.runInContext(()=>E(e,t,i,n))).pipe(am())})).pipe(zg()):Vt(!0)}(r.component,r.route,i,t,n)),am(r=>!0!==r,!0))}(d,n,r,e).pipe(er(m=>m&&function w6(e){return"boolean"==typeof e}(m)?function R6(e,t,i,n){return ei(t).pipe(Pg(r=>n0(function P6(e,t){return null!==e&&t&&t(new JU(e)),Vt(!0)}(r.route.parent,n),function k6(e,t){return null!==e&&t&&t(new t6(e)),Vt(!0)}(r.route,n),function F6(e,t,i){const n=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(d=>function v6(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(d)).filter(d=>null!==d).map(d=>kR(()=>Vt(d.guards.map(b=>{const E=f0(d.node)??i,I=Bg(b,E);return dp(function E6(e){return e&&g0(e.canActivateChild)}(I)?I.canActivateChild(n,e):E.runInContext(()=>I(n,e))).pipe(am())})).pipe(zg())));return Vt(s).pipe(zg())}(e,r.path,i),function O6(e,t,i){const n=t.routeConfig?t.routeConfig.canActivate:null;if(!n||0===n.length)return Vt(!0);const r=n.map(s=>kR(()=>{const d=f0(t)??i,m=Bg(s,d);return dp(function D6(e){return e&&g0(e.canActivate)}(m)?m.canActivate(t,e):d.runInContext(()=>m(t,e))).pipe(am())}));return Vt(r).pipe(zg())}(e,r.route,i))),am(r=>!0!==r,!0))}(n,s,e,t):Vt(m)),Xt(m=>({...i,guardsResult:m})))})}(this.environmentInjector,m=>this.events.next(m)),Nr(m=>{if(r.guardsResult=m.guardsResult,dm(m.guardsResult))throw lk(0,m.guardsResult);const b=new ZU(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot,!!m.guardsResult);this.events.next(b)}),sr(m=>!!m.guardsResult||(n.restoreHistory(m),this.cancelNavigationTransition(m,"",3),!1)),JE(m=>{if(m.guards.canActivateChecks.length)return Vt(m).pipe(Nr(b=>{const E=new YU(b.id,this.urlSerializer.serialize(b.extractedUrl),this.urlSerializer.serialize(b.urlAfterRedirects),b.targetSnapshot);this.events.next(E)}),Fe(b=>{let E=!1;return Vt(b).pipe(function e8(e,t){return er(i=>{const{targetSnapshot:n,guards:{canActivateChecks:r}}=i;if(!r.length)return Vt(i);let s=0;return ei(r).pipe(Pg(d=>function t8(e,t,i,n){const r=e.routeConfig,s=e._resolve;return void 0!==r?.title&&!wk(r)&&(s[r0]=r.title),function n8(e,t,i,n){const r=function i8(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===r.length)return Vt({});const s={};return ei(r).pipe(er(d=>function r8(e,t,i,n){const r=f0(t)??n,s=Bg(e,r);return dp(s.resolve?s.resolve(t,i):r.runInContext(()=>s(t,i)))}(e[d],t,i,n).pipe(am(),Nr(m=>{s[d]=m}))),FE(1),function pU(e){return t=>t.lift(new fU(e))}(s),lm(d=>fk(d)?lp:sm(d)))}(s,e,t,n).pipe(Xt(d=>(e._resolvedData=d,e.data=rk(e,i).resolve,r&&wk(r)&&(e.data[r0]=r.title),null)))}(d.route,n,e,t)),Nr(()=>s++),FE(1),er(d=>s===r.length?Vt(i):lp))})}(n.paramsInheritanceStrategy,this.environmentInjector),Nr({next:()=>E=!0,complete:()=>{E||(n.restoreHistory(b),this.cancelNavigationTransition(b,"",2))}}))}),Nr(b=>{const E=new XU(b.id,this.urlSerializer.serialize(b.extractedUrl),this.urlSerializer.serialize(b.urlAfterRedirects),b.targetSnapshot);this.events.next(E)}))}),JE(m=>{const b=E=>{const I=[];E.routeConfig?.loadComponent&&!E.routeConfig._loadedComponent&&I.push(this.configLoader.loadComponent(E.routeConfig).pipe(Nr(O=>{E.component=O}),Xt(()=>{})));for(const O of E.children)I.push(...b(O));return I};return Fx(b(m.targetSnapshot.root)).pipe(Bx(),no(1))}),JE(()=>this.afterPreactivation()),Xt(m=>{const b=function l6(e,t,i){const n=p0(e,t._root,i?i._root:void 0);return new nk(n,t)}(n.routeReuseStrategy,m.targetSnapshot,m.currentRouterState);return r={...m,targetRouterState:b}}),Nr(m=>{n.currentUrlTree=m.urlAfterRedirects,n.rawUrlTree=n.urlHandlingStrategy.merge(m.urlAfterRedirects,m.rawUrl),n.routerState=m.targetRouterState,"deferred"===n.urlUpdateStrategy&&(m.extras.skipLocationChange||n.setBrowserUrl(n.rawUrlTree,m),n.browserUrlTree=m.urlAfterRedirects)}),((e,t,i,n)=>Xt(r=>(new g6(t,r.targetRouterState,r.currentRouterState,i,n).activate(e),r)))(this.rootContexts,n.routeReuseStrategy,m=>this.events.next(m),this.inputBindingEnabled),no(1),Nr({next:m=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,n.navigated=!0,this.events.next(new um(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(n.currentUrlTree))),n.titleStrategy?.updateTitle(m.targetRouterState.snapshot),m.resolve(!0)},complete:()=>{s=!0}}),Og(()=>{s||d||this.cancelNavigationTransition(r,"",1),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),lm(m=>{if(d=!0,uk(m)){dk(m)||(n.navigated=!0,n.restoreHistory(r,!0));const b=new Gx(r.id,this.urlSerializer.serialize(r.extractedUrl),m.message,m.cancellationCode);if(this.events.next(b),dk(m)){const E=n.urlHandlingStrategy.merge(m.url,n.rawUrlTree),I={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===n.urlUpdateStrategy||Dk(r.source)};n.scheduleNavigation(E,d0,null,I,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{n.restoreHistory(r,!0);const b=new UE(r.id,this.urlSerializer.serialize(r.extractedUrl),m,r.targetSnapshot??void 0);this.events.next(b);try{r.resolve(n.errorHandler(m))}catch(E){r.reject(E)}}return lp}))}))}cancelNavigationTransition(n,r,s){const d=new Gx(n.id,this.urlSerializer.serialize(n.extractedUrl),r,s);this.events.next(d),n.resolve(!1)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function Dk(e){return e!==d0}let Ek=(()=>{var e;class t{buildTitle(n){let r,s=n.root;for(;void 0!==s;)r=this.getResolvedTitleForRoute(s)??r,s=s.children.find(d=>d.outlet===Nn);return r}getResolvedTitleForRoute(n){return n.data[r0]}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:function(){return ft(s8)},providedIn:"root"}),t})(),s8=(()=>{var e;class t extends Ek{constructor(n){super(),this.title=n}updateTitle(n){const r=this.buildTitle(n);void 0!==r&&this.title.setTitle(r)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(TR))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),a8=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:function(){return ft(c8)},providedIn:"root"}),t})();class l8{shouldDetach(t){return!1}store(t,i){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,i){return t.routeConfig===i.routeConfig}}let c8=(()=>{var e;class t extends l8{}return(e=t).\u0275fac=function(){let i;return function(r){return(i||(i=mi(e)))(r||e)}}(),e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const Jx=new mt("",{providedIn:"root",factory:()=>({})});let d8=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:function(){return ft(u8)},providedIn:"root"}),t})(),u8=(()=>{var e;class t{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,r){return n}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();var y0=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(y0||{});function Tk(e,t){e.events.pipe(sr(i=>i instanceof um||i instanceof Gx||i instanceof UE||i instanceof u0),Xt(i=>i instanceof um||i instanceof u0?y0.COMPLETE:i instanceof Gx&&(0===i.code||1===i.code)?y0.REDIRECTING:y0.FAILED),sr(i=>i!==y0.REDIRECTING),no(1)).subscribe(()=>{t()})}function h8(e){throw e}function p8(e,t,i){return t.parse("/")}const f8={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},m8={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Lr=(()=>{var e;class t{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=ft(ZI),this.isNgZoneEnabled=!1,this.options=ft(Jx,{optional:!0})||{},this.pendingTasks=ft(px),this.errorHandler=this.options.errorHandler||h8,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||p8,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=ft(d8),this.routeReuseStrategy=ft(a8),this.titleStrategy=ft(Ek),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=ft(jg,{optional:!0})?.flat()??[],this.navigationTransitions=ft(Qx),this.urlSerializer=ft(s0),this.location=ft(Kv),this.componentInputBindingEnabled=!!ft(Wx,{optional:!0}),this.isNgZoneEnabled=ft(_n)instanceof _n&&_n.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Ng,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=ik(0,null),this.navigationTransitions.setupNavigations(this).subscribe(n=>{this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId??0},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const n=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),d0,n)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const r="popstate"===n.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(n.url,r,n.state)},0)}))}navigateToSyncWithBrowser(n,r,s){const d={replaceUrl:!0},m=s?.navigationId?s:null;if(s){const E={...s};delete E.navigationId,delete E.\u0275routerPageId,0!==Object.keys(E).length&&(d.state=E)}const b=this.parseUrl(n);this.scheduleNavigation(b,r,m,d)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(XE),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,r={}){const{relativeTo:s,queryParams:d,fragment:m,queryParamsHandling:b,preserveFragment:E}=r,I=E?this.currentUrlTree.fragment:m;let q,O=null;switch(b){case"merge":O={...this.currentUrlTree.queryParams,...d};break;case"preserve":O=this.currentUrlTree.queryParams;break;default:O=d||null}null!==O&&(O=this.removeEmptyProps(O));try{q=WR(s?s.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof n[0]||!n[0].startsWith("/"))&&(n=[]),q=this.currentUrlTree.root}return ZR(q,n,O,I??null)}navigateByUrl(n,r={skipLocationChange:!1}){const s=dm(n)?n:this.parseUrl(n),d=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(d,d0,null,r)}navigate(n,r={skipLocationChange:!1}){return function _8(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new He(4008,!1)}(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let r;try{r=this.urlSerializer.parse(n)}catch(s){r=this.malformedUriErrorHandler(s,this.urlSerializer,n)}return r}isActive(n,r){let s;if(s=!0===r?{...f8}:!1===r?{...m8}:r,dm(n))return BR(this.currentUrlTree,n,s);const d=this.parseUrl(n);return BR(this.currentUrlTree,d,s)}removeEmptyProps(n){return Object.keys(n).reduce((r,s)=>{const d=n[s];return null!=d&&(r[s]=d),r},{})}scheduleNavigation(n,r,s,d,m){if(this.disposed)return Promise.resolve(!1);let b,E,I;m?(b=m.resolve,E=m.reject,I=m.promise):I=new Promise((q,Y)=>{b=q,E=Y});const O=this.pendingTasks.add();return Tk(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(O))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:d,resolve:b,reject:E,promise:I,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),I.catch(q=>Promise.reject(q))}setBrowserUrl(n,r){const s=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(s)||r.extras.replaceUrl){const m={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(s,"",m)}else{const d={...r.extras.state,...this.generateNgRouterState(r.id,(this.browserPageId??0)+1)};this.location.go(s,"",d)}}restoreHistory(n,r=!1){if("computed"===this.canceledNavigationResolution){const d=this.currentPageId-(this.browserPageId??this.currentPageId);0!==d?this.location.historyGo(d):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===d&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,r){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),Fc=(()=>{var e;class t{constructor(n,r,s,d,m,b){this.router=n,this.route=r,this.tabIndexAttribute=s,this.renderer=d,this.el=m,this.locationStrategy=b,this.href=null,this.commands=null,this.onChanges=new vn,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const E=m.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===E||"area"===E,this.isAnchorElement?this.subscription=n.events.subscribe(I=>{I instanceof um&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(n,r,s,d,m){return!!(null===this.urlTree||this.isAnchorElement&&(0!==n||r||s||d||m||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const n=null===this.href?null:function c1(e,t,i){return function l1(e,t){return"src"===t&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===t&&("base"===e||"link"===e)?uv:cs}(t,i)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",n)}applyAttributeValue(n,r){const s=this.renderer,d=this.el.nativeElement;null!==r?s.setAttribute(d,n,r):s.removeAttribute(d,n)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Lr),oe(Ga),oa("tabindex"),oe(po),oe(Tn),oe(om))},e.\u0275dir=gt({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(n,r){1&n&&nt("click",function(d){return r.onClick(d.button,d.ctrlKey,d.shiftKey,d.altKey,d.metaKey)}),2&n&&Fn("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",Ag],skipLocationChange:["skipLocationChange","skipLocationChange",Ag],replaceUrl:["replaceUrl","replaceUrl",Ag],routerLink:"routerLink"},standalone:!0,features:[cg,Ci]}),t})();class Sk{}let v8=(()=>{var e;class t{constructor(n,r,s,d,m){this.router=n,this.injector=s,this.preloadingStrategy=d,this.loader=m}setUpPreloading(){this.subscription=this.router.events.pipe(sr(n=>n instanceof um),Pg(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){const s=[];for(const d of r){d.providers&&!d._injector&&(d._injector=CD(d.providers,n,`Route: ${d.path}`));const m=d._injector??n,b=d._loadedInjector??m;(d.loadChildren&&!d._loadedRoutes&&void 0===d.canLoad||d.loadComponent&&!d._loadedComponent)&&s.push(this.preloadConfig(m,d)),(d.children||d._loadedRoutes)&&s.push(this.processRoutes(b,d.children??d._loadedRoutes))}return ei(s).pipe(Gs())}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>{let s;s=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(n,r):Vt(null);const d=s.pipe(er(m=>null===m?Vt(void 0):(r._loadedRoutes=m.routes,r._loadedInjector=m.injector,this.processRoutes(m.injector??n,m.routes))));return r.loadComponent&&!r._loadedComponent?ei([d,this.loader.loadComponent(r)]).pipe(Gs()):d})}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Lr),je(YI),je(Qr),je(Sk),je(eT))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const tT=new mt("");let Mk=(()=>{var e;class t{constructor(n,r,s,d,m={}){this.urlSerializer=n,this.transitions=r,this.viewportScroller=s,this.zone=d,this.options=m,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},m.scrollPositionRestoration=m.scrollPositionRestoration||"disabled",m.anchorScrolling=m.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof jE?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof um?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof u0&&0===n.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof ek&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new ek(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return(e=t).\u0275fac=function(n){Os()},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();function ku(e,t){return{\u0275kind:e,\u0275providers:t}}function Ik(){const e=ft(pr);return t=>{const i=e.get(Rc);if(t!==i.components[0])return;const n=e.get(Lr),r=e.get(Rk);1===e.get(nT)&&n.initialNavigation(),e.get(kk,null,pn.Optional)?.setUpPreloading(),e.get(tT,null,pn.Optional)?.init(),n.resetRootComponentType(i.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const Rk=new mt("",{factory:()=>new vn}),nT=new mt("",{providedIn:"root",factory:()=>1}),kk=new mt("");function C8(e){return ku(0,[{provide:kk,useExisting:v8},{provide:Sk,useExisting:e}])}const Pk=new mt("ROUTER_FORROOT_GUARD"),E8=[Kv,{provide:s0,useClass:NE},Lr,h0,{provide:Ga,useFactory:function Ak(e){return e.routerState.root},deps:[Lr]},eT,[]];function T8(){return new l2("Router",Lr)}let Ok=(()=>{var e;class t{constructor(n){}static forRoot(n,r){return{ngModule:t,providers:[E8,[],{provide:jg,multi:!0,useValue:n},{provide:Pk,useFactory:I8,deps:[[Lr,new Al,new Il]]},{provide:Jx,useValue:r||{}},r?.useHash?{provide:om,useClass:S4}:{provide:om,useClass:L2},{provide:tT,useFactory:()=>{const e=ft(U5),t=ft(_n),i=ft(Jx),n=ft(Qx),r=ft(s0);return i.scrollOffset&&e.setOffset(i.scrollOffset),new Mk(r,n,e,t,i)}},r?.preloadingStrategy?C8(r.preloadingStrategy).\u0275providers:[],{provide:l2,multi:!0,useFactory:T8},r?.initialNavigation?R8(r):[],r?.bindToComponentInputs?ku(8,[ak,{provide:Wx,useExisting:ak}]).\u0275providers:[],[{provide:Fk,useFactory:Ik},{provide:XD,multi:!0,useExisting:Fk}]]}}static forChild(n){return{ngModule:t,providers:[{provide:jg,multi:!0,useValue:n}]}}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Pk,8))},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})();function I8(e){return"guarded"}function R8(e){return["disabled"===e.initialNavigation?ku(3,[{provide:VD,multi:!0,useFactory:()=>{const t=ft(Lr);return()=>{t.setUpLocationChangeListener()}}},{provide:nT,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?ku(2,[{provide:nT,useValue:0},{provide:VD,multi:!0,deps:[pr],useFactory:t=>{const i=t.get(E4,Promise.resolve());return()=>i.then(()=>new Promise(n=>{const r=t.get(Lr),s=t.get(Rk);Tk(r,()=>{n(!0)}),t.get(Qx).afterPreactivation=()=>(n(!0),s.closed?Vt(void 0):s),r.initialNavigation()}))}}]).\u0275providers:[]]}const Fk=new mt("");class ew{}class tw{}class Nc{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?"string"==typeof t?this.lazyInit=()=>{this.headers=new Map,t.split("\n").forEach(i=>{const n=i.indexOf(":");if(n>0){const r=i.slice(0,n),s=r.toLowerCase(),d=i.slice(n+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(d):this.headers.set(s,[d])}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((i,n)=>{this.setHeaderEntries(n,i)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([i,n])=>{this.setHeaderEntries(i,n)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const i=this.headers.get(t.toLowerCase());return i&&i.length>0?i[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,i){return this.clone({name:t,value:i,op:"a"})}set(t,i){return this.clone({name:t,value:i,op:"s"})}delete(t,i){return this.clone({name:t,value:i,op:"d"})}maybeSetNormalizedName(t,i){this.normalizedNames.has(i)||this.normalizedNames.set(i,t)}init(){this.lazyInit&&(this.lazyInit instanceof Nc?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(i=>{this.headers.set(i,t.headers.get(i)),this.normalizedNames.set(i,t.normalizedNames.get(i))})}clone(t){const i=new Nc;return i.lazyInit=this.lazyInit&&this.lazyInit instanceof Nc?this.lazyInit:this,i.lazyUpdate=(this.lazyUpdate||[]).concat([t]),i}applyUpdate(t){const i=t.name.toLowerCase();switch(t.op){case"a":case"s":let n=t.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(t.name,i);const r=("a"===t.op?this.headers.get(i):void 0)||[];r.push(...n),this.headers.set(i,r);break;case"d":const s=t.value;if(s){let d=this.headers.get(i);if(!d)return;d=d.filter(m=>-1===s.indexOf(m)),0===d.length?(this.headers.delete(i),this.normalizedNames.delete(i)):this.headers.set(i,d)}else this.headers.delete(i),this.normalizedNames.delete(i)}}setHeaderEntries(t,i){const n=(Array.isArray(i)?i:[i]).map(s=>s.toString()),r=t.toLowerCase();this.headers.set(r,n),this.maybeSetNormalizedName(t,r)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(i=>t(this.normalizedNames.get(i),this.headers.get(i)))}}class P8{encodeKey(t){return Nk(t)}encodeValue(t){return Nk(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const F8=/%(\d[a-f0-9])/gi,N8={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Nk(e){return encodeURIComponent(e).replace(F8,(t,i)=>N8[i]??t)}function nw(e){return`${e}`}class up{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new P8,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function O8(e,t){const i=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[d,m]=-1==s?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,s)),t.decodeValue(r.slice(s+1))],b=i.get(d)||[];b.push(m),i.set(d,b)}),i}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(i=>{const n=t.fromObject[i],r=Array.isArray(n)?n.map(nw):[nw(n)];this.map.set(i,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const i=this.map.get(t);return i?i[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,i){return this.clone({param:t,value:i,op:"a"})}appendAll(t){const i=[];return Object.keys(t).forEach(n=>{const r=t[n];Array.isArray(r)?r.forEach(s=>{i.push({param:n,value:s,op:"a"})}):i.push({param:n,value:r,op:"a"})}),this.clone(i)}set(t,i){return this.clone({param:t,value:i,op:"s"})}delete(t,i){return this.clone({param:t,value:i,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const i=this.encoder.encodeKey(t);return this.map.get(t).map(n=>i+"="+this.encoder.encodeValue(n)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const i=new up({encoder:this.encoder});return i.cloneFrom=this.cloneFrom||this,i.updates=(this.updates||[]).concat(t),i}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const i=("a"===t.op?this.map.get(t.param):void 0)||[];i.push(nw(t.value)),this.map.set(t.param,i);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let n=this.map.get(t.param)||[];const r=n.indexOf(nw(t.value));-1!==r&&n.splice(r,1),n.length>0?this.map.set(t.param,n):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class L8{constructor(){this.map=new Map}set(t,i){return this.map.set(t,i),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function Lk(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function Bk(e){return typeof Blob<"u"&&e instanceof Blob}function zk(e){return typeof FormData<"u"&&e instanceof FormData}class v0{constructor(t,i,n,r){let s;if(this.url=i,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function B8(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==n?n:null,s=r):s=n,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new Nc),this.context||(this.context=new L8),this.params){const d=this.params.toString();if(0===d.length)this.urlWithParams=i;else{const m=i.indexOf("?");this.urlWithParams=i+(-1===m?"?":m<i.length-1?"&":"")+d}}else this.params=new up,this.urlWithParams=i}serializeBody(){return null===this.body?null:Lk(this.body)||Bk(this.body)||zk(this.body)||function z8(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof up?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||zk(this.body)?null:Bk(this.body)?this.body.type||null:Lk(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof up?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const i=t.method||this.method,n=t.url||this.url,r=t.responseType||this.responseType,s=void 0!==t.body?t.body:this.body,d=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,m=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let b=t.headers||this.headers,E=t.params||this.params;const I=t.context??this.context;return void 0!==t.setHeaders&&(b=Object.keys(t.setHeaders).reduce((O,q)=>O.set(q,t.setHeaders[q]),b)),t.setParams&&(E=Object.keys(t.setParams).reduce((O,q)=>O.set(q,t.setParams[q]),E)),new v0(i,n,s,{params:E,headers:b,context:I,reportProgress:m,responseType:r,withCredentials:d})}}var Ug=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(Ug||{});class iT{constructor(t,i=200,n="OK"){this.headers=t.headers||new Nc,this.status=void 0!==t.status?t.status:i,this.statusText=t.statusText||n,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class rT extends iT{constructor(t={}){super(t),this.type=Ug.ResponseHeader}clone(t={}){return new rT({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class $g extends iT{constructor(t={}){super(t),this.type=Ug.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new $g({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Vk extends iT{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function oT(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let iw=(()=>{var e;class t{constructor(n){this.handler=n}request(n,r,s={}){let d;if(n instanceof v0)d=n;else{let E,I;E=s.headers instanceof Nc?s.headers:new Nc(s.headers),s.params&&(I=s.params instanceof up?s.params:new up({fromObject:s.params})),d=new v0(n,r,void 0!==s.body?s.body:null,{headers:E,context:s.context,params:I,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials})}const m=Vt(d).pipe(Pg(E=>this.handler.handle(E)));if(n instanceof v0||"events"===s.observe)return m;const b=m.pipe(sr(E=>E instanceof $g));switch(s.observe||"body"){case"body":switch(d.responseType){case"arraybuffer":return b.pipe(Xt(E=>{if(null!==E.body&&!(E.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return E.body}));case"blob":return b.pipe(Xt(E=>{if(null!==E.body&&!(E.body instanceof Blob))throw new Error("Response is not a Blob.");return E.body}));case"text":return b.pipe(Xt(E=>{if(null!==E.body&&"string"!=typeof E.body)throw new Error("Response is not a string.");return E.body}));default:return b.pipe(Xt(E=>E.body))}case"response":return b;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(n,r={}){return this.request("DELETE",n,r)}get(n,r={}){return this.request("GET",n,r)}head(n,r={}){return this.request("HEAD",n,r)}jsonp(n,r){return this.request("JSONP",n,{params:(new up).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,r={}){return this.request("OPTIONS",n,r)}patch(n,r,s={}){return this.request("PATCH",n,oT(s,r))}post(n,r,s={}){return this.request("POST",n,oT(s,r))}put(n,r,s={}){return this.request("PUT",n,oT(s,r))}}return(e=t).\u0275fac=function(n){return new(n||e)(je(ew))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();function $k(e,t){return t(e)}function j8(e,t){return(i,n)=>t.intercept(i,{handle:r=>e(r,n)})}const $8=new mt(""),b0=new mt(""),Hk=new mt("");function H8(){let e=null;return(t,i)=>{null===e&&(e=(ft($8,{optional:!0})??[]).reduceRight(j8,$k));const n=ft(px),r=n.add();return e(t,i).pipe(Og(()=>n.remove(r)))}}let Gk=(()=>{var e;class t extends ew{constructor(n,r){super(),this.backend=n,this.injector=r,this.chain=null,this.pendingTasks=ft(px)}handle(n){if(null===this.chain){const s=Array.from(new Set([...this.injector.get(b0),...this.injector.get(Hk,[])]));this.chain=s.reduceRight((d,m)=>function U8(e,t,i){return(n,r)=>i.runInContext(()=>t(n,s=>e(s,r)))}(d,m,this.injector),$k)}const r=this.pendingTasks.add();return this.chain(n,s=>this.backend.handle(s)).pipe(Og(()=>this.pendingTasks.remove(r)))}}return(e=t).\u0275fac=function(n){return new(n||e)(je(tw),je(Qr))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();const Z8=/^\)\]\}',?\n/;let Wk=(()=>{var e;class t{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new He(-2800,!1);const r=this.xhrFactory;return(r.\u0275loadImpl?ei(r.\u0275loadImpl()):Vt(null)).pipe(Fe(()=>new ot(d=>{const m=r.build();if(m.open(n.method,n.urlWithParams),n.withCredentials&&(m.withCredentials=!0),n.headers.forEach((ke,Ge)=>m.setRequestHeader(ke,Ge.join(","))),n.headers.has("Accept")||m.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const ke=n.detectContentTypeHeader();null!==ke&&m.setRequestHeader("Content-Type",ke)}if(n.responseType){const ke=n.responseType.toLowerCase();m.responseType="json"!==ke?ke:"text"}const b=n.serializeBody();let E=null;const I=()=>{if(null!==E)return E;const ke=m.statusText||"OK",Ge=new Nc(m.getAllResponseHeaders()),Oe=function Y8(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(m)||n.url;return E=new rT({headers:Ge,status:m.status,statusText:ke,url:Oe}),E},O=()=>{let{headers:ke,status:Ge,statusText:Oe,url:pt}=I(),rt=null;204!==Ge&&(rt=typeof m.response>"u"?m.responseText:m.response),0===Ge&&(Ge=rt?200:0);let At=Ge>=200&&Ge<300;if("json"===n.responseType&&"string"==typeof rt){const Wt=rt;rt=rt.replace(Z8,"");try{rt=""!==rt?JSON.parse(rt):null}catch(en){rt=Wt,At&&(At=!1,rt={error:en,text:rt})}}At?(d.next(new $g({body:rt,headers:ke,status:Ge,statusText:Oe,url:pt||void 0})),d.complete()):d.error(new Vk({error:rt,headers:ke,status:Ge,statusText:Oe,url:pt||void 0}))},q=ke=>{const{url:Ge}=I(),Oe=new Vk({error:ke,status:m.status||0,statusText:m.statusText||"Unknown Error",url:Ge||void 0});d.error(Oe)};let Y=!1;const pe=ke=>{Y||(d.next(I()),Y=!0);let Ge={type:Ug.DownloadProgress,loaded:ke.loaded};ke.lengthComputable&&(Ge.total=ke.total),"text"===n.responseType&&m.responseText&&(Ge.partialText=m.responseText),d.next(Ge)},Te=ke=>{let Ge={type:Ug.UploadProgress,loaded:ke.loaded};ke.lengthComputable&&(Ge.total=ke.total),d.next(Ge)};return m.addEventListener("load",O),m.addEventListener("error",q),m.addEventListener("timeout",q),m.addEventListener("abort",q),n.reportProgress&&(m.addEventListener("progress",pe),null!==b&&m.upload&&m.upload.addEventListener("progress",Te)),m.send(b),d.next({type:Ug.Sent}),()=>{m.removeEventListener("error",q),m.removeEventListener("abort",q),m.removeEventListener("load",O),m.removeEventListener("timeout",q),n.reportProgress&&(m.removeEventListener("progress",pe),null!==b&&m.upload&&m.upload.removeEventListener("progress",Te)),m.readyState!==m.DONE&&m.abort()}})))}}return(e=t).\u0275fac=function(n){return new(n||e)(je(cR))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();const sT=new mt("XSRF_ENABLED"),Zk=new mt("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),Yk=new mt("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class Xk{}let Q8=(()=>{var e;class t{constructor(n,r,s){this.doc=n,this.platform=r,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=Y2(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn),je(Ll),je(Zk))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();function J8(e,t){const i=e.url.toLowerCase();if(!ft(sT)||"GET"===e.method||"HEAD"===e.method||i.startsWith("http://")||i.startsWith("https://"))return t(e);const n=ft(Xk).getToken(),r=ft(Yk);return null!=n&&!e.headers.has(r)&&(e=e.clone({headers:e.headers.set(r,n)})),t(e)}var hp=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(hp||{});function hm(e,t){return{\u0275kind:e,\u0275providers:t}}function e$(...e){const t=[iw,Wk,Gk,{provide:ew,useExisting:Gk},{provide:tw,useExisting:Wk},{provide:b0,useValue:J8,multi:!0},{provide:sT,useValue:!0},{provide:Xk,useClass:Q8}];for(const i of e)t.push(...i.\u0275providers);return function Gh(e){return{\u0275providers:e}}(t)}const Kk=new mt("LEGACY_INTERCEPTOR_FN");let x0=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({providers:[e$(hm(hp.LegacyInterceptors,[{provide:Kk,useFactory:H8},{provide:b0,useExisting:Kk,multi:!0}]))]}),t})();const w0_mapbox_accessToken="pk.eyJ1IjoidGRyYXZlIiwiYSI6ImNsbXFjOXVyajAyZWcybW1rOHN2b3JtdTgifQ.5F-rEe5HE5D0JK9f55mxSw";let C0=(()=>{var e;class t{constructor(){this.companyName=""}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),hs=(()=>{var e;class t{constructor(n,r){this.http=n,this.companyService=r,this.url="https://ugmarket.ugent.be/api2/"}getTokenHeader(n){return(new Nc).set("x-access-token",n)}signIn(n,r){return this.http.post(`${this.url}/api/auth/signin`,{login:n,password:r}).toPromise()}signUp(n){return this.http.post(`${this.url}/api/auth/signup`,n).toPromise()}getUserData(n,r){return this.http.get(`${this.url}/api/userdata?id=${n}`,{headers:this.getTokenHeader(r)}).toPromise()}postUserData(n,r,s){return this.http.post(`${this.url}/api/userdata?id=${n}`,s,{headers:this.getTokenHeader(r)}).toPromise()}getProfilePicture(n){return this.http.get(`${this.url}/api/userPicture?id=${n}`).toPromise()}changePassword(n,r,s){return this.http.post(`${this.url}/api/user/changePassword`,{oldPassword:n,newPassword:r},{headers:this.getTokenHeader(s)}).toPromise()}getAllListings(){return this.http.get(`${this.url}/api/listings`,{params:{company:this.companyService.companyName}}).toPromise()}getActiveListings(){return this.http.get(`${this.url}/api/activeListings`,{params:{company:this.companyService.companyName}}).toPromise()}getUserListings(n){return this.http.get(`${this.url}/api/listings/user?id=${n}`,{params:{company:this.companyService.companyName}}).toPromise()}createListing(n,r,s){const d={...r,companyName:s};return this.http.post(`${this.url}/api/listing/create`,d,{headers:this.getTokenHeader(n)}).toPromise()}getListing(n){return this.http.get(`${this.url}/api/listing?id=${n}`).toPromise()}getTransaction(n){return this.http.get(`${this.url}/api/transaction?transactionID=${n}`).toPromise()}postListing(n,r,s){return this.http.post(`${this.url}/api/listing?id=${n}`,s,{headers:this.getTokenHeader(r)}).toPromise()}cancelListing(n,r){return this.http.get(`${this.url}/api/listing/cancel?id=${n}`,{headers:this.getTokenHeader(r)}).toPromise()}soldListingStatus(n){return this.http.get(`${this.url}/api/listing/soldStatus?id=${n}`).toPromise()}getListingTransactions(n,r){return this.http.get(`${this.url}/api/transactions/listing?id=${n}`,{headers:this.getTokenHeader(r)}).toPromise()}getUserTransactions(n){return this.http.get(`${this.url}/api/transactions/user`,{params:{company:this.companyService.companyName},headers:this.getTokenHeader(n)}).toPromise()}createTransaction(n,r){return this.http.post(`${this.url}/api/transaction/create`,r,{headers:this.getTokenHeader(n)}).toPromise()}cancelTransaction(n,r){return this.http.get(`${this.url}/api/transaction/cancel?id=${n}`,{headers:this.getTokenHeader(r)}).toPromise()}confirmPayment(n,r){return this.http.get(`${this.url}/api/transaction/confirmPayment?id=${n}`,{headers:this.getTokenHeader(r)}).toPromise()}getCategories(){return this.http.get(`${this.url}/api/categories`,{params:{company:this.companyService.companyName}}).toPromise()}deleteCategory(n){return this.http.post(`${this.url}/api/category/delete`,{name:n}).toPromise()}deleteCategoryType(n){return this.http.post(`${this.url}/api/category/deleteType`,{type:n}).toPromise()}createCategory(n){return n.company=this.companyService.companyName,this.http.post(`${this.url}/api/category/create`,n).toPromise()}createCompany(n){return this.http.post(`${this.url}/api/company/create`,n).toPromise()}getUserNotifications(n){return this.http.get(`${this.url}/api/notifications`,{headers:this.getTokenHeader(n)}).toPromise()}markNotificationAsViewed(n,r){return this.http.get(`${this.url}/api/notification/markViewed?id=${n}`,{headers:this.getTokenHeader(r)}).toPromise()}deleteNotifications(n){return this.http.delete(`${this.url}/api/notification`,{headers:this.getTokenHeader(n)}).toPromise()}postReview(n,r,s){return this.http.post(`${this.url}/api/review?id=${r}`,s,{headers:this.getTokenHeader(n)}).toPromise()}getListingReviews(n){return this.http.get(`${this.url}/api/reviews/listing?id=${n}`).toPromise()}getUserReviews(n){return this.http.get(`${this.url}/api/reviews/user?id=${n}`).toPromise()}getBooking(n,r){return this.http.get(`${this.url}/api/booking?id=${r}`,{headers:this.getTokenHeader(n)}).toPromise()}getTransactionBookings(n,r){return this.http.get(`${this.url}/api/transaction/bookings?id=${r}`,{headers:this.getTokenHeader(n)}).toPromise()}getListingBookings(n,r,s){return this.http.get(`${this.url}/api/listing/bookings?id=${n}&month=${r}&year=${s}`).toPromise()}createBooking(n,r){return this.http.post(`${this.url}/api/booking`,r,{headers:this.getTokenHeader(n)}).toPromise()}addBookingInfo(n,r){return this.http.post(`${this.url}/api/booking/info`,r,{headers:this.getTokenHeader(n)}).toPromise()}getSellerRating(n){return this.http.get(`${this.url}/api/user/sellerrating?id=${n}`).toPromise()}getUserRating(n,r){return this.http.get(`${this.url}/api/user/userrating?id=${r}`,{headers:this.getTokenHeader(n)}).toPromise()}getTaxonomy(){return this.http.get(`${this.url}/api/taxonomy`,{params:{company:this.companyService.companyName}}).toPromise()}getConstraints(){return this.http.get(`${this.url}/api/constraints`).toPromise()}getProperties(){return this.http.get(`${this.url}/api/properties`,{params:{company:this.companyService.companyName}}).toPromise()}getSelectedCompany(){return this.http.get(`${this.url}/api/company`).toPromise()}getCompanies(){return this.http.get(`${this.url}/api/companies`).toPromise()}setCompany(n){return this.http.post(`${this.url}/api/setCompany/${n}`,{}).toPromise()}createProperty(n,r){return this.http.post(`${this.url}/api/property/create/${r}/${n}`,{}).toPromise()}deleteProperty(n,r){return this.http.delete(`${this.url}/api/property/${r}/${n}`).subscribe(s=>{},s=>{console.error("Error deleting record",s)})}postMessage(n,r,s){return this.http.post(`${this.url}/api/message`,{receiverID:r,message:s},{headers:this.getTokenHeader(n)}).toPromise()}getMessages(n,r){return this.http.get(`${this.url}/api/messages?id=${r}`,{headers:this.getTokenHeader(n)}).toPromise()}getLastMessages(n){return this.http.get(`${this.url}/api/lastMessages`,{headers:this.getTokenHeader(n)}).toPromise()}getNewMessagesAmount(n){return this.http.get(`${this.url}/api/newMessages`,{headers:this.getTokenHeader(n)}).toPromise()}geoLocate(n){return this.http.get(`https://api.mapbox.com/geocoding/v5/mapbox.places/${n}.json?access_token=${w0_mapbox_accessToken}`).toPromise()}}return(e=t).\u0275fac=function(n){return new(n||e)(je(iw),je(C0))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function Qk(...e){if(1===e.length){const t=e[0];if(Vr(t))return ow(t,null);if(Po(t)&&Object.getPrototypeOf(t)===Object.prototype){const i=Object.keys(t);return ow(i.map(n=>t[n]),i)}}if("function"==typeof e[e.length-1]){const t=e.pop();return ow(e=1===e.length&&Vr(e[0])?e[0]:e,null).pipe(Xt(i=>t(...i)))}return ow(e,null)}function ow(e,t){return new ot(i=>{const n=e.length;if(0===n)return void i.complete();const r=new Array(n);let s=0,d=0;for(let m=0;m<n;m++){const b=ei(e[m]);let E=!1;i.add(b.subscribe({next:I=>{E||(E=!0,d++),r[m]=I},error:I=>i.error(I),complete:()=>{s++,(s===n||!E)&&(d===n&&i.next(t?t.reduce((I,O,q)=>(I[O]=r[q],I),{}):r),i.complete())}}))}})}let Jk=(()=>{var e;class t{constructor(n,r){this._renderer=n,this._elementRef=r,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(n,r){this._renderer.setProperty(this._elementRef.nativeElement,n,r)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(po),oe(Tn))},e.\u0275dir=gt({type:e}),t})(),pm=(()=>{var e;class t extends Jk{}return(e=t).\u0275fac=function(){let i;return function(r){return(i||(i=mi(e)))(r||e)}}(),e.\u0275dir=gt({type:e,features:[Yt]}),t})();const fa=new mt("NgValueAccessor"),a$={provide:fa,useExisting:wt(()=>Hg),multi:!0};let Hg=(()=>{var e;class t extends pm{writeValue(n){this.setProperty("checked",n)}}return(e=t).\u0275fac=function(){let i;return function(r){return(i||(i=mi(e)))(r||e)}}(),e.\u0275dir=gt({type:e,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(n,r){1&n&&nt("change",function(d){return r.onChange(d.target.checked)})("blur",function(){return r.onTouched()})},features:[vi([a$]),Yt]}),t})();const l$={provide:fa,useExisting:wt(()=>ma),multi:!0},d$=new mt("CompositionEventMode");let ma=(()=>{var e;class t extends Jk{constructor(n,r,s){super(n,r),this._compositionMode=s,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function c$(){const e=sp()?sp().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(n){this.setProperty("value",n??"")}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(po),oe(Tn),oe(d$,8))},e.\u0275dir=gt({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,r){1&n&&nt("input",function(d){return r._handleInput(d.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(d){return r._compositionEnd(d.target.value)})},features:[vi([l$]),Yt]}),t})();function pp(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}const ko=new mt("NgValidators"),fp=new mt("NgAsyncValidators");function sw(e){return null}function cP(e){return null!=e}function dP(e){return Lv(e)?ei(e):e}function uP(e){let t={};return e.forEach(i=>{t=null!=i?{...t,...i}:t}),0===Object.keys(t).length?null:t}function hP(e,t){return t.map(i=>i(e))}function pP(e){return e.map(t=>function p$(e){return!e.validate}(t)?t:i=>t.validate(i))}function aT(e){return null!=e?function fP(e){if(!e)return null;const t=e.filter(cP);return 0==t.length?null:function(i){return uP(hP(i,t))}}(pP(e)):null}function lT(e){return null!=e?function mP(e){if(!e)return null;const t=e.filter(cP);return 0==t.length?null:function(i){return Qk(hP(i,t).map(dP)).pipe(Xt(uP))}}(pP(e)):null}function _P(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function gP(e){return e._rawValidators}function yP(e){return e._rawAsyncValidators}function cT(e){return e?Array.isArray(e)?e:[e]:[]}function aw(e,t){return Array.isArray(e)?e.includes(t):e===t}function vP(e,t){const i=cT(t);return cT(e).forEach(r=>{aw(i,r)||i.push(r)}),i}function bP(e,t){return cT(t).filter(i=>!aw(e,i))}class xP{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=aT(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=lT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,i){return!!this.control&&this.control.hasError(t,i)}getError(t,i){return this.control?this.control.getError(t,i):null}}class zs extends xP{get formDirective(){return null}get path(){return null}}class mp extends xP{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class wP{constructor(t){this._cd=t}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let $l=(()=>{var e;class t extends wP{constructor(n){super(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(mp,2))},e.\u0275dir=gt({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,r){2&n&&kn("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[Yt]}),t})(),_p=(()=>{var e;class t extends wP{constructor(n){super(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(zs,10))},e.\u0275dir=gt({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,r){2&n&&kn("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)("ng-submitted",r.isSubmitted)},features:[Yt]}),t})();const D0="VALID",cw="INVALID",Gg="PENDING",E0="DISABLED";function hT(e){return(dw(e)?e.validators:e)||null}function pT(e,t){return(dw(t)?t.asyncValidators:e)||null}function dw(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function DP(e,t,i){const n=e.controls;if(!(t?Object.keys(n):n).length)throw new He(1e3,"");if(!n[i])throw new He(1001,"")}function EP(e,t,i){e._forEachChild((n,r)=>{if(void 0===i[r])throw new He(1002,"")})}class uw{constructor(t,i){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(t),this._assignAsyncValidators(i)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===D0}get invalid(){return this.status===cw}get pending(){return this.status==Gg}get disabled(){return this.status===E0}get enabled(){return this.status!==E0}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(vP(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(vP(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(bP(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(bP(t,this._rawAsyncValidators))}hasValidator(t){return aw(this._rawValidators,t)}hasAsyncValidator(t){return aw(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(i=>{i.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Gg,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const i=this._parentMarkedDirty(t.onlySelf);this.status=E0,this.errors=null,this._forEachChild(n=>{n.disable({...t,onlySelf:!0})}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:i}),this._onDisabledChange.forEach(n=>n(!0))}enable(t={}){const i=this._parentMarkedDirty(t.onlySelf);this.status=D0,this._forEachChild(n=>{n.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:i}),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===D0||this.status===Gg)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(i=>i._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?E0:D0}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Gg,this._hasOwnPendingAsyncValidator=!0;const i=dP(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(n=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(n,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,i={}){this.errors=t,this._updateControlsErrors(!1!==i.emitEvent)}get(t){let i=t;return null==i||(Array.isArray(i)||(i=i.split(".")),0===i.length)?null:i.reduce((n,r)=>n&&n._find(r),this)}getError(t,i){const n=i?this.get(i):this;return n&&n.errors?n.errors[t]:null}hasError(t,i){return!!this.getError(t,i)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new Ct,this.statusChanges=new Ct}_calculateStatus(){return this._allControlsDisabled()?E0:this.errors?cw:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Gg)?Gg:this._anyControlsHaveStatus(cw)?cw:D0}_anyControlsHaveStatus(t){return this._anyControls(i=>i.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){dw(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=function g$(e){return Array.isArray(e)?aT(e):e||null}(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=function y$(e){return Array.isArray(e)?lT(e):e||null}(this._rawAsyncValidators)}}class qg extends uw{constructor(t,i,n){super(hT(i),pT(n,i)),this.controls=t,this._initObservables(),this._setUpdateStrategy(i),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,i){return this.controls[t]?this.controls[t]:(this.controls[t]=i,i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange),i)}addControl(t,i,n={}){this.registerControl(t,i),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(t,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}setControl(t,i,n={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],i&&this.registerControl(t,i),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,i={}){EP(this,0,t),Object.keys(t).forEach(n=>{DP(this,!0,n),this.controls[n].setValue(t[n],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i)}patchValue(t,i={}){null!=t&&(Object.keys(t).forEach(n=>{const r=this.controls[n];r&&r.patchValue(t[n],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i))}reset(t={},i={}){this._forEachChild((n,r)=>{n.reset(t[r],{onlySelf:!0,emitEvent:i.emitEvent})}),this._updatePristine(i),this._updateTouched(i),this.updateValueAndValidity(i)}getRawValue(){return this._reduceChildren({},(t,i,n)=>(t[n]=i.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(i,n)=>!!n._syncPendingControls()||i);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(i=>{const n=this.controls[i];n&&t(n,i)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[i,n]of Object.entries(this.controls))if(this.contains(i)&&t(n))return!0;return!1}_reduceValue(){return this._reduceChildren({},(i,n,r)=>((n.enabled||this.disabled)&&(i[r]=n.value),i))}_reduceChildren(t,i){let n=t;return this._forEachChild((r,s)=>{n=i(n,r,s)}),n}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}const Sd=qg;class TP extends qg{}const fm=new mt("CallSetDisabledState",{providedIn:"root",factory:()=>T0}),T0="always";function hw(e,t){return[...t.path,e]}function S0(e,t,i=T0){fT(e,t),t.valueAccessor.writeValue(e.value),(e.disabled||"always"===i)&&t.valueAccessor.setDisabledState?.(e.disabled),function b$(e,t){t.valueAccessor.registerOnChange(i=>{e._pendingValue=i,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&SP(e,t)})}(e,t),function w$(e,t){const i=(n,r)=>{t.valueAccessor.writeValue(n),r&&t.viewToModelUpdate(n)};e.registerOnChange(i),t._registerOnDestroy(()=>{e._unregisterOnChange(i)})}(e,t),function x$(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&SP(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function v$(e,t){if(t.valueAccessor.setDisabledState){const i=n=>{t.valueAccessor.setDisabledState(n)};e.registerOnDisabledChange(i),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(i)})}}(e,t)}function pw(e,t,i=!0){const n=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(n),t.valueAccessor.registerOnTouched(n)),mw(e,t),e&&(t._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function fw(e,t){e.forEach(i=>{i.registerOnValidatorChange&&i.registerOnValidatorChange(t)})}function fT(e,t){const i=gP(e);null!==t.validator?e.setValidators(_P(i,t.validator)):"function"==typeof i&&e.setValidators([i]);const n=yP(e);null!==t.asyncValidator?e.setAsyncValidators(_P(n,t.asyncValidator)):"function"==typeof n&&e.setAsyncValidators([n]);const r=()=>e.updateValueAndValidity();fw(t._rawValidators,r),fw(t._rawAsyncValidators,r)}function mw(e,t){let i=!1;if(null!==e){if(null!==t.validator){const r=gP(e);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.validator);s.length!==r.length&&(i=!0,e.setValidators(s))}}if(null!==t.asyncValidator){const r=yP(e);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.asyncValidator);s.length!==r.length&&(i=!0,e.setAsyncValidators(s))}}}const n=()=>{};return fw(t._rawValidators,n),fw(t._rawAsyncValidators,n),i}function SP(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function _T(e,t){if(!e.hasOwnProperty("model"))return!1;const i=e.model;return!!i.isFirstChange()||!Object.is(t,i.currentValue)}function gT(e,t){if(!t)return null;let i,n,r;return Array.isArray(t),t.forEach(s=>{s.constructor===ma?i=s:function E$(e){return Object.getPrototypeOf(e.constructor)===pm}(s)?n=s:r=s}),r||n||i||null}function IP(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}function RP(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const mm=class extends uw{constructor(t=null,i,n){super(hT(i),pT(n,i)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(i),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),dw(i)&&(i.nonNullable||i.initialValueIsDefault)&&(this.defaultValue=RP(t)?t.value:t)}setValue(t,i={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==i.emitModelToViewChange&&this._onChange.forEach(n=>n(this.value,!1!==i.emitViewToModelChange)),this.updateValueAndValidity(i)}patchValue(t,i={}){this.setValue(t,i)}reset(t=this.defaultValue,i={}){this._applyFormState(t),this.markAsPristine(i),this.markAsUntouched(i),this.setValue(this.value,i),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){IP(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){IP(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){RP(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},On=mm,I$={provide:mp,useExisting:wt(()=>gp)},OP=(()=>Promise.resolve())();let gp=(()=>{var e;class t extends mp{constructor(n,r,s,d,m,b){super(),this._changeDetectorRef=m,this.callSetDisabledState=b,this.control=new mm,this._registered=!1,this.name="",this.update=new Ct,this._parent=n,this._setValidators(r),this._setAsyncValidators(s),this.valueAccessor=gT(0,d)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){const r=n.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),_T(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){S0(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(n){OP.then(()=>{this.control.setValue(n,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(n){const r=n.isDisabled.currentValue,s=0!==r&&Ag(r);OP.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(n){return this._parent?hw(n,this._parent):[n]}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(zs,9),oe(ko,10),oe(fp,10),oe(fa,10),oe(Io,8),oe(fm,8))},e.\u0275dir=gt({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[vi([I$]),Yt,Ci]}),t})(),yp=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275dir=gt({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),t})();const R$={provide:fa,useExisting:wt(()=>Wg),multi:!0};let Wg=(()=>{var e;class t extends pm{writeValue(n){this.setProperty("value",n??"")}registerOnChange(n){this.onChange=r=>{n(""==r?null:parseFloat(r))}}}return(e=t).\u0275fac=function(){let i;return function(r){return(i||(i=mi(e)))(r||e)}}(),e.\u0275dir=gt({type:e,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(n,r){1&n&&nt("input",function(d){return r.onChange(d.target.value)})("blur",function(){return r.onTouched()})},features:[vi([R$]),Yt]}),t})(),FP=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})();const vT=new mt("NgModelWithFormControlWarning"),N$={provide:zs,useExisting:wt(()=>Md)};let Md=(()=>{var e;class t extends zs{constructor(n,r,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Ct,this._setValidators(n),this._setAsyncValidators(r)}ngOnChanges(n){this._checkFormPresent(),n.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(mw(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(n){const r=this.form.get(n.path);return S0(r,n,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(n),r}getControl(n){return this.form.get(n.path)}removeControl(n){pw(n.control||null,n,!1),function T$(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}(this.directives,n)}addFormGroup(n){this._setUpFormContainer(n)}removeFormGroup(n){this._cleanUpFormContainer(n)}getFormGroup(n){return this.form.get(n.path)}addFormArray(n){this._setUpFormContainer(n)}removeFormArray(n){this._cleanUpFormContainer(n)}getFormArray(n){return this.form.get(n.path)}updateModel(n,r){this.form.get(n.path).setValue(r)}onSubmit(n){return this.submitted=!0,function AP(e,t){e._syncPendingControls(),t.forEach(i=>{const n=i.control;"submit"===n.updateOn&&n._pendingChange&&(i.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(n),"dialog"===n?.target?.method}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submitted=!1}_updateDomValue(){this.directives.forEach(n=>{const r=n.control,s=this.form.get(n.path);r!==s&&(pw(r||null,n),(e=>e instanceof mm)(s)&&(S0(s,n,this.callSetDisabledState),n.control=s))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(n){const r=this.form.get(n.path);(function MP(e,t){fT(e,t)})(r,n),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(n){if(this.form){const r=this.form.get(n.path);r&&function C$(e,t){return mw(e,t)}(r,n)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){fT(this.form,this),this._oldForm&&mw(this._oldForm,this)}_checkFormPresent(){}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(ko,10),oe(fp,10),oe(fm,8))},e.\u0275dir=gt({type:e,selectors:[["","formGroup",""]],hostBindings:function(n,r){1&n&&nt("submit",function(d){return r.onSubmit(d)})("reset",function(){return r.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[vi([N$]),Yt,Ci]}),t})();const z$={provide:mp,useExisting:wt(()=>Pu)};let Pu=(()=>{var e;class t extends mp{set isDisabled(n){}constructor(n,r,s,d,m){super(),this._ngModelWarningConfig=m,this._added=!1,this.name=null,this.update=new Ct,this._ngModelWarningSent=!1,this._parent=n,this._setValidators(r),this._setAsyncValidators(s),this.valueAccessor=gT(0,d)}ngOnChanges(n){this._added||this._setUpControl(),_T(n,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}get path(){return hw(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}}return(e=t)._ngModelWarningSentOnce=!1,e.\u0275fac=function(n){return new(n||e)(oe(zs,13),oe(ko,10),oe(fp,10),oe(fa,10),oe(vT,8))},e.\u0275dir=gt({type:e,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[vi([z$]),Yt,Ci]}),t})();const V$={provide:fa,useExisting:wt(()=>A0),multi:!0};function VP(e,t){return null==e?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let A0=(()=>{var e;class t extends pm{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){this.value=n;const s=VP(this._getOptionId(n),n);this.setProperty("value",s)}registerOnChange(n){this.onChange=r=>{this.value=this._getOptionValue(r),n(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(n){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),n))return r;return null}_getOptionValue(n){const r=function j$(e){return e.split(":")[0]}(n);return this._optionMap.has(r)?this._optionMap.get(r):n}}return(e=t).\u0275fac=function(){let i;return function(r){return(i||(i=mi(e)))(r||e)}}(),e.\u0275dir=gt({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(n,r){1&n&&nt("change",function(d){return r.onChange(d.target.value)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},features:[vi([V$]),Yt]}),t})(),wT=(()=>{var e;class t{constructor(n,r,s){this._element=n,this._renderer=r,this._select=s,this._select&&(this.id=this._select._registerOption())}set ngValue(n){null!=this._select&&(this._select._optionMap.set(this.id,n),this._setElementValue(VP(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._setElementValue(n),this._select&&this._select.writeValue(this._select.value)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Tn),oe(po),oe(A0,9))},e.\u0275dir=gt({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),t})();const U$={provide:fa,useExisting:wt(()=>CT),multi:!0};function jP(e,t){return null==e?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let CT=(()=>{var e;class t extends pm{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){let r;if(this.value=n,Array.isArray(n)){const s=n.map(d=>this._getOptionId(d));r=(d,m)=>{d._setSelected(s.indexOf(m.toString())>-1)}}else r=(s,d)=>{s._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(n){this.onChange=r=>{const s=[],d=r.selectedOptions;if(void 0!==d){const m=d;for(let b=0;b<m.length;b++){const I=this._getOptionValue(m[b].value);s.push(I)}}else{const m=r.options;for(let b=0;b<m.length;b++){const E=m[b];if(E.selected){const I=this._getOptionValue(E.value);s.push(I)}}}this.value=s,n(s)}}_registerOption(n){const r=(this._idCounter++).toString();return this._optionMap.set(r,n),r}_getOptionId(n){for(const r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,n))return r;return null}_getOptionValue(n){const r=function $$(e){return e.split(":")[0]}(n);return this._optionMap.has(r)?this._optionMap.get(r)._value:n}}return(e=t).\u0275fac=function(){let i;return function(r){return(i||(i=mi(e)))(r||e)}}(),e.\u0275dir=gt({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(n,r){1&n&&nt("change",function(d){return r.onChange(d.target)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},features:[vi([U$]),Yt]}),t})(),DT=(()=>{var e;class t{constructor(n,r,s){this._element=n,this._renderer=r,this._select=s,this._select&&(this.id=this._select._registerOption(this))}set ngValue(n){null!=this._select&&(this._value=n,this._setElementValue(jP(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._select?(this._value=n,this._setElementValue(jP(this.id,n)),this._select.writeValue(this._select.value)):this._setElementValue(n)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}_setSelected(n){this._renderer.setProperty(this._element.nativeElement,"selected",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Tn),oe(po),oe(CT,9))},e.\u0275dir=gt({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),t})();function $P(e){return"number"==typeof e?e:parseFloat(e)}let _m=(()=>{var e;class t{constructor(){this._validator=sw}ngOnChanges(n){if(this.inputName in n){const r=this.normalizeInput(n[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):sw,this._onChange&&this._onChange()}}validate(n){return this._validator(n)}registerOnValidatorChange(n){this._onChange=n}enabled(n){return null!=n}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275dir=gt({type:e,features:[Ci]}),t})();const H$={provide:ko,useExisting:wt(()=>I0),multi:!0};let I0=(()=>{var e;class t extends _m{constructor(){super(...arguments),this.inputName="max",this.normalizeInput=n=>$P(n),this.createValidator=n=>function nP(e){return t=>{if(pp(t.value)||pp(e))return null;const i=parseFloat(t.value);return!isNaN(i)&&i>e?{max:{max:e,actual:t.value}}:null}}(n)}}return(e=t).\u0275fac=function(){let i;return function(r){return(i||(i=mi(e)))(r||e)}}(),e.\u0275dir=gt({type:e,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(n,r){2&n&&Fn("max",r._enabled?r.max:null)},inputs:{max:"max"},features:[vi([H$]),Yt]}),t})();const G$={provide:ko,useExisting:wt(()=>Zg),multi:!0};let Zg=(()=>{var e;class t extends _m{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=n=>$P(n),this.createValidator=n=>function tP(e){return t=>{if(pp(t.value)||pp(e))return null;const i=parseFloat(t.value);return!isNaN(i)&&i<e?{min:{min:e,actual:t.value}}:null}}(n)}}return(e=t).\u0275fac=function(){let i;return function(r){return(i||(i=mi(e)))(r||e)}}(),e.\u0275dir=gt({type:e,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(n,r){2&n&&Fn("min",r._enabled?r.min:null)},inputs:{min:"min"},features:[vi([G$]),Yt]}),t})(),YP=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[FP]}),t})();class XP extends uw{constructor(t,i,n){super(hT(i),pT(n,i)),this.controls=t,this._initObservables(),this._setUpdateStrategy(i),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(t){return this.controls[this._adjustIndex(t)]}push(t,i={}){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}insert(t,i,n={}){this.controls.splice(t,0,i),this._registerControl(i),this.updateValueAndValidity({emitEvent:n.emitEvent})}removeAt(t,i={}){let n=this._adjustIndex(t);n<0&&(n=0),this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),this.controls.splice(n,1),this.updateValueAndValidity({emitEvent:i.emitEvent})}setControl(t,i,n={}){let r=this._adjustIndex(t);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),i&&(this.controls.splice(r,0,i),this._registerControl(i)),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,i={}){EP(this,0,t),t.forEach((n,r)=>{DP(this,!1,r),this.at(r).setValue(n,{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i)}patchValue(t,i={}){null!=t&&(t.forEach((n,r)=>{this.at(r)&&this.at(r).patchValue(n,{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i))}reset(t=[],i={}){this._forEachChild((n,r)=>{n.reset(t[r],{onlySelf:!0,emitEvent:i.emitEvent})}),this._updatePristine(i),this._updateTouched(i),this.updateValueAndValidity(i)}getRawValue(){return this.controls.map(t=>t.getRawValue())}clear(t={}){this.controls.length<1||(this._forEachChild(i=>i._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_adjustIndex(t){return t<0?t+this.length:t}_syncPendingControls(){let t=this.controls.reduce((i,n)=>!!n._syncPendingControls()||i,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){this.controls.forEach((i,n)=>{t(i,n)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(i=>i.enabled&&t(i))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}_find(t){return this.at(t)??null}}function KP(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let Q$=(()=>{var e;class t{constructor(){this.useNonNullable=!1}get nonNullable(){const n=new t;return n.useNonNullable=!0,n}group(n,r=null){const s=this._reduceControls(n);let d={};return KP(r)?d=r:null!==r&&(d.validators=r.validator,d.asyncValidators=r.asyncValidator),new qg(s,d)}record(n,r=null){const s=this._reduceControls(n);return new TP(s,r)}control(n,r,s){let d={};return this.useNonNullable?(KP(r)?d=r:(d.validators=r,d.asyncValidators=s),new mm(n,{...d,nonNullable:!0})):new mm(n,r,s)}array(n,r,s){const d=n.map(m=>this._createControl(m));return new XP(d,r,s)}_reduceControls(n){const r={};return Object.keys(n).forEach(s=>{r[s]=this._createControl(n[s])}),r}_createControl(n){return n instanceof mm||n instanceof uw?n:Array.isArray(n)?this.control(n[0],n.length>1?n[1]:null,n.length>2?n[2]:null):this.control(n)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),J$=(()=>{var e;class t extends Q${group(n,r=null){return super.group(n,r)}control(n,r,s){return super.control(n,r,s)}array(n,r,s){return super.array(n,r,s)}}return(e=t).\u0275fac=function(){let i;return function(r){return(i||(i=mi(e)))(r||e)}}(),e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),R0=(()=>{var e;class t{static withConfig(n){return{ngModule:t,providers:[{provide:fm,useValue:n.callSetDisabledState??T0}]}}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[YP]}),t})(),k0=(()=>{var e;class t{static withConfig(n){return{ngModule:t,providers:[{provide:vT,useValue:n.warnOnNgModelWithFormControl??"always"},{provide:fm,useValue:n.callSetDisabledState??T0}]}}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[YP]}),t})();function eH(e,t){if(1&e){const i=zt();H(0,"li")(1,"div",7),Rt(2,"input",13),H(3,"div",9)(4,"button",14),nt("click",function(){const s=_e(i).index,d=ue().index;return Ie(ue().removeOption(d,s))}),ne(5," Remove "),j()()()()}if(2&e){const i=t.$implicit;G(2),ee("placeholder",i)}}function tH(e,t){if(1&e){const i=zt();H(0,"div")(1,"h5",12)(2,"div",7),Rt(3,"input",13),H(4,"div",9)(5,"button",14),nt("click",function(){const s=_e(i).index;return Ie(ue().removeCategory(s))}),ne(6," Remove "),j()()()(),H(7,"ul"),me(8,eH,6,1,"li",6),H(9,"li")(10,"div",7)(11,"input",15),nt("ngModelChange",function(r){const d=_e(i).index;return Ie(ue().newOptionName[d]=r)}),j(),H(12,"div",9)(13,"button",10),nt("click",function(){const s=_e(i).index;return Ie(ue().addOption(s))}),ne(14," Add Option "),j()()()()()()}if(2&e){const i=t.$implicit,n=t.index,r=ue();G(3),ee("placeholder",i[0]),G(5),ee("ngForOf",i[1]),G(3),ee("ngModel",r.newOptionName[n]),G(2),ee("disabled",r.loading||!r.newOptionName[n])}}function nH(e,t){if(1&e&&(H(0,"h5")(1,"i",16),ne(2),j()()),2&e){const i=ue();G(2),Cn(i.error)}}let TT,iH=(()=>{var e;class t{constructor(n){this.db=n,this.loading=!1,this.categories=[],this.newOptionName=[""],this.newCategoryName="",this.fetchCategories()}ngOnInit(){}fetchCategories(){this.db.getCategories().then(n=>{this.categories=Object.entries(n),this.loading=!1}).catch(n=>{this.error=n.error.message,this.loading=!1})}addOption(n){this.loading=!0;let r={name:this.newOptionName[n]};r.type=this.categories[n][0],this.db.createCategory(r).then(s=>{this.fetchCategories(),this.newOptionName[n]=""}).catch(s=>{this.error=s.error.message,this.loading=!1})}addCategory(){this.categories.push([this.newCategoryName,[]]),this.newCategoryName=""}removeOption(n,r){this.loading=!0,this.db.deleteCategory(this.categories[n][1][r]).then(s=>{this.fetchCategories()}).catch(s=>{this.error=s.error.message,this.loading=!1})}removeCategory(n){this.loading=!0,this.db.deleteCategoryType(this.categories[n][0]).then(r=>{this.fetchCategories()}).catch(r=>{this.error=r.error.message,this.loading=!1})}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(hs))},e.\u0275cmp=In({type:e,selectors:[["app-categories"]],decls:13,vars:4,consts:[[2,"margin","10px"],[1,"container"],[1,"row"],[1,"offset-md-2","col-md-8","offset-lg-3","col-lg-6"],[1,"card"],[1,"card-body"],[4,"ngFor","ngForOf"],[1,"input-group","mb-3"],["type","text","placeholder","Category name",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group-append"],[1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"],[1,"card-title"],["type","text","readonly","",1,"form-control",3,"placeholder"],[1,"btn","btn-danger",3,"click"],["type","text","placeholder","option name",1,"form-control",3,"ngModel","ngModelChange"],[2,"color","red"]],template:function(n,r){1&n&&(H(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),me(6,tH,15,4,"div",6),H(7,"div",7)(8,"input",8),nt("ngModelChange",function(d){return r.newCategoryName=d}),j(),H(9,"div",9)(10,"button",10),nt("click",function(){return r.addCategory()}),ne(11," Add Category "),j()()(),me(12,nH,3,1,"h5",11),j()()()()()()),2&n&&(G(6),ee("ngForOf",r.categories),G(2),ee("ngModel",r.newCategoryName),G(2),ee("disabled",r.loading||!r.newCategoryName),G(2),ee("ngIf",r.error))},dependencies:[to,fr,ma,$l,gp]}),t})();try{TT=typeof Intl<"u"&&Intl.v8BreakIterator}catch{TT=!1}let P0,ym,ST,Go=(()=>{var e;class t{constructor(n){this._platformId=n,this.isBrowser=this._platformId?aR(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!TT)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Ll))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function gm(e){return function rH(){if(null==P0&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>P0=!0}))}finally{P0=P0||!1}return P0}()?e:!!e.capture}function oH(){if(null==ym){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return ym=!1,ym;if("scrollBehavior"in document.documentElement.style)ym=!0;else{const e=Element.prototype.scrollTo;ym=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return ym}function vp(e){return e.composedPath?e.composedPath()[0]:e.target}function MT(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function LT(e){return t=>t.lift(new fH(e))}class fH{constructor(t){this.total=t}call(t,i){return i.subscribe(new mH(t,this.total))}}class mH extends Gn{constructor(t,i){super(t),this.total=i,this.count=0}_next(t){++this.count>this.total&&this.destination.next(t)}}function mr(e){return t=>t.lift(new _H(e))}class _H{constructor(t){this.notifier=t}call(t,i){const n=new gH(t),r=_s(this.notifier,new $s(n));return r&&!n.seenValue?(n.add(r),i.subscribe(n)):n}}class gH extends Hs{constructor(t){super(t),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}function Qg(e){return null!=e&&"false"!=`${e}`}function yw(e){return Array.isArray(e)?e:[e]}function io(e){return null==e?"":"string"==typeof e?e:`${e}px`}function Jg(e){return e instanceof Tn?e.nativeElement:e}let vH=(()=>{var e;class t{create(n){return typeof MutationObserver>"u"?null:new MutationObserver(n)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),bH=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({providers:[vH]}),t})();class xH extends un{constructor(t,i){super()}schedule(t,i=0){return this}}class BT extends xH{constructor(t,i){super(t,i),this.scheduler=t,this.work=i,this.pending=!1}schedule(t,i=0){if(this.closed)return this;this.state=t;const n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,i)),this.pending=!0,this.delay=i,this.id=this.id||this.requestAsyncId(r,this.id,i),this}requestAsyncId(t,i,n=0){return setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,i,n=0){if(null!==n&&this.delay===n&&!1===this.pending)return i;clearInterval(i)}execute(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,i);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,i){let r,n=!1;try{this.work(t)}catch(s){n=!0,r=!!s&&s||new Error(s)}if(n)return this.unsubscribe(),r}_unsubscribe(){const t=this.id,i=this.scheduler,n=i.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(i,t,null)),this.delay=null}}let JP=(()=>{class e{constructor(i,n=e.now){this.SchedulerAction=i,this.now=n}schedule(i,n=0,r){return new this.SchedulerAction(this,i).schedule(r,n)}}return e.now=()=>Date.now(),e})();class Ad extends JP{constructor(t,i=JP.now){super(t,()=>Ad.delegate&&Ad.delegate!==this?Ad.delegate.now():i()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,i=0,n){return Ad.delegate&&Ad.delegate!==this?Ad.delegate.schedule(t,i,n):super.schedule(t,i,n)}flush(t){const{actions:i}=this;if(this.active)return void i.push(t);let n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=i.shift());if(this.active=!1,n){for(;t=i.shift();)t.unsubscribe();throw n}}}const vw=new Ad(BT);class CH{constructor(t,i){this.dueTime=t,this.scheduler=i}call(t,i){return i.subscribe(new DH(t,this.dueTime,this.scheduler))}}class DH extends Gn{constructor(t,i,n){super(t),this.dueTime=i,this.scheduler=n,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(EH,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:t}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}}clearDebounce(){const t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)}}function EH(e){e.debouncedNext()}const eO=new Set;let vm,TH=(()=>{var e;class t{constructor(n,r){this._platform=n,this._nonce=r,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):MH}matchMedia(n){return(this._platform.WEBKIT||this._platform.BLINK)&&function SH(e,t){if(!eO.has(e))try{vm||(vm=document.createElement("style"),t&&(vm.nonce=t),vm.setAttribute("type","text/css"),document.head.appendChild(vm)),vm.sheet&&(vm.sheet.insertRule(`@media ${e} {body{ }}`,0),eO.add(e))}catch(i){console.error(i)}}(n,this._nonce),this._matchMedia(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Go),je(yv,8))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function MH(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let AH=(()=>{var e;class t{constructor(n,r){this._mediaMatcher=n,this._zone=r,this._queries=new Map,this._destroySubject=new vn}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(n){return tO(yw(n)).some(s=>this._registerQuery(s).mql.matches)}observe(n){let d=Fx(tO(yw(n)).map(m=>this._registerQuery(m).observable));return d=n0(d.pipe(no(1)),d.pipe(LT(1),function wH(e,t=vw){return i=>i.lift(new CH(e,t))}(0))),d.pipe(Xt(m=>{const b={matches:!1,breakpoints:{}};return m.forEach(({matches:E,query:I})=>{b.matches=b.matches||E,b.breakpoints[I]=E}),b}))}_registerQuery(n){if(this._queries.has(n))return this._queries.get(n);const r=this._mediaMatcher.matchMedia(n),d={observable:new ot(m=>{const b=E=>this._zone.run(()=>m.next(E));return r.addListener(b),()=>{r.removeListener(b)}}).pipe(kg(r),Xt(({matches:m})=>({query:n,matches:m})),mr(this._destroySubject)),mql:r};return this._queries.set(n,d),d}}return(e=t).\u0275fac=function(n){return new(n||e)(je(TH),je(_n))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function tO(e){return e.map(t=>t.split(",")).reduce((t,i)=>t.concat(i)).map(t=>t.trim())}function oO(e){return 0===e.buttons||0===e.offsetX&&0===e.offsetY}function sO(e){const t=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}const LH=new mt("cdk-input-modality-detector-options"),BH={ignoreKeys:[18,17,224,91,16]},ey=gm({passive:!0,capture:!0});let zH=(()=>{var e;class t{get mostRecentModality(){return this._modality.value}constructor(n,r,s,d){this._platform=n,this._mostRecentTarget=null,this._modality=new jr(null),this._lastTouchMs=0,this._onKeydown=m=>{this._options?.ignoreKeys?.some(b=>b===m.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=vp(m))},this._onMousedown=m=>{Date.now()-this._lastTouchMs<650||(this._modality.next(oO(m)?"keyboard":"mouse"),this._mostRecentTarget=vp(m))},this._onTouchstart=m=>{sO(m)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=vp(m))},this._options={...BH,...d},this.modalityDetected=this._modality.pipe(LT(1)),this.modalityChanged=this.modalityDetected.pipe(Ue()),n.isBrowser&&r.runOutsideAngular(()=>{s.addEventListener("keydown",this._onKeydown,ey),s.addEventListener("mousedown",this._onMousedown,ey),s.addEventListener("touchstart",this._onTouchstart,ey)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,ey),document.removeEventListener("mousedown",this._onMousedown,ey),document.removeEventListener("touchstart",this._onTouchstart,ey))}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Go),je(_n),je(Sn),je(LH,8))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const jH=new mt("cdk-focus-monitor-default-options"),bw=gm({passive:!0,capture:!0});let lO=(()=>{var e;class t{constructor(n,r,s,d,m){this._ngZone=n,this._platform=r,this._inputModalityDetector=s,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new vn,this._rootNodeFocusAndBlurListener=b=>{for(let I=vp(b);I;I=I.parentElement)"focus"===b.type?this._onFocus(b,I):this._onBlur(b,I)},this._document=d,this._detectionMode=m?.detectionMode||0}monitor(n,r=!1){const s=Jg(n);if(!this._platform.isBrowser||1!==s.nodeType)return Vt();const d=function aH(e){if(function sH(){if(null==ST){const e=typeof document<"u"?document.head:null;ST=!(!e||!e.createShadowRoot&&!e.attachShadow)}return ST}()){const t=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(s)||this._getDocument(),m=this._elementInfo.get(s);if(m)return r&&(m.checkChildren=!0),m.subject;const b={checkChildren:r,subject:new vn,rootNode:d};return this._elementInfo.set(s,b),this._registerGlobalListeners(b),b.subject}stopMonitoring(n){const r=Jg(n),s=this._elementInfo.get(r);s&&(s.subject.complete(),this._setClasses(r),this._elementInfo.delete(r),this._removeGlobalListeners(s))}focusVia(n,r,s){const d=Jg(n);d===this._getDocument().activeElement?this._getClosestElementsInfo(d).forEach(([b,E])=>this._originChanged(b,r,E)):(this._setOrigin(r),"function"==typeof d.focus&&d.focus(s))}ngOnDestroy(){this._elementInfo.forEach((n,r)=>this.stopMonitoring(r))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(n){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(n)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:n&&this._isLastInteractionFromInputLabel(n)?"mouse":"program"}_shouldBeAttributedToTouch(n){return 1===this._detectionMode||!!n?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(n,r){n.classList.toggle("cdk-focused",!!r),n.classList.toggle("cdk-touch-focused","touch"===r),n.classList.toggle("cdk-keyboard-focused","keyboard"===r),n.classList.toggle("cdk-mouse-focused","mouse"===r),n.classList.toggle("cdk-program-focused","program"===r)}_setOrigin(n,r=!1){this._ngZone.runOutsideAngular(()=>{this._origin=n,this._originFromTouchInteraction="touch"===n&&r,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(n,r){const s=this._elementInfo.get(r),d=vp(n);!s||!s.checkChildren&&r!==d||this._originChanged(r,this._getFocusOrigin(d),s)}_onBlur(n,r){const s=this._elementInfo.get(r);!s||s.checkChildren&&n.relatedTarget instanceof Node&&r.contains(n.relatedTarget)||(this._setClasses(r),this._emitOrigin(s,null))}_emitOrigin(n,r){n.subject.observers.length&&this._ngZone.run(()=>n.subject.next(r))}_registerGlobalListeners(n){if(!this._platform.isBrowser)return;const r=n.rootNode,s=this._rootNodeFocusListenerCount.get(r)||0;s||this._ngZone.runOutsideAngular(()=>{r.addEventListener("focus",this._rootNodeFocusAndBlurListener,bw),r.addEventListener("blur",this._rootNodeFocusAndBlurListener,bw)}),this._rootNodeFocusListenerCount.set(r,s+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(mr(this._stopInputModalityDetector)).subscribe(d=>{this._setOrigin(d,!0)}))}_removeGlobalListeners(n){const r=n.rootNode;if(this._rootNodeFocusListenerCount.has(r)){const s=this._rootNodeFocusListenerCount.get(r);s>1?this._rootNodeFocusListenerCount.set(r,s-1):(r.removeEventListener("focus",this._rootNodeFocusAndBlurListener,bw),r.removeEventListener("blur",this._rootNodeFocusAndBlurListener,bw),this._rootNodeFocusListenerCount.delete(r))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(n,r,s){this._setClasses(n,r),this._emitOrigin(s,r),this._lastFocusOrigin=r}_getClosestElementsInfo(n){const r=[];return this._elementInfo.forEach((s,d)=>{(d===n||s.checkChildren&&d.contains(n))&&r.push([d,s])}),r}_isLastInteractionFromInputLabel(n){const{_mostRecentTarget:r,mostRecentModality:s}=this._inputModalityDetector;if("mouse"!==s||!r||r===n||"INPUT"!==n.nodeName&&"TEXTAREA"!==n.nodeName||n.disabled)return!1;const d=n.labels;if(d)for(let m=0;m<d.length;m++)if(d[m].contains(r))return!0;return!1}}return(e=t).\u0275fac=function(n){return new(n||e)(je(_n),je(Go),je(zH),je(Sn,8),je(jH,8))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),UH=(()=>{var e;class t{constructor(n,r){this._elementRef=n,this._focusMonitor=r,this._focusOrigin=null,this.cdkFocusChange=new Ct}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){const n=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(n,1===n.nodeType&&n.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(r=>{this._focusOrigin=r,this.cdkFocusChange.emit(r)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Tn),oe(lO))},e.\u0275dir=gt({type:e,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"]}),t})();const cO="cdk-high-contrast-black-on-white",dO="cdk-high-contrast-white-on-black",zT="cdk-high-contrast-active";let uO=(()=>{var e;class t{constructor(n,r){this._platform=n,this._document=r,this._breakpointSubscription=ft(AH).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const n=this._document.createElement("div");n.style.backgroundColor="rgb(1,2,3)",n.style.position="absolute",this._document.body.appendChild(n);const r=this._document.defaultView||window,s=r&&r.getComputedStyle?r.getComputedStyle(n):null,d=(s&&s.backgroundColor||"").replace(/ /g,"");switch(n.remove(),d){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const n=this._document.body.classList;n.remove(zT,cO,dO),this._hasCheckedHighContrastMode=!0;const r=this.getHighContrastMode();1===r?n.add(zT,cO):2===r&&n.add(zT,dO)}}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Go),je(Sn))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),$H=(()=>{var e;class t{constructor(n){n._applyBodyHighContrastModeCssClasses()}}return(e=t).\u0275fac=function(n){return new(n||e)(je(uO))},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[bH]}),t})();function qo(e,t,i,n){return ql(i)&&(n=i,i=void 0),n?qo(e,t,i).pipe(Xt(r=>Vr(r)?n(...r):n(r))):new ot(r=>{hO(e,t,function s(d){r.next(arguments.length>1?Array.prototype.slice.call(arguments):d)},r,i)})}function hO(e,t,i,n,r){let s;if(function qH(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(e)){const d=e;e.addEventListener(t,i,r),s=()=>d.removeEventListener(t,i,r)}else if(function GH(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(e)){const d=e;e.on(t,i),s=()=>d.off(t,i)}else if(function HH(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(e)){const d=e;e.addListener(t,i),s=()=>d.removeListener(t,i)}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(let d=0,m=e.length;d<m;d++)hO(e[d],t,i,n,r)}n.add(s)}new class ZH extends Ad{flush(t){this.active=!0,this.scheduled=void 0;const{actions:i}=this;let n,r=-1,s=i.length;t=t||i.shift();do{if(n=t.execute(t.state,t.delay))break}while(++r<s&&(t=i.shift()));if(this.active=!1,n){for(;++r<s&&(t=i.shift());)t.unsubscribe();throw n}}}(class WH extends BT{constructor(t,i){super(t,i),this.scheduler=t,this.work=i}requestAsyncId(t,i,n=0){return null!==n&&n>0?super.requestAsyncId(t,i,n):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame(()=>t.flush(null))))}recycleAsyncId(t,i,n=0){if(null!==n&&n>0||null===n&&this.delay>0)return super.recycleAsyncId(t,i,n);0===t.actions.length&&(cancelAnimationFrame(i),t.scheduled=void 0)}});let XH=1;const KH=Promise.resolve(),xw={};function pO(e){return e in xw&&(delete xw[e],!0)}const fO={setImmediate(e){const t=XH++;return xw[t]=!0,KH.then(()=>pO(t)&&e()),t},clearImmediate(e){pO(e)}};new class JH extends Ad{flush(t){this.active=!0,this.scheduled=void 0;const{actions:i}=this;let n,r=-1,s=i.length;t=t||i.shift();do{if(n=t.execute(t.state,t.delay))break}while(++r<s&&(t=i.shift()));if(this.active=!1,n){for(;++r<s&&(t=i.shift());)t.unsubscribe();throw n}}}(class QH extends BT{constructor(t,i){super(t,i),this.scheduler=t,this.work=i}requestAsyncId(t,i,n=0){return null!==n&&n>0?super.requestAsyncId(t,i,n):(t.actions.push(this),t.scheduled||(t.scheduled=fO.setImmediate(t.flush.bind(t,null))))}recycleAsyncId(t,i,n=0){if(null!==n&&n>0||null===n&&this.delay>0)return super.recycleAsyncId(t,i,n);0===t.actions.length&&(fO.clearImmediate(i),t.scheduled=void 0)}});class nG{constructor(t){this.durationSelector=t}call(t,i){return i.subscribe(new iG(t,this.durationSelector))}}class iG extends Hs{constructor(t,i){super(t),this.durationSelector=i,this.hasValue=!1}_next(t){if(this.value=t,this.hasValue=!0,!this.throttled){let i;try{const{durationSelector:r}=this;i=r(t)}catch(r){return this.destination.error(r)}const n=_s(i,new $s(this));!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}}clearThrottle(){const{value:t,hasValue:i,throttled:n}=this;n&&(this.remove(n),this.throttled=void 0,n.unsubscribe()),i&&(this.value=void 0,this.hasValue=!1,this.destination.next(t))}notifyNext(){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}function mO(e){return!Vr(e)&&e-parseFloat(e)+1>=0}function _O(e=0,t,i){let n=-1;return mO(t)?n=Number(t)<1?1:Number(t):hn(t)&&(i=t),hn(i)||(i=vw),new ot(r=>{const s=mO(e)?e:+e-i.now();return i.schedule(rG,s,{index:0,period:n,subscriber:r})})}function rG(e){const{index:t,period:i,subscriber:n}=e;if(n.next(t),!n.closed){if(-1===i)return n.complete();e.index=t+1,this.schedule(e,i)}}function gO(e,t=vw){return function tG(e){return function(i){return i.lift(new nG(e))}}(()=>_O(e,t))}const oG=new mt("cdk-dir-doc",{providedIn:"root",factory:function sG(){return ft(Sn)}}),aG=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let ww=(()=>{var e;class t{constructor(n){this.value="ltr",this.change=new Ct,n&&(this.value=function lG(e){const t=e?.toLowerCase()||"";return"auto"===t&&typeof navigator<"u"&&navigator?.language?aG.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((n.body?n.body.dir:null)||(n.documentElement?n.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}}return(e=t).\u0275fac=function(n){return new(n||e)(je(oG,8))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),O0=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),dG=(()=>{var e;class t{constructor(n,r,s){this._ngZone=n,this._platform=r,this._scrolled=new vn,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=s}register(n){this.scrollContainers.has(n)||this.scrollContainers.set(n,n.elementScrolled().subscribe(()=>this._scrolled.next(n)))}deregister(n){const r=this.scrollContainers.get(n);r&&(r.unsubscribe(),this.scrollContainers.delete(n))}scrolled(n=20){return this._platform.isBrowser?new ot(r=>{this._globalSubscription||this._addGlobalListener();const s=n>0?this._scrolled.pipe(gO(n)).subscribe(r):this._scrolled.subscribe(r);return this._scrolledCount++,()=>{s.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Vt()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((n,r)=>this.deregister(r)),this._scrolled.complete()}ancestorScrolled(n,r){const s=this.getAncestorScrollContainers(n);return this.scrolled(r).pipe(sr(d=>!d||s.indexOf(d)>-1))}getAncestorScrollContainers(n){const r=[];return this.scrollContainers.forEach((s,d)=>{this._scrollableContainsElement(d,n)&&r.push(d)}),r}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(n,r){let s=Jg(r),d=n.getElementRef().nativeElement;do{if(s==d)return!0}while(s=s.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>qo(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(_n),je(Go),je(Sn,8))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),yO=(()=>{var e;class t{constructor(n,r,s){this._platform=n,this._change=new vn,this._changeListener=d=>{this._change.next(d)},this._document=s,r.runOutsideAngular(()=>{if(n.isBrowser){const d=this._getWindow();d.addEventListener("resize",this._changeListener),d.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const n=this._getWindow();n.removeEventListener("resize",this._changeListener),n.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const n={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),n}getViewportRect(){const n=this.getViewportScrollPosition(),{width:r,height:s}=this.getViewportSize();return{top:n.top,left:n.left,bottom:n.top+s,right:n.left+r,height:s,width:r}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const n=this._document,r=this._getWindow(),s=n.documentElement,d=s.getBoundingClientRect();return{top:-d.top||n.body.scrollTop||r.scrollY||s.scrollTop||0,left:-d.left||n.body.scrollLeft||r.scrollX||s.scrollLeft||0}}change(n=20){return n>0?this._change.pipe(gO(n)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const n=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:n.innerWidth,height:n.innerHeight}:{width:0,height:0}}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Go),je(_n),je(Sn,8))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),VT=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),vO=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[O0,VT,O0,VT]}),t})();class jT{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class bO extends jT{constructor(t,i,n,r,s){super(),this.component=t,this.viewContainerRef=i,this.injector=n,this.componentFactoryResolver=r,this.projectableNodes=s}}class hG extends jT{constructor(t,i,n,r){super(),this.templateRef=t,this.viewContainerRef=i,this.context=n,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,i=this.context){return this.context=i,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class pG extends jT{constructor(t){super(),this.element=t instanceof Tn?t.nativeElement:t}}class xO{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof bO?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof hG?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof pG?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class fG extends xO{constructor(t,i,n,r,s){super(),this.outletElement=t,this._componentFactoryResolver=i,this._appRef=n,this._defaultInjector=r,this.attachDomPortal=d=>{const m=d.element,b=this._document.createComment("dom-portal");m.parentNode.insertBefore(b,m),this.outletElement.appendChild(m),this._attachedPortal=d,super.setDisposeFn(()=>{b.parentNode&&b.parentNode.replaceChild(m,b)})},this._document=s}attachComponentPortal(t){const n=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(n,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector,t.projectableNodes||void 0),this.setDisposeFn(()=>r.destroy())):(r=n.create(t.injector||this._defaultInjector||pr.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let i=t.viewContainerRef,n=i.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return n.rootNodes.forEach(r=>this.outletElement.appendChild(r)),n.detectChanges(),this.setDisposeFn(()=>{let r=i.indexOf(n);-1!==r&&i.remove(r)}),this._attachedPortal=t,n}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let mG=(()=>{var e;class t extends xO{constructor(n,r,s){super(),this._componentFactoryResolver=n,this._viewContainerRef=r,this._isInitialized=!1,this.attached=new Ct,this.attachDomPortal=d=>{const m=d.element,b=this._document.createComment("dom-portal");d.setAttachedHost(this),m.parentNode.insertBefore(b,m),this._getRootNode().appendChild(m),this._attachedPortal=d,super.setDisposeFn(()=>{b.parentNode&&b.parentNode.replaceChild(m,b)})},this._document=s}get portal(){return this._attachedPortal}set portal(n){this.hasAttached()&&!n&&!this._isInitialized||(this.hasAttached()&&super.detach(),n&&super.attach(n),this._attachedPortal=n||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(n){n.setAttachedHost(this);const r=null!=n.viewContainerRef?n.viewContainerRef:this._viewContainerRef,d=(n.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(n.component),m=r.createComponent(d,r.length,n.injector||r.injector,n.projectableNodes||void 0);return r!==this._viewContainerRef&&this._getRootNode().appendChild(m.hostView.rootNodes[0]),super.setDisposeFn(()=>m.destroy()),this._attachedPortal=n,this._attachedRef=m,this.attached.emit(m),m}attachTemplatePortal(n){n.setAttachedHost(this);const r=this._viewContainerRef.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=n,this._attachedRef=r,this.attached.emit(r),r}_getRootNode(){const n=this._viewContainerRef.element.nativeElement;return n.nodeType===n.ELEMENT_NODE?n:n.parentNode}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Bl),oe(ha),oe(Sn))},e.\u0275dir=gt({type:e,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Yt]}),t})(),wO=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})();const CO=oH();class _G{constructor(t,i){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=i}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=io(-this._previousScrollPosition.left),t.style.top=io(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,n=t.style,r=this._document.body.style,s=n.scrollBehavior||"",d=r.scrollBehavior||"";this._isEnabled=!1,n.left=this._previousHTMLStyles.left,n.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),CO&&(n.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),CO&&(n.scrollBehavior=s,r.scrollBehavior=d)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const i=this._document.body,n=this._viewportRuler.getViewportSize();return i.scrollHeight>n.height||i.scrollWidth>n.width}}class gG{constructor(t,i,n,r){this._scrollDispatcher=t,this._ngZone=i,this._viewportRuler=n,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0).pipe(sr(i=>!i||!this._overlayRef.overlayElement.contains(i.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const i=this._viewportRuler.getViewportScrollPosition().top;Math.abs(i-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class DO{enable(){}disable(){}attach(){}}function UT(e,t){return t.some(i=>e.bottom<i.top||e.top>i.bottom||e.right<i.left||e.left>i.right)}function EO(e,t){return t.some(i=>e.top<i.top||e.bottom>i.bottom||e.left<i.left||e.right>i.right)}class yG{constructor(t,i,n,r){this._scrollDispatcher=t,this._viewportRuler=i,this._ngZone=n,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const i=this._overlayRef.overlayElement.getBoundingClientRect(),{width:n,height:r}=this._viewportRuler.getViewportSize();UT(i,[{width:n,height:r,bottom:r,right:n,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let vG=(()=>{var e;class t{constructor(n,r,s,d){this._scrollDispatcher=n,this._viewportRuler=r,this._ngZone=s,this.noop=()=>new DO,this.close=m=>new gG(this._scrollDispatcher,this._ngZone,this._viewportRuler,m),this.block=()=>new _G(this._viewportRuler,this._document),this.reposition=m=>new yG(this._scrollDispatcher,this._viewportRuler,this._ngZone,m),this._document=d}}return(e=t).\u0275fac=function(n){return new(n||e)(je(dG),je(yO),je(_n),je(Sn))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();class bG{constructor(t){if(this.scrollStrategy=new DO,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const i=Object.keys(t);for(const n of i)void 0!==t[n]&&(this[n]=t[n])}}}class xG{constructor(t,i){this.connectionPair=t,this.scrollableViewProperties=i}}let TO=(()=>{var e;class t{constructor(n){this._attachedOverlays=[],this._document=n}ngOnDestroy(){this.detach()}add(n){this.remove(n),this._attachedOverlays.push(n)}remove(n){const r=this._attachedOverlays.indexOf(n);r>-1&&this._attachedOverlays.splice(r,1),0===this._attachedOverlays.length&&this.detach()}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),wG=(()=>{var e;class t extends TO{constructor(n,r){super(n),this._ngZone=r,this._keydownListener=s=>{const d=this._attachedOverlays;for(let m=d.length-1;m>-1;m--)if(d[m]._keydownEvents.observers.length>0){const b=d[m]._keydownEvents;this._ngZone?this._ngZone.run(()=>b.next(s)):b.next(s);break}}}add(n){super.add(n),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn),je(_n,8))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),CG=(()=>{var e;class t extends TO{constructor(n,r,s){super(n),this._platform=r,this._ngZone=s,this._cursorStyleIsSet=!1,this._pointerDownListener=d=>{this._pointerDownEventTarget=vp(d)},this._clickListener=d=>{const m=vp(d),b="click"===d.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:m;this._pointerDownEventTarget=null;const E=this._attachedOverlays.slice();for(let I=E.length-1;I>-1;I--){const O=E[I];if(O._outsidePointerEvents.observers.length<1||!O.hasAttached())continue;if(O.overlayElement.contains(m)||O.overlayElement.contains(b))break;const q=O._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>q.next(d)):q.next(d)}}}add(n){if(super.add(n),!this._isAttached){const r=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(r)):this._addEventListeners(r),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=r.style.cursor,r.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const n=this._document.body;n.removeEventListener("pointerdown",this._pointerDownListener,!0),n.removeEventListener("click",this._clickListener,!0),n.removeEventListener("auxclick",this._clickListener,!0),n.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(n.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(n){n.addEventListener("pointerdown",this._pointerDownListener,!0),n.addEventListener("click",this._clickListener,!0),n.addEventListener("auxclick",this._clickListener,!0),n.addEventListener("contextmenu",this._clickListener,!0)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn),je(Go),je(_n,8))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),SO=(()=>{var e;class t{constructor(n,r){this._platform=r,this._document=n}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const n="cdk-overlay-container";if(this._platform.isBrowser||MT()){const s=this._document.querySelectorAll(`.${n}[platform="server"], .${n}[platform="test"]`);for(let d=0;d<s.length;d++)s[d].remove()}const r=this._document.createElement("div");r.classList.add(n),MT()?r.setAttribute("platform","test"):this._platform.isBrowser||r.setAttribute("platform","server"),this._document.body.appendChild(r),this._containerElement=r}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn),je(Go))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();class DG{constructor(t,i,n,r,s,d,m,b,E,I=!1){this._portalOutlet=t,this._host=i,this._pane=n,this._config=r,this._ngZone=s,this._keyboardDispatcher=d,this._document=m,this._location=b,this._outsideClickDispatcher=E,this._animationsDisabled=I,this._backdropElement=null,this._backdropClick=new vn,this._attachments=new vn,this._detachments=new vn,this._locationChanges=un.EMPTY,this._backdropClickHandler=O=>this._backdropClick.next(O),this._backdropTransitionendHandler=O=>{this._disposeBackdrop(O.target)},this._keydownEvents=new vn,this._outsidePointerEvents=new vn,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const i=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(no(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof i?.onDestroy&&i.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),i}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config={...this._config,...t},this._updateElementSize()}setDirection(t){this._config={...this._config,direction:t},this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=io(this._config.width),t.height=io(this._config.height),t.minWidth=io(this._config.minWidth),t.minHeight=io(this._config.minHeight),t.maxWidth=io(this._config.maxWidth),t.maxHeight=io(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,i,n){const r=yw(i||[]).filter(s=>!!s);r.length&&(n?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(mr(Da(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const MO="cdk-overlay-connected-position-bounding-box",EG=/([A-Za-z%]+)$/;class TG{get positions(){return this._preferredPositions}constructor(t,i,n,r,s){this._viewportRuler=i,this._document=n,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new vn,this._resizeSubscription=un.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}attach(t){this._validatePositions(),t.hostElement.classList.add(MO),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,i=this._overlayRect,n=this._viewportRect,r=this._containerRect,s=[];let d;for(let m of this._preferredPositions){let b=this._getOriginPoint(t,r,m),E=this._getOverlayPoint(b,i,m),I=this._getOverlayFit(E,i,n,m);if(I.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(m,b);this._canFitWithFlexibleDimensions(I,E,n)?s.push({position:m,origin:b,overlayRect:i,boundingBoxRect:this._calculateBoundingBoxRect(b,m)}):(!d||d.overlayFit.visibleArea<I.visibleArea)&&(d={overlayFit:I,overlayPoint:E,originPoint:b,position:m,overlayRect:i})}if(s.length){let m=null,b=-1;for(const E of s){const I=E.boundingBoxRect.width*E.boundingBoxRect.height*(E.position.weight||1);I>b&&(b=I,m=E)}return this._isPushed=!1,void this._applyPosition(m.position,m.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(d.position,d.originPoint);this._applyPosition(d.position,d.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&bm(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(MO),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const i=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,i)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,i,n){let r,s;if("center"==n.originX)r=t.left+t.width/2;else{const d=this._isRtl()?t.right:t.left,m=this._isRtl()?t.left:t.right;r="start"==n.originX?d:m}return i.left<0&&(r-=i.left),s="center"==n.originY?t.top+t.height/2:"top"==n.originY?t.top:t.bottom,i.top<0&&(s-=i.top),{x:r,y:s}}_getOverlayPoint(t,i,n){let r,s;return r="center"==n.overlayX?-i.width/2:"start"===n.overlayX?this._isRtl()?-i.width:0:this._isRtl()?0:-i.width,s="center"==n.overlayY?-i.height/2:"top"==n.overlayY?0:-i.height,{x:t.x+r,y:t.y+s}}_getOverlayFit(t,i,n,r){const s=IO(i);let{x:d,y:m}=t,b=this._getOffset(r,"x"),E=this._getOffset(r,"y");b&&(d+=b),E&&(m+=E);let q=0-m,Y=m+s.height-n.height,pe=this._subtractOverflows(s.width,0-d,d+s.width-n.width),Te=this._subtractOverflows(s.height,q,Y),ke=pe*Te;return{visibleArea:ke,isCompletelyWithinViewport:s.width*s.height===ke,fitsInViewportVertically:Te===s.height,fitsInViewportHorizontally:pe==s.width}}_canFitWithFlexibleDimensions(t,i,n){if(this._hasFlexibleDimensions){const r=n.bottom-i.y,s=n.right-i.x,d=AO(this._overlayRef.getConfig().minHeight),m=AO(this._overlayRef.getConfig().minWidth);return(t.fitsInViewportVertically||null!=d&&d<=r)&&(t.fitsInViewportHorizontally||null!=m&&m<=s)}return!1}_pushOverlayOnScreen(t,i,n){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=IO(i),s=this._viewportRect,d=Math.max(t.x+r.width-s.width,0),m=Math.max(t.y+r.height-s.height,0),b=Math.max(s.top-n.top-t.y,0),E=Math.max(s.left-n.left-t.x,0);let I=0,O=0;return I=r.width<=s.width?E||-d:t.x<this._viewportMargin?s.left-n.left-t.x:0,O=r.height<=s.height?b||-m:t.y<this._viewportMargin?s.top-n.top-t.y:0,this._previousPushAmount={x:I,y:O},{x:t.x+I,y:t.y+O}}_applyPosition(t,i){if(this._setTransformOrigin(t),this._setOverlayElementStyles(i,t),this._setBoundingBoxStyles(i,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const n=this._getScrollVisibility(),r=new xG(t,n);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const i=this._boundingBox.querySelectorAll(this._transformOriginSelector);let n,r=t.overlayY;n="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let s=0;s<i.length;s++)i[s].style.transformOrigin=`${n} ${r}`}_calculateBoundingBoxRect(t,i){const n=this._viewportRect,r=this._isRtl();let s,d,m,I,O,q;if("top"===i.overlayY)d=t.y,s=n.height-d+this._viewportMargin;else if("bottom"===i.overlayY)m=n.height-t.y+2*this._viewportMargin,s=n.height-m+this._viewportMargin;else{const Y=Math.min(n.bottom-t.y+n.top,t.y),pe=this._lastBoundingBoxSize.height;s=2*Y,d=t.y-Y,s>pe&&!this._isInitialRender&&!this._growAfterOpen&&(d=t.y-pe/2)}if("end"===i.overlayX&&!r||"start"===i.overlayX&&r)q=n.width-t.x+this._viewportMargin,I=t.x-this._viewportMargin;else if("start"===i.overlayX&&!r||"end"===i.overlayX&&r)O=t.x,I=n.right-t.x;else{const Y=Math.min(n.right-t.x+n.left,t.x),pe=this._lastBoundingBoxSize.width;I=2*Y,O=t.x-Y,I>pe&&!this._isInitialRender&&!this._growAfterOpen&&(O=t.x-pe/2)}return{top:d,left:O,bottom:m,right:q,width:I,height:s}}_setBoundingBoxStyles(t,i){const n=this._calculateBoundingBoxRect(t,i);!this._isInitialRender&&!this._growAfterOpen&&(n.height=Math.min(n.height,this._lastBoundingBoxSize.height),n.width=Math.min(n.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,d=this._overlayRef.getConfig().maxWidth;r.height=io(n.height),r.top=io(n.top),r.bottom=io(n.bottom),r.width=io(n.width),r.left=io(n.left),r.right=io(n.right),r.alignItems="center"===i.overlayX?"center":"end"===i.overlayX?"flex-end":"flex-start",r.justifyContent="center"===i.overlayY?"center":"bottom"===i.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=io(s)),d&&(r.maxWidth=io(d))}this._lastBoundingBoxSize=n,bm(this._boundingBox.style,r)}_resetBoundingBoxStyles(){bm(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){bm(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,i){const n={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,d=this._overlayRef.getConfig();if(r){const I=this._viewportRuler.getViewportScrollPosition();bm(n,this._getExactOverlayY(i,t,I)),bm(n,this._getExactOverlayX(i,t,I))}else n.position="static";let m="",b=this._getOffset(i,"x"),E=this._getOffset(i,"y");b&&(m+=`translateX(${b}px) `),E&&(m+=`translateY(${E}px)`),n.transform=m.trim(),d.maxHeight&&(r?n.maxHeight=io(d.maxHeight):s&&(n.maxHeight="")),d.maxWidth&&(r?n.maxWidth=io(d.maxWidth):s&&(n.maxWidth="")),bm(this._pane.style,n)}_getExactOverlayY(t,i,n){let r={top:"",bottom:""},s=this._getOverlayPoint(i,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,n)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=io(s.y),r}_getExactOverlayX(t,i,n){let d,r={left:"",right:""},s=this._getOverlayPoint(i,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,n)),d=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===d?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=io(s.x),r}_getScrollVisibility(){const t=this._getOriginRect(),i=this._pane.getBoundingClientRect(),n=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:EO(t,n),isOriginOutsideView:UT(t,n),isOverlayClipped:EO(i,n),isOverlayOutsideView:UT(i,n)}}_subtractOverflows(t,...i){return i.reduce((n,r)=>n-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,i=this._document.documentElement.clientHeight,n=this._viewportRuler.getViewportScrollPosition();return{top:n.top+this._viewportMargin,left:n.left+this._viewportMargin,right:n.left+t-this._viewportMargin,bottom:n.top+i-this._viewportMargin,width:t-2*this._viewportMargin,height:i-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,i){return"x"===i?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&yw(t).forEach(i=>{""!==i&&-1===this._appliedPanelClasses.indexOf(i)&&(this._appliedPanelClasses.push(i),this._pane.classList.add(i))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof Tn)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const i=t.width||0,n=t.height||0;return{top:t.y,bottom:t.y+n,left:t.x,right:t.x+i,height:n,width:i}}}function bm(e,t){for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function AO(e){if("number"!=typeof e&&null!=e){const[t,i]=e.split(EG);return i&&"px"!==i?null:parseFloat(t)}return e||null}function IO(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const RO="cdk-global-overlay-wrapper";class SG{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const i=t.getConfig();this._overlayRef=t,this._width&&!i.width&&t.updateSize({width:this._width}),this._height&&!i.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(RO),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement.style,n=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:d,maxHeight:m}=n,b=!("100%"!==r&&"100vw"!==r||d&&"100%"!==d&&"100vw"!==d),E=!("100%"!==s&&"100vh"!==s||m&&"100%"!==m&&"100vh"!==m),I=this._xPosition,O=this._xOffset,q="rtl"===this._overlayRef.getConfig().direction;let Y="",pe="",Te="";b?Te="flex-start":"center"===I?(Te="center",q?pe=O:Y=O):q?"left"===I||"end"===I?(Te="flex-end",Y=O):("right"===I||"start"===I)&&(Te="flex-start",pe=O):"left"===I||"start"===I?(Te="flex-start",Y=O):("right"===I||"end"===I)&&(Te="flex-end",pe=O),t.position=this._cssPosition,t.marginLeft=b?"0":Y,t.marginTop=E?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=b?"0":pe,i.justifyContent=Te,i.alignItems=E?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement,n=i.style;i.classList.remove(RO),n.justifyContent=n.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let MG=(()=>{var e;class t{constructor(n,r,s,d){this._viewportRuler=n,this._document=r,this._platform=s,this._overlayContainer=d}global(){return new SG}flexibleConnectedTo(n){return new TG(n,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(yO),je(Sn),je(Go),je(SO))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),AG=0,$T=(()=>{var e;class t{constructor(n,r,s,d,m,b,E,I,O,q,Y,pe){this.scrollStrategies=n,this._overlayContainer=r,this._componentFactoryResolver=s,this._positionBuilder=d,this._keyboardDispatcher=m,this._injector=b,this._ngZone=E,this._document=I,this._directionality=O,this._location=q,this._outsideClickDispatcher=Y,this._animationsModuleType=pe}create(n){const r=this._createHostElement(),s=this._createPaneElement(r),d=this._createPortalOutlet(s),m=new bG(n);return m.direction=m.direction||this._directionality.value,new DG(d,r,s,m,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(n){const r=this._document.createElement("div");return r.id="cdk-overlay-"+AG++,r.classList.add("cdk-overlay-pane"),n.appendChild(r),r}_createHostElement(){const n=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(n),n}_createPortalOutlet(n){return this._appRef||(this._appRef=this._injector.get(Rc)),new fG(n,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(vG),je(SO),je(Bl),je(MG),je(wG),je(pr),je(_n),je(Sn),je(ww),je(Kv),je(CG),je(xu,8))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const kG={provide:new mt("cdk-connected-overlay-scroll-strategy"),deps:[$T],useFactory:function RG(e){return()=>e.scrollStrategies.reposition()}};let PG=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({providers:[$T,kG],imports:[O0,wO,vO,vO]}),t})();const FG=new mt("mat-sanity-checks",{providedIn:"root",factory:function OG(){return!0}});let xm=(()=>{var e;class t{constructor(n,r,s){this._sanityChecks=r,this._document=s,this._hasDoneGlobalChecks=!1,n._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(n){return!MT()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[n])}}return(e=t).\u0275fac=function(n){return new(n||e)(je(uO),je(FG,8),je(Sn))},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[O0,O0]}),t})();function NG(e){return class extends e{get disabled(){return this._disabled}set disabled(t){this._disabled=Qg(t)}constructor(...t){super(...t),this._disabled=!1}}}function FO(e,t){return class extends e{get color(){return this._color}set color(i){const n=i||this.defaultColor;n!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),n&&this._elementRef.nativeElement.classList.add(`mat-${n}`),this._color=n)}constructor(...i){super(...i),this.defaultColor=t,this.color=t}}}function LG(e){return class extends e{get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=Qg(t)}constructor(...t){super(...t),this._disableRipple=!1}}}const BG=new mt("MAT_DATE_LOCALE",{providedIn:"root",factory:function zG(){return ft(Vl)}});class Vs{constructor(){this._localeChanges=new vn,this.localeChanges=this._localeChanges}getValidDateOrNull(t){return this.isDateInstance(t)&&this.isValid(t)?t:null}deserialize(t){return null==t||this.isDateInstance(t)&&this.isValid(t)?t:this.invalid()}setLocale(t){this.locale=t,this._localeChanges.next()}compareDate(t,i){return this.getYear(t)-this.getYear(i)||this.getMonth(t)-this.getMonth(i)||this.getDate(t)-this.getDate(i)}sameDate(t,i){if(t&&i){let n=this.isValid(t),r=this.isValid(i);return n&&r?!this.compareDate(t,i):n==r}return t==i}clampDate(t,i,n){return i&&this.compareDate(t,i)<0?i:n&&this.compareDate(t,n)>0?n:t}}const wm=new mt("mat-date-formats"),VG=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function HT(e,t){const i=Array(e);for(let n=0;n<e;n++)i[n]=t(n);return i}let jG=(()=>{var e;class t extends Vs{constructor(n,r){super(),this.useUtcForDisplay=!1,super.setLocale(n)}getYear(n){return n.getFullYear()}getMonth(n){return n.getMonth()}getDate(n){return n.getDate()}getDayOfWeek(n){return n.getDay()}getMonthNames(n){const r=new Intl.DateTimeFormat(this.locale,{month:n,timeZone:"utc"});return HT(12,s=>this._format(r,new Date(2017,s,1)))}getDateNames(){const n=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return HT(31,r=>this._format(n,new Date(2017,0,r+1)))}getDayOfWeekNames(n){const r=new Intl.DateTimeFormat(this.locale,{weekday:n,timeZone:"utc"});return HT(7,s=>this._format(r,new Date(2017,0,s+1)))}getYearName(n){const r=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._format(r,n)}getFirstDayOfWeek(){return 0}getNumDaysInMonth(n){return this.getDate(this._createDateWithOverflow(this.getYear(n),this.getMonth(n)+1,0))}clone(n){return new Date(n.getTime())}createDate(n,r,s){let d=this._createDateWithOverflow(n,r,s);return d.getMonth(),d}today(){return new Date}parse(n,r){return"number"==typeof n?new Date(n):n?new Date(Date.parse(n)):null}format(n,r){if(!this.isValid(n))throw Error("NativeDateAdapter: Cannot format invalid date.");const s=new Intl.DateTimeFormat(this.locale,{...r,timeZone:"utc"});return this._format(s,n)}addCalendarYears(n,r){return this.addCalendarMonths(n,12*r)}addCalendarMonths(n,r){let s=this._createDateWithOverflow(this.getYear(n),this.getMonth(n)+r,this.getDate(n));return this.getMonth(s)!=((this.getMonth(n)+r)%12+12)%12&&(s=this._createDateWithOverflow(this.getYear(s),this.getMonth(s),0)),s}addCalendarDays(n,r){return this._createDateWithOverflow(this.getYear(n),this.getMonth(n),this.getDate(n)+r)}toIso8601(n){return[n.getUTCFullYear(),this._2digit(n.getUTCMonth()+1),this._2digit(n.getUTCDate())].join("-")}deserialize(n){if("string"==typeof n){if(!n)return null;if(VG.test(n)){let r=new Date(n);if(this.isValid(r))return r}}return super.deserialize(n)}isDateInstance(n){return n instanceof Date}isValid(n){return!isNaN(n.getTime())}invalid(){return new Date(NaN)}_createDateWithOverflow(n,r,s){const d=new Date;return d.setFullYear(n,r,s),d.setHours(0,0,0,0),d}_2digit(n){return("00"+n).slice(-2)}_format(n,r){const s=new Date;return s.setUTCFullYear(r.getFullYear(),r.getMonth(),r.getDate()),s.setUTCHours(r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()),n.format(s)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(BG,8),je(Go))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();const UG={parse:{dateInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"}}};let $G=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({providers:[{provide:Vs,useClass:jG}]}),t})(),ty=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({providers:[{provide:wm,useValue:UG}],imports:[$G]}),t})();class HG{constructor(t,i,n,r=!1){this._renderer=t,this.element=i,this.config=n,this._animationForciblyDisabledThroughCss=r,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const NO=gm({passive:!0,capture:!0});class GG{constructor(){this._events=new Map,this._delegateEventHandler=t=>{const i=vp(t);i&&this._events.get(t.type)?.forEach((n,r)=>{(r===i||r.contains(i))&&n.forEach(s=>s.handleEvent(t))})}}addHandler(t,i,n,r){const s=this._events.get(i);if(s){const d=s.get(n);d?d.add(r):s.set(n,new Set([r]))}else this._events.set(i,new Map([[n,new Set([r])]])),t.runOutsideAngular(()=>{document.addEventListener(i,this._delegateEventHandler,NO)})}removeHandler(t,i,n){const r=this._events.get(t);if(!r)return;const s=r.get(i);s&&(s.delete(n),0===s.size&&r.delete(i),0===r.size&&(this._events.delete(t),document.removeEventListener(t,this._delegateEventHandler,NO)))}}const LO={enterDuration:225,exitDuration:150},BO=gm({passive:!0,capture:!0}),zO=["mousedown","touchstart"],VO=["mouseup","mouseleave","touchend","touchcancel"];class N0{constructor(t,i,n,r){this._target=t,this._ngZone=i,this._platform=r,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=Jg(n))}fadeInRipple(t,i,n={}){const r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),s={...LO,...n.animation};n.centered&&(t=r.left+r.width/2,i=r.top+r.height/2);const d=n.radius||function WG(e,t,i){const n=Math.max(Math.abs(e-i.left),Math.abs(e-i.right)),r=Math.max(Math.abs(t-i.top),Math.abs(t-i.bottom));return Math.sqrt(n*n+r*r)}(t,i,r),m=t-r.left,b=i-r.top,E=s.enterDuration,I=document.createElement("div");I.classList.add("mat-ripple-element"),I.style.left=m-d+"px",I.style.top=b-d+"px",I.style.height=2*d+"px",I.style.width=2*d+"px",null!=n.color&&(I.style.backgroundColor=n.color),I.style.transitionDuration=`${E}ms`,this._containerElement.appendChild(I);const O=window.getComputedStyle(I),Y=O.transitionDuration,pe="none"===O.transitionProperty||"0s"===Y||"0s, 0s"===Y||0===r.width&&0===r.height,Te=new HG(this,I,n,pe);I.style.transform="scale3d(1, 1, 1)",Te.state=0,n.persistent||(this._mostRecentTransientRipple=Te);let ke=null;return!pe&&(E||s.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const Ge=()=>this._finishRippleTransition(Te),Oe=()=>this._destroyRipple(Te);I.addEventListener("transitionend",Ge),I.addEventListener("transitioncancel",Oe),ke={onTransitionEnd:Ge,onTransitionCancel:Oe}}),this._activeRipples.set(Te,ke),(pe||!E)&&this._finishRippleTransition(Te),Te}fadeOutRipple(t){if(2===t.state||3===t.state)return;const i=t.element,n={...LO,...t.config.animation};i.style.transitionDuration=`${n.exitDuration}ms`,i.style.opacity="0",t.state=2,(t._animationForciblyDisabledThroughCss||!n.exitDuration)&&this._finishRippleTransition(t)}fadeOutAll(){this._getActiveRipples().forEach(t=>t.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(t=>{t.config.persistent||t.fadeOut()})}setupTriggerEvents(t){const i=Jg(t);!this._platform.isBrowser||!i||i===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=i,zO.forEach(n=>{N0._eventManager.addHandler(this._ngZone,n,i,this)}))}handleEvent(t){"mousedown"===t.type?this._onMousedown(t):"touchstart"===t.type?this._onTouchStart(t):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{VO.forEach(i=>{this._triggerElement.addEventListener(i,this,BO)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(t){0===t.state?this._startFadeOutTransition(t):2===t.state&&this._destroyRipple(t)}_startFadeOutTransition(t){const i=t===this._mostRecentTransientRipple,{persistent:n}=t.config;t.state=1,!n&&(!i||!this._isPointerDown)&&t.fadeOut()}_destroyRipple(t){const i=this._activeRipples.get(t)??null;this._activeRipples.delete(t),this._activeRipples.size||(this._containerRect=null),t===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),t.state=3,null!==i&&(t.element.removeEventListener("transitionend",i.onTransitionEnd),t.element.removeEventListener("transitioncancel",i.onTransitionCancel)),t.element.remove()}_onMousedown(t){const i=oO(t),n=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!i&&!n&&(this._isPointerDown=!0,this.fadeInRipple(t.clientX,t.clientY,this._target.rippleConfig))}_onTouchStart(t){if(!this._target.rippleDisabled&&!sO(t)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const i=t.changedTouches;if(i)for(let n=0;n<i.length;n++)this.fadeInRipple(i[n].clientX,i[n].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(t=>{!t.config.persistent&&(1===t.state||t.config.terminateOnPointerUp&&0===t.state)&&t.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const t=this._triggerElement;t&&(zO.forEach(i=>N0._eventManager.removeHandler(i,t,this)),this._pointerUpEventsRegistered&&VO.forEach(i=>t.removeEventListener(i,this,BO)))}}N0._eventManager=new GG;const jO=new mt("mat-ripple-global-options");let ZG=(()=>{var e;class t{get disabled(){return this._disabled}set disabled(n){n&&this.fadeOutAllNonPersistent(),this._disabled=n,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(n){this._trigger=n,this._setupTriggerEventsIfEnabled()}constructor(n,r,s,d,m){this._elementRef=n,this._animationMode=m,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=d||{},this._rippleRenderer=new N0(this,r,n,s)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(n,r=0,s){return"number"==typeof n?this._rippleRenderer.fadeInRipple(n,r,{...this.rippleConfig,...s}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...n})}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Tn),oe(_n),oe(Go),oe(jO,8),oe(xu,8))},e.\u0275dir=gt({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(n,r){2&n&&kn("mat-ripple-unbounded",r.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]}),t})(),YG=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[xm,xm]}),t})();const UO={capture:!0},$O=["focus","click","mouseenter","touchstart"],GT="mat-ripple-loader-uninitialized",qT="mat-ripple-loader-class-name",HO="mat-ripple-loader-centered",Cw="mat-ripple-loader-disabled";let XG=(()=>{var e;class t{constructor(){this._document=ft(Sn,{optional:!0}),this._animationMode=ft(xu,{optional:!0}),this._globalRippleOptions=ft(jO,{optional:!0}),this._platform=ft(Go),this._ngZone=ft(_n),this._onInteraction=n=>{if(!(n.target instanceof HTMLElement))return;const s=n.target.closest(`[${GT}]`);s&&this.createRipple(s)},this._ngZone.runOutsideAngular(()=>{for(const n of $O)this._document?.addEventListener(n,this._onInteraction,UO)})}ngOnDestroy(){for(const n of $O)this._document?.removeEventListener(n,this._onInteraction,UO)}configureRipple(n,r){n.setAttribute(GT,""),(r.className||!n.hasAttribute(qT))&&n.setAttribute(qT,r.className||""),r.centered&&n.setAttribute(HO,""),r.disabled&&n.setAttribute(Cw,"")}getRipple(n){return n.matRipple?n.matRipple:this.createRipple(n)}setDisabled(n,r){const s=n.matRipple;s?s.disabled=r:r?n.setAttribute(Cw,""):n.removeAttribute(Cw)}createRipple(n){if(!this._document)return;n.querySelector(".mat-ripple")?.remove();const r=this._document.createElement("span");r.classList.add("mat-ripple",n.getAttribute(qT)),n.append(r);const s=new ZG(new Tn(r),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return s._isInitialized=!0,s.trigger=n,s.centered=n.hasAttribute(HO),s.disabled=n.hasAttribute(Cw),this.attachRipple(n,s),s}attachRipple(n,r){n.removeAttribute(GT),n.matRipple=r}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const KG=["mat-button",""],QG=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],JG=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],t7=["mat-icon-button",""],n7=["*"],i7=[{selector:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{selector:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{selector:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{selector:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{selector:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{selector:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{selector:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],r7=FO(NG(LG(class{constructor(e){this._elementRef=e}})));let GO=(()=>{var e;class t extends r7{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(n){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,n)}get disableRipple(){return this._disableRipple}set disableRipple(n){this._disableRipple=Qg(n),this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(n){this._disabled=Qg(n),this._updateRippleDisabled()}constructor(n,r,s,d){super(n),this._platform=r,this._ngZone=s,this._animationMode=d,this._focusMonitor=ft(lO),this._rippleLoader=ft(XG),this._isFab=!1,this._disableRipple=!1,this._disabled=!1,this._rippleLoader?.configureRipple(this._elementRef.nativeElement,{className:"mat-mdc-button-ripple"});const m=n.nativeElement.classList;for(const b of i7)this._hasHostAttributes(b.selector)&&b.mdcClasses.forEach(E=>{m.add(E)})}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(n="program",r){n?this._focusMonitor.focusVia(this._elementRef.nativeElement,n,r):this._elementRef.nativeElement.focus(r)}_hasHostAttributes(...n){return n.some(r=>this._elementRef.nativeElement.hasAttribute(r))}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}}return(e=t).\u0275fac=function(n){Os()},e.\u0275dir=gt({type:e,features:[Yt]}),t})(),s7=(()=>{var e;class t extends GO{constructor(n,r,s,d){super(n,r,s,d)}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Tn),oe(Go),oe(_n),oe(xu,8))},e.\u0275cmp=In({type:e,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:7,hostBindings:function(n,r){2&n&&(Fn("disabled",r.disabled||null),kn("_mat-animation-noopable","NoopAnimations"===r._animationMode)("mat-unthemed",!r.color)("mat-mdc-button-base",!0))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[Yt],attrs:KG,ngContentSelectors:JG,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(n,r){1&n&&(em(QG),Rt(0,"span",0),Su(1),H(2,"span",1),Su(3,1),j(),Su(4,2),Rt(5,"span",2)(6,"span",3)),2&n&&kn("mdc-button__ripple",!r._isFab)("mdc-fab__ripple",r._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(\n      100% + 4px\n    );width:calc(\n      100% + 4px\n    );display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{height:var(--mdc-text-button-container-height, 36px);border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, inherit)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button{height:var(--mdc-filled-button-container-height, 36px);border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color, transparent)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, inherit)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button{height:var(--mdc-protected-button-container-height, 36px);border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px));box-shadow:var(--mdc-protected-button-container-elevation, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color, transparent)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, inherit)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button.mdc-ripple-upgraded--background-focused,.mat-mdc-raised-button:not(.mdc-ripple-upgraded):focus{box-shadow:var(--mdc-protected-button-focus-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled):active{box-shadow:var(--mdc-protected-button-pressed-container-elevation, 0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation, 0px 0px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 0px rgba(0, 0, 0, 0.14), 0px 0px 0px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button{height:var(--mdc-outlined-button-container-height, 36px);border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px));padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, inherit)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width, 1px));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width, 1px))}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0;background-color:var(--mat-mdc-button-persistent-ripple-color)}.mat-mdc-button .mat-ripple-element,.mat-mdc-unelevated-button .mat-ripple-element,.mat-mdc-raised-button .mat-ripple-element,.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-mdc-button-ripple-color)}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button[disabled],.mat-mdc-unelevated-button[disabled],.mat-mdc-raised-button[disabled],.mat-mdc-outlined-button[disabled]{cursor:default;pointer-events:none}.mat-mdc-button .mat-mdc-button-touch-target,.mat-mdc-unelevated-button .mat-mdc-button-touch-target,.mat-mdc-raised-button .mat-mdc-button-touch-target,.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}[dir=rtl] .mat-mdc-button>.mat-icon,.mat-mdc-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}.mat-mdc-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon,.mat-mdc-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem;margin-left:-4px;margin-right:8px}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:-4px}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon,.mat-mdc-raised-button .mdc-button__label+.mat-icon,.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:-4px}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon,.mat-mdc-unelevated-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-raised-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-outlined-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:-4px;margin-right:8px}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px) * -1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px) * -1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0}),t})(),l7=(()=>{var e;class t extends GO{constructor(n,r,s,d){super(n,r,s,d),this._rippleLoader.configureRipple(this._elementRef.nativeElement,{centered:!0})}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Tn),oe(Go),oe(_n),oe(xu,8))},e.\u0275cmp=In({type:e,selectors:[["button","mat-icon-button",""]],hostVars:7,hostBindings:function(n,r){2&n&&(Fn("disabled",r.disabled||null),kn("_mat-animation-noopable","NoopAnimations"===r._animationMode)("mat-unthemed",!r.color)("mat-mdc-button-base",!0))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[Yt],attrs:t7,ngContentSelectors:n7,decls:4,vars:0,consts:[[1,"mat-mdc-button-persistent-ripple","mdc-icon-button__ripple"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(n,r){1&n&&(em(),Rt(0,"span",0),Su(1),Rt(2,"span",1)(3,"span",2))},styles:['.mdc-icon-button{display:inline-block;position:relative;box-sizing:border-box;border:none;outline:none;background-color:rgba(0,0,0,0);fill:currentColor;color:inherit;text-decoration:none;cursor:pointer;user-select:none;z-index:0;overflow:visible}.mdc-icon-button .mdc-icon-button__touch{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%)}@media screen and (forced-colors: active){.mdc-icon-button.mdc-ripple-upgraded--background-focused .mdc-icon-button__focus-ring,.mdc-icon-button:not(.mdc-ripple-upgraded):focus .mdc-icon-button__focus-ring{display:block}}.mdc-icon-button:disabled{cursor:default;pointer-events:none}.mdc-icon-button[hidden]{display:none}.mdc-icon-button--display-flex{align-items:center;display:inline-flex;justify-content:center}.mdc-icon-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%;display:none}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring{border-color:CanvasText}}.mdc-icon-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring::after{border-color:CanvasText}}.mdc-icon-button__icon{display:inline-block}.mdc-icon-button__icon.mdc-icon-button__icon--on{display:none}.mdc-icon-button--on .mdc-icon-button__icon{display:none}.mdc-icon-button--on .mdc-icon-button__icon.mdc-icon-button__icon--on{display:inline-block}.mdc-icon-button__link{height:100%;left:0;outline:none;position:absolute;top:0;width:100%}.mat-mdc-icon-button{height:var(--mdc-icon-button-state-layer-size);width:var(--mdc-icon-button-state-layer-size);color:var(--mdc-icon-button-icon-color);--mdc-icon-button-state-layer-size:48px;--mdc-icon-button-icon-size:24px;--mdc-icon-button-disabled-icon-color:black;--mdc-icon-button-disabled-icon-opacity:0.38}.mat-mdc-icon-button .mdc-button__icon{font-size:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button svg,.mat-mdc-icon-button img{width:var(--mdc-icon-button-icon-size);height:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button:disabled{opacity:var(--mdc-icon-button-disabled-icon-opacity)}.mat-mdc-icon-button:disabled{color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button{padding:12px;font-size:var(--mdc-icon-button-icon-size);border-radius:50%;flex-shrink:0;text-align:center;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-icon-button svg{vertical-align:baseline}.mat-mdc-icon-button[disabled]{cursor:default;pointer-events:none;opacity:1}.mat-mdc-icon-button .mat-mdc-button-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-icon-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0;background-color:var(--mat-mdc-button-persistent-ripple-color)}.mat-mdc-icon-button .mat-ripple-element{background-color:var(--mat-mdc-button-ripple-color)}.mat-mdc-icon-button .mdc-button__label{z-index:1}.mat-mdc-icon-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-icon-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-icon-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%)}.mat-mdc-icon-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple{border-radius:50%}.mat-mdc-icon-button.mat-unthemed:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-primary:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-accent:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-warn:not(.mdc-ripple-upgraded):focus::before{background:rgba(0,0,0,0);opacity:1}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0}),t})(),c7=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[xm,YG,xm]}),t})();class qO{}class d7{}const Ou="*";function WO(e,t=null){return{type:2,steps:e,options:t}}function Lc(e){return{type:6,styles:e,offset:null}}class z0{constructor(t=0,i=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+i}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const i="start"==t?this._onStartFns:this._onDoneFns;i.forEach(n=>n()),i.length=0}}class YO{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let i=0,n=0,r=0;const s=this.players.length;0==s?queueMicrotask(()=>this._onFinish()):this.players.forEach(d=>{d.onDone(()=>{++i==s&&this._onFinish()}),d.onDestroy(()=>{++n==s&&this._onDestroy()}),d.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((d,m)=>Math.max(d,m.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const i=t*this.totalTime;this.players.forEach(n=>{const r=n.totalTime?Math.min(1,i/n.totalTime):1;n.setPosition(r)})}getPosition(){const t=this.players.reduce((i,n)=>null===i||n.totalTime>i.totalTime?n:i,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const i="start"==t?this._onStartFns:this._onDoneFns;i.forEach(n=>n()),i.length=0}}const v7=["mat-calendar-body",""];function b7(e,t){if(1&e&&(H(0,"tr",3)(1,"td",4),ne(2),j()()),2&e){const i=ue();G(1),wg("padding-top",i._cellPadding)("padding-bottom",i._cellPadding),Fn("colspan",i.numCols),G(1),Ft(" ",i.label," ")}}function x7(e,t){if(1&e&&(H(0,"td",4),ne(1),j()),2&e){const i=ue(2);wg("padding-top",i._cellPadding)("padding-bottom",i._cellPadding),Fn("colspan",i._firstRowOffset),G(1),Ft(" ",i._firstRowOffset>=i.labelMinRequiredCells?i.label:""," ")}}function w7(e,t){if(1&e){const i=zt();H(0,"td",8)(1,"button",9),nt("click",function(r){const d=_e(i).$implicit;return Ie(ue(2)._cellClicked(d,r))})("focus",function(r){const d=_e(i).$implicit;return Ie(ue(2)._emitActiveDateChange(d,r))}),H(2,"span",10),ne(3),j(),Rt(4,"span",11),j()()}if(2&e){const i=t.$implicit,n=t.index,r=ue().index,s=ue();wg("width",s._cellWidth)("padding-top",s._cellPadding)("padding-bottom",s._cellPadding),Fn("data-mat-row",r)("data-mat-col",n),G(1),kn("mat-calendar-body-disabled",!i.enabled)("mat-calendar-body-active",s._isActiveCell(r,n))("mat-calendar-body-range-start",s._isRangeStart(i.compareValue))("mat-calendar-body-range-end",s._isRangeEnd(i.compareValue))("mat-calendar-body-in-range",s._isInRange(i.compareValue))("mat-calendar-body-comparison-bridge-start",s._isComparisonBridgeStart(i.compareValue,r,n))("mat-calendar-body-comparison-bridge-end",s._isComparisonBridgeEnd(i.compareValue,r,n))("mat-calendar-body-comparison-start",s._isComparisonStart(i.compareValue))("mat-calendar-body-comparison-end",s._isComparisonEnd(i.compareValue))("mat-calendar-body-in-comparison-range",s._isInComparisonRange(i.compareValue))("mat-calendar-body-preview-start",s._isPreviewStart(i.compareValue))("mat-calendar-body-preview-end",s._isPreviewEnd(i.compareValue))("mat-calendar-body-in-preview",s._isInPreview(i.compareValue)),ee("ngClass",i.cssClasses)("tabindex",s._isActiveCell(r,n)?0:-1),Fn("aria-label",i.ariaLabel)("aria-disabled",!i.enabled||null)("aria-pressed",s._isSelected(i.compareValue))("aria-current",s.todayValue===i.compareValue?"date":null)("aria-describedby",s._getDescribedby(i.compareValue)),G(1),kn("mat-calendar-body-selected",s._isSelected(i.compareValue))("mat-calendar-body-comparison-identical",s._isComparisonIdentical(i.compareValue))("mat-calendar-body-today",s.todayValue===i.compareValue),G(1),Ft(" ",i.displayValue," ")}}function C7(e,t){if(1&e&&(H(0,"tr",5),me(1,x7,2,6,"td",6),me(2,w7,5,48,"td",7),j()),2&e){const i=t.$implicit,n=t.index,r=ue();G(1),ee("ngIf",0===n&&r._firstRowOffset),G(1),ee("ngForOf",i)}}function D7(e,t){if(1&e&&(H(0,"th",5)(1,"span",6),ne(2),j(),H(3,"span",7),ne(4),j()()),2&e){const i=t.$implicit;G(2),Cn(i.long),G(2),Cn(i.narrow)}}const E7=["*"];function T7(e,t){}function S7(e,t){if(1&e){const i=zt();H(0,"mat-month-view",5),nt("activeDateChange",function(r){return _e(i),Ie(ue().activeDate=r)})("_userSelection",function(r){return _e(i),Ie(ue()._dateSelected(r))})("dragStarted",function(r){return _e(i),Ie(ue()._dragStarted(r))})("dragEnded",function(r){return _e(i),Ie(ue()._dragEnded(r))}),j()}if(2&e){const i=ue();ee("activeDate",i.activeDate)("selected",i.selected)("dateFilter",i.dateFilter)("maxDate",i.maxDate)("minDate",i.minDate)("dateClass",i.dateClass)("comparisonStart",i.comparisonStart)("comparisonEnd",i.comparisonEnd)("startDateAccessibleName",i.startDateAccessibleName)("endDateAccessibleName",i.endDateAccessibleName)("activeDrag",i._activeDrag)}}function M7(e,t){if(1&e){const i=zt();H(0,"mat-year-view",6),nt("activeDateChange",function(r){return _e(i),Ie(ue().activeDate=r)})("monthSelected",function(r){return _e(i),Ie(ue()._monthSelectedInYearView(r))})("selectedChange",function(r){return _e(i),Ie(ue()._goToDateInView(r,"month"))}),j()}if(2&e){const i=ue();ee("activeDate",i.activeDate)("selected",i.selected)("dateFilter",i.dateFilter)("maxDate",i.maxDate)("minDate",i.minDate)("dateClass",i.dateClass)}}function A7(e,t){if(1&e){const i=zt();H(0,"mat-multi-year-view",7),nt("activeDateChange",function(r){return _e(i),Ie(ue().activeDate=r)})("yearSelected",function(r){return _e(i),Ie(ue()._yearSelectedInMultiYearView(r))})("selectedChange",function(r){return _e(i),Ie(ue()._goToDateInView(r,"year"))}),j()}if(2&e){const i=ue();ee("activeDate",i.activeDate)("selected",i.selected)("dateFilter",i.dateFilter)("maxDate",i.maxDate)("minDate",i.minDate)("dateClass",i.dateClass)}}let XT=(()=>{var e;class t{constructor(){this.changes=new vn,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(n,r){return`${n} \u2013 ${r}`}formatYearRangeLabel(n,r){return`${n} to ${r}`}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();class KT{constructor(t,i,n,r,s={},d=t,m){this.value=t,this.displayValue=i,this.ariaLabel=n,this.enabled=r,this.cssClasses=s,this.compareValue=d,this.rawValue=m}}let I7=1;const XO=gm({passive:!1,capture:!0}),bp=gm({passive:!0,capture:!0}),Dw=gm({passive:!0});let ny=(()=>{var e;class t{ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}constructor(n,r){this._elementRef=n,this._ngZone=r,this._platform=ft(Go),this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new Ct,this.previewChange=new Ct,this.activeDateChange=new Ct,this.dragStarted=new Ct,this.dragEnded=new Ct,this._didDragSinceMouseDown=!1,this._enterHandler=s=>{if(this._skipNextFocus&&"focus"===s.type)this._skipNextFocus=!1;else if(s.target&&this.isRange){const d=this._getCellFromElement(s.target);d&&this._ngZone.run(()=>this.previewChange.emit({value:d.enabled?d:null,event:s}))}},this._touchmoveHandler=s=>{if(!this.isRange)return;const d=KO(s),m=d?this._getCellFromElement(d):null;d!==s.target&&(this._didDragSinceMouseDown=!0),JT(s.target)&&s.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:m?.enabled?m:null,event:s}))},this._leaveHandler=s=>{null!==this.previewEnd&&this.isRange&&("blur"!==s.type&&(this._didDragSinceMouseDown=!0),s.target&&this._getCellFromElement(s.target)&&(!s.relatedTarget||!this._getCellFromElement(s.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:s})))},this._mousedownHandler=s=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;const d=s.target&&this._getCellFromElement(s.target);!d||!this._isInRange(d.rawValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:d.rawValue,event:s})})},this._mouseupHandler=s=>{if(!this.isRange)return;const d=JT(s.target);d?d.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{const m=this._getCellFromElement(d);this.dragEnded.emit({value:m?.rawValue??null,event:s})}):this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:s})})},this._touchendHandler=s=>{const d=KO(s);d&&this._mouseupHandler({target:d})},this._id="mat-calendar-body-"+I7++,this._startDateLabelId=`${this._id}-start-date`,this._endDateLabelId=`${this._id}-end-date`,r.runOutsideAngular(()=>{const s=n.nativeElement;s.addEventListener("touchmove",this._touchmoveHandler,XO),s.addEventListener("mouseenter",this._enterHandler,bp),s.addEventListener("focus",this._enterHandler,bp),s.addEventListener("mouseleave",this._leaveHandler,bp),s.addEventListener("blur",this._leaveHandler,bp),s.addEventListener("mousedown",this._mousedownHandler,Dw),s.addEventListener("touchstart",this._mousedownHandler,Dw),this._platform.isBrowser&&(window.addEventListener("mouseup",this._mouseupHandler),window.addEventListener("touchend",this._touchendHandler))})}_cellClicked(n,r){this._didDragSinceMouseDown||n.enabled&&this.selectedValueChange.emit({value:n.value,event:r})}_emitActiveDateChange(n,r){n.enabled&&this.activeDateChange.emit({value:n.value,event:r})}_isSelected(n){return this.startValue===n||this.endValue===n}ngOnChanges(n){const r=n.numCols,{rows:s,numCols:d}=this;(n.rows||r)&&(this._firstRowOffset=s&&s.length&&s[0].length?d-s[0].length:0),(n.cellAspectRatio||r||!this._cellPadding)&&(this._cellPadding=50*this.cellAspectRatio/d+"%"),(r||!this._cellWidth)&&(this._cellWidth=100/d+"%")}ngOnDestroy(){const n=this._elementRef.nativeElement;n.removeEventListener("touchmove",this._touchmoveHandler,XO),n.removeEventListener("mouseenter",this._enterHandler,bp),n.removeEventListener("focus",this._enterHandler,bp),n.removeEventListener("mouseleave",this._leaveHandler,bp),n.removeEventListener("blur",this._leaveHandler,bp),n.removeEventListener("mousedown",this._mousedownHandler,Dw),n.removeEventListener("touchstart",this._mousedownHandler,Dw),this._platform.isBrowser&&(window.removeEventListener("mouseup",this._mouseupHandler),window.removeEventListener("touchend",this._touchendHandler))}_isActiveCell(n,r){let s=n*this.numCols+r;return n&&(s-=this._firstRowOffset),s==this.activeCell}_focusActiveCell(n=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(no(1)).subscribe(()=>{setTimeout(()=>{const r=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");r&&(n||(this._skipNextFocus=!0),r.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(n){return eS(n,this.startValue,this.endValue)}_isRangeEnd(n){return tS(n,this.startValue,this.endValue)}_isInRange(n){return nS(n,this.startValue,this.endValue,this.isRange)}_isComparisonStart(n){return eS(n,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(n,r,s){if(!this._isComparisonStart(n)||this._isRangeStart(n)||!this._isInRange(n))return!1;let d=this.rows[r][s-1];if(!d){const m=this.rows[r-1];d=m&&m[m.length-1]}return d&&!this._isRangeEnd(d.compareValue)}_isComparisonBridgeEnd(n,r,s){if(!this._isComparisonEnd(n)||this._isRangeEnd(n)||!this._isInRange(n))return!1;let d=this.rows[r][s+1];if(!d){const m=this.rows[r+1];d=m&&m[0]}return d&&!this._isRangeStart(d.compareValue)}_isComparisonEnd(n){return tS(n,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(n){return nS(n,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(n){return this.comparisonStart===this.comparisonEnd&&n===this.comparisonStart}_isPreviewStart(n){return eS(n,this.previewStart,this.previewEnd)}_isPreviewEnd(n){return tS(n,this.previewStart,this.previewEnd)}_isInPreview(n){return nS(n,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(n){return this.isRange?this.startValue===n&&this.endValue===n?`${this._startDateLabelId} ${this._endDateLabelId}`:this.startValue===n?this._startDateLabelId:this.endValue===n?this._endDateLabelId:null:null}_getCellFromElement(n){const r=JT(n);if(r){const s=r.getAttribute("data-mat-row"),d=r.getAttribute("data-mat-col");if(s&&d)return this.rows[parseInt(s)][parseInt(d)]}return null}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Tn),oe(_n))},e.\u0275cmp=In({type:e,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],features:[Ci],attrs:v7,decls:6,vars:6,consts:[["aria-hidden","true",4,"ngIf"],["role","row",4,"ngFor","ngForOf"],[1,"mat-calendar-body-hidden-label",3,"id"],["aria-hidden","true"],[1,"mat-calendar-body-label"],["role","row"],["class","mat-calendar-body-label",3,"paddingTop","paddingBottom",4,"ngIf"],["role","gridcell","class","mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom",4,"ngFor","ngForOf"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"ngClass","tabindex","click","focus"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"]],template:function(n,r){1&n&&(me(0,b7,3,6,"tr",0),me(1,C7,3,2,"tr",1),H(2,"label",2),ne(3),j(),H(4,"label",2),ne(5),j()),2&n&&(ee("ngIf",r._firstRowOffset<r.labelMinRequiredCells),G(1),ee("ngForOf",r.rows),G(1),ee("id",r._startDateLabelId),G(1),Ft(" ",r.startDateAccessibleName,"\n"),G(1),ee("id",r._endDateLabelId),G(1),Ft(" ",r.endDateAccessibleName,"\n"))},dependencies:[K2,to,fr],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color)}.mat-calendar-body-label{height:0;line-height:0;text-align:left;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size);font-weight:var(--mat-datepicker-calendar-body-label-text-weight);color:var(--mat-datepicker-calendar-body-label-text-color)}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color)}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color)}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color);border-color:var(--mat-datepicker-calendar-date-outline-color)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color)}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color)}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color);color:var(--mat-datepicker-calendar-date-selected-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color)}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color)}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color)}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color)}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}[dir=rtl] .mat-calendar-body-label{text-align:right}'],encapsulation:2,changeDetection:0}),t})();function QT(e){return"TD"===e?.nodeName}function JT(e){let t;return QT(e)?t=e:QT(e.parentNode)?t=e.parentNode:QT(e.parentNode?.parentNode)&&(t=e.parentNode.parentNode),null!=t?.getAttribute("data-mat-row")?t:null}function eS(e,t,i){return null!==i&&t!==i&&e<i&&e===t}function tS(e,t,i){return null!==t&&t!==i&&e>=t&&e===i}function nS(e,t,i,n){return n&&null!==t&&null!==i&&t!==i&&e>=t&&e<=i}function KO(e){const t=e.changedTouches[0];return document.elementFromPoint(t.clientX,t.clientY)}class ps{constructor(t,i){this.start=t,this.end=i}}let iy=(()=>{var e;class t{constructor(n,r){this.selection=n,this._adapter=r,this._selectionChanged=new vn,this.selectionChanged=this._selectionChanged,this.selection=n}updateSelection(n,r){const s=this.selection;this.selection=n,this._selectionChanged.next({selection:n,source:r,oldValue:s})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(n){return this._adapter.isDateInstance(n)&&this._adapter.isValid(n)}}return(e=t).\u0275fac=function(n){Os()},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})(),R7=(()=>{var e;class t extends iy{constructor(n){super(null,n)}add(n){super.updateSelection(n,this)}isValid(){return null!=this.selection&&this._isValidDateInstance(this.selection)}isComplete(){return null!=this.selection}clone(){const n=new t(this._adapter);return n.updateSelection(this.selection,this),n}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Vs))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();const O7={provide:iy,deps:[[new Al,new Il,iy],Vs],useFactory:function P7(e,t){return e||new R7(t)}},Ew=new mt("MAT_DATE_RANGE_SELECTION_STRATEGY");let QO=(()=>{var e;class t{constructor(n){this._dateAdapter=n}selectionFinished(n,r){let{start:s,end:d}=r;return null==s?s=n:null==d&&n&&this._dateAdapter.compareDate(n,s)>=0?d=n:(s=n,d=null),new ps(s,d)}createPreview(n,r){let s=null,d=null;return r.start&&!r.end&&n&&(s=r.start,d=n),new ps(s,d)}createDrag(n,r,s){let d=r.start,m=r.end;if(!d||!m)return null;const b=this._dateAdapter,E=0!==b.compareDate(d,m),I=b.getYear(s)-b.getYear(n),O=b.getMonth(s)-b.getMonth(n),q=b.getDate(s)-b.getDate(n);return E&&b.sameDate(n,r.start)?(d=s,b.compareDate(s,m)>0&&(m=b.addCalendarYears(m,I),m=b.addCalendarMonths(m,O),m=b.addCalendarDays(m,q))):E&&b.sameDate(n,r.end)?(m=s,b.compareDate(s,d)<0&&(d=b.addCalendarYears(d,I),d=b.addCalendarMonths(d,O),d=b.addCalendarDays(d,q))):(d=b.addCalendarYears(d,I),d=b.addCalendarMonths(d,O),d=b.addCalendarDays(d,q),m=b.addCalendarYears(m,I),m=b.addCalendarMonths(m,O),m=b.addCalendarDays(m,q)),new ps(d,m)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Vs))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})(),JO=(()=>{var e;class t{get activeDate(){return this._activeDate}set activeDate(n){const r=this._activeDate,s=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(s,this.minDate,this.maxDate),this._hasSameMonthAndYear(r,this._activeDate)||this._init()}get selected(){return this._selected}set selected(n){this._selected=n instanceof ps?n:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}constructor(n,r,s,d,m){this._changeDetectorRef=n,this._dateFormats=r,this._dateAdapter=s,this._dir=d,this._rangeStrategy=m,this._rerenderSubscription=un.EMPTY,this.activeDrag=null,this.selectedChange=new Ct,this._userSelection=new Ct,this.dragStarted=new Ct,this.dragEnded=new Ct,this.activeDateChange=new Ct,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(kg(null)).subscribe(()=>this._init())}ngOnChanges(n){const r=n.comparisonStart||n.comparisonEnd;r&&!r.firstChange&&this._setRanges(this.selected),n.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(n){const r=n.value,s=this._getDateFromDayOfMonth(r);let d,m;this._selected instanceof ps?(d=this._getDateInCurrentMonth(this._selected.start),m=this._getDateInCurrentMonth(this._selected.end)):d=m=this._getDateInCurrentMonth(this._selected),(d!==r||m!==r)&&this.selectedChange.emit(s),this._userSelection.emit({value:s,event:n.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(n){const s=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(n.value),this._dateAdapter.compareDate(s,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(n){const r=this._activeDate,s=this._isRtl();switch(n.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,s?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,s?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=n.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=n.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:return this._selectionKeyPressed=!0,void(this._canSelect(this._activeDate)&&n.preventDefault());case 27:return void(null!=this._previewEnd&&!function NT(e,...t){return t.length?t.some(i=>e[i]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}(n)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:n}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:n})),n.preventDefault(),n.stopPropagation()));default:return}this._dateAdapter.compareDate(r,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),n.preventDefault()}_handleCalendarBodyKeyup(n){(32===n.keyCode||13===n.keyCode)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:n}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let n=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(n)-this._dateAdapter.getFirstDayOfWeek())%7,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(n){this._matCalendarBody._focusActiveCell(n)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:n,value:r}){if(this._rangeStrategy){const s=r?r.rawValue:null,d=this._rangeStrategy.createPreview(s,this.selected,n);if(this._previewStart=this._getCellCompareValue(d.start),this._previewEnd=this._getCellCompareValue(d.end),this.activeDrag&&s){const m=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,s,n);m&&(this._previewStart=this._getCellCompareValue(m.start),this._previewEnd=this._getCellCompareValue(m.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(n){if(this.activeDrag)if(n.value){const r=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,n.value,n.event);this.dragEnded.emit({value:r??null,event:n.event})}else this.dragEnded.emit({value:null,event:n.event})}_getDateFromDayOfMonth(n){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),n)}_initWeekdays(){const n=this._dateAdapter.getFirstDayOfWeek(),r=this._dateAdapter.getDayOfWeekNames("narrow");let d=this._dateAdapter.getDayOfWeekNames("long").map((m,b)=>({long:m,narrow:r[b]}));this._weekdays=d.slice(n).concat(d.slice(0,n))}_createWeekCells(){const n=this._dateAdapter.getNumDaysInMonth(this.activeDate),r=this._dateAdapter.getDateNames();this._weeks=[[]];for(let s=0,d=this._firstWeekOffset;s<n;s++,d++){7==d&&(this._weeks.push([]),d=0);const m=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),s+1),b=this._shouldEnableDate(m),E=this._dateAdapter.format(m,this._dateFormats.display.dateA11yLabel),I=this.dateClass?this.dateClass(m,"month"):void 0;this._weeks[this._weeks.length-1].push(new KT(s+1,r[s],E,b,I,this._getCellCompareValue(m),m))}}_shouldEnableDate(n){return!!n&&(!this.minDate||this._dateAdapter.compareDate(n,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(n,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(n))}_getDateInCurrentMonth(n){return n&&this._hasSameMonthAndYear(n,this.activeDate)?this._dateAdapter.getDate(n):null}_hasSameMonthAndYear(n,r){return!(!n||!r||this._dateAdapter.getMonth(n)!=this._dateAdapter.getMonth(r)||this._dateAdapter.getYear(n)!=this._dateAdapter.getYear(r))}_getCellCompareValue(n){if(n){const r=this._dateAdapter.getYear(n),s=this._dateAdapter.getMonth(n),d=this._dateAdapter.getDate(n);return new Date(r,s,d).getTime()}return null}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setRanges(n){n instanceof ps?(this._rangeStart=this._getCellCompareValue(n.start),this._rangeEnd=this._getCellCompareValue(n.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(n),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(n){return!this.dateFilter||this.dateFilter(n)}_clearPreview(){this._previewStart=this._previewEnd=null}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Io),oe(wm,8),oe(Vs,8),oe(ww,8),oe(Ew,8))},e.\u0275cmp=In({type:e,selectors:[["mat-month-view"]],viewQuery:function(n,r){if(1&n&&Ls(ny,5),2&n){let s;$n(s=Hn())&&(r._matCalendarBody=s.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],features:[Ci],decls:7,vars:15,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["scope","col",4,"ngFor","ngForOf"],["aria-hidden","true","colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName","selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown"],["scope","col"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(n,r){1&n&&(H(0,"table",0)(1,"thead",1)(2,"tr"),me(3,D7,5,2,"th",2),j(),H(4,"tr"),Rt(5,"th",3),j()(),H(6,"tbody",4),nt("selectedValueChange",function(d){return r._dateSelected(d)})("activeDateChange",function(d){return r._updateActiveDate(d)})("previewChange",function(d){return r._previewChanged(d)})("dragStarted",function(d){return r.dragStarted.emit(d)})("dragEnded",function(d){return r._dragEnded(d)})("keyup",function(d){return r._handleCalendarBodyKeyup(d)})("keydown",function(d){return r._handleCalendarBodyKeydown(d)}),j()()),2&n&&(G(3),ee("ngForOf",r._weekdays),G(3),ee("label",r._monthLabel)("rows",r._weeks)("todayValue",r._todayDate)("startValue",r._rangeStart)("endValue",r._rangeEnd)("comparisonStart",r._comparisonRangeStart)("comparisonEnd",r._comparisonRangeEnd)("previewStart",r._previewStart)("previewEnd",r._previewEnd)("isRange",r._isRange)("labelMinRequiredCells",3)("activeCell",r._dateAdapter.getDate(r.activeDate)-1)("startDateAccessibleName",r.startDateAccessibleName)("endDateAccessibleName",r.endDateAccessibleName))},dependencies:[to,ny],encapsulation:2,changeDetection:0}),t})();const qa=24;let eF=(()=>{var e;class t{get activeDate(){return this._activeDate}set activeDate(n){let r=this._activeDate;const s=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(s,this.minDate,this.maxDate),tF(this._dateAdapter,r,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(n){this._selected=n instanceof ps?n:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n)),this._setSelectedYear(n)}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}constructor(n,r,s){this._changeDetectorRef=n,this._dateAdapter=r,this._dir=s,this._rerenderSubscription=un.EMPTY,this.selectedChange=new Ct,this.yearSelected=new Ct,this.activeDateChange=new Ct,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(kg(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());const r=this._dateAdapter.getYear(this._activeDate)-V0(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let s=0,d=[];s<qa;s++)d.push(r+s),4==d.length&&(this._years.push(d.map(m=>this._createCellForYear(m))),d=[]);this._changeDetectorRef.markForCheck()}_yearSelected(n){const r=n.value,s=this._dateAdapter.createDate(r,0,1),d=this._getDateFromYear(r);this.yearSelected.emit(s),this.selectedChange.emit(d)}_updateActiveDate(n){const s=this._activeDate;this.activeDate=this._getDateFromYear(n.value),this._dateAdapter.compareDate(s,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(n){const r=this._activeDate,s=this._isRtl();switch(n.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,s?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,s?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-V0(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,qa-V0(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?10*-qa:-qa);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?10*qa:qa);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(r,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),n.preventDefault()}_handleCalendarBodyKeyup(n){(32===n.keyCode||13===n.keyCode)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:n}),this._selectionKeyPressed=!1)}_getActiveCell(){return V0(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(n){const r=this._dateAdapter.getMonth(this.activeDate),s=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(n,r,1));return this._dateAdapter.createDate(n,r,Math.min(this._dateAdapter.getDate(this.activeDate),s))}_createCellForYear(n){const r=this._dateAdapter.createDate(n,0,1),s=this._dateAdapter.getYearName(r),d=this.dateClass?this.dateClass(r,"multi-year"):void 0;return new KT(n,s,s,this._shouldEnableYear(n),d)}_shouldEnableYear(n){if(null==n||this.maxDate&&n>this._dateAdapter.getYear(this.maxDate)||this.minDate&&n<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;for(let s=this._dateAdapter.createDate(n,0,1);this._dateAdapter.getYear(s)==n;s=this._dateAdapter.addCalendarDays(s,1))if(this.dateFilter(s))return!0;return!1}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setSelectedYear(n){if(this._selectedYear=null,n instanceof ps){const r=n.start||n.end;r&&(this._selectedYear=this._dateAdapter.getYear(r))}else n&&(this._selectedYear=this._dateAdapter.getYear(n))}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Io),oe(Vs,8),oe(ww,8))},e.\u0275cmp=In({type:e,selectors:[["mat-multi-year-view"]],viewQuery:function(n,r){if(1&n&&Ls(ny,5),2&n){let s;$n(s=Hn())&&(r._matCalendarBody=s.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(n,r){1&n&&(H(0,"table",0)(1,"thead",1)(2,"tr"),Rt(3,"th",2),j()(),H(4,"tbody",3),nt("selectedValueChange",function(d){return r._yearSelected(d)})("activeDateChange",function(d){return r._updateActiveDate(d)})("keyup",function(d){return r._handleCalendarBodyKeyup(d)})("keydown",function(d){return r._handleCalendarBodyKeydown(d)}),j()()),2&n&&(G(4),ee("rows",r._years)("todayValue",r._todayYear)("startValue",r._selectedYear)("endValue",r._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",r._getActiveCell()))},dependencies:[ny],encapsulation:2,changeDetection:0}),t})();function tF(e,t,i,n,r){const s=e.getYear(t),d=e.getYear(i),m=nF(e,n,r);return Math.floor((s-m)/qa)===Math.floor((d-m)/qa)}function V0(e,t,i,n){return function L7(e,t){return(e%t+t)%t}(e.getYear(t)-nF(e,i,n),qa)}function nF(e,t,i){let n=0;return i?n=e.getYear(i)-qa+1:t&&(n=e.getYear(t)),n}let iF=(()=>{var e;class t{get activeDate(){return this._activeDate}set activeDate(n){let r=this._activeDate;const s=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(s,this.minDate,this.maxDate),this._dateAdapter.getYear(r)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(n){this._selected=n instanceof ps?n:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n)),this._setSelectedMonth(n)}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}constructor(n,r,s,d){this._changeDetectorRef=n,this._dateFormats=r,this._dateAdapter=s,this._dir=d,this._rerenderSubscription=un.EMPTY,this.selectedChange=new Ct,this.monthSelected=new Ct,this.activeDateChange=new Ct,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(kg(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(n){const r=n.value,s=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,1);this.monthSelected.emit(s);const d=this._getDateFromMonth(r);this.selectedChange.emit(d)}_updateActiveDate(n){const s=this._activeDate;this.activeDate=this._getDateFromMonth(n.value),this._dateAdapter.compareDate(s,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(n){const r=this._activeDate,s=this._isRtl();switch(n.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,s?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,s?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(r,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),n.preventDefault()}_handleCalendarBodyKeyup(n){(32===n.keyCode||13===n.keyCode)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:n}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let n=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(r=>r.map(s=>this._createCellForMonth(s,n[s]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(n){return n&&this._dateAdapter.getYear(n)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(n):null}_getDateFromMonth(n){const r=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),n,1),s=this._dateAdapter.getNumDaysInMonth(r);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),n,Math.min(this._dateAdapter.getDate(this.activeDate),s))}_createCellForMonth(n,r){const s=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),n,1),d=this._dateAdapter.format(s,this._dateFormats.display.monthYearA11yLabel),m=this.dateClass?this.dateClass(s,"year"):void 0;return new KT(n,r.toLocaleUpperCase(),d,this._shouldEnableMonth(n),m)}_shouldEnableMonth(n){const r=this._dateAdapter.getYear(this.activeDate);if(null==n||this._isYearAndMonthAfterMaxDate(r,n)||this._isYearAndMonthBeforeMinDate(r,n))return!1;if(!this.dateFilter)return!0;for(let d=this._dateAdapter.createDate(r,n,1);this._dateAdapter.getMonth(d)==n;d=this._dateAdapter.addCalendarDays(d,1))if(this.dateFilter(d))return!0;return!1}_isYearAndMonthAfterMaxDate(n,r){if(this.maxDate){const s=this._dateAdapter.getYear(this.maxDate),d=this._dateAdapter.getMonth(this.maxDate);return n>s||n===s&&r>d}return!1}_isYearAndMonthBeforeMinDate(n,r){if(this.minDate){const s=this._dateAdapter.getYear(this.minDate),d=this._dateAdapter.getMonth(this.minDate);return n<s||n===s&&r<d}return!1}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setSelectedMonth(n){this._selectedMonth=n instanceof ps?this._getMonthInCurrentYear(n.start)||this._getMonthInCurrentYear(n.end):this._getMonthInCurrentYear(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Io),oe(wm,8),oe(Vs,8),oe(ww,8))},e.\u0275cmp=In({type:e,selectors:[["mat-year-view"]],viewQuery:function(n,r){if(1&n&&Ls(ny,5),2&n){let s;$n(s=Hn())&&(r._matCalendarBody=s.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(n,r){1&n&&(H(0,"table",0)(1,"thead",1)(2,"tr"),Rt(3,"th",2),j()(),H(4,"tbody",3),nt("selectedValueChange",function(d){return r._monthSelected(d)})("activeDateChange",function(d){return r._updateActiveDate(d)})("keyup",function(d){return r._handleCalendarBodyKeyup(d)})("keydown",function(d){return r._handleCalendarBodyKeydown(d)}),j()()),2&n&&(G(4),ee("label",r._yearLabel)("rows",r._months)("todayValue",r._todayMonth)("startValue",r._selectedMonth)("endValue",r._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",r._dateAdapter.getMonth(r.activeDate)))},dependencies:[ny],encapsulation:2,changeDetection:0}),t})(),B7=1,z7=(()=>{var e;class t{constructor(n,r,s,d,m){this._intl=n,this.calendar=r,this._dateAdapter=s,this._dateFormats=d,this._id="mat-calendar-header-"+B7++,this._periodButtonLabelId=`${this._id}-period-label`,this.calendar.stateChanges.subscribe(()=>m.markForCheck())}get periodButtonText(){return"month"==this.calendar.currentView?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():"year"==this.calendar.currentView?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return"month"==this.calendar.currentView?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():"year"==this.calendar.currentView?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return"month"==this.calendar.currentView?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView="month"==this.calendar.currentView?"multi-year":"month"}previousClicked(){this.calendar.activeDate="month"==this.calendar.currentView?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,"year"==this.calendar.currentView?-1:-qa)}nextClicked(){this.calendar.activeDate="month"==this.calendar.currentView?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,"year"==this.calendar.currentView?1:qa)}previousEnabled(){return!this.calendar.minDate||!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate)}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(n,r){return"month"==this.calendar.currentView?this._dateAdapter.getYear(n)==this._dateAdapter.getYear(r)&&this._dateAdapter.getMonth(n)==this._dateAdapter.getMonth(r):"year"==this.calendar.currentView?this._dateAdapter.getYear(n)==this._dateAdapter.getYear(r):tF(this._dateAdapter,n,r,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){const r=this._dateAdapter.getYear(this.calendar.activeDate)-V0(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),s=r+qa-1;return[this._dateAdapter.getYearName(this._dateAdapter.createDate(r,0,1)),this._dateAdapter.getYearName(this._dateAdapter.createDate(s,0,1))]}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(XT),oe(wt(()=>Tw)),oe(Vs,8),oe(wm,8),oe(Io))},e.\u0275cmp=In({type:e,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],ngContentSelectors:E7,decls:13,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"disabled","click"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"disabled","click"],[1,"mat-calendar-hidden-label",3,"id"]],template:function(n,r){1&n&&(em(),H(0,"div",0)(1,"div",1)(2,"button",2),nt("click",function(){return r.currentPeriodClicked()}),H(3,"span",3),ne(4),j(),function ka(){V.lFrame.currentNamespace="svg"}(),H(5,"svg",4),Rt(6,"polygon",5),j()(),function nu(){!function iu(){V.lFrame.currentNamespace=null}()}(),Rt(7,"div",6),Su(8),H(9,"button",7),nt("click",function(){return r.previousClicked()}),j(),H(10,"button",8),nt("click",function(){return r.nextClicked()}),j()()(),H(11,"label",9),ne(12),j()),2&n&&(G(2),Fn("aria-label",r.periodButtonLabel)("aria-describedby",r._periodButtonLabelId),G(2),Cn(r.periodButtonText),G(1),kn("mat-calendar-invert","month"!==r.calendar.currentView),G(4),ee("disabled",!r.previousEnabled()),Fn("aria-label",r.prevButtonLabel),G(1),ee("disabled",!r.nextEnabled()),Fn("aria-label",r.nextButtonLabel),G(1),ee("id",r._periodButtonLabelId),G(1),Cn(r.periodButtonDescription))},dependencies:[s7,l7],encapsulation:2,changeDetection:0}),t})(),Tw=(()=>{var e;class t{get startAt(){return this._startAt}set startAt(n){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get selected(){return this._selected}set selected(n){this._selected=n instanceof ps?n:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get activeDate(){return this._clampedActiveDate}set activeDate(n){this._clampedActiveDate=this._dateAdapter.clampDate(n,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(n){const r=this._currentView!==n?n:null;this._currentView=n,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),r&&this.viewChanged.emit(r)}constructor(n,r,s,d){this._dateAdapter=r,this._dateFormats=s,this._changeDetectorRef=d,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new Ct,this.yearSelected=new Ct,this.monthSelected=new Ct,this.viewChanged=new Ct(!0),this._userSelection=new Ct,this._userDragDrop=new Ct,this._activeDrag=null,this.stateChanges=new vn,this._intlChanges=n.changes.subscribe(()=>{d.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new bO(this.headerComponent||z7),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(n){const r=n.minDate&&!this._dateAdapter.sameDate(n.minDate.previousValue,n.minDate.currentValue)?n.minDate:void 0,s=n.maxDate&&!this._dateAdapter.sameDate(n.maxDate.previousValue,n.maxDate.currentValue)?n.maxDate:void 0,d=r||s||n.dateFilter;if(d&&!d.firstChange){const m=this._getCurrentViewComponent();m&&(this._changeDetectorRef.detectChanges(),m._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(n){const r=n.value;(this.selected instanceof ps||r&&!this._dateAdapter.sameDate(r,this.selected))&&this.selectedChange.emit(r),this._userSelection.emit(n)}_yearSelectedInMultiYearView(n){this.yearSelected.emit(n)}_monthSelectedInYearView(n){this.monthSelected.emit(n)}_goToDateInView(n,r){this.activeDate=n,this.currentView=r}_dragStarted(n){this._activeDrag=n}_dragEnded(n){this._activeDrag&&(n.value&&this._userDragDrop.emit(n),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(XT),oe(Vs,8),oe(wm,8),oe(Io))},e.\u0275cmp=In({type:e,selectors:[["mat-calendar"]],viewQuery:function(n,r){if(1&n&&(Ls(JO,5),Ls(iF,5),Ls(eF,5)),2&n){let s;$n(s=Hn())&&(r.monthView=s.first),$n(s=Hn())&&(r.yearView=s.first),$n(s=Hn())&&(r.multiYearView=s.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],features:[vi([O7]),Ci],decls:5,vars:5,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content",3,"ngSwitch"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag","activeDateChange","_userSelection","dragStarted","dragEnded",4,"ngSwitchCase"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","monthSelected","selectedChange",4,"ngSwitchCase"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","yearSelected","selectedChange",4,"ngSwitchCase"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag","activeDateChange","_userSelection","dragStarted","dragEnded"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","monthSelected","selectedChange"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","yearSelected","selectedChange"]],template:function(n,r){1&n&&(me(0,T7,0,0,"ng-template",0),H(1,"div",1),me(2,S7,1,11,"mat-month-view",2),me(3,M7,1,6,"mat-year-view",3),me(4,A7,1,6,"mat-multi-year-view",4),j()),2&n&&(ee("cdkPortalOutlet",r._calendarHeaderPortal),G(1),ee("ngSwitch",r.currentView),G(1),ee("ngSwitchCase","month"),G(1),ee("ngSwitchCase","year"),G(1),ee("ngSwitchCase","multi-year"))},dependencies:[Rx,tR,UH,mG,JO,iF,eF],styles:['.mat-calendar{display:block;font-family:var(--mat-datepicker-calendar-text-font);font-size:var(--mat-datepicker-calendar-text-size)}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size);font-weight:var(--mat-datepicker-calendar-period-button-text-weight)}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color)}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-datepicker-content .mat-calendar-previous-button,.mat-datepicker-content .mat-calendar-next-button{color:var(--mat-datepicker-calendar-navigation-button-icon-color)}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color);font-size:var(--mat-datepicker-calendar-header-text-size);font-weight:var(--mat-datepicker-calendar-header-text-weight)}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px) * -1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}.mat-calendar-hidden-label{display:none}'],encapsulation:2,changeDetection:0}),t})();const U7={provide:new mt("mat-datepicker-scroll-strategy"),deps:[$T],useFactory:function j7(e){return()=>e.scrollStrategies.reposition()}};let ry=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({providers:[XT,U7],imports:[oR,c7,PG,$H,wO,xm,VT]}),t})();var j0=Bu(574);let sF=(()=>{var e;class t{constructor(n,r){this.document=n,this.platformId=r,this.documentIsAccessible=aR(this.platformId)}static getCookieRegExp(n){const r=n.replace(/([\[\]\{\}\(\)\|\=\;\+\?\,\.\*\^\$])/gi,"\\$1");return new RegExp("(?:^"+r+"|;\\s*"+r+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(n){try{return decodeURIComponent(n)}catch{return n}}check(n){return!!this.documentIsAccessible&&(n=encodeURIComponent(n),t.getCookieRegExp(n).test(this.document.cookie))}get(n){if(this.documentIsAccessible&&this.check(n)){n=encodeURIComponent(n);const s=t.getCookieRegExp(n).exec(this.document.cookie);return s[1]?t.safeDecodeURIComponent(s[1]):""}return""}getAll(){if(!this.documentIsAccessible)return{};const n={},r=this.document;return r.cookie&&""!==r.cookie&&r.cookie.split(";").forEach(s=>{const[d,m]=s.split("=");n[t.safeDecodeURIComponent(d.replace(/^ /,""))]=t.safeDecodeURIComponent(m)}),n}set(n,r,s,d,m,b,E){if(!this.documentIsAccessible)return;if("number"==typeof s||s instanceof Date||d||m||b||E)return void this.set(n,r,{expires:s,path:d,domain:m,secure:b,sameSite:E||"Lax"});let I=encodeURIComponent(n)+"="+encodeURIComponent(r)+";";const O=s||{};O.expires&&(I+="number"==typeof O.expires?"expires="+new Date((new Date).getTime()+1e3*O.expires*60*60*24).toUTCString()+";":"expires="+O.expires.toUTCString()+";"),O.path&&(I+="path="+O.path+";"),O.domain&&(I+="domain="+O.domain+";"),!1===O.secure&&"None"===O.sameSite&&(O.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${n} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),O.secure&&(I+="secure;"),O.sameSite||(O.sameSite="Lax"),I+="sameSite="+O.sameSite+";",this.document.cookie=I}delete(n,r,s,d,m="Lax"){this.documentIsAccessible&&this.set(n,"",{expires:new Date("Thu, 01 Jan 1970 00:00:01 GMT"),path:r,domain:s,secure:d,sameSite:m})}deleteAll(n,r,s,d="Lax"){if(!this.documentIsAccessible)return;const m=this.getAll();for(const b in m)m.hasOwnProperty(b)&&this.delete(b,n,r,s,d)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn),je(Ll))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),Bc=(()=>{var e;class t{constructor(n,r){this.cookieService=n,this.db=r,this.cookieName="user",this.storeCookie=!1;let s=this.cookieService.get(this.cookieName);s&&(this.user=JSON.parse(s),this.fetchProfilePicture())}fetchProfilePicture(){this.isLoggedIn()&&this.db.getProfilePicture(this.getId()).then(n=>{this.profilePic=n.profilePicture})}isLoggedIn(){return typeof this.user<"u"}setUser(n){this.storeCookie&&this.cookieService.set(this.cookieName,JSON.stringify(n),1),this.user=n,this.fetchProfilePicture()}logOut(){this.cookieService.delete(this.cookieName),this.user=void 0,this.profilePic=void 0}getLoginToken(){return this.user?this.user.accessToken:""}getId(){return this.user?this.user.id:-1}getUserName(){return this.user?this.user.userName:""}passwordStrength(n){return[n.split("").reduce((r,s)=>r||isNaN(+s)&&s===s.toUpperCase(),!1),n.split("").reduce((r,s)=>r||!isNaN(+s),!1),n.length>=8].reduce((r,s)=>s?r+1:r,1)}getProfilePicture(){return this.profilePic?this.profilePic:"/assets/userPlaceholder.png"}}return(e=t).\u0275fac=function(n){return new(n||e)(je(sF),je(hs))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),Cm=(()=>{var e;class t{constructor(){}convertFileToJpegBase64(n,r,s,d,m,b=1){if("image"!==n.type.split("/")[0])return s("File has no Image type!");const E=new FileReader;E.readAsDataURL(n),E.onload=I=>{let O=new Image;O.onload=()=>{var q=document.createElement("canvas");q.width=d,q.height=m,q.getContext("2d").drawImage(O,0,0,O.width,O.height,0,0,d,m);var Y=q.toDataURL("image/jpeg",b);r(Y)},O.src=I.target.result},E.onerror=I=>{s("File could not be read: "+I.target.error.code)}}getPlaceholderImage(){return"/assets/placeholderImage.jpg"}getUserPlaceholderImage(){return"/assets/userPlaceholder.png"}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),xp=(()=>{var e;class t{constructor(n){this.db=n,this.fetchProperties()}fetchProperties(){this.db.getProperties().then(n=>{this.properties=n})}}return(e=t).\u0275fac=function(n){return new(n||e)(je(hs))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function aF(...e){if(1===e.length){if(!Vr(e[0]))return e[0];e=e[0]}return gs(e,void 0).lift(new Y7)}class Y7{call(t,i){return i.subscribe(new X7(t))}}class X7 extends PE{constructor(t){super(t),this.hasFirst=!1,this.observables=[],this.subscriptions=[]}_next(t){this.observables.push(t)}_complete(){const t=this.observables,i=t.length;if(0===i)this.destination.complete();else{for(let n=0;n<i&&!this.hasFirst;n++){const s=OE(this,t[n],void 0,n);this.subscriptions&&this.subscriptions.push(s),this.add(s)}this.observables=null}}notifyNext(t,i,n){if(!this.hasFirst){this.hasFirst=!0;for(let r=0;r<this.subscriptions.length;r++)if(r!==n){let s=this.subscriptions[r];s.unsubscribe(),this.remove(s)}this.subscriptions=null}this.destination.next(i)}}function sS(...e){const t=e[e.length-1];return"function"==typeof t&&e.pop(),gs(e,void 0).lift(new K7(t))}class K7{constructor(t){this.resultSelector=t}call(t,i){return i.subscribe(new Q7(t,this.resultSelector))}}class Q7 extends Gn{constructor(t,i,n=Object.create(null)){super(t),this.resultSelector=i,this.iterators=[],this.active=0,this.resultSelector="function"==typeof i?i:void 0}_next(t){const i=this.iterators;Vr(t)?i.push(new e9(t)):i.push("function"==typeof t[Oo]?new J7(t[Oo]()):new t9(this.destination,this,t))}_complete(){const t=this.iterators,i=t.length;if(this.unsubscribe(),0!==i){this.active=i;for(let n=0;n<i;n++){let r=t[n];r.stillUnsubscribed?this.destination.add(r.subscribe()):this.active--}}else this.destination.complete()}notifyInactive(){this.active--,0===this.active&&this.destination.complete()}checkIterators(){const t=this.iterators,i=t.length,n=this.destination;for(let d=0;d<i;d++){let m=t[d];if("function"==typeof m.hasValue&&!m.hasValue())return}let r=!1;const s=[];for(let d=0;d<i;d++){let m=t[d],b=m.next();if(m.hasCompleted()&&(r=!0),b.done)return void n.complete();s.push(b.value)}this.resultSelector?this._tryresultSelector(s):n.next(s),r&&n.complete()}_tryresultSelector(t){let i;try{i=this.resultSelector.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(i)}}class J7{constructor(t){this.iterator=t,this.nextResult=t.next()}hasValue(){return!0}next(){const t=this.nextResult;return this.nextResult=this.iterator.next(),t}hasCompleted(){const t=this.nextResult;return!(!t||!t.done)}}class e9{constructor(t){this.array=t,this.index=0,this.length=0,this.length=t.length}[Oo](){return this}next(t){const i=this.index++;return i<this.length?{value:this.array[i],done:!1}:{value:null,done:!0}}hasValue(){return this.array.length>this.index}hasCompleted(){return this.array.length===this.index}}class t9 extends Hs{constructor(t,i,n){super(t),this.parent=i,this.observable=n,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}[Oo](){return this}next(){const t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}}hasValue(){return this.buffer.length>0}hasCompleted(){return 0===this.buffer.length&&this.isComplete}notifyComplete(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()}notifyNext(t){this.buffer.push(t),this.parent.checkIterators()}subscribe(){return _s(this.observable,new $s(this))}}function aS(...e){return t=>{let i;return"function"==typeof e[e.length-1]&&(i=e.pop()),t.lift(new r9(e,i))}}class r9{constructor(t,i){this.observables=t,this.project=i}call(t,i){return i.subscribe(new o9(t,this.observables,this.project))}}class o9 extends PE{constructor(t,i,n){super(t),this.observables=i,this.project=n,this.toRespond=[];const r=i.length;this.values=new Array(r);for(let s=0;s<r;s++)this.toRespond.push(s);for(let s=0;s<r;s++)this.add(OE(this,i[s],void 0,s))}notifyNext(t,i,n){this.values[n]=i;const r=this.toRespond;if(r.length>0){const s=r.indexOf(n);-1!==s&&r.splice(s,1)}}notifyComplete(){}_next(t){if(0===this.toRespond.length){const i=[t,...this.values];this.project?this._tryProject(i):this.destination.next(i)}}_tryProject(t){let i;try{i=this.project.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(i)}}class zc{constructor(t,i,n){this.kind=t,this.value=i,this.error=n,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,i,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return i&&i(this.error);case"C":return n&&n()}}accept(t,i,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,i,n)}toObservable(){switch(this.kind){case"N":return Vt(this.value);case"E":return sm(this.error);case"C":return Lx()}throw new Error("unexpected notification kind value")}static createNext(t){return typeof t<"u"?new zc("N",t):zc.undefinedValueNotification}static createError(t){return new zc("E",void 0,t)}static createComplete(){return zc.completeNotification}}function lF(e,t=vw){const n=function s9(e){return e instanceof Date&&!isNaN(+e)}(e)?+e-t.now():Math.abs(e);return r=>r.lift(new l9(n,t))}zc.completeNotification=new zc("C"),zc.undefinedValueNotification=new zc("N",void 0);class l9{constructor(t,i){this.delay=t,this.scheduler=i}call(t,i){return i.subscribe(new lS(t,this.delay,this.scheduler))}}class lS extends Gn{constructor(t,i,n){super(t),this.delay=i,this.scheduler=n,this.queue=[],this.active=!1,this.errored=!1}static dispatch(t){const i=t.source,n=i.queue,r=t.scheduler,s=t.destination;for(;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(s);if(n.length>0){const d=Math.max(0,n[0].time-r.now());this.schedule(t,d)}else this.unsubscribe(),i.active=!1}_schedule(t){this.active=!0,this.destination.add(t.schedule(lS.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))}scheduleNotification(t){if(!0===this.errored)return;const i=this.scheduler,n=new c9(i.now()+this.delay,t);this.queue.push(n),!1===this.active&&this._schedule(i)}_next(t){this.scheduleNotification(zc.createNext(t))}_error(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()}_complete(){this.scheduleNotification(zc.createComplete()),this.unsubscribe()}}class c9{constructor(t,i){this.time=t,this.notification=i}}var d9={left:"right",right:"left",bottom:"top",top:"bottom"};function Mw(e){return e.replace(/left|right|bottom|top/g,function(t){return d9[t]})}function Id(e){return e.split("-")[0]}var u9={start:"end",end:"start"};function cF(e){return e.replace(/start|end/g,function(t){return u9[t]})}var Wa="top",Vc="bottom",jc="right",Za="left",cS="auto",U0=[Wa,Vc,jc,Za],oy="start",$0="end",dF="viewport",H0="popper",uF=U0.reduce(function(e,t){return e.concat([t+"-"+oy,t+"-"+$0])},[]),hF=[].concat(U0,[cS]).reduce(function(e,t){return e.concat([t,t+"-"+oy,t+"-"+$0])},[]),C9=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Ya(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Dm(e){return e instanceof Ya(e).Element||e instanceof Element}function Hl(e){return e instanceof Ya(e).HTMLElement||e instanceof HTMLElement}function dS(e){return!(typeof ShadowRoot>"u")&&(e instanceof Ya(e).ShadowRoot||e instanceof ShadowRoot)}function wp(e){return((Dm(e)?e.ownerDocument:e.document)||window.document).documentElement}var Em=Math.max,Aw=Math.min,sy=Math.round;function uS(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function pF(){return!/^((?!chrome|android).)*safari/i.test(uS())}function ay(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1);var n=e.getBoundingClientRect(),r=1,s=1;t&&Hl(e)&&(r=e.offsetWidth>0&&sy(n.width)/e.offsetWidth||1,s=e.offsetHeight>0&&sy(n.height)/e.offsetHeight||1);var m=(Dm(e)?Ya(e):window).visualViewport,b=!pF()&&i,E=(n.left+(b&&m?m.offsetLeft:0))/r,I=(n.top+(b&&m?m.offsetTop:0))/s,O=n.width/r,q=n.height/s;return{width:O,height:q,top:I,right:E+O,bottom:I+q,left:E,x:E,y:I}}function hS(e){var t=Ya(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function pS(e){return ay(wp(e)).left+hS(e).scrollLeft}function Fu(e){return Ya(e).getComputedStyle(e)}function Rd(e){return e?(e.nodeName||"").toLowerCase():null}function Iw(e){return"html"===Rd(e)?e:e.assignedSlot||e.parentNode||(dS(e)?e.host:null)||wp(e)}function fS(e){var t=Fu(e);return/auto|scroll|overlay|hidden/.test(t.overflow+t.overflowY+t.overflowX)}function fF(e){return["html","body","#document"].indexOf(Rd(e))>=0?e.ownerDocument.body:Hl(e)&&fS(e)?e:fF(Iw(e))}function G0(e,t){var i;void 0===t&&(t=[]);var n=fF(e),r=n===(null==(i=e.ownerDocument)?void 0:i.body),s=Ya(n),d=r?[s].concat(s.visualViewport||[],fS(n)?n:[]):n,m=t.concat(d);return r?m:m.concat(G0(Iw(d)))}function T9(e){return["table","td","th"].indexOf(Rd(e))>=0}function mF(e){return Hl(e)&&"fixed"!==Fu(e).position?e.offsetParent:null}function q0(e){for(var t=Ya(e),i=mF(e);i&&T9(i)&&"static"===Fu(i).position;)i=mF(i);return i&&("html"===Rd(i)||"body"===Rd(i)&&"static"===Fu(i).position)?t:i||function S9(e){var t=/firefox/i.test(uS());if(/Trident/i.test(uS())&&Hl(e)&&"fixed"===Fu(e).position)return null;var r=Iw(e);for(dS(r)&&(r=r.host);Hl(r)&&["html","body"].indexOf(Rd(r))<0;){var s=Fu(r);if("none"!==s.transform||"none"!==s.perspective||"paint"===s.contain||-1!==["transform","perspective"].indexOf(s.willChange)||t&&"filter"===s.willChange||t&&s.filter&&"none"!==s.filter)return r;r=r.parentNode}return null}(e)||t}function _F(e,t){var i=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(i&&dS(i)){var n=t;do{if(n&&e.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function mS(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function gF(e,t,i){return t===dF?mS(function D9(e,t){var i=Ya(e),n=wp(e),r=i.visualViewport,s=n.clientWidth,d=n.clientHeight,m=0,b=0;if(r){s=r.width,d=r.height;var E=pF();(E||!E&&"fixed"===t)&&(m=r.offsetLeft,b=r.offsetTop)}return{width:s,height:d,x:m+pS(e),y:b}}(e,i)):Dm(t)?function M9(e,t){var i=ay(e,!1,"fixed"===t);return i.top=i.top+e.clientTop,i.left=i.left+e.clientLeft,i.bottom=i.top+e.clientHeight,i.right=i.left+e.clientWidth,i.width=e.clientWidth,i.height=e.clientHeight,i.x=i.left,i.y=i.top,i}(t,i):mS(function E9(e){var t,i=wp(e),n=hS(e),r=null==(t=e.ownerDocument)?void 0:t.body,s=Em(i.scrollWidth,i.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),d=Em(i.scrollHeight,i.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),m=-n.scrollLeft+pS(e),b=-n.scrollTop;return"rtl"===Fu(r||i).direction&&(m+=Em(i.clientWidth,r?r.clientWidth:0)-s),{width:s,height:d,x:m,y:b}}(wp(e)))}function ly(e){return e.split("-")[1]}function _S(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function yF(e){var b,t=e.reference,i=e.element,n=e.placement,r=n?Id(n):null,s=n?ly(n):null,d=t.x+t.width/2-i.width/2,m=t.y+t.height/2-i.height/2;switch(r){case Wa:b={x:d,y:t.y-i.height};break;case Vc:b={x:d,y:t.y+t.height};break;case jc:b={x:t.x+t.width,y:m};break;case Za:b={x:t.x-i.width,y:m};break;default:b={x:t.x,y:t.y}}var E=r?_S(r):null;if(null!=E){var I="y"===E?"height":"width";switch(s){case oy:b[E]=b[E]-(t[I]/2-i[I]/2);break;case $0:b[E]=b[E]+(t[I]/2-i[I]/2)}}return b}function bF(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function xF(e,t){return t.reduce(function(i,n){return i[n]=e,i},{})}function gS(e,t){void 0===t&&(t={});var n=t.placement,r=void 0===n?e.placement:n,s=t.strategy,d=void 0===s?e.strategy:s,m=t.boundary,b=void 0===m?"clippingParents":m,E=t.rootBoundary,I=void 0===E?dF:E,O=t.elementContext,q=void 0===O?H0:O,Y=t.altBoundary,pe=void 0!==Y&&Y,Te=t.padding,ke=void 0===Te?0:Te,Ge=bF("number"!=typeof ke?ke:xF(ke,U0)),pt=e.rects.popper,rt=e.elements[pe?q===H0?"reference":H0:q],At=function I9(e,t,i,n){var r="clippingParents"===t?function A9(e){var t=G0(Iw(e)),n=["absolute","fixed"].indexOf(Fu(e).position)>=0&&Hl(e)?q0(e):e;return Dm(n)?t.filter(function(r){return Dm(r)&&_F(r,n)&&"body"!==Rd(r)}):[]}(e):[].concat(t),s=[].concat(r,[i]),m=s.reduce(function(b,E){var I=gF(e,E,n);return b.top=Em(I.top,b.top),b.right=Aw(I.right,b.right),b.bottom=Aw(I.bottom,b.bottom),b.left=Em(I.left,b.left),b},gF(e,s[0],n));return m.width=m.right-m.left,m.height=m.bottom-m.top,m.x=m.left,m.y=m.top,m}(Dm(rt)?rt:rt.contextElement||wp(e.elements.popper),b,I,d),Wt=ay(e.elements.reference),en=yF({reference:Wt,element:pt,strategy:"absolute",placement:r}),Mn=mS(Object.assign({},pt,en)),pi=q===H0?Mn:Wt,wi={top:At.top-pi.top+Ge.top,bottom:pi.bottom-At.bottom+Ge.bottom,left:At.left-pi.left+Ge.left,right:pi.right-At.right+Ge.right},Br=e.modifiersData.offset;if(q===H0&&Br){var Zo=Br[r];Object.keys(wi).forEach(function(_r){var Pd=[jc,Vc].indexOf(_r)>=0?1:-1,Od=[Wa,Vc].indexOf(_r)>=0?"y":"x";wi[_r]+=Zo[Od]*Pd})}return wi}const O9={name:"flip",enabled:!0,phase:"main",fn:function P9(e){var t=e.state,i=e.options,n=e.name;if(!t.modifiersData[n]._skip){for(var r=i.mainAxis,s=void 0===r||r,d=i.altAxis,m=void 0===d||d,b=i.fallbackPlacements,E=i.padding,I=i.boundary,O=i.rootBoundary,q=i.altBoundary,Y=i.flipVariations,pe=void 0===Y||Y,Te=i.allowedAutoPlacements,ke=t.options.placement,Ge=Id(ke),pt=b||(Ge!==ke&&pe?function k9(e){if(Id(e)===cS)return[];var t=Mw(e);return[cF(e),t,cF(t)]}(ke):[Mw(ke)]),rt=[ke].concat(pt).reduce(function(Di,Hc){return Di.concat(Id(Hc)===cS?function R9(e,t){void 0===t&&(t={});var r=t.boundary,s=t.rootBoundary,d=t.padding,m=t.flipVariations,b=t.allowedAutoPlacements,E=void 0===b?hF:b,I=ly(t.placement),O=I?m?uF:uF.filter(function(pe){return ly(pe)===I}):U0,q=O.filter(function(pe){return E.indexOf(pe)>=0});0===q.length&&(q=O);var Y=q.reduce(function(pe,Te){return pe[Te]=gS(e,{placement:Te,boundary:r,rootBoundary:s,padding:d})[Id(Te)],pe},{});return Object.keys(Y).sort(function(pe,Te){return Y[pe]-Y[Te]})}(t,{placement:Hc,boundary:I,rootBoundary:O,padding:E,flipVariations:pe,allowedAutoPlacements:Te}):Hc)},[]),At=t.rects.reference,Wt=t.rects.popper,en=new Map,Mn=!0,pi=rt[0],wi=0;wi<rt.length;wi++){var Br=rt[wi],Zo=Id(Br),_r=ly(Br)===oy,Pd=[Wa,Vc].indexOf(Zo)>=0,Od=Pd?"width":"height",kt=gS(t,{placement:Br,boundary:I,rootBoundary:O,altBoundary:q,padding:E}),$t=Pd?_r?jc:Za:_r?Vc:Wa;At[Od]>Wt[Od]&&($t=Mw($t));var on=Mw($t),Bn=[];if(s&&Bn.push(kt[Zo]<=0),m&&Bn.push(kt[$t]<=0,kt[on]<=0),Bn.every(function(Di){return Di})){pi=Br,Mn=!1;break}en.set(Br,Bn)}if(Mn)for(var va=function(Hc){var Nm=rt.find(function(zr){var js=en.get(zr);if(js)return js.slice(0,Hc).every(function(fs){return fs})});if(Nm)return pi=Nm,"break"},yo=pe?3:1;yo>0&&"break"!==va(yo);yo--);t.placement!==pi&&(t.modifiersData[n]._skip=!0,t.placement=pi,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function W0(e,t,i){return Em(e,Aw(t,i))}function yS(e){var t=ay(e),i=e.offsetWidth,n=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-n)<=1&&(n=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:n}}const B9={name:"preventOverflow",enabled:!0,phase:"main",fn:function L9(e){var t=e.state,i=e.options,n=e.name,r=i.mainAxis,s=void 0===r||r,d=i.altAxis,m=void 0!==d&&d,q=i.tether,Y=void 0===q||q,pe=i.tetherOffset,Te=void 0===pe?0:pe,ke=gS(t,{boundary:i.boundary,rootBoundary:i.rootBoundary,padding:i.padding,altBoundary:i.altBoundary}),Ge=Id(t.placement),Oe=ly(t.placement),pt=!Oe,rt=_S(Ge),At=function F9(e){return"x"===e?"y":"x"}(rt),Wt=t.modifiersData.popperOffsets,en=t.rects.reference,Mn=t.rects.popper,pi="function"==typeof Te?Te(Object.assign({},t.rects,{placement:t.placement})):Te,wi="number"==typeof pi?{mainAxis:pi,altAxis:pi}:Object.assign({mainAxis:0,altAxis:0},pi),Br=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,Zo={x:0,y:0};if(Wt){if(s){var _r,Pd="y"===rt?Wa:Za,Od="y"===rt?Vc:jc,kt="y"===rt?"height":"width",$t=Wt[rt],on=$t+ke[Pd],Bn=$t-ke[Od],gr=Y?-Mn[kt]/2:0,va=Oe===oy?en[kt]:Mn[kt],yo=Oe===oy?-Mn[kt]:-en[kt],Qa=t.elements.arrow,Di=Y&&Qa?yS(Qa):{width:0,height:0},Hc=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},Nm=Hc[Pd],zr=Hc[Od],js=W0(0,en[kt],Di[kt]),fs=pt?en[kt]/2-gr-js-Nm-wi.mainAxis:va-js-Nm-wi.mainAxis,my=pt?-en[kt]/2+gr+js+zr+wi.mainAxis:yo+js+zr+wi.mainAxis,Lm=t.elements.arrow&&q0(t.elements.arrow),qte=Lm?"y"===rt?Lm.clientTop||0:Lm.clientLeft||0:0,ML=null!=(_r=Br?.[rt])?_r:0,Zte=$t+my-ML,AL=W0(Y?Aw(on,$t+fs-ML-qte):on,$t,Y?Em(Bn,Zte):Bn);Wt[rt]=AL,Zo[rt]=AL-$t}if(m){var IL,Bm=Wt[At],lC="y"===At?"height":"width",RL=Bm+ke["x"===rt?Wa:Za],kL=Bm-ke["x"===rt?Vc:jc],aM=-1!==[Wa,Za].indexOf(Ge),PL=null!=(IL=Br?.[At])?IL:0,OL=aM?RL:Bm-en[lC]-Mn[lC]-PL+wi.altAxis,FL=aM?Bm+en[lC]+Mn[lC]-PL-wi.altAxis:kL,NL=Y&&aM?function N9(e,t,i){var n=W0(e,t,i);return n>i?i:n}(OL,Bm,FL):W0(Y?OL:RL,Bm,Y?FL:kL);Wt[At]=NL,Zo[At]=NL-Bm}t.modifiersData[n]=Zo}},requiresIfExists:["offset"]},U9={name:"arrow",enabled:!0,phase:"main",fn:function V9(e){var t,i=e.state,n=e.name,r=e.options,s=i.elements.arrow,d=i.modifiersData.popperOffsets,m=Id(i.placement),b=_S(m),I=[Za,jc].indexOf(m)>=0?"height":"width";if(s&&d){var O=function(t,i){return bF("number"!=typeof(t="function"==typeof t?t(Object.assign({},i.rects,{placement:i.placement})):t)?t:xF(t,U0))}(r.padding,i),q=yS(s),Y="y"===b?Wa:Za,pe="y"===b?Vc:jc,Te=i.rects.reference[I]+i.rects.reference[b]-d[b]-i.rects.popper[I],ke=d[b]-i.rects.reference[b],Ge=q0(s),Oe=Ge?"y"===b?Ge.clientHeight||0:Ge.clientWidth||0:0,Wt=Oe/2-q[I]/2+(Te/2-ke/2),en=W0(O[Y],Wt,Oe-q[I]-O[pe]);i.modifiersData[n]=((t={})[b]=en,t.centerOffset=en-Wt,t)}},effect:function j9(e){var t=e.state,n=e.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"==typeof r&&!(r=t.elements.popper.querySelector(r))||_F(t.elements.popper,r)&&(t.elements.arrow=r))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function q9(e,t,i){void 0===i&&(i=!1);var n=Hl(t),r=Hl(t)&&function G9(e){var t=e.getBoundingClientRect(),i=sy(t.width)/e.offsetWidth||1,n=sy(t.height)/e.offsetHeight||1;return 1!==i||1!==n}(t),s=wp(t),d=ay(e,r,i),m={scrollLeft:0,scrollTop:0},b={x:0,y:0};return(n||!n&&!i)&&(("body"!==Rd(t)||fS(s))&&(m=function H9(e){return e!==Ya(e)&&Hl(e)?function $9(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}(e):hS(e)}(t)),Hl(t)?((b=ay(t,!0)).x+=t.clientLeft,b.y+=t.clientTop):s&&(b.x=pS(s))),{x:d.left+m.scrollLeft-b.x,y:d.top+m.scrollTop-b.y,width:d.width,height:d.height}}function W9(e){var t=new Map,i=new Set,n=[];function r(s){i.add(s.name),[].concat(s.requires||[],s.requiresIfExists||[]).forEach(function(m){if(!i.has(m)){var b=t.get(m);b&&r(b)}}),n.push(s)}return e.forEach(function(s){t.set(s.name,s)}),e.forEach(function(s){i.has(s.name)||r(s)}),n}function Y9(e){var t;return function(){return t||(t=new Promise(function(i){Promise.resolve().then(function(){t=void 0,i(e())})})),t}}var wF={placement:"bottom",modifiers:[],strategy:"absolute"};function CF(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some(function(n){return!(n&&"function"==typeof n.getBoundingClientRect)})}function K9(e){void 0===e&&(e={});var i=e.defaultModifiers,n=void 0===i?[]:i,r=e.defaultOptions,s=void 0===r?wF:r;return function(m,b,E){void 0===E&&(E=s);var I={placement:"bottom",orderedModifiers:[],options:Object.assign({},wF,s),modifiersData:{},elements:{reference:m,popper:b},attributes:{},styles:{}},O=[],q=!1,Y={state:I,setOptions:function(Ge){var Oe="function"==typeof Ge?Ge(I.options):Ge;Te(),I.options=Object.assign({},s,I.options,Oe),I.scrollParents={reference:Dm(m)?G0(m):m.contextElement?G0(m.contextElement):[],popper:G0(b)};var pt=function Z9(e){var t=W9(e);return C9.reduce(function(i,n){return i.concat(t.filter(function(r){return r.phase===n}))},[])}(function X9(e){var t=e.reduce(function(i,n){var r=i[n.name];return i[n.name]=r?Object.assign({},r,n,{options:Object.assign({},r.options,n.options),data:Object.assign({},r.data,n.data)}):n,i},{});return Object.keys(t).map(function(i){return t[i]})}([].concat(n,I.options.modifiers)));return I.orderedModifiers=pt.filter(function(rt){return rt.enabled}),function pe(){I.orderedModifiers.forEach(function(ke){var Oe=ke.options,rt=ke.effect;if("function"==typeof rt){var At=rt({state:I,name:ke.name,instance:Y,options:void 0===Oe?{}:Oe});O.push(At||function(){})}})}(),Y.update()},forceUpdate:function(){if(!q){var Ge=I.elements,Oe=Ge.reference,pt=Ge.popper;if(CF(Oe,pt)){I.rects={reference:q9(Oe,q0(pt),"fixed"===I.options.strategy),popper:yS(pt)},I.reset=!1,I.placement=I.options.placement,I.orderedModifiers.forEach(function(wi){return I.modifiersData[wi.name]=Object.assign({},wi.data)});for(var rt=0;rt<I.orderedModifiers.length;rt++)if(!0!==I.reset){var At=I.orderedModifiers[rt],Wt=At.fn,en=At.options;"function"==typeof Wt&&(I=Wt({state:I,options:void 0===en?{}:en,name:At.name,instance:Y})||I)}else I.reset=!1,rt=-1}}},update:Y9(function(){return new Promise(function(ke){Y.forceUpdate(),ke(I)})}),destroy:function(){Te(),q=!0}};if(!CF(m,b))return Y;function Te(){O.forEach(function(ke){return ke()}),O=[]}return Y.setOptions(E).then(function(ke){!q&&E.onFirstUpdate&&E.onFirstUpdate(ke)}),Y}}var Rw={passive:!0};const J9={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function Q9(e){var t=e.state,i=e.instance,n=e.options,r=n.scroll,s=void 0===r||r,d=n.resize,m=void 0===d||d,b=Ya(t.elements.popper),E=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&E.forEach(function(I){I.addEventListener("scroll",i.update,Rw)}),m&&b.addEventListener("resize",i.update,Rw),function(){s&&E.forEach(function(I){I.removeEventListener("scroll",i.update,Rw)}),m&&b.removeEventListener("resize",i.update,Rw)}},data:{}},tq={name:"popperOffsets",enabled:!0,phase:"read",fn:function eq(e){var t=e.state;t.modifiersData[e.name]=yF({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}};var nq={top:"auto",right:"auto",bottom:"auto",left:"auto"};function DF(e){var t,i=e.popper,n=e.popperRect,r=e.placement,s=e.variation,d=e.offsets,m=e.position,b=e.gpuAcceleration,E=e.adaptive,I=e.roundOffsets,O=e.isFixed,q=d.x,Y=void 0===q?0:q,pe=d.y,Te=void 0===pe?0:pe,ke="function"==typeof I?I({x:Y,y:Te}):{x:Y,y:Te};Y=ke.x,Te=ke.y;var Ge=d.hasOwnProperty("x"),Oe=d.hasOwnProperty("y"),pt=Za,rt=Wa,At=window;if(E){var Wt=q0(i),en="clientHeight",Mn="clientWidth";Wt===Ya(i)&&"static"!==Fu(Wt=wp(i)).position&&"absolute"===m&&(en="scrollHeight",Mn="scrollWidth"),(r===Wa||(r===Za||r===jc)&&s===$0)&&(rt=Vc,Te-=(O&&Wt===At&&At.visualViewport?At.visualViewport.height:Wt[en])-n.height,Te*=b?1:-1),r!==Za&&(r!==Wa&&r!==Vc||s!==$0)||(pt=jc,Y-=(O&&Wt===At&&At.visualViewport?At.visualViewport.width:Wt[Mn])-n.width,Y*=b?1:-1)}var _r,Br=Object.assign({position:m},E&&nq),Zo=!0===I?function iq(e,t){var n=e.y,r=t.devicePixelRatio||1;return{x:sy(e.x*r)/r||0,y:sy(n*r)/r||0}}({x:Y,y:Te},Ya(i)):{x:Y,y:Te};return Y=Zo.x,Te=Zo.y,Object.assign({},Br,b?((_r={})[rt]=Oe?"0":"",_r[pt]=Ge?"0":"",_r.transform=(At.devicePixelRatio||1)<=1?"translate("+Y+"px, "+Te+"px)":"translate3d("+Y+"px, "+Te+"px, 0)",_r):((t={})[rt]=Oe?Te+"px":"",t[pt]=Ge?Y+"px":"",t.transform="",t))}const oq={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function rq(e){var t=e.state,i=e.options,n=i.gpuAcceleration,r=void 0===n||n,s=i.adaptive,d=void 0===s||s,m=i.roundOffsets,b=void 0===m||m,E={placement:Id(t.placement),variation:ly(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:r,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,DF(Object.assign({},E,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:d,roundOffsets:b})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,DF(Object.assign({},E,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:b})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}};var lq=[J9,tq,oq,{name:"applyStyles",enabled:!0,phase:"write",fn:function sq(e){var t=e.state;Object.keys(t.elements).forEach(function(i){var n=t.styles[i]||{},r=t.attributes[i]||{},s=t.elements[i];!Hl(s)||!Rd(s)||(Object.assign(s.style,n),Object.keys(r).forEach(function(d){var m=r[d];!1===m?s.removeAttribute(d):s.setAttribute(d,!0===m?"":m)}))})},effect:function aq(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach(function(n){var r=t.elements[n],s=t.attributes[n]||{},m=Object.keys(t.styles.hasOwnProperty(n)?t.styles[n]:i[n]).reduce(function(b,E){return b[E]="",b},{});!Hl(r)||!Rd(r)||(Object.assign(r.style,m),Object.keys(s).forEach(function(b){r.removeAttribute(b)}))})}},requires:["computeStyles"]}],cq=K9({defaultModifiers:lq});const hq={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function uq(e){var t=e.state,n=e.name,r=e.options.offset,s=void 0===r?[0,0]:r,d=hF.reduce(function(I,O){return I[O]=function dq(e,t,i){var n=Id(e),r=[Za,Wa].indexOf(n)>=0?-1:1,s="function"==typeof i?i(Object.assign({},t,{placement:e})):i,d=s[0],m=s[1];return d=d||0,m=(m||0)*r,[Za,jc].indexOf(n)>=0?{x:m,y:d}:{x:d,y:m}}(O,t.rects,s),I},{}),m=d[t.placement],E=m.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=m.x,t.modifiersData.popperOffsets.y+=E),t.modifiersData[n]=d}},EF=["*"],Yq=["dialog"];function EW(e,t){1&e&&ne(0),2&e&&Cn(ue(2).title)}function TW(e,t){}function SW(e,t){if(1&e&&(H(0,"h3",3),me(1,EW,1,1,"ng-template",null,4,us),me(3,TW,0,0,"ng-template",5),j()),2&e){const i=Ho(2),n=ue();G(3),ee("ngTemplateOutlet",n.isTitleTemplate()?n.title:i)("ngTemplateOutletContext",n.context)}}function MW(e,t){1&e&&ne(0),2&e&&Cn(100===t.fill?"\u2605":"\u2606")}function AW(e,t){}function IW(e,t){if(1&e){const i=zt();H(0,"span",2),ne(1),j(),H(2,"span",3),nt("mouseenter",function(){const s=_e(i).index;return Ie(ue().enter(s+1))})("click",function(){const s=_e(i).index;return Ie(ue().handleClick(s+1))}),me(3,AW,0,0,"ng-template",4),j()}if(2&e){const i=t.index,n=ue(),r=Ho(1);G(1),Ft("(",i<n.nextRate?"*":" ",")"),G(1),wg("cursor",n.isInteractive()?"pointer":"default"),G(1),ee("ngTemplateOutlet",n.starTemplate||n.starTemplateFromContent||r)("ngTemplateOutletContext",n.contexts[i])}}function bS(e,t,i=0){return Math.max(Math.min(e,t),i)}function Cp(e){return"string"==typeof e}function Tm(e){return null!=e}function cy(e){return(e||document.body).getBoundingClientRect()}const RF={animation:!0,transitionTimerDelayMs:5},$W=()=>{},{transitionTimerDelayMs:HW}=RF,Z0=new Map,ya=(e,t,i,n)=>{let r=n.context||{};const s=Z0.get(t);if(s)switch(n.runningTransition){case"continue":return lp;case"stop":e.run(()=>s.transition$.complete()),r=Object.assign(s.context,r),Z0.delete(t)}const d=i(t,n.animation,r)||$W;if(!n.animation||"none"===window.getComputedStyle(t).transitionProperty)return e.run(()=>d()),Vt(void 0).pipe(function jW(e){return t=>new ot(i=>t.subscribe({next:d=>e.run(()=>i.next(d)),error:d=>e.run(()=>i.error(d)),complete:()=>e.run(()=>i.complete())}))}(e));const m=new vn,b=new vn,E=m.pipe(function n9(...e){return t=>n0(t,Vt(...e))}(!0));Z0.set(t,{transition$:m,complete:()=>{b.next(),b.complete()},context:r});const I=function UW(e){const{transitionDelay:t,transitionDuration:i}=window.getComputedStyle(e);return 1e3*(parseFloat(t)+parseFloat(i))}(t);return e.runOutsideAngular(()=>{const O=qo(t,"transitionend").pipe(mr(E),sr(({target:Y})=>Y===t));aF(_O(I+HW).pipe(mr(E)),O,b).pipe(mr(E)).subscribe(()=>{Z0.delete(t),e.run(()=>{d(),m.next(),m.complete()})})}),m.asObservable()};let Y0=(()=>{var e;class t{constructor(){this.animation=RF.animation}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),VF=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),jF=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),HF=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),GF=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})();var hi=function(e){return e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Escape=27]="Escape",e[e.Space=32]="Space",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.ArrowLeft=37]="ArrowLeft",e[e.ArrowUp=38]="ArrowUp",e[e.ArrowRight=39]="ArrowRight",e[e.ArrowDown=40]="ArrowDown",e}(hi||{});const Lw=(e,t)=>!!t&&t.some(i=>i.contains(e)),XF=(e,t)=>!t||null!=function VW(e,t){return!t||typeof e.closest>"u"?null:e.closest(t)}(e,t),vZ=typeof navigator<"u"&&!!navigator.userAgent&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/Android/.test(navigator.userAgent));const KF=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(", ");function QF(e){const t=Array.from(e.querySelectorAll(KF)).filter(i=>-1!==i.tabIndex);return[t[0],t[t.length-1]]}let xZ=(()=>{var e;class t{constructor(n){this._element=n.documentElement}isRTL(){return"rtl"===(this._element.getAttribute("dir")||"").toLowerCase()}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const wZ=/\s+/,CZ=/  +/gi,DZ={top:["top"],bottom:["bottom"],start:["left","right"],left:["left"],end:["right","left"],right:["right"],"top-start":["top-start","top-end"],"top-left":["top-start"],"top-end":["top-end","top-start"],"top-right":["top-end"],"bottom-start":["bottom-start","bottom-end"],"bottom-left":["bottom-start"],"bottom-end":["bottom-end","bottom-start"],"bottom-right":["bottom-end"],"start-top":["left-start","right-start"],"left-top":["left-start"],"start-bottom":["left-end","right-end"],"left-bottom":["left-end"],"end-top":["right-start","left-start"],"right-top":["right-start"],"end-bottom":["right-end","left-end"],"right-bottom":["right-end"]},TZ=/^left/,SZ=/^right/,MZ=/^start/,AZ=/^end/;function eN({placement:e,baseClass:t},i){let n=Array.isArray(e)?e:e.split(wZ),s=n.findIndex(E=>"auto"===E);s>=0&&["top","bottom","start","end","top-start","top-end","bottom-start","bottom-end","start-top","start-bottom","end-top","end-bottom"].forEach(function(E){null==n.find(I=>-1!==I.search("^"+E))&&n.splice(s++,1,E)});const d=n.map(E=>function EZ(e,t){const[i,n]=DZ[e];return t&&n||i}(E,i.isRTL()));return{placement:d.shift(),modifiers:[{name:"bootstrapClasses",enabled:!!t,phase:"write",fn({state:E}){const I=new RegExp(t+"(-[a-z]+)*","gi"),O=E.elements.popper,q=E.placement;let Y=O.className;Y=Y.replace(I,""),Y+=` ${function IZ(e,t){let[i,n]=t.split("-");const r=i.replace(TZ,"start").replace(SZ,"end");let s=[r];if(n){let d=n;("left"===i||"right"===i)&&(d=d.replace(MZ,"top").replace(AZ,"bottom")),s.push(`${r}-${d}`)}return e&&(s=s.map(d=>`${e}-${d}`)),s.join(" ")}(t,q)}`,Y=Y.trim().replace(CZ," "),O.className=Y}},O9,B9,U9,{enabled:!0,name:"flip",options:{fallbackPlacements:d}},{enabled:!0,name:"preventOverflow",phase:"main",fn:function(){}}]}}function tN(e){return e}new Date(1882,10,12),new Date(2174,10,25);let cN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),hN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})();class Rm{constructor(t,i,n){this.nodes=t,this.viewRef=i,this.componentRef=n}}class $Z{constructor(t,i,n,r,s,d){this._componentType=t,this._injector=i,this._viewContainerRef=n,this._renderer=r,this._ngZone=s,this._applicationRef=d,this._windowRef=null,this._contentRef=null}open(t,i,n=!1){this._windowRef||(this._contentRef=this._getContentRef(t,i),this._windowRef=this._viewContainerRef.createComponent(this._componentType,{injector:this._injector,projectableNodes:this._contentRef.nodes}));const{nativeElement:r}=this._windowRef.location,s=this._ngZone.onStable.pipe(no(1),er(()=>ya(this._ngZone,r,({classList:d})=>d.add("show"),{animation:n,runningTransition:"continue"})));return{windowRef:this._windowRef,transition$:s}}close(t=!1){return this._windowRef?ya(this._ngZone,this._windowRef.location.nativeElement,({classList:i})=>i.remove("show"),{animation:t,runningTransition:"stop"}).pipe(Nr(()=>{this._windowRef&&(this._viewContainerRef.remove(this._viewContainerRef.indexOf(this._windowRef.hostView)),this._windowRef=null),this._contentRef?.viewRef&&(this._applicationRef.detachView(this._contentRef.viewRef),this._contentRef.viewRef.destroy(),this._contentRef=null)})):Vt(void 0)}_getContentRef(t,i){if(t){if(t instanceof Ui){const n=t.createEmbeddedView(i);return this._applicationRef.attachView(n),new Rm([n.rootNodes],n)}return new Rm([[this._renderer.createText(`${t}`)]])}return new Rm([])}}let HZ=(()=>{var e;class t{constructor(n,r){this._el=n,this._zone=r}ngOnInit(){this._zone.onStable.asObservable().pipe(no(1)).subscribe(()=>{ya(this._zone,this._el.nativeElement,(n,r)=>{r&&cy(n),n.classList.add("show")},{animation:this.animation,runningTransition:"continue"})})}hide(){return ya(this._zone,this._el.nativeElement,({classList:n})=>n.remove("show"),{animation:this.animation,runningTransition:"stop"})}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Tn),oe(_n))},e.\u0275cmp=In({type:e,selectors:[["ngb-modal-backdrop"]],hostAttrs:[2,"z-index","1055"],hostVars:6,hostBindings:function(n,r){2&n&&(Er("modal-backdrop"+(r.backdropClass?" "+r.backdropClass:"")),kn("show",!r.animation)("fade",r.animation))},inputs:{animation:"animation",backdropClass:"backdropClass"},standalone:!0,features:[ua],decls:0,vars:0,template:function(n,r){},encapsulation:2}),t})();class pN{update(t){}close(t){}dismiss(t){}}const GZ=["animation","ariaLabelledBy","ariaDescribedBy","backdrop","centered","fullscreen","keyboard","scrollable","size","windowClass","modalDialogClass"],qZ=["animation","backdropClass"];class WZ{_applyWindowOptions(t,i){GZ.forEach(n=>{Tm(i[n])&&(t[n]=i[n])})}_applyBackdropOptions(t,i){qZ.forEach(n=>{Tm(i[n])&&(t[n]=i[n])})}update(t){this._applyWindowOptions(this._windowCmptRef.instance,t),this._backdropCmptRef&&this._backdropCmptRef.instance&&this._applyBackdropOptions(this._backdropCmptRef.instance,t)}get componentInstance(){if(this._contentRef&&this._contentRef.componentRef)return this._contentRef.componentRef.instance}get closed(){return this._closed.asObservable().pipe(mr(this._hidden))}get dismissed(){return this._dismissed.asObservable().pipe(mr(this._hidden))}get hidden(){return this._hidden.asObservable()}get shown(){return this._windowCmptRef.instance.shown.asObservable()}constructor(t,i,n,r){this._windowCmptRef=t,this._contentRef=i,this._backdropCmptRef=n,this._beforeDismiss=r,this._closed=new vn,this._dismissed=new vn,this._hidden=new vn,t.instance.dismissEvent.subscribe(s=>{this.dismiss(s)}),this.result=new Promise((s,d)=>{this._resolve=s,this._reject=d}),this.result.then(null,()=>{})}close(t){this._windowCmptRef&&(this._closed.next(t),this._resolve(t),this._removeModalElements())}_dismiss(t){this._dismissed.next(t),this._reject(t),this._removeModalElements()}dismiss(t){if(this._windowCmptRef)if(this._beforeDismiss){const i=this._beforeDismiss();!function SF(e){return e&&e.then}(i)?!1!==i&&this._dismiss(t):i.then(n=>{!1!==n&&this._dismiss(t)},()=>{})}else this._dismiss(t)}_removeModalElements(){const t=this._windowCmptRef.instance.hide(),i=this._backdropCmptRef?this._backdropCmptRef.instance.hide():Vt(void 0);t.subscribe(()=>{const{nativeElement:n}=this._windowCmptRef.location;n.parentNode.removeChild(n),this._windowCmptRef.destroy(),this._contentRef&&this._contentRef.viewRef&&this._contentRef.viewRef.destroy(),this._windowCmptRef=null,this._contentRef=null}),i.subscribe(()=>{if(this._backdropCmptRef){const{nativeElement:n}=this._backdropCmptRef.location;n.parentNode.removeChild(n),this._backdropCmptRef.destroy(),this._backdropCmptRef=null}}),sS(t,i).subscribe(()=>{this._hidden.next(),this._hidden.complete()})}}var NS=function(e){return e[e.BACKDROP_CLICK=0]="BACKDROP_CLICK",e[e.ESC=1]="ESC",e}(NS||{});let ZZ=(()=>{var e;class t{constructor(n,r,s){this._document=n,this._elRef=r,this._zone=s,this._closed$=new vn,this._elWithFocus=null,this.backdrop=!0,this.keyboard=!0,this.dismissEvent=new Ct,this.shown=new vn,this.hidden=new vn}get fullscreenClass(){return!0===this.fullscreen?" modal-fullscreen":Cp(this.fullscreen)?` modal-fullscreen-${this.fullscreen}-down`:""}dismiss(n){this.dismissEvent.emit(n)}ngOnInit(){this._elWithFocus=this._document.activeElement,this._zone.onStable.asObservable().pipe(no(1)).subscribe(()=>{this._show()})}ngOnDestroy(){this._disableEventHandling()}hide(){const{nativeElement:n}=this._elRef,r={animation:this.animation,runningTransition:"stop"},m=sS(ya(this._zone,n,()=>n.classList.remove("show"),r),ya(this._zone,this._dialogEl.nativeElement,()=>{},r));return m.subscribe(()=>{this.hidden.next(),this.hidden.complete()}),this._disableEventHandling(),this._restoreFocus(),m}_show(){const n={animation:this.animation,runningTransition:"continue"};sS(ya(this._zone,this._elRef.nativeElement,(d,m)=>{m&&cy(d),d.classList.add("show")},n),ya(this._zone,this._dialogEl.nativeElement,()=>{},n)).subscribe(()=>{this.shown.next(),this.shown.complete()}),this._enableEventHandling(),this._setFocus()}_enableEventHandling(){const{nativeElement:n}=this._elRef;this._zone.runOutsideAngular(()=>{qo(n,"keydown").pipe(mr(this._closed$),sr(s=>s.which===hi.Escape)).subscribe(s=>{this.keyboard?requestAnimationFrame(()=>{s.defaultPrevented||this._zone.run(()=>this.dismiss(NS.ESC))}):"static"===this.backdrop&&this._bumpBackdrop()});let r=!1;qo(this._dialogEl.nativeElement,"mousedown").pipe(mr(this._closed$),Nr(()=>r=!1),Fe(()=>qo(n,"mouseup").pipe(mr(this._closed$),no(1))),sr(({target:s})=>n===s)).subscribe(()=>{r=!0}),qo(n,"click").pipe(mr(this._closed$)).subscribe(({target:s})=>{n===s&&("static"===this.backdrop?this._bumpBackdrop():!0===this.backdrop&&!r&&this._zone.run(()=>this.dismiss(NS.BACKDROP_CLICK))),r=!1})})}_disableEventHandling(){this._closed$.next()}_setFocus(){const{nativeElement:n}=this._elRef;if(!n.contains(document.activeElement)){const r=n.querySelector("[ngbAutofocus]"),s=QF(n)[0];(r||s||n).focus()}}_restoreFocus(){const n=this._document.body,r=this._elWithFocus;let s;s=r&&r.focus&&n.contains(r)?r:n,this._zone.runOutsideAngular(()=>{setTimeout(()=>s.focus()),this._elWithFocus=null})}_bumpBackdrop(){"static"===this.backdrop&&ya(this._zone,this._elRef.nativeElement,({classList:n})=>(n.add("modal-static"),()=>n.remove("modal-static")),{animation:this.animation,runningTransition:"continue"})}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Sn),oe(Tn),oe(_n))},e.\u0275cmp=In({type:e,selectors:[["ngb-modal-window"]],viewQuery:function(n,r){if(1&n&&Ls(Yq,7),2&n){let s;$n(s=Hn())&&(r._dialogEl=s.first)}},hostAttrs:["role","dialog","tabindex","-1"],hostVars:7,hostBindings:function(n,r){2&n&&(Fn("aria-modal",!0)("aria-labelledby",r.ariaLabelledBy)("aria-describedby",r.ariaDescribedBy),Er("modal d-block"+(r.windowClass?" "+r.windowClass:"")),kn("fade",r.animation))},inputs:{animation:"animation",ariaLabelledBy:"ariaLabelledBy",ariaDescribedBy:"ariaDescribedBy",backdrop:"backdrop",centered:"centered",fullscreen:"fullscreen",keyboard:"keyboard",scrollable:"scrollable",size:"size",windowClass:"windowClass",modalDialogClass:"modalDialogClass"},outputs:{dismissEvent:"dismiss"},standalone:!0,features:[ua],ngContentSelectors:EF,decls:4,vars:2,consts:[["role","document"],["dialog",""],[1,"modal-content"]],template:function(n,r){1&n&&(em(),H(0,"div",0,1)(2,"div",2),Su(3),j()()),2&n&&Er("modal-dialog"+(r.size?" modal-"+r.size:"")+(r.centered?" modal-dialog-centered":"")+r.fullscreenClass+(r.scrollable?" modal-dialog-scrollable":"")+(r.modalDialogClass?" "+r.modalDialogClass:""))},styles:["ngb-modal-window .component-host-scrollable{display:flex;flex-direction:column;overflow:hidden}\n"],encapsulation:2}),t})(),YZ=(()=>{var e;class t{constructor(n){this._document=n}hide(){const n=Math.abs(window.innerWidth-this._document.documentElement.clientWidth),r=this._document.body,s=r.style,{overflow:d,paddingRight:m}=s;if(n>0){const b=parseFloat(window.getComputedStyle(r).paddingRight);s.paddingRight=`${b+n}px`}return s.overflow="hidden",()=>{n>0&&(s.paddingRight=m),s.overflow=d}}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),XZ=(()=>{var e;class t{constructor(n,r,s,d,m,b,E){this._applicationRef=n,this._injector=r,this._environmentInjector=s,this._document=d,this._scrollBar=m,this._rendererFactory=b,this._ngZone=E,this._activeWindowCmptHasChanged=new vn,this._ariaHiddenValues=new Map,this._scrollBarRestoreFn=null,this._modalRefs=[],this._windowCmpts=[],this._activeInstances=new Ct,this._activeWindowCmptHasChanged.subscribe(()=>{if(this._windowCmpts.length){const I=this._windowCmpts[this._windowCmpts.length-1];((e,t,i,n=!1)=>{e.runOutsideAngular(()=>{const r=qo(t,"focusin").pipe(mr(i),Xt(s=>s.target));qo(t,"keydown").pipe(mr(i),sr(s=>s.which===hi.Tab),aS(r)).subscribe(([s,d])=>{const[m,b]=QF(t);(d===m||d===t)&&s.shiftKey&&(b.focus(),s.preventDefault()),d===b&&!s.shiftKey&&(m.focus(),s.preventDefault())}),n&&qo(t,"click").pipe(mr(i),aS(r),Xt(s=>s[1])).subscribe(s=>s.focus())})})(this._ngZone,I.location.nativeElement,this._activeWindowCmptHasChanged),this._revertAriaHidden(),this._setAriaHidden(I.location.nativeElement)}})}_restoreScrollBar(){const n=this._scrollBarRestoreFn;n&&(this._scrollBarRestoreFn=null,n())}_hideScrollBar(){this._scrollBarRestoreFn||(this._scrollBarRestoreFn=this._scrollBar.hide())}open(n,r,s){const d=s.container instanceof HTMLElement?s.container:Tm(s.container)?this._document.querySelector(s.container):this._document.body,m=this._rendererFactory.createRenderer(null,null);if(!d)throw new Error(`The specified modal container "${s.container||"body"}" was not found in the DOM.`);this._hideScrollBar();const b=new pN,E=(n=s.injector||n).get(Qr,null)||this._environmentInjector,I=this._getContentRef(n,E,r,b,s);let O=!1!==s.backdrop?this._attachBackdrop(d):void 0,q=this._attachWindowComponent(d,I.nodes),Y=new WZ(q,I,O,s.beforeDismiss);return this._registerModalRef(Y),this._registerWindowCmpt(q),Y.hidden.pipe(no(1)).subscribe(()=>Promise.resolve(!0).then(()=>{this._modalRefs.length||(m.removeClass(this._document.body,"modal-open"),this._restoreScrollBar(),this._revertAriaHidden())})),b.close=pe=>{Y.close(pe)},b.dismiss=pe=>{Y.dismiss(pe)},b.update=pe=>{Y.update(pe)},Y.update(s),1===this._modalRefs.length&&m.addClass(this._document.body,"modal-open"),O&&O.instance&&O.changeDetectorRef.detectChanges(),q.changeDetectorRef.detectChanges(),Y}get activeInstances(){return this._activeInstances}dismissAll(n){this._modalRefs.forEach(r=>r.dismiss(n))}hasOpenModals(){return this._modalRefs.length>0}_attachBackdrop(n){let r=iE(HZ,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector});return this._applicationRef.attachView(r.hostView),n.appendChild(r.location.nativeElement),r}_attachWindowComponent(n,r){let s=iE(ZZ,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector,projectableNodes:r});return this._applicationRef.attachView(s.hostView),n.appendChild(s.location.nativeElement),s}_getContentRef(n,r,s,d,m){return s?s instanceof Ui?this._createFromTemplateRef(s,d):Cp(s)?this._createFromString(s):this._createFromComponent(n,r,s,d,m):new Rm([])}_createFromTemplateRef(n,r){const d=n.createEmbeddedView({$implicit:r,close(m){r.close(m)},dismiss(m){r.dismiss(m)}});return this._applicationRef.attachView(d),new Rm([d.rootNodes],d)}_createFromString(n){const r=this._document.createTextNode(`${n}`);return new Rm([[r]])}_createFromComponent(n,r,s,d,m){const E=iE(s,{environmentInjector:r,elementInjector:pr.create({providers:[{provide:pN,useValue:d}],parent:n})}),I=E.location.nativeElement;return m.scrollable&&I.classList.add("component-host-scrollable"),this._applicationRef.attachView(E.hostView),new Rm([[I]],E.hostView,E)}_setAriaHidden(n){const r=n.parentElement;r&&n!==this._document.body&&(Array.from(r.children).forEach(s=>{s!==n&&"SCRIPT"!==s.nodeName&&(this._ariaHiddenValues.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}),this._setAriaHidden(r))}_revertAriaHidden(){this._ariaHiddenValues.forEach((n,r)=>{n?r.setAttribute("aria-hidden",n):r.removeAttribute("aria-hidden")}),this._ariaHiddenValues.clear()}_registerModalRef(n){const r=()=>{const s=this._modalRefs.indexOf(n);s>-1&&(this._modalRefs.splice(s,1),this._activeInstances.emit(this._modalRefs))};this._modalRefs.push(n),this._activeInstances.emit(this._modalRefs),n.result.then(r,r)}_registerWindowCmpt(n){this._windowCmpts.push(n),this._activeWindowCmptHasChanged.next(),n.onDestroy(()=>{const r=this._windowCmpts.indexOf(n);r>-1&&(this._windowCmpts.splice(r,1),this._activeWindowCmptHasChanged.next())})}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Rc),je(pr),je(Qr),je(Sn),je(YZ),je(Ba),je(_n))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),KZ=(()=>{var e;class t{constructor(n){this._ngbConfig=n,this.backdrop=!0,this.fullscreen=!1,this.keyboard=!0}get animation(){return void 0===this._animation?this._ngbConfig.animation:this._animation}set animation(n){this._animation=n}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Y0))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),QZ=(()=>{var e;class t{constructor(n,r,s){this._injector=n,this._modalStack=r,this._config=s}open(n,r={}){const s={...this._config,animation:this._config.animation,...r};return this._modalStack.open(this._injector,n,s)}get activeInstances(){return this._modalStack.activeInstances}dismissAll(n){this._modalStack.dismissAll(n)}hasOpenModals(){return this._modalStack.hasOpenModals()}}return(e=t).\u0275fac=function(n){return new(n||e)(je(pr),je(XZ),je(KZ))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),fN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({providers:[QZ]}),t})(),gN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),EN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})();class aY{constructor(t,i){this.open=t,this.close=i,i||(this.close=t)}isManual(){return"manual"===this.open||"manual"===this.close}}const lY={hover:["mouseenter","mouseleave"],focus:["focusin","focusout"]},TN=e=>e>0?lF(e):t=>t;let pY=(()=>{var e;class t{constructor(n){this._ngbConfig=n,this.autoClose=!0,this.placement="auto",this.popperOptions=r=>r,this.triggers="click",this.disablePopover=!1,this.openDelay=0,this.closeDelay=0}get animation(){return void 0===this._animation?this._ngbConfig.animation:this._animation}set animation(n){this._animation=n}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Y0))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),fY=0,mY=(()=>{var e;class t{isTitleTemplate(){return this.title instanceof Ui}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=In({type:e,selectors:[["ngb-popover-window"]],hostAttrs:["role","tooltip",2,"position","absolute"],hostVars:5,hostBindings:function(n,r){2&n&&(Fs("id",r.id),Er("popover"+(r.popoverClass?" "+r.popoverClass:"")),kn("fade",r.animation))},inputs:{animation:"animation",title:"title",id:"id",popoverClass:"popoverClass",context:"context"},standalone:!0,features:[ua],ngContentSelectors:EF,decls:4,vars:1,consts:[["data-popper-arrow","",1,"popover-arrow"],["class","popover-header",4,"ngIf"],[1,"popover-body"],[1,"popover-header"],["simpleTitle",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(n,r){1&n&&(em(),Rt(0,"div",0),me(1,SW,4,2,"h3",1),H(2,"div",2),Su(3),j()),2&n&&(G(1),ee("ngIf",r.title))},dependencies:[Dd,fr],encapsulation:2,changeDetection:0}),t})(),_Y=(()=>{var e;class t{_isDisabled(){return!(!this.disablePopover&&(this.ngbPopover||this.popoverTitle))}constructor(n,r,s,d,m,b,E,I,O){this._elementRef=n,this._renderer=r,this._ngZone=b,this._document=E,this._changeDetector=I,this.shown=new Ct,this.hidden=new Ct,this._ngbPopoverWindowId="ngb-popover-"+fY++,this._windowRef=null,this.animation=m.animation,this.autoClose=m.autoClose,this.placement=m.placement,this.popperOptions=m.popperOptions,this.triggers=m.triggers,this.container=m.container,this.disablePopover=m.disablePopover,this.popoverClass=m.popoverClass,this.openDelay=m.openDelay,this.closeDelay=m.closeDelay,this._positioning=function RS(){const e=ft(xZ);let t=null;return{createPopper(i){if(!t){let r=(i.updatePopperOptions||tN)(eN(i,e));t=cq(i.hostElement,i.targetElement,r)}},update(){t&&t.update()},setOptions(i){if(t){let r=(i.updatePopperOptions||tN)(eN(i,e));t.setOptions(r)}},destroy(){t&&(t.destroy(),t=null)}}}(),this._popupService=new $Z(mY,s,d,r,this._ngZone,O)}open(n){if(!this._windowRef&&!this._isDisabled()){const{windowRef:r,transition$:s}=this._popupService.open(this.ngbPopover,n??this.popoverContext,this.animation);this._windowRef=r,this._windowRef.setInput("animation",this.animation),this._windowRef.setInput("title",this.popoverTitle),this._windowRef.setInput("context",n??this.popoverContext),this._windowRef.setInput("popoverClass",this.popoverClass),this._windowRef.setInput("id",this._ngbPopoverWindowId),this._renderer.setAttribute(this._getPositionTargetElement(),"aria-describedby",this._ngbPopoverWindowId),"body"===this.container&&this._document.querySelector(this.container).appendChild(this._windowRef.location.nativeElement),this._windowRef.changeDetectorRef.detectChanges(),this._windowRef.changeDetectorRef.markForCheck(),this._ngZone.runOutsideAngular(()=>{this._positioning.createPopper({hostElement:this._getPositionTargetElement(),targetElement:this._windowRef.location.nativeElement,placement:this.placement,appendToBody:"body"===this.container,baseClass:"bs-popover",updatePopperOptions:d=>this.popperOptions(function kS(e){return t=>(t.modifiers.push(hq,{name:"offset",options:{offset:()=>e}}),t)}([0,8])(d))}),Promise.resolve().then(()=>{this._positioning.update(),this._zoneSubscription=this._ngZone.onStable.subscribe(()=>this._positioning.update())})}),function IS(e,t,i,n,r,s,d,m){i&&e.runOutsideAngular((e=>vZ?()=>setTimeout(()=>e(),100):e)(()=>{const E=qo(t,"keydown").pipe(mr(r),sr(q=>q.which===hi.Escape),Nr(q=>q.preventDefault())),I=qo(t,"mousedown").pipe(Xt(q=>{const Y=q.target;return 2!==q.button&&!Lw(Y,d)&&("inside"===i?Lw(Y,s)&&XF(Y,m):"outside"===i?!Lw(Y,s):XF(Y,m)||!Lw(Y,s))}),mr(r)),O=qo(t,"mouseup").pipe(aS(I),sr(([q,Y])=>Y),lF(0),mr(r));aF([E.pipe(Xt(q=>0)),O.pipe(Xt(q=>1))]).subscribe(q=>e.run(()=>n(q)))}))}(this._ngZone,this._document,this.autoClose,()=>this.close(),this.hidden,[this._windowRef.location.nativeElement]),s.subscribe(()=>this.shown.emit())}}close(n=this.animation){this._windowRef&&(this._renderer.removeAttribute(this._getPositionTargetElement(),"aria-describedby"),this._popupService.close(n).subscribe(()=>{this._windowRef=null,this._positioning.destroy(),this._zoneSubscription?.unsubscribe(),this.hidden.emit(),this._changeDetector.markForCheck()}))}toggle(){this._windowRef?this.close():this.open()}isOpen(){return null!=this._windowRef}ngOnInit(){this._unregisterListenersFn=function hY(e,t,i,n,r,s,d=0,m=0){const b=function cY(e,t=lY){const i=(e||"").trim();if(0===i.length)return[];const n=i.split(/\s+/).map(s=>s.split(":")).map(s=>{let d=t[s[0]]||s;return new aY(d[0],d[1])}),r=n.filter(s=>s.isManual());if(r.length>1)throw"Triggers parse error: only one manual trigger is allowed";if(1===r.length&&n.length>1)throw"Triggers parse error: manual trigger can't be mixed with other triggers";return n}(i);if(1===b.length&&b[0].isManual())return()=>{};const E=function dY(e,t,i,n){return new ot(r=>{const s=[],d=()=>r.next(!0),m=()=>r.next(!1),b=()=>r.next(!n());return i.forEach(E=>{E.open===E.close?s.push(e.listen(t,E.open,b)):s.push(e.listen(t,E.open,d),e.listen(t,E.close,m))}),()=>{s.forEach(E=>E())}})}(e,t,b,n).pipe(function uY(e,t,i){return n=>{let r=null;const s=n.pipe(Xt(b=>({open:b})),sr(b=>{const E=i();return E===b.open||r&&r.open!==E?(r&&r.open!==b.open&&(r=null),!1):(r=b,!0)}),Me());return Da(s.pipe(sr(b=>b.open),TN(e)),s.pipe(sr(b=>!b.open),TN(t))).pipe(sr(b=>b===r&&(r=null,b.open!==i())),Xt(b=>b.open))}}(d,m,n)).subscribe(I=>I?r():s());return()=>E.unsubscribe()}(this._renderer,this._elementRef.nativeElement,this.triggers,this.isOpen.bind(this),this.open.bind(this),this.close.bind(this),+this.openDelay,+this.closeDelay)}ngOnChanges({ngbPopover:n,popoverTitle:r,disablePopover:s,popoverClass:d}){d&&this.isOpen()&&(this._windowRef.instance.popoverClass=d.currentValue),(n||r||s)&&this._isDisabled()&&this.close()}ngOnDestroy(){this.close(!1),this._unregisterListenersFn?.()}_getPositionTargetElement(){return(Cp(this.positionTarget)?this._document.querySelector(this.positionTarget):this.positionTarget)||this._elementRef.nativeElement}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Tn),oe(po),oe(pr),oe(ha),oe(pY),oe(_n),oe(Sn),oe(Io),oe(Rc))},e.\u0275dir=gt({type:e,selectors:[["","ngbPopover",""]],inputs:{animation:"animation",autoClose:"autoClose",ngbPopover:"ngbPopover",popoverTitle:"popoverTitle",placement:"placement",popperOptions:"popperOptions",triggers:"triggers",positionTarget:"positionTarget",container:"container",disablePopover:"disablePopover",popoverClass:"popoverClass",popoverContext:"popoverContext",openDelay:"openDelay",closeDelay:"closeDelay"},outputs:{shown:"shown",hidden:"hidden"},exportAs:["ngbPopover"],standalone:!0,features:[Ci]}),t})(),SN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),MN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),gY=(()=>{var e;class t{constructor(){this.max=10,this.readonly=!1,this.resettable=!1,this.tabindex=0}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),Hw=(()=>{var e;class t{ariaValueText(n,r){return`${n} out of ${r}`}constructor(n,r){this._changeDetectorRef=r,this.contexts=[],this.disabled=!1,this.hover=new Ct,this.leave=new Ct,this.rateChange=new Ct(!0),this.onChange=s=>{},this.onTouched=()=>{},this.max=n.max,this.readonly=n.readonly,this.tabindex=n.tabindex}isInteractive(){return!this.readonly&&!this.disabled}enter(n){this.isInteractive()&&this._updateState(n),this.hover.emit(n)}handleBlur(){this.onTouched()}handleClick(n){this.isInteractive()&&this.update(this.resettable&&this.rate===n?0:n)}handleKeyDown(n){switch(n.which){case hi.ArrowDown:case hi.ArrowLeft:this.update(this.rate-1);break;case hi.ArrowUp:case hi.ArrowRight:this.update(this.rate+1);break;case hi.Home:this.update(0);break;case hi.End:this.update(this.max);break;default:return}n.preventDefault()}ngOnChanges(n){n.rate&&this.update(this.rate),n.max&&this._updateMax()}ngOnInit(){this._setupContexts(),this._updateState(this.rate)}registerOnChange(n){this.onChange=n}registerOnTouched(n){this.onTouched=n}reset(){this.leave.emit(this.nextRate),this._updateState(this.rate)}setDisabledState(n){this.disabled=n}update(n,r=!0){const s=bS(n,this.max,0);this.isInteractive()&&this.rate!==s&&(this.rate=s,this.rateChange.emit(this.rate)),r&&(this.onChange(this.rate),this.onTouched()),this._updateState(this.rate)}writeValue(n){this.update(n,!1),this._changeDetectorRef.markForCheck()}_updateState(n){this.nextRate=n,this.contexts.forEach((r,s)=>r.fill=Math.round(100*bS(n-s,1,0)))}_updateMax(){this.max>0&&(this._setupContexts(),this.update(this.rate))}_setupContexts(){this.contexts=Array.from({length:this.max},(n,r)=>({fill:0,index:r}))}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(gY),oe(Io))},e.\u0275cmp=In({type:e,selectors:[["ngb-rating"]],contentQueries:function(n,r,s){if(1&n&&function or(e,t,i,n){const r=De();if(r.firstCreatePass){const s=Pe();II(r,new SI(t,i,n),s.index),function $z(e,t){const i=e.contentQueries||(e.contentQueries=[]);t!==(i.length?i[i.length-1]:-1)&&i.push(e.queries.length-1,t)}(r,e),2==(2&i)&&(r.staticContentQueries=!0)}AI(r,ce(),i)}(s,Ui,5),2&n){let d;$n(d=Hn())&&(r.starTemplateFromContent=d.first)}},hostAttrs:["role","slider","aria-valuemin","0",1,"d-inline-flex"],hostVars:5,hostBindings:function(n,r){1&n&&nt("blur",function(){return r.handleBlur()})("keydown",function(d){return r.handleKeyDown(d)})("mouseleave",function(){return r.reset()}),2&n&&(Fs("tabindex",r.disabled?-1:r.tabindex),Fn("aria-valuemax",r.max)("aria-valuenow",r.nextRate)("aria-valuetext",r.ariaValueText(r.nextRate,r.max))("aria-disabled",!!r.readonly||null))},inputs:{max:"max",rate:"rate",readonly:"readonly",resettable:"resettable",starTemplate:"starTemplate",tabindex:"tabindex",ariaValueText:"ariaValueText"},outputs:{hover:"hover",leave:"leave",rateChange:"rateChange"},standalone:!0,features:[vi([{provide:fa,useExisting:wt(()=>e),multi:!0}]),Ci,ua],decls:3,vars:1,consts:[["t",""],["ngFor","",3,"ngForOf"],[1,"visually-hidden"],[3,"mouseenter","click"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(n,r){1&n&&(me(0,MW,1,1,"ng-template",null,0,us),me(2,IW,4,5,"ng-template",1)),2&n&&(G(2),ee("ngForOf",r.contexts))},dependencies:[to,Dd],encapsulation:2,changeDetection:0}),t})(),AN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),IN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),RN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),kN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),PN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})();new mt("live announcer delay",{providedIn:"root",factory:function wY(){return 100}});let ON=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})(),FN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({}),t})();const DY=[VF,jF,HF,GF,cN,hN,fN,gN,FN,EN,SN,MN,AN,IN,RN,kN,PN,ON];let py=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[DY,VF,jF,HF,GF,cN,hN,fN,gN,FN,EN,SN,MN,AN,IN,RN,kN,PN,ON]}),t})();const EY=["bookings"];function TY(e,t){1&e&&(H(0,"b",18),ne(1," (CANCELLED)"),j())}function SY(e,t){1&e&&(H(0,"b",18),ne(1," (SOLD OUT)"),j())}const MY=function(e){return{edit:e}};function AY(e,t){if(1&e){const i=zt();H(0,"div",19)(1,"div",20)(2,"button",21),ne(3," EDIT "),j(),H(4,"button",22),nt("click",function(){_e(i);const r=ue(2);return Ie(r.cancelListing(r.listing.listingID))}),ne(5," CANCEL "),j()()()}if(2&e){const i=ue(2);G(2),ee("queryParams",$a(1,MY,i.listing.listingID))}}function IY(e,t){if(1&e&&(H(0,"div",23),Rt(1,"img",24),j()),2&e){const i=ue(2);G(1),ee("src",i.listing.picture?i.listing.picture:i.image.getPlaceholderImage(),cs)}}function RY(e,t){if(1&e&&(H(0,"p",32),ne(1),j()),2&e){const i=t.$implicit;G(1),Ft(" ",i," ")}}function kY(e,t){if(1&e&&(H(0,"div"),ne(1," Scheduled bookings: "),me(2,RY,2,1,"p",31),j()),2&e){const i=ue(3);G(2),ee("ngForOf",i.logBookings())}}function PY(e,t){if(1&e){const i=zt();H(0,"div",25)(1,"div",26)(2,"mat-card",27)(3,"mat-calendar",28,29),nt("selectedChange",function(r){return _e(i),Ie(ue(2)._onSelectedChange(r))}),j()(),me(5,kY,3,1,"div",30),j()()}if(2&e){const i=ue(2);G(3),ee("dateClass",i.dateClass)("selected",null!=i.ps.properties["Time Unit"]&&i.ps.properties["Time Unit"].includes("Day")?i.selectedDateRange:i.selectedDate),G(2),ee("ngIf",null==i.ps.properties["Time Unit"]?null:i.ps.properties["Time Unit"].includes("Hour"))}}function OY(e,t){1&e&&(H(0,"div",36)(1,"label",37),ne(2," Address "),j(),Rt(3,"input",38),j())}function FY(e,t){if(1&e&&(H(0,"div",36)(1,"label",39),ne(2),j(),Rt(3,"input",40),j()),2&e){const i=ue(3);G(2),Ft(" Quantity (max ",i.listing.availableAssets,") "),G(1),bg("max",i.listing.availableAssets)}}function NY(e,t){1&e&&(H(0,"div",36)(1,"label",41),ne(2,"Start Time"),j(),Rt(3,"input",42),j())}function LY(e,t){1&e&&(H(0,"div",36)(1,"label",43),ne(2,"Amount of hours"),j(),Rt(3,"input",44),j())}function BY(e,t){if(1&e&&(H(0,"div"),ne(1),j()),2&e){const i=ue(3);G(1),Ft(" Total Price: \u20ac",i.getTotalPrice()," ")}}function zY(e,t){if(1&e){const i=zt();H(0,"div",25)(1,"div",26)(2,"form",33),nt("ngSubmit",function(){return _e(i),Ie(ue(2).createTransaction())}),me(3,OY,4,0,"div",34),me(4,FY,4,2,"div",34),me(5,NY,4,0,"div",34),me(6,LY,4,0,"div",34),me(7,BY,2,1,"div",30),H(8,"div")(9,"button",35),ne(10," Make Transaction "),j()()()()()}if(2&e){const i=ue(2);G(2),ee("formGroup",i.form),G(1),ee("ngIf",null==i.ps.properties["Listing Type"]?null:i.ps.properties["Listing Type"].includes("Physical Good")),G(1),ee("ngIf",!(null!=i.ps.properties.Quantity&&i.ps.properties.Quantity.includes("One")||null!=i.ps.properties.Frequency&&i.ps.properties.Frequency.includes("Recurring"))),G(1),ee("ngIf",(null==i.ps.properties["Listing Kind"]?null:i.ps.properties["Listing Kind"].includes("Service"))&&(null==i.ps.properties.Frequency?null:i.ps.properties.Frequency.includes("Recurring"))&&i.ps.properties["Time Unit"].includes("Hour")),G(1),ee("ngIf",(null==i.ps.properties["Listing Kind"]?null:i.ps.properties["Listing Kind"].includes("Service"))&&(null==i.ps.properties.Frequency?null:i.ps.properties.Frequency.includes("Recurring"))&&i.ps.properties["Time Unit"].includes("Hour")),G(1),ee("ngIf",(null==i.ps.properties["Listing Kind"]?null:i.ps.properties["Listing Kind"].includes("Service"))&&(null==i.ps.properties.Frequency?null:i.ps.properties.Frequency.includes("Recurring")))}}function VY(e,t){1&e&&(H(0,"div",25)(1,"div",45)(2,"button",46),ne(3," Make Transaction "),j()()())}function jY(e,t){if(1&e&&(H(0,"span")(1,"span",49),ne(2," \u2605 "),j(),ne(3," \u2605 "),j()),2&e){const i=t.fill;Er("rating-star-back"+(100===i?"-filled":"")),G(1),Jr("width:"+i+"%")}}function UY(e,t){if(1&e){const i=zt();H(0,"ngb-rating",48),nt("rateChange",function(r){return _e(i),Ie(ue(3).avgScore=r)}),me(1,jY,4,4,"ng-template"),j()}2&e&&ee("rate",ue(3).avgScore)}function $Y(e,t){if(1&e){const i=zt();H(0,"button",11),nt("click",function(){return _e(i),Ie(ue(2).selectedTab="reviews")}),ne(1," Reviews: "),me(2,UY,2,1,"ngb-rating",47),ne(3),j()}if(2&e){const i=ue(2);Er("btn detail-tab-radio-button--success"+("reviews"===i.selectedTab?"-selected":"")),G(2),ee("ngIf",0!==i.avgScore),G(1),Ft(" (",i.reviews.length,") ")}}function HY(e,t){if(1&e){const i=zt();H(0,"button",11),nt("click",function(){return _e(i),Ie(ue(2).selectedTab="transactions")}),ne(1," Transactions "),j()}2&e&&Er("btn detail-tab-radio-button--warning"+("transactions"===ue(2).selectedTab?"-selected":""))}function GY(e,t){if(1&e){const i=zt();H(0,"button",50),nt("click",function(){return _e(i),Ie(ue(2).contactOwner())}),ne(1," Message Seller "),j()}}function qY(e,t){1&e&&(H(0,"b"),ne(1,"Description:"),j())}function WY(e,t){if(1&e&&(H(0,"p"),ne(1),j()),2&e){const i=ue(3);G(1),Ft(" ",i.listing.description," ")}}function ZY(e,t){if(1&e&&(H(0,"p")(1,"b"),ne(2,"Quantity Available: "),j(),ne(3),j()),2&e){const i=ue(3);G(3),Ft("",i.listing.availableAssets," ")}}function YY(e,t){if(1&e&&(H(0,"p")(1,"b"),ne(2,"Date: "),j(),ne(3),j()),2&e){const i=ue(3);G(3),Ft("",i.listing.date," ")}}function XY(e,t){if(1&e&&(H(0,"div")(1,"b"),ne(2,"Location: "),j(),ne(3),Rt(4,"div",53),j()),2&e){const i=ue(3);G(3),Ft("",i.listing.location," ")}}function KY(e,t){if(1&e&&(H(0,"span")(1,"span",49),ne(2," \u2605 "),j(),ne(3," \u2605 "),j()),2&e){const i=t.fill;Er("rating-star-back"+(100===i?"-filled":"")),G(1),Jr("width:"+i+"%")}}function QY(e,t){if(1&e){const i=zt();H(0,"span")(1,"ngb-rating",48),nt("rateChange",function(r){return _e(i),Ie(ue(3).sellerScore=r)}),me(2,KY,4,4,"ng-template"),j(),ne(3),j()}if(2&e){const i=ue(3);G(1),ee("rate",i.sellerScore),G(2),Ft(" (",i.sellerReviewAmount,") ")}}function JY(e,t){if(1&e&&(H(0,"p")(1,"b"),ne(2),j(),ne(3),j()),2&e){const i=t.$implicit;G(2),Ft("",i[0],":"),G(1),Ft(" ",i[1].join(", ")," ")}}function eX(e,t){if(1&e&&(H(0,"div",51),me(1,qY,2,0,"b",30),me(2,WY,2,1,"p",30),me(3,ZY,4,1,"p",30),me(4,YY,4,1,"p",30),me(5,XY,5,1,"div",30),H(6,"p")(7,"b"),ne(8,"Seller: "),j(),ne(9),me(10,QY,4,2,"span",30),j(),me(11,JY,4,2,"p",52),j()),2&e){const i=ue(2);G(1),ee("ngIf",i.listing.description),G(1),ee("ngIf",i.listing.description),G(1),ee("ngIf",!i.ps.properties.Quantity.includes("One")&&(i.listing.availableAssets||0===i.listing.availableAssets)),G(1),ee("ngIf",i.listing.date),G(1),ee("ngIf",i.listing.location),G(4),Ft("",i.listing.userName," "),G(1),ee("ngIf",(null==i.ps.properties["Review Of"]?null:i.ps.properties["Review Of"].includes("Of Provider"))&&0!==i.sellerReviewAmount),G(1),ee("ngForOf",i.listing.categories)}}function tX(e,t){1&e&&(H(0,"span"),ne(1," \u2605 "),j()),2&e&&Er("rating-star-back"+(100===t.fill?"-filled":""))}function nX(e,t){if(1&e&&(H(0,"p",57),ne(1),j()),2&e){const i=ue().$implicit;G(1),Ft(" ",i.comment," ")}}function iX(e,t){if(1&e){const i=zt();H(0,"div"),Rt(1,"img",55),ne(2),H(3,"ngb-rating",48),nt("rateChange",function(r){return Ie(_e(i).$implicit.score=r)}),me(4,tX,2,2,"ng-template"),j(),me(5,nX,2,1,"p",56),Rt(6,"hr"),j()}if(2&e){const i=t.$implicit,n=ue(4);G(1),ee("src",i.Transaction.User.profilePicture?i.Transaction.User.profilePicture:n.image.getUserPlaceholderImage(),cs),G(1),Ft(" ",i.Transaction.User.userName," "),G(1),ee("rate",i.score),G(2),ee("ngIf",i.comment)}}function rX(e,t){if(1&e&&(H(0,"div"),me(1,iX,7,4,"div",52),j()),2&e){const i=ue(3);G(1),ee("ngForOf",i.reviews)}}function oX(e,t){1&e&&(H(0,"div"),ne(1," No one has reviewed this listing yet "),j())}function sX(e,t){if(1&e&&(H(0,"div",54),me(1,rX,2,1,"div",30),me(2,oX,2,0,"div",30),j()),2&e){const i=ue(2);G(1),ee("ngIf",i.reviews.length>0),G(1),ee("ngIf",0===i.reviews.length)}}function aX(e,t){if(1&e&&(H(0,"span")(1,"span",49),ne(2," \u2605 "),j(),ne(3," \u2605 "),j()),2&e){const i=t.fill;Er("rating-star-back"+(100===i?"-filled":"")),G(1),Jr("width:"+i+"%")}}function lX(e,t){if(1&e){const i=zt();tx(0),H(1,"ngb-rating",48),nt("rateChange",function(r){return _e(i),Ie(ue().$implicit.userRating=r)}),me(2,aX,4,4,"ng-template"),j(),ne(3),nx()}if(2&e){const i=ue().$implicit;G(1),ee("rate",i.userRating),G(2),Ft(" (",i.userRatingCount,") ")}}function cX(e,t){if(1&e&&(H(0,"div"),ne(1," Quantity: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Cn(i.numberOfAssets)}}function dX(e,t){if(1&e&&(H(0,"div"),ne(1," Address: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Cn(i.sendAddress)}}function uX(e,t){if(1&e){const i=zt();H(0,"button",66),nt("click",function(){_e(i);const r=ue(2).$implicit;return Ie(ue(4).confirmPayment(r.transactionID))}),ne(1," Confirm Payment "),j()}}function hX(e,t){if(1&e){const i=zt();H(0,"button",66),nt("click",function(){_e(i);const r=ue(2).$implicit;return Ie(ue(4).selectedTransactionForReview=r.transactionID)}),ne(1," Review User "),j()}}function pX(e,t){if(1&e){const i=zt();H(0,"div",20),me(1,uX,2,0,"button",64),me(2,hX,2,0,"button",64),H(3,"button",65),nt("click",function(){_e(i);const r=ue().$implicit;return Ie(ue(4).cancelTransaction(r.transactionID))}),ne(4," Cancel Transaction "),j()()}if(2&e){const i=ue().$implicit,n=ue(4);G(1),ee("ngIf","payed"!==i.status),G(1),ee("ngIf",(null==n.ps.properties["Review By"]?null:n.ps.properties["Review By"].includes("By Provider"))&&"payed"===i.status&&i.reviewable)}}function fX(e,t){1&e&&(H(0,"th",72),ne(1,"Time"),j())}function mX(e,t){if(1&e&&(H(0,"td"),ne(1),j()),2&e){const i=ue().$implicit;G(1),Cg(" ",i.startTime," - ",i.endTime," ")}}function _X(e,t){if(1&e){const i=zt();H(0,"tr")(1,"td"),ne(2),j(),me(3,mX,2,2,"td",30),H(4,"td")(5,"textarea",73),nt("ngModelChange",function(r){return Ie(_e(i).$implicit.info=r)}),j()(),H(6,"td")(7,"button",74),nt("click",function(){const s=_e(i).$implicit;return Ie(ue(7).saveBookingInfo(s))}),ne(8," Update info "),j()()()}if(2&e){const i=t.$implicit,n=ue(7);G(2),Ft(" ",i.startDate===i.endDate?i.startDate:i.startDate+" - "+i.endDate," "),G(1),ee("ngIf",null==n.ps.properties["Time Unit"]?null:n.ps.properties["Time Unit"].includes("Hour")),G(2),ee("ngModel",i.info)}}function gX(e,t){if(1&e&&(H(0,"table",68)(1,"thead",69)(2,"tr")(3,"th",70),ne(4,"Date"),j(),me(5,fX,2,0,"th",71),H(6,"th",72),ne(7,"Info"),j(),H(8,"th",72),ne(9,"Actions"),j()()(),H(10,"tbody"),me(11,_X,9,3,"tr",52),j()()),2&e){const i=ue(2).$implicit,n=ue(4);G(5),ee("ngIf",null==n.ps.properties["Time Unit"]?null:n.ps.properties["Time Unit"].includes("Hour")),G(6),ee("ngForOf",i.bookings)}}function yX(e,t){1&e&&(H(0,"div")(1,"b"),ne(2,"No Bookings On this transaction"),j()())}function vX(e,t){if(1&e&&(H(0,"div"),ne(1," Bookings: "),me(2,gX,12,2,"table",67),me(3,yX,3,0,"div",30),j()),2&e){const i=ue().$implicit;G(2),ee("ngIf",i.bookings&&i.bookings.length>0),G(1),ee("ngIf",!i.bookings||0===i.bookings.length)}}function bX(e,t){if(1&e&&(H(0,"span"),ne(1," \u2605 "),j()),2&e){const i=t.index,n=ue(6);Jr("font-size: 50px;color: "+(i<n.hoverRating&&i>=n.rating?"#FAB81E":i<n.hoverRating?"orange":i>=n.rating?"gray":"#FFC300"))}}function xX(e,t){if(1&e){const i=zt();H(0,"div")(1,"form",33),nt("ngSubmit",function(){return _e(i),Ie(ue(5).postReview())}),H(2,"h4"),ne(3),H(4,"ngb-rating",75),nt("rateChange",function(r){return _e(i),Ie(ue(5).rating=r)})("hover",function(r){return _e(i),Ie(ue(5).hoverRating=r)})("leave",function(){return _e(i),Ie(ue(5).hoverRating=0)}),me(5,bX,2,2,"ng-template"),j()(),H(6,"div",36)(7,"label",76),ne(8," Comment (optional) "),j(),H(9,"textarea",77),ne(10,"                  "),j()(),H(11,"div",20)(12,"button",78),nt("click",function(){return _e(i),Ie(ue(5).resetReviewForm())}),ne(13," Cancel Review "),j(),H(14,"button",79),ne(15," Post Review "),j()()()()}if(2&e){const i=ue().$implicit,n=ue(4);G(1),ee("formGroup",n.reviewForm),G(2),Ft(" Review ",i.User.userName,": "),G(1),ee("rate",n.rating),G(10),ee("disabled",0===n.rating)}}function wX(e,t){if(1&e&&(H(0,"div",60)(1,"h5",61)(2,"div",4)(3,"div",5),ne(4),me(5,lX,4,2,"ng-container",30),j(),H(6,"div",62),ne(7),j()()(),H(8,"div",26)(9,"div",4)(10,"div",5)(11,"div"),ne(12," Price: "),H(13,"b"),ne(14),j()(),H(15,"div"),ne(16," Created At: "),H(17,"b"),ne(18),j()(),me(19,cX,4,1,"div",30),me(20,dX,4,1,"div",30),j(),H(21,"div",19),me(22,pX,5,2,"div",63),j()(),me(23,vX,4,2,"div",30),me(24,xX,16,4,"div",30),j()()),2&e){const i=t.$implicit,n=ue(4);Er("card bg-"+i.status),G(4),Ft(" ",i.User.userName," "),G(1),ee("ngIf",(null==n.ps.properties["Review By"]?null:n.ps.properties["Review By"].includes("By Provider"))&&0!==i.userRatingCount),G(1),Er("col text-end text-"+i.status),G(1),Ft(" ",i.status.toUpperCase()," "),G(7),Ft("\u20ac",i.price,""),G(4),Cn(i.createdAt.split("T").join(" ").split(":").slice(0,-1).join(":")),G(1),ee("ngIf",null==n.ps.properties.Quantity?null:n.ps.properties.Quantity.includes("Many")),G(1),ee("ngIf",null==n.ps.properties["Listing Type"]?null:n.ps.properties["Listing Type"].includes("Physical Good")),G(2),ee("ngIf","cancelled"!==i.status),G(1),ee("ngIf",(null==n.ps.properties["Listing Kind"]?null:n.ps.properties["Listing Kind"].includes("Service"))&&(null==n.ps.properties.Frequency?null:n.ps.properties.Frequency.includes("Recurring"))),G(1),ee("ngIf",n.selectedTransactionForReview===i.transactionID)}}function CX(e,t){if(1&e&&(H(0,"div"),me(1,wX,25,14,"div",59),j()),2&e){const i=ue(3);G(1),ee("ngForOf",i.transactions)}}function DX(e,t){1&e&&(H(0,"div"),ne(1," No one has make a transaction yet "),j())}function EX(e,t){if(1&e&&(H(0,"div",58),me(1,CX,2,1,"div",30),me(2,DX,2,0,"div",30),j()),2&e){const i=ue(2);G(1),ee("ngIf",i.transactions.length>0),G(1),ee("ngIf",0===i.transactions.length)}}function TX(e,t){if(1&e){const i=zt();H(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h1"),ne(5),me(6,TY,2,0,"b",6),me(7,SY,2,0,"b",6),j()(),me(8,AY,6,3,"div",7),j(),H(9,"div",4),me(10,IY,2,1,"div",8),H(11,"div",5)(12,"h2"),ne(13,"Asking Price:"),H(14,"b"),ne(15),j()(),me(16,PY,6,3,"div",9),me(17,zY,11,6,"div",9),me(18,VY,4,0,"div",9),j()(),H(19,"div",10)(20,"button",11),nt("click",function(){return _e(i),Ie(ue().selectedTab="info")}),ne(21," Info "),j(),me(22,$Y,4,4,"button",12),me(23,HY,2,2,"button",12),me(24,GY,2,0,"button",13),j(),H(25,"div",14),me(26,eX,12,8,"div",15),me(27,sX,3,2,"div",16),me(28,EX,3,2,"div",17),j()()()}if(2&e){const i=ue();G(5),Ft(" ",i.listing.name," "),G(1),ee("ngIf","cancelled"===i.listing.status),G(1),ee("ngIf",0===i.listing.availableAssets),G(1),ee("ngIf",i.user.getId()===i.listing.userID&&"cancelled"!==i.listing.status),G(2),ee("ngIf",!(null!=i.ps.properties["Listing Type"]&&i.ps.properties["Listing Type"].includes("Digital Good"))),G(5),Ft(" \u20ac",i.listing.price,""),G(1),ee("ngIf",(null==i.ps.properties["Listing Kind"]?null:i.ps.properties["Listing Kind"].includes("Service"))&&i.ps.properties.Frequency.includes("Recurring")),G(1),ee("ngIf",i.user.isLoggedIn()&&i.listing.userID!==i.user.getId()&&0!==i.listing.availableAssets&&"cancelled"!==i.listing.status),G(1),ee("ngIf",!i.user.isLoggedIn()),G(2),Er("btn detail-tab-radio-button--info"+("info"===i.selectedTab?"-selected":"")),G(2),ee("ngIf",null==i.ps.properties["Review By"]?null:i.ps.properties["Review By"].includes("By Customer")),G(1),ee("ngIf",i.listing.userID===i.user.getId()),G(1),ee("ngIf",i.listing.userID!==i.user.getId()&&i.user.isLoggedIn()&&(null==i.ps.properties["Conversation System"]?null:i.ps.properties["Conversation System"].includes("Listings Conversation"))),G(1),Er("detail-window--"+i.selectedTab),G(1),ee("ngIf","info"===i.selectedTab),G(1),ee("ngIf","reviews"===i.selectedTab),G(1),ee("ngIf","transactions"===i.selectedTab)}}function SX(e,t){if(1&e){const i=zt();H(0,"div",80)(1,"h1"),ne(2,"ERROR"),j(),H(3,"p"),ne(4),j(),H(5,"button",65),nt("click",function(){return _e(i),Ie(ue().error="")}),ne(6,"OK"),j()()}if(2&e){const i=ue();G(4),Cn(i.error)}}let NN=(()=>{var e;class t{ngAfterViewChecked(){this.listing&&!this.map&&this.listing.location&&document.getElementById("map")&&this.coords.length>0&&(this.map=new j0.Map({accessToken:w0_mapbox_accessToken,container:"map",style:"mapbox://styles/mapbox/streets-v11",zoom:13,center:this.coords}),(new j0.Marker).setLngLat(this.coords).addTo(this.map))}_onSelectedChange(n){this.selectedDate=n,this.selectedDateRange=this.selectedDateRange&&this.selectedDateRange.start&&n>this.selectedDateRange.start&&!this.selectedDateRange.end?new ps(this.selectedDateRange.start,n):new ps(n,null)}customToDate(n){let r=n.split("-").map(s=>parseInt(s));return Date.UTC(r[0],r[1]-1,r[2])}dateToYYYYMMDDformat(n){const r=n.getTimezoneOffset();return new Date(n.getTime()-60*r*1e3).toISOString().split("T")[0]}logBookings(n=this.bookings){return n.map(r=>`(${r.startDate}) ${r.startTime} - ${r.endTime} (${r.endDate})`)}getTotalPrice(){return parseInt(this.listing.price)*this.getTotalServiceAssets()}getTotalServiceAssets(){return this.ps.properties["Time Unit"]?.includes("Hour")?parseInt(this.form.get("amountOfHours").value):this.selectedDateRange&&this.selectedDateRange.start&&this.selectedDateRange.end?Math.round((this.selectedDateRange.end.valueOf()-this.selectedDateRange.start.valueOf())/864e5):0}constructor(n,r,s,d,m,b){this.route=n,this.db=r,this.user=s,this.router=d,this.image=m,this.ps=b,this.transactions=[],this.reviews=[],this.avgScore=0,this.sellerScore=0,this.sellerReviewAmount=0,this.selectedTab="",this.loading=0,this.rating=0,this.selectedTransactionForReview=-1,this.loadedBookings=[0,0],this.bookings=[],this.coords=[],this.dateClass=(E,I)=>{if("month"===I){(this.loadedBookings[0]!==E.getMonth()+1||this.loadedBookings[1]!==E.getFullYear())&&(this.db.getListingBookings(this.listing.listingID,E.getMonth()+1,E.getFullYear()).then(q=>{this.bookings=q.bookings,this.calendar.updateTodaysDate()}),this.loadedBookings=[E.getMonth()+1,E.getFullYear()]);let O=Date.UTC(E.getFullYear(),E.getMonth(),E.getDate());for(let q=0;q<this.bookings.length;q++){let Y=this.customToDate(this.bookings[q].startDate),pe=this.customToDate(this.bookings[q].endDate);if(O>=Y&&O<=pe)return"calendar-date-occupied"}}return""},this.form=new Sd({numberOfAssets:new mm(1),address:new On,date:new On,startTime:new On,amountOfHours:new On(1)}),this.reviewForm=new Sd({comment:new On("")})}ngOnInit(){this.route.params.subscribe(n=>{this.error="",n.type&&["info","reviews","transactions"].includes(n.type)&&(this.selectedTab=n.type),this.db.getListing(n.id).then(r=>{this.db.getCategories().then(s=>{let d=[];Object.entries(s).forEach(([m,b])=>{let E=b.filter(I=>r.categories.includes(I));E.length>0&&d.push([m,E])}),this.listing=r,this.listing.categories=d,this.loadReviews(),this.listing.userID===this.user.getId()&&this.loadTransactions(),this.ps.properties["Review Of"]?.includes("Of Listing")&&this.db.getSellerRating(this.listing.userID).then(m=>{this.sellerScore=m.sellerScore,this.sellerReviewAmount=m.reviewAmount}),this.listing.location&&this.db.geoLocate(this.listing.location).then(m=>{this.coords=m.features[0].center})})}).catch(r=>this.error=r.error.message)})}onFinishLoading(){this.loading-=1,0===this.loading&&(this.selectedTab?setTimeout(()=>document.getElementById(this.selectedTab).scrollIntoView(),50):this.selectedTab="info")}loadReviews(){this.loading+=1,this.db.getListingReviews(this.listing.listingID).then(n=>{this.avgScore=n.score,this.reviews=n.reviews,this.onFinishLoading()}).catch(n=>this.error=n.error.message)}loadTransactions(){this.loading+=1,this.db.getListingTransactions(this.listing.listingID,this.user.getLoginToken()).then(n=>{n.transactions.sort((r,s)=>s.transactionID-r.transactionID),this.transactions=n.transactions,this.transactions.forEach(r=>{this.db.getUserRating(this.user.getLoginToken(),r.customerID).then(s=>{r.userRatingCount=s.reviewAmount,r.userRating=s.userRating}),this.ps.properties["Listing Kind"]?.includes("Service")&&this.ps.properties.Frequency?.includes("Recurring")&&this.db.getTransactionBookings(this.user.getLoginToken(),r.transactionID).then(s=>{r.bookings=s.bookings})}),this.onFinishLoading()}).catch(n=>{this.error=n.error.message})}cancelListing(n){this.db.cancelListing(n,this.user.getLoginToken()).then(r=>{this.listing.status="cancelled",this.loadTransactions()})}createTransaction(){let n={...this.form.getRawValue()};n.numberOfAssets=this.getTotalServiceAssets(),n.listingID=this.listing.listingID,this.db.createTransaction(this.user.getLoginToken(),n).then(r=>{if(this.ps.properties["Listing Kind"]?.includes("Service")&&this.ps.properties.Frequency?.includes("Recurring")){let s={transactionID:r.transactionID};if(this.ps.properties["Time Unit"]?.includes("Day"))s.startDate=this.dateToYYYYMMDDformat(this.selectedDateRange.start),s.endDate=this.dateToYYYYMMDDformat(this.selectedDateRange.end);else{s.startDate=this.dateToYYYYMMDDformat(this.selectedDate);let d=new Date(this.selectedDate);d.setHours(n.startTime.split(":")[0]),d.setMinutes(n.startTime.split(":")[1]),d.setTime(d.getTime()+60*n.amountOfHours*60*1e3),s.endDate=this.dateToYYYYMMDDformat(d),s.startTime=n.startTime,s.endTime=`${d.getHours()}:${d.getMinutes()}`}this.db.createBooking(this.user.getLoginToken(),s).then(d=>{this.transactionSuccess()}).catch(d=>{this.db.cancelTransaction(r.transactionID,this.user.getLoginToken()),this.error=`Booking failed: ${d.error.message}`})}else this.transactionSuccess()})}transactionSuccess(){this.ps.properties.Quantity?.includes("One")&&!this.ps.properties.Frequency?.includes("Recurring")&&this.db.soldListingStatus(this.listing.listingID),this.router.navigate(["/transactions"])}cancelTransaction(n){this.db.cancelTransaction(n,this.user.getLoginToken()).then(r=>{this.loadTransactions()}).catch(r=>this.error=r.error.message)}confirmPayment(n){this.db.confirmPayment(n,this.user.getLoginToken()).then(r=>{this.loadTransactions()}).catch(r=>this.error=r.error.message)}contactOwner(){this.router.navigateByUrl(`/messages?id=${this.listing.userID}`)}postReview(){let n=this.reviewForm.getRawValue();n.score=this.rating,this.db.postReview(this.user.getLoginToken(),this.selectedTransactionForReview,n).then(r=>{this.resetReviewForm(),this.loadTransactions()})}resetReviewForm(){this.selectedTransactionForReview=-1,this.rating=0,this.reviewForm.setValue({comment:""})}saveBookingInfo(n){this.db.addBookingInfo(this.user.getLoginToken(),{bookingID:n.bookingID,info:n.info}).then(r=>{})}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Ga),oe(hs),oe(Bc),oe(Lr),oe(Cm),oe(xp))},e.\u0275cmp=In({type:e,selectors:[["app-detail"]],viewQuery:function(n,r){if(1&n&&Ls(EY,5),2&n){let s;$n(s=Hn())&&(r.calendar=s.first)}},features:[vi([{provide:Ew,useClass:QO}])],decls:2,vars:2,consts:[["class","d-flex justify-content-center","style","margin: 10px;",4,"ngIf"],["style","margin: 10px;",4,"ngIf"],[1,"d-flex","justify-content-center",2,"margin","10px"],[1,"container"],[1,"row"],[1,"col"],["style","color: red;",4,"ngIf"],["class","col text-end",4,"ngIf"],["class","col-8",4,"ngIf"],["class","card",4,"ngIf"],["role","group",1,"btn-group",2,"margin-left","15px","margin-top","20px"],[3,"click"],[3,"class","click",4,"ngIf"],["class","btn detail-tab-radio-button--danger",3,"click",4,"ngIf"],["id","details"],["id","info",4,"ngIf"],["id","reviews",4,"ngIf"],["id","transactions",4,"ngIf"],[2,"color","red"],[1,"col","text-end"],["role","group",1,"btn-group"],["routerLink","/listings/createEditListing",1,"btn","btn-lg","btn-success",3,"queryParams"],[1,"btn","btn-lg","btn-danger",3,"click"],[1,"col-8"],[2,"width","100%","border-radius","5px",3,"src"],[1,"card"],[1,"card-body"],[2,"width","100%","padding-top","0px"],[3,"dateClass","selected","selectedChange"],["bookings",""],[4,"ngIf"],["style","margin: 0",4,"ngFor","ngForOf"],[2,"margin","0"],[3,"formGroup","ngSubmit"],["class","form-group",4,"ngIf"],["type","submit",1,"btn","btn-primary","btn-block"],[1,"form-group"],["for","address"],["type","text","id","address","placeholder","address","formControlName","address",1,"form-control"],["for","inputNumberOfAssets"],["type","number","min","1","id","inputNumberOfAssets","placeholder","Quantity","formControlName","numberOfAssets",1,"form-control",3,"max"],["for","inputStartTime"],["type","time","id","inputStartTime","formControlName","startTime",1,"form-control"],["for","inputAmountOfHours"],["type","number","min","1","id","inputAmountOfHours","formControlName","amountOfHours",1,"form-control"],[1,"text-center",2,"padding","10px"],["type","button","routerLink","/login",1,"btn","btn-primary","btn-block"],["max","5","readonly","true",3,"rate","rateChange",4,"ngIf"],["max","5","readonly","true",3,"rate","rateChange"],[1,"rating-star-front"],[1,"btn","detail-tab-radio-button--danger",3,"click"],["id","info"],[4,"ngFor","ngForOf"],["id","map",1,"map",2,"height","500px"],["id","reviews"],[2,"border-radius","50%","height","30px","width","30px",3,"src"],["style","margin-left: 10px;",4,"ngIf"],[2,"margin-left","10px"],["id","transactions"],["style","margin-bottom: 5px;",3,"class",4,"ngFor","ngForOf"],[2,"margin-bottom","5px"],[1,"card-title",2,"margin-left","5px"],[2,"margin-right","5px"],["class","btn-group","role","group",4,"ngIf"],["class","btn btn-success",3,"click",4,"ngIf"],[1,"btn","btn-danger",3,"click"],[1,"btn","btn-success",3,"click"],["class","table",4,"ngIf"],[1,"table"],[1,"thead-light"],["scope","col"],["score","col",4,"ngIf"],["score","col"],["placeholder","Enter Info","rows","3",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn","btn-info",3,"click"],["max","5",3,"rate","rateChange","hover","leave"],["for","textareaComment"],["id","textareaComment","placeholder","Enter comment","rows","3","formControlName","comment",1,"form-control"],["type","button",1,"btn","btn-danger",3,"click"],[1,"btn","btn-success",3,"disabled"],[2,"margin","10px"]],template:function(n,r){1&n&&(me(0,TX,29,19,"div",0),me(1,SX,7,1,"div",1)),2&n&&(ee("ngIf",r.listing&&!r.error),G(1),ee("ngIf",r.error))},dependencies:[to,fr,Fc,Hw,yp,ma,Wg,$l,_p,Zg,I0,gp,Md,Pu,Tw],styles:[".bg-reserved[_ngcontent-%COMP%], .bg-payed[_ngcontent-%COMP%], .bg-cancelled[_ngcontent-%COMP%]{--bs-bg-opacity: .3}.detail-tab-radio-button[_ngcontent-%COMP%], .detail-tab-radio-button--danger[_ngcontent-%COMP%], .detail-tab-radio-button--danger-selected[_ngcontent-%COMP%], .detail-tab-radio-button--warning[_ngcontent-%COMP%], .detail-tab-radio-button--warning-selected[_ngcontent-%COMP%], .detail-tab-radio-button--success[_ngcontent-%COMP%], .detail-tab-radio-button--success-selected[_ngcontent-%COMP%], .detail-tab-radio-button--info[_ngcontent-%COMP%], .detail-tab-radio-button--info-selected[_ngcontent-%COMP%]{border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-style:hidden;box-shadow:none!important;outline:0px!important}.detail-window--info[_ngcontent-%COMP%]{border-style:solid;border-radius:12px;border-width:1px;padding:10px;border-color:#17a2b8}.detail-window--reviews[_ngcontent-%COMP%]{border-style:solid;border-radius:12px;border-width:1px;padding:10px;border-color:#28a745}.detail-window--transactions[_ngcontent-%COMP%]{border-style:solid;border-radius:12px;border-width:1px;padding:10px;border-color:#ffc107}.rating-star-back[_ngcontent-%COMP%], .rating-star-back-filled[_ngcontent-%COMP%]{position:relative;display:inline-block;font-size:20px;color:gray}.rating-star-back-filled[_ngcontent-%COMP%]{color:#fab81e}.rating-star-front[_ngcontent-%COMP%]{position:absolute;display:inline-block;overflow:hidden;color:#fab81e}.col-8[_ngcontent-%COMP%]{flex:0 0 auto;width:66.66666667%!important}[_nghost-%COMP%]     .calendar-date-occupied{background:red;border-radius:100%}[_nghost-%COMP%]     .calendar-date-partially-occupied{background:orange;border-radius:100%}"]}),t})();function MX(e,t){1&e&&(H(0,"div",7)(1,"label",24),ne(2," Quantity Available "),j(),Rt(3,"input",25),j())}function AX(e,t){1&e&&(H(0,"div",7)(1,"label",26),ne(2," Date "),j(),Rt(3,"input",27),j())}function IX(e,t){1&e&&(H(0,"div",7)(1,"label",28),ne(2," Location "),j(),Rt(3,"input",29),j())}function RX(e,t){if(1&e&&(H(0,"div",36),Rt(1,"img",37),j()),2&e){const i=ue(2);G(1),ee("src",i.imgSrc,cs)}}function kX(e,t){if(1&e){const i=zt();H(0,"button",38),nt("click",function(){return _e(i),Ie(ue(2).imgSrc=null)}),ne(1," Remove Image "),j()}}function PX(e,t){if(1&e&&(H(0,"small",21)(1,"i",9),ne(2),j()()),2&e){const i=ue(2);G(2),Cn(i.imgError)}}function OX(e,t){if(1&e){const i=zt();H(0,"div",7)(1,"label",30),ne(2," Image "),j(),H(3,"div",31)(4,"input",32),nt("change",function(r){return _e(i),Ie(ue().fileSelected(r))}),j(),H(5,"label",33),ne(6),j()(),me(7,RX,2,1,"div",34),me(8,kX,2,0,"button",35),me(9,PX,3,1,"small",23),j()}if(2&e){const i=ue();G(6),Ft(" ",i.fileName?i.fileName:"Choose Image"," "),G(1),ee("ngIf",i.imgSrc),G(1),ee("ngIf",i.imgSrc),G(1),ee("ngIf",i.imgError)}}function FX(e,t){if(1&e){const i=zt();H(0,"div",7)(1,"label",39),ne(2," File "),j(),H(3,"div",40)(4,"input",32),nt("change",function(r){return _e(i),Ie(ue().fileSelected(r))}),j(),H(5,"label",33),ne(6),j()()()}if(2&e){const i=ue();G(6),Ft(" ",i.fileName?i.fileName:"Choose File"," ")}}function NX(e,t){1&e&&(H(0,"div",7)(1,"label",41),ne(2," Link "),j(),Rt(3,"input",42),j())}function LX(e,t){if(1&e){const i=zt();H(0,"div",45)(1,"input",46),nt("ngModelChange",function(r){return Ie(_e(i).$implicit.selected=r)}),j(),H(2,"label",47),ne(3),j()()}if(2&e){const i=t.$implicit;G(1),ee("id",i.name)("ngModel",i.selected),G(1),ee("for",i.name),G(1),Ft(" ",i.name," ")}}function BX(e,t){if(1&e&&(H(0,"div")(1,"h6",43),ne(2),j(),me(3,LX,4,4,"div",44),j()),2&e){const i=t.$implicit;G(2),Cn(i[0]),G(1),ee("ngForOf",i[1])}}function zX(e,t){if(1&e){const i=zt();H(0,"button",48),nt("click",function(){return _e(i),Ie(ue().createListing())}),ne(1),j()}if(2&e){const i=t.ngIf,n=ue();ee("disabled",!(i.name&&i.price)),G(1),Ft(" ",n.listingId<0?"Create":"Edit"," Listing ")}}function VX(e,t){if(1&e&&(H(0,"small",21)(1,"i",9),ne(2),j()()),2&e){const i=ue();G(2),Cn(i.error)}}let jX=(()=>{var e;class t{constructor(n,r,s,d,m,b,E){this.user=n,this.route=r,this.db=s,this.router=d,this.image=m,this.companyService=b,this.ps=E,this.listingId=-1,this.categories=[],this.properties={},this.user.isLoggedIn()||this.router.navigateByUrl("/login"),this.form=new Sd({name:new On,description:new On,availableAssets:new On,date:new On,price:new On,location:new On,link:new On})}ngOnInit(){this.route.queryParamMap.subscribe(n=>{let r=n.params.edit;r?this.db.getListing(r).then(s=>{this.listingId=s.listingID,this.form.patchValue({name:s.name,description:s.description,availableAssets:s.availableAssets,date:s.date,price:s.price,location:s.location}),s.picture&&(this.imgSrc=s.picture,this.imgError=""),this.getCategories(s.categories)}):this.getCategories()})}getCategories(n=[]){this.db.getCategories().then(r=>{this.categories=Object.entries(r).map(([s,d])=>[s,d.map(m=>({name:m,selected:n.includes(m)}))])})}fileSelected(n){if(0===n.target.files.length)return;this.imgError=void 0,this.imgSrc=void 0;let r=n.target.files[0];this.fileName=r.name,this.image.convertFileToJpegBase64(r,s=>{this.imgSrc=s},s=>{this.imgError=s},572,360)}createListing(){let n={...this.form.getRawValue()};n.categories=this.categories.map(r=>r[1]).reduce((r,s)=>r.concat(s),[]).filter(r=>r.selected).map(r=>r.name),n.picture=this.imgSrc,n.file=this.imgSrc,this.listingId<0?this.db.createListing(this.user.getLoginToken(),n,this.companyService.companyName).then(r=>{this.router.navigateByUrl(`/listings/details/${r.listingID}`)}).catch(r=>this.error=r.error.message):this.db.postListing(this.listingId,this.user.getLoginToken(),n).then(r=>{this.router.navigateByUrl(`/listings/details/${this.listingId}`)}).catch(r=>this.error=r.error.message)}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Bc),oe(Ga),oe(hs),oe(Lr),oe(Cm),oe(C0),oe(xp))},e.\u0275cmp=In({type:e,selectors:[["app-form"]],decls:49,vars:11,consts:[[2,"margin","10px"],[1,"container"],[1,"row"],[1,"offset-md-2","col-md-8","offset-lg-3","col-lg-6"],[1,"card"],[1,"card-body"],[3,"formGroup","ngSubmit"],[1,"form-group"],["for","inputName"],[2,"color","red"],["type","text","id","inputName","placeholder","Enter Name","formControlName","name",1,"form-control"],["for","textareaDescription"],["id","textareaDescription","placeholder","Enter Description","rows","3","formControlName","description",1,"form-control"],["class","form-group",4,"ngIf"],["for","inputPrice"],[1,"input-group","mb-3"],[1,"input-group-prepend"],[1,"input-group-text"],["type","number","min","0","step","0.01","id","inputPrice","placeholder","Enter Price","formControlName","price",1,"form-control"],[1,"card-title"],[4,"ngFor","ngForOf"],[1,"form-text"],["type","submit","class","btn btn-primary btn-block",3,"disabled","click",4,"ngIf"],["class","form-text",4,"ngIf"],["for","inputAvailableAssets"],["type","number","min","1","id","inputAvailableAssets","placeholder","Enter Quantity Available","formControlName","availableAssets",1,"form-control"],["for","inputDate"],["type","date","id","inputDate","placeholder","Enter Start Date","formControlName","date",1,"form-control"],["for","inputLocation"],["type","text","id","inputLocation","placeholder","Enter Location","formControlName","location",1,"form-control"],["for","inputImage"],["id","inputImage",1,"custom-file"],["type","file","id","customFile",1,"custom-file-input",3,"change"],["for","customFile",1,"custom-file-label"],["style","display: flex;justify-content: center;",4,"ngIf"],["type","button","class","btn btn-outline-danger btn-block",3,"click",4,"ngIf"],[2,"display","flex","justify-content","center"],[2,"width","318px","height","200px",3,"src"],["type","button",1,"btn","btn-outline-danger","btn-block",3,"click"],["for","inputFile"],["id","inputFile",1,"custom-file"],["for","inputLink"],["type","text","id","inputLink","placeholder","Enter Link","formControlName","link",1,"form-control"],[2,"margin-top","10px"],["class","form-check",4,"ngFor","ngForOf"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"id","ngModel","ngModelChange"],[1,"form-check-label",3,"for"],["type","submit",1,"btn","btn-primary","btn-block",3,"disabled","click"]],template:function(n,r){1&n&&(H(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1"),ne(5),j()()(),H(6,"div",2)(7,"div",3)(8,"div",4)(9,"div",5)(10,"form",6),nt("ngSubmit",function(){return r.createListing()}),H(11,"div",7)(12,"label",8),ne(13," Name "),H(14,"i",9),ne(15,"*"),j()(),Rt(16,"input",10),j(),H(17,"div",7)(18,"label",11),ne(19," Description "),j(),H(20,"textarea",12),ne(21,"                "),j()(),me(22,MX,4,0,"div",13),me(23,AX,4,0,"div",13),H(24,"div",7)(25,"label",14),ne(26," Price "),H(27,"i",9),ne(28,"*"),j()(),H(29,"div",15)(30,"div",16)(31,"span",17),ne(32," \u20ac "),j()(),Rt(33,"input",18),j()(),me(34,IX,4,0,"div",13),me(35,OX,10,4,"div",13),me(36,FX,7,1,"div",13),me(37,NX,4,0,"div",13),j(),H(38,"div",4)(39,"div",5)(40,"h5",19),ne(41,"Categories"),j(),me(42,BX,4,2,"div",20),j()(),H(43,"small",21)(44,"i",9),ne(45,"*"),j(),ne(46," Required "),j(),me(47,zX,2,2,"button",22),me(48,VX,3,1,"small",23),j()()()()()()),2&n&&(G(5),Cn(r.listingId<0?"Create Listing":"Edit Listing"),G(5),ee("formGroup",r.form),G(12),ee("ngIf",!(null!=r.ps.properties.Quantity&&r.ps.properties.Quantity.includes("One")||null!=r.ps.properties.Frequency&&r.ps.properties.Frequency.includes("Recurring"))),G(1),ee("ngIf",(null==r.ps.properties["Listing Kind"]?null:r.ps.properties["Listing Kind"].includes("Service"))&&(null==r.ps.properties.Frequency?null:r.ps.properties.Frequency.includes("One-Time"))),G(11),ee("ngIf",null==r.ps.properties["Listing Type"]?null:r.ps.properties["Listing Type"].includes("Offline Service")),G(1),ee("ngIf",!(null!=r.ps.properties["Listing Type"]&&r.ps.properties["Listing Type"].includes("Digital Good"))),G(1),ee("ngIf",null==r.ps.properties["Listing Type"]?null:r.ps.properties["Listing Type"].includes("Digital Good")),G(1),ee("ngIf",null==r.ps.properties["Listing Type"]?null:r.ps.properties["Listing Type"].includes("Digital Service")),G(5),ee("ngForOf",r.categories),G(5),ee("ngIf",r.form.getRawValue()),G(1),ee("ngIf",r.error))},dependencies:[to,fr,yp,ma,Wg,Hg,$l,_p,Zg,gp,Md,Pu]}),t})();function LN(e,t,i,n,r,s,d){try{var m=e[s](d),b=m.value}catch(E){return void i(E)}m.done?t(b):Promise.resolve(b).then(n,r)}function BN(e){return function(){var t=this,i=arguments;return new Promise(function(n,r){var s=e.apply(t,i);function d(b){LN(s,n,r,d,m,"next",b)}function m(b){LN(s,n,r,d,m,"throw",b)}d(void 0)})}}function UX(e,t){if(1&e){const i=zt();H(0,"button",27),nt("click",function(){return _e(i),Ie(ue(5).selected=null)}),ne(1," Clear Date Selection "),j()}}function $X(e,t){if(1&e){const i=zt();H(0,"div")(1,"mat-card",24)(2,"mat-calendar",25),nt("selectedChange",function(r){return _e(i),Ie(ue(4).selected=r)}),j()(),me(3,UX,2,0,"button",26),j()}if(2&e){const i=ue(4);G(2),ee("selected",i.selected),G(1),ee("ngIf",i.selected)}}function HX(e,t){1&e&&(H(0,"div"),Rt(1,"div",28),j())}function GX(e,t){if(1&e){const i=zt();H(0,"label",32)(1,"input",33),nt("ngModelChange",function(r){return Ie(_e(i).$implicit.selected=r)}),j(),ne(2),j()}if(2&e){const i=t.$implicit;ee("for",i.name),G(1),ee("id",i.name)("ngModel",i.selected),G(1),Ft(" ",i.name+(i.selected?" \u2714":"")," ")}}function qX(e,t){if(1&e&&(H(0,"div")(1,"h4",29),ne(2),j(),H(3,"div",30),me(4,GX,3,4,"label",31),j()()),2&e){const i=t.$implicit;G(2),Ft(" ",i[0]," "),G(2),ee("ngForOf",i[1])}}function WX(e,t){if(1&e&&(H(0,"div",20)(1,"div",21)(2,"div",22)(3,"h2"),ne(4,"Filter by"),j(),me(5,$X,4,2,"div",16),me(6,HX,2,0,"div",16),me(7,qX,5,2,"div",23),j()()()),2&e){const i=ue(3);G(5),ee("ngIf",null==i.ps.properties["Listing Kind"]?null:i.ps.properties["Listing Kind"].includes("Service")),G(1),ee("ngIf",null==i.ps.properties["Listing Type"]?null:i.ps.properties["Listing Type"].includes("Offline Service")),G(1),ee("ngForOf",i.categories)}}function ZX(e,t){if(1&e&&(H(0,"option",34),ne(1),j()),2&e){const i=t.$implicit;ee("value",t.index),G(1),Ft(" ",i.name," ")}}function YX(e,t){if(1&e&&(H(0,"i"),ne(1),j()),2&e){const i=ue().ngIf;G(1),Cg("",i.length," result",i.length>1?"s":"","")}}function XX(e,t){1&e&&(H(0,"i"),ne(1,"Loading Listings..."),j())}function KX(e,t){if(1&e){const i=zt();H(0,"button",44),nt("click",function(){const s=_e(i).index,d=ue(5);return d.pageLimitIndex=s,Ie(d.currentPage=1)}),ne(1),j()}if(2&e){const i=t.$implicit,n=t.index;Er("btn btn"+(ue(5).pageLimitIndex===n?"":"-outline")+"-secondary"),G(1),Ft(" ",i," ")}}function QX(e,t){if(1&e){const i=zt();H(0,"div",11)(1,"div",3)(2,"div",11)(3,"div",36)(4,"label",37),ne(5," Items Per Page: "),j(),H(6,"div",38),me(7,KX,2,3,"button",39),j()()(),H(8,"div",11)(9,"div",40)(10,"div",8)(11,"button",41),nt("click",function(){_e(i);const r=ue(4);return Ie(r.currentPage=1!==r.currentPage?r.currentPage-1:r.currentPage)}),ne(12," < "),j()(),H(13,"input",42),nt("ngModelChange",function(r){return _e(i),Ie(ue(4).currentPage=r)}),j(),H(14,"div",43)(15,"button",41),nt("click",function(){_e(i);const r=ue(2).ngIf,s=ue(2);return Ie(s.currentPage=s.currentPage!==s.maxPage(r)?s.currentPage+1:s.currentPage)}),ne(16," > "),j()()()()()()}if(2&e){const i=ue(2).ngIf,n=ue(2);G(7),ee("ngForOf",n.pageLimitOption),G(6),ee("max",n.maxPage(i))("ngModel",n.currentPage)}}function JX(e,t){1&e&&me(0,QX,17,3,"div",35),2&e&&ee("ngIf",ue().ngIf.length>10)}function eK(e,t){1&e&&vg(0)}const zN=function(e){return["/listings","details",e]};function tK(e,t){if(1&e&&(H(0,"div",53),Rt(1,"img",54),j()),2&e){const i=ue().$implicit,n=ue(4);ee("routerLink",$a(3,zN,i.listingID)),G(1),ee("src",i.picture?i.picture:n.image.getPlaceholderImage(),cs)("alt",i.name)}}function nK(e,t){1&e&&(H(0,"b",55),ne(1," (YOURS) "),j())}function iK(e,t){1&e&&(H(0,"b",56),ne(1," (CANCELLED) "),j())}function rK(e,t){1&e&&(H(0,"b",56),ne(1," (SOLD OUT) "),j())}function oK(e,t){if(1&e&&(H(0,"span")(1,"span",58),ne(2," \u2605 "),j(),ne(3," \u2605 "),j()),2&e){const i=t.fill;Er("rating-star-back"+(100===i?"-filled":"")),G(1),Jr("width:"+i+"%")}}function sK(e,t){if(1&e){const i=zt();H(0,"div")(1,"ngb-rating",57),nt("rateChange",function(r){return _e(i),Ie(ue().$implicit.avgScore=r)}),me(2,oK,4,4,"ng-template"),j(),ne(3),j()}if(2&e){const i=ue().$implicit;G(1),ee("rate",i.avgScore),G(2),Ft(" (",i.reviewAmount,") ")}}function aK(e,t){if(1&e&&(H(0,"div"),ne(1,"Quantity Available: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Cn(i.availableAssets)}}function lK(e,t){if(1&e&&(H(0,"div"),ne(1,"Date: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Cn(i.date)}}function cK(e,t){if(1&e&&(H(0,"div"),ne(1,"Location: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Cn(i.location)}}function dK(e,t){if(1&e&&(H(0,"div"),ne(1,"Offered by: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Cn(i.organisation)}}function uK(e,t){if(1&e&&(H(0,"div"),ne(1,"Offered by: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Cn(i.userName)}}function hK(e,t){1&e&&(H(0,"div")(1,"b"),ne(2,"No Listings Found"),j()())}function pK(e,t){if(1&e&&(H(0,"div",46)(1,"div",47),me(2,tK,2,5,"div",48),H(3,"div",5)(4,"div",22)(5,"div",47)(6,"div",49)(7,"h5",50),ne(8),me(9,nK,2,0,"b",51),me(10,iK,2,0,"b",52),me(11,rK,2,0,"b",52),j(),H(12,"div")(13,"div"),ne(14," categories: "),H(15,"b"),ne(16),j()(),me(17,sK,4,2,"div",16),me(18,aK,4,1,"div",16),me(19,lK,4,1,"div",16),me(20,cK,4,1,"div",16),me(21,dK,4,1,"div",16),me(22,uK,4,1,"div",16),j()(),H(23,"div",11)(24,"h2")(25,"i"),ne(26),j()()()()()()(),me(27,hK,3,0,"div",16),j()),2&e){const i=t.$implicit,n=ue(2).ngIf,r=ue(2);G(2),ee("ngIf",!(null!=r.ps.properties["Listing Type"]&&r.ps.properties["Listing Type"].includes("Digital Good"))),G(4),ee("routerLink",$a(15,zN,i.listingID)),G(2),Ft("",i.name," "),G(1),ee("ngIf",r.user.getId()===i.userID),G(1),ee("ngIf","cancelled"===i.status),G(1),ee("ngIf",0===i.availableAssets),G(5),Cn(r.formatCategories(i.categories)),G(1),ee("ngIf",i.avgScore&&i.reviewAmount&&(null==r.ps.properties["Review Of"]?null:r.ps.properties["Review Of"].includes("Of Listing"))),G(1),ee("ngIf",i.availableAssets&&(null==r.ps.properties.Quantity?null:r.ps.properties.Quantity.includes("Many"))),G(1),ee("ngIf",i.date),G(1),ee("ngIf",i.location),G(1),ee("ngIf",i.organisation),G(1),ee("ngIf",!i.organisation),G(4),Ft("\u20ac ",i.price,""),G(1),ee("ngIf",void 0!==n&&0===n.length)}}function fK(e,t){if(1&e&&(H(0,"div",5),me(1,pK,28,17,"div",45),j()),2&e){const i=t.ngIf,n=ue().ngIf,r=ue(2);G(1),ee("ngForOf",n.slice(i*(r.currentPage-1),i*(r.currentPage-1)+i))}}function mK(e,t){1&e&&vg(0)}function _K(e,t){if(1&e&&(H(0,"div",3),Rt(1,"div",5),me(2,mK,1,0,"ng-container",18),j()),2&e){ue();const i=Ho(24);G(2),ee("ngTemplateOutlet",i)}}function gK(e,t){if(1&e){const i=zt();H(0,"div",3),me(1,WX,8,3,"div",4),H(2,"div",5)(3,"div",6)(4,"div",3)(5,"div",5)(6,"div",7)(7,"div",8)(8,"span",9),ne(9," \u{1f50e} "),j()(),H(10,"input",10),nt("ngModelChange",function(r){return _e(i),Ie(ue(2).searchTerm=r)}),j()()(),H(11,"div",11)(12,"div",7)(13,"div",8)(14,"label",12),ne(15," Order By "),j()(),H(16,"select",13),nt("ngModelChange",function(r){return _e(i),Ie(ue(2).sortCol=r)}),me(17,ZX,2,2,"option",14),j()()()(),H(18,"div",3)(19,"div",5)(20,"p",15),me(21,YX,2,2,"i",16),me(22,XX,2,0,"i",16),j()(),me(23,JX,1,1,"ng-template",null,17,us),me(25,eK,1,0,"ng-container",18),j(),H(26,"div",3),me(27,fK,2,1,"div",19),me(28,_K,3,1,"div",2),j()()()()}if(2&e){const i=t.ngIf,n=Ho(24),r=ue(2);G(1),ee("ngIf",!r.isMobile),G(9),ee("ngModel",r.searchTerm),G(6),ee("ngModel",r.sortCol),G(1),ee("ngForOf",r.sortCols),G(4),ee("ngIf",!r.loading),G(1),ee("ngIf",r.loading),G(3),ee("ngTemplateOutlet",n),G(2),ee("ngIf",r.pageLimitOption[r.pageLimitIndex]),G(1),ee("ngIf",i.length>0)}}function yK(e,t){if(1&e&&(H(0,"div",1),me(1,gK,29,9,"div",2),j()),2&e){const i=ue();G(1),ee("ngIf",i.filteredListings())}}let vK=(()=>{var e;class t{constructor(n,r,s,d,m,b,E){this.db=n,this.user=r,this.route=s,this.image=d,this.router=m,this.platform=b,this.ps=E,this.activeListings=!0,this.hasCancelled=!1,this.listings=[],this.categories=[],this.transactions=!1,this.loading=!0,this.searchTerm="",this.sortCol=4,this.sortCols=[{name:"Name: A -> Z",sortFunc:(I,O)=>(I.name?I.name:"").localeCompare(O.name?O.name:"")},{name:"Name: Z -> A",sortFunc:(I,O)=>-(I.name?I.name:"").localeCompare(O.name?O.name:"")},{name:"Available assets: Low -> High",sortFunc:(I,O)=>I.availableAssets-O.availableAssets},{name:"Available assets: High -> Low",sortFunc:(I,O)=>O.availableAssets-I.availableAssets},{name:"Date: Recent -> Oldest",sortFunc:(I,O)=>-(I.date?I.date:"").localeCompare(O.date?O.date:"")},{name:"Date: Oldest -> Recent",sortFunc:(I,O)=>(I.date?I.date:"").localeCompare(O.date?O.date:"")},{name:"Price: Low -> High",sortFunc:(I,O)=>I.price-O.price},{name:"Price: High -> Low",sortFunc:(I,O)=>O.price-I.price},{name:"Rating: Best -> Worst",sortFunc:(I,O)=>O.avgScore-I.avgScore},{name:"Rating: Worst -> Best",sortFunc:(I,O)=>I.avgScore-O.avgScore}],this.rating=0,this.hoverRating=0,this.pageLimitOption=[10,20,50],this.pageLimitIndex=1,this.currentPage=1,this.maxPage=I=>Math.ceil(I.length/this.pageLimitOption[this.pageLimitIndex]),this.filteredListings=()=>{let I=this.categories.map(O=>[O[0],O[1].filter(q=>q.selected).map(q=>q.name)]);return this.listings.filter(O=>I.every(q=>0===q[1].length||q[1].some(Y=>O.categories.includes(Y)))).filter(O=>Object.values(O).join("").toString().toLowerCase().indexOf(this.searchTerm.toString().toLowerCase())>-1&&(!this.selected||this.selected.getTime()===new Date(O.date).setHours(0,0,0,0))).sort(this.transactions?(O,q)=>1:this.sortCols[this.sortCol].sortFunc)},this.form=new Sd({comment:new On("")})}ngOnInit(){this.loading=!0,this.isMobile=this.platform.ANDROID||this.platform.IOS,this.db.getCategories().then(n=>{this.categories=Object.entries(n).map(([r,s])=>[r,s.map(d=>({name:d,selected:!1}))])}),this.db.getActiveListings().then(n=>{this.listings=n.listings,this.hasCancelled=!1,this.loading=!1,this.ps.properties["Listing Type"]?.includes("Offline Service")&&this.renderMap()})}renderMap(){var n=this;return BN(function*(){n.map=void 0;let r=[];for(const d of n.listings)if(d.location){let b=(yield n.db.geoLocate(d.location)).features[0].center;n.map||(n.map=new j0.Map({accessToken:w0_mapbox_accessToken,container:"map",style:"mapbox://styles/mapbox/streets-v11",zoom:13,center:b})),r.push(b),(new j0.Marker).setLngLat(b).addTo(n.map).getElement().addEventListener("click",()=>{n.router.navigateByUrl(`/listings/details/${d.listingID}`)})}const s=new j0.LngLatBounds(r[0],r[0]);for(const d of r)s.extend(d);n.map.fitBounds(s,{padding:50})})()}formatCategories(n){return n.replace(/;/g,", ")}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(hs),oe(Bc),oe(Ga),oe(Cm),oe(Lr),oe(Go),oe(xp))},e.\u0275cmp=In({type:e,selectors:[["app-listings"]],decls:1,vars:1,consts:[["style","margin: 10px;",4,"ngIf"],[2,"margin","10px"],["class","row",4,"ngIf"],[1,"row"],["class","col-3",4,"ngIf"],[1,"col"],[1,"container"],[1,"input-group","mb-3"],[1,"input-group-prepend"],["id","basic-addon1",1,"input-group-text"],["type","text","placeholder","Search",1,"form-control",3,"ngModel","ngModelChange"],[1,"col-auto"],["for","orderBySelect",1,"input-group-text"],["id","orderBySelect",1,"custom-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[2,"margin","0px"],[4,"ngIf"],["pages",""],[4,"ngTemplateOutlet"],["class","col",4,"ngIf"],[1,"col-3"],[1,"card"],[1,"card-body"],[4,"ngFor","ngForOf"],[2,"width","100%","padding-top","0px"],[3,"selected","selectedChange"],["type","button","class","btn btn-outline-danger btn-block",3,"click",4,"ngIf"],["type","button",1,"btn","btn-outline-danger","btn-block",3,"click"],["id","map",1,"map",2,"height","300px"],[1,"display-6",2,"margin-top","10px"],["data-toggle","buttons",1,"btn-group-toggle","btn-group-vertical",2,"width","100%"],["class","btn btn-outline-dark btn-block",3,"for",4,"ngFor","ngForOf"],[1,"btn","btn-outline-dark","btn-block",3,"for"],["type","checkbox","autocomplete","off",1,"btn-check",3,"id","ngModel","ngModelChange"],[3,"value"],["class","col-auto",4,"ngIf"],[1,"form-group"],["for","itemsPerPage",2,"margin-right","3px"],["role","group","aria-label","First group","id","itemsPerPage",1,"btn-group","mr-2"],[3,"class","click",4,"ngFor","ngForOf"],["id","currPage",1,"input-group","mb-3"],[1,"btn","btn-outline-secondary",3,"click"],["type","number","min","1",1,"form-control",3,"max","ngModel","ngModelChange"],[1,"input-group-append"],[3,"click"],["class","card","style","margin-bottom: 5px;",4,"ngFor","ngForOf"],[1,"card",2,"margin-bottom","5px"],[1,"row","no-gutters"],["class","col-auto","style","cursor:pointer;",3,"routerLink",4,"ngIf"],[1,"col",2,"cursor","pointer",3,"routerLink"],[1,"card-title"],["style","color: blue;",4,"ngIf"],["style","color: red;",4,"ngIf"],[1,"col-auto",2,"cursor","pointer",3,"routerLink"],[1,"card-img-left",2,"width","318px","height","200",3,"src","alt"],[2,"color","blue"],[2,"color","red"],["max","5","readonly","true",3,"rate","rateChange"],[1,"rating-star-front"]],template:function(n,r){1&n&&me(0,yK,2,1,"div",0),2&n&&ee("ngIf",r.ps.properties)},dependencies:[to,fr,Dd,Fc,Hw,wT,DT,ma,Wg,Hg,A0,$l,Zg,I0,gp,Tw],styles:[".rating-star-back[_ngcontent-%COMP%], .rating-star-back-filled[_ngcontent-%COMP%]{position:relative;display:inline-block;font-size:20px;color:gray}.rating-star-back-filled[_ngcontent-%COMP%]{color:#fab81e}.rating-star-front[_ngcontent-%COMP%]{position:absolute;display:inline-block;overflow:hidden;color:#fab81e}"]}),t})();function bK(e,t){if(1&e){const i=zt();H(0,"button",26),nt("click",function(){return _e(i),Ie(ue(4).selected=null)}),ne(1," Clear Date Selection "),j()}}function xK(e,t){if(1&e){const i=zt();H(0,"div")(1,"mat-card",23)(2,"mat-calendar",24),nt("selectedChange",function(r){return _e(i),Ie(ue(3).selected=r)}),j()(),me(3,bK,2,0,"button",25),j()}if(2&e){const i=ue(3);G(2),ee("selected",i.selected),G(1),ee("ngIf",i.selected)}}function wK(e,t){if(1&e){const i=zt();H(0,"label",30)(1,"input",31),nt("ngModelChange",function(r){return Ie(_e(i).$implicit.selected=r)}),j(),ne(2),j()}if(2&e){const i=t.$implicit;ee("for",i.name),G(1),ee("id",i.name)("ngModel",i.selected),G(1),Ft(" ",i.name+(i.selected?" \u2714":"")," ")}}function CK(e,t){if(1&e&&(H(0,"div")(1,"h4",27),ne(2),j(),H(3,"div",28),me(4,wK,3,4,"label",29),j()()),2&e){const i=t.$implicit;G(2),Ft(" ",i[0]," "),G(2),ee("ngForOf",i[1])}}function DK(e,t){if(1&e&&(H(0,"div",18)(1,"div",19)(2,"div",20)(3,"h2"),ne(4,"Filter by"),j(),me(5,xK,4,2,"div",21),me(6,CK,5,2,"div",22),j()()()),2&e){const i=ue(2);G(5),ee("ngIf",null==i.ps.properties["Listing Kind"]?null:i.ps.properties["Listing Kind"].includes("Service")),G(1),ee("ngForOf",i.categories)}}function EK(e,t){if(1&e&&(H(0,"option",32),ne(1),j()),2&e){const i=t.$implicit;ee("value",t.index),G(1),Ft(" ",i.name," ")}}function TK(e,t){if(1&e){const i=zt();H(0,"button",42),nt("click",function(){const s=_e(i).index,d=ue(4);return d.pageLimitIndex=s,Ie(d.currentPage=1)}),ne(1),j()}if(2&e){const i=t.$implicit,n=t.index;Er("btn btn"+(ue(4).pageLimitIndex===n?"":"-outline")+"-secondary"),G(1),Ft(" ",i," ")}}function SK(e,t){if(1&e){const i=zt();H(0,"div",10)(1,"div",2)(2,"div",10)(3,"div",34)(4,"label",35),ne(5," Items Per Page: "),j(),H(6,"div",36),me(7,TK,2,3,"button",37),j()()(),H(8,"div",10)(9,"div",38)(10,"div",7)(11,"button",39),nt("click",function(){_e(i);const r=ue(3);return Ie(r.currentPage=1!==r.currentPage?r.currentPage-1:r.currentPage)}),ne(12," < "),j()(),H(13,"input",40),nt("ngModelChange",function(r){return _e(i),Ie(ue(3).currentPage=r)}),j(),H(14,"div",41)(15,"button",39),nt("click",function(){_e(i);const r=ue(2).ngIf,s=ue();return Ie(s.currentPage=s.currentPage!==s.maxPage(r)?s.currentPage+1:s.currentPage)}),ne(16," > "),j()()()()()()}if(2&e){const i=ue(2).ngIf,n=ue();G(7),ee("ngForOf",n.pageLimitOption),G(6),ee("max",n.maxPage(i))("ngModel",n.currentPage)}}function MK(e,t){1&e&&me(0,SK,17,3,"div",33),2&e&&ee("ngIf",ue().ngIf.length>10)}function AK(e,t){1&e&&vg(0)}const VN=function(e){return["/listings","details",e]};function IK(e,t){if(1&e&&(H(0,"div",51),Rt(1,"img",52),j()),2&e){const i=ue().$implicit,n=ue(3);ee("routerLink",$a(3,VN,i.listingID)),G(1),ee("src",i.picture?i.picture:n.image.getPlaceholderImage(),cs)("alt",i.name)}}function RK(e,t){1&e&&(H(0,"b",53),ne(1," (YOURS) "),j())}function kK(e,t){1&e&&(H(0,"b",54),ne(1," (CANCELLED) "),j())}function PK(e,t){1&e&&(H(0,"b",54),ne(1," (SOLD OUT) "),j())}function OK(e,t){if(1&e&&(H(0,"span")(1,"span",56),ne(2," \u2605 "),j(),ne(3," \u2605 "),j()),2&e){const i=t.fill;Er("rating-star-back"+(100===i?"-filled":"")),G(1),Jr("width:"+i+"%")}}function FK(e,t){if(1&e){const i=zt();H(0,"div"),ne(1,"Rating: "),H(2,"ngb-rating",55),nt("rateChange",function(r){return _e(i),Ie(ue().$implicit.avgScore=r)}),me(3,OK,4,4,"ng-template"),j(),ne(4),j()}if(2&e){const i=ue().$implicit;G(2),ee("rate",i.avgScore),G(2),Ft(" (",i.reviewAmount,") ")}}function NK(e,t){if(1&e&&(H(0,"div"),ne(1,"Quantity Available: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Cn(i.availableAssets)}}function LK(e,t){if(1&e&&(H(0,"div"),ne(1,"Date: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Cn(i.date)}}function BK(e,t){if(1&e&&(H(0,"div"),ne(1,"Location: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Cn(i.location)}}function zK(e,t){1&e&&(H(0,"div")(1,"b"),ne(2,"No Listings Found"),j()())}function VK(e,t){if(1&e&&(H(0,"div",44)(1,"div",45),me(2,IK,2,5,"div",46),H(3,"div",4)(4,"div",20)(5,"div",45)(6,"div",47)(7,"h5",48),ne(8),me(9,RK,2,0,"b",49),me(10,kK,2,0,"b",50),me(11,PK,2,0,"b",50),j(),H(12,"div")(13,"div"),ne(14," categories: "),H(15,"b"),ne(16),j()(),me(17,FK,5,2,"div",21),me(18,NK,4,1,"div",21),me(19,LK,4,1,"div",21),me(20,BK,4,1,"div",21),j()(),H(21,"div",10)(22,"h2")(23,"i"),ne(24),j()()()()()()(),me(25,zK,3,0,"div",21),j()),2&e){const i=t.$implicit,n=ue(2).ngIf,r=ue();G(2),ee("ngIf",!(null!=r.ps.properties["Listing Type"]&&r.ps.properties["Listing Type"].includes("Digital Good"))),G(4),ee("routerLink",$a(13,VN,i.listingID)),G(2),Ft("",i.name," "),G(1),ee("ngIf",r.user.getId()===i.userID),G(1),ee("ngIf","cancelled"===i.status),G(1),ee("ngIf",0===i.availableAssets),G(5),Cn(i.categories),G(1),ee("ngIf",i.avgScore&&i.reviewAmount&&(null==r.ps.properties["Review By"]?null:r.ps.properties["Review By"].includes("By Customer"))),G(1),ee("ngIf",i.availableAssets&&(null==r.ps.properties.Quantity?null:r.ps.properties.Quantity.includes("Many"))),G(1),ee("ngIf",i.date),G(1),ee("ngIf",i.location),G(4),Ft("\u20ac ",i.price,""),G(1),ee("ngIf",void 0!==n&&0===n.length)}}function jK(e,t){if(1&e&&(H(0,"div",4),me(1,VK,26,15,"div",43),j()),2&e){const i=t.ngIf,n=ue().ngIf,r=ue();G(1),ee("ngForOf",n.slice(i*(r.currentPage-1),i*(r.currentPage-1)+i))}}function UK(e,t){1&e&&vg(0)}function $K(e,t){if(1&e&&(H(0,"div",2),Rt(1,"div",4),me(2,UK,1,0,"ng-container",16),j()),2&e){ue();const i=Ho(24);G(2),ee("ngTemplateOutlet",i)}}function HK(e,t){if(1&e){const i=zt();H(0,"div",2),me(1,DK,7,2,"div",3),H(2,"div",4)(3,"div",5)(4,"div",2)(5,"div",4)(6,"div",6)(7,"div",7)(8,"span",8),ne(9," \u{1f50e} "),j()(),H(10,"input",9),nt("ngModelChange",function(r){return _e(i),Ie(ue().searchTerm=r)}),j()()(),H(11,"div",10)(12,"div",6)(13,"div",7)(14,"label",11),ne(15," Order By "),j()(),H(16,"select",12),nt("ngModelChange",function(r){return _e(i),Ie(ue().sortCol=r)}),me(17,EK,2,2,"option",13),j()()()(),H(18,"div",2)(19,"div",4)(20,"p",14)(21,"i"),ne(22),j()()(),me(23,MK,1,1,"ng-template",null,15,us),me(25,AK,1,0,"ng-container",16),j(),H(26,"div",2),me(27,jK,2,1,"div",17),me(28,$K,3,1,"div",1),j()()()()}if(2&e){const i=t.ngIf,n=Ho(24),r=ue();G(1),ee("ngIf",!r.isMobile),G(9),ee("ngModel",r.searchTerm),G(6),ee("ngModel",r.sortCol),G(1),ee("ngForOf",r.sortCols),G(5),Cg("",i.length," result",i.length>1?"s":""," "),G(3),ee("ngTemplateOutlet",n),G(2),ee("ngIf",r.pageLimitOption[r.pageLimitIndex]),G(1),ee("ngIf",i.length>0)}}let GK=(()=>{var e;class t{constructor(n,r,s,d,m,b,E){this.db=n,this.user=r,this.route=s,this.image=d,this.router=m,this.platform=b,this.ps=E,this.listings=[],this.categories=[],this.transactions=!1,this.properties={},this.searchTerm="",this.sortCol=4,this.sortCols=[{name:"Name: A -> Z",sortFunc:(I,O)=>(I.name?I.name:"").localeCompare(O.name?O.name:"")},{name:"Name: Z -> A",sortFunc:(I,O)=>-(I.name?I.name:"").localeCompare(O.name?O.name:"")},{name:"Available assets: Low -> High",sortFunc:(I,O)=>I.availableAssets-O.availableAssets},{name:"Available assets: High -> Low",sortFunc:(I,O)=>O.availableAssets-I.availableAssets},{name:"Date: Recent -> Oldest",sortFunc:(I,O)=>-(I.date?I.date:"").localeCompare(O.date?O.date:"")},{name:"Date: Oldest -> Recent",sortFunc:(I,O)=>(I.date?I.date:"").localeCompare(O.date?O.date:"")},{name:"Price: Low -> High",sortFunc:(I,O)=>I.price-O.price},{name:"Price: High -> Low",sortFunc:(I,O)=>O.price-I.price},{name:"Rating: Best -> Worst",sortFunc:(I,O)=>O.avgScore-I.avgScore},{name:"Rating: Worst -> Best",sortFunc:(I,O)=>I.avgScore-O.avgScore}],this.rating=0,this.hoverRating=0,this.pageLimitOption=[10,20,50],this.pageLimitIndex=1,this.currentPage=1,this.maxPage=I=>Math.ceil(I.length/this.pageLimitOption[this.pageLimitIndex]),this.filteredListings=()=>{let I=this.categories.map(O=>O[1]).reduce((O,q)=>O.concat(q),[]).filter(O=>O.selected).map(O=>O.name);return this.listings.filter(O=>I.every(q=>O.categories.includes(q))).filter(O=>Object.values(O).join("").toString().toLowerCase().indexOf(this.searchTerm.toString().toLowerCase())>-1&&(!this.selected||this.selected.getTime()===new Date(O.date).setHours(0,0,0,0))).sort(this.transactions?(O,q)=>1:this.sortCols[this.sortCol].sortFunc)},this.form=new Sd({comment:new On("")})}ngOnInit(){this.isMobile=this.platform.ANDROID||this.platform.IOS,this.db.getCategories().then(n=>{this.categories=Object.entries(n).map(([r,s])=>[r,s.map(d=>({name:d,selected:!1}))])}),this.route.queryParamMap.subscribe(n=>{this.db.getUserListings(n.params.id).then(s=>{this.listings=s.listings})})}formatCategories(n){return n.replace(/;/g,", ")}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(hs),oe(Bc),oe(Ga),oe(Cm),oe(Lr),oe(Go),oe(xp))},e.\u0275cmp=In({type:e,selectors:[["app-mylistings"]],decls:2,vars:1,consts:[[2,"margin","10px"],["class","row",4,"ngIf"],[1,"row"],["class","col-3",4,"ngIf"],[1,"col"],[1,"container"],[1,"input-group","mb-3"],[1,"input-group-prepend"],["id","basic-addon1",1,"input-group-text"],["type","text","placeholder","Search",1,"form-control",3,"ngModel","ngModelChange"],[1,"col-auto"],["for","orderBySelect",1,"input-group-text"],["id","orderBySelect",1,"custom-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[2,"margin","0px"],["pages",""],[4,"ngTemplateOutlet"],["class","col",4,"ngIf"],[1,"col-3"],[1,"card"],[1,"card-body"],[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"width","100%","padding-top","0px"],[3,"selected","selectedChange"],["type","button","class","btn btn-outline-danger btn-block",3,"click",4,"ngIf"],["type","button",1,"btn","btn-outline-danger","btn-block",3,"click"],[1,"display-6",2,"margin-top","10px"],["data-toggle","buttons",1,"btn-group-toggle","btn-group-vertical",2,"width","100%"],["class","btn btn-outline-dark btn-block",3,"for",4,"ngFor","ngForOf"],[1,"btn","btn-outline-dark","btn-block",3,"for"],["type","checkbox","autocomplete","off",1,"btn-check",3,"id","ngModel","ngModelChange"],[3,"value"],["class","col-auto",4,"ngIf"],[1,"form-group"],["for","itemsPerPage",2,"margin-right","3px"],["role","group","aria-label","First group","id","itemsPerPage",1,"btn-group","mr-2"],[3,"class","click",4,"ngFor","ngForOf"],["id","currPage",1,"input-group","mb-3"],[1,"btn","btn-outline-secondary",3,"click"],["type","number","min","1",1,"form-control",3,"max","ngModel","ngModelChange"],[1,"input-group-append"],[3,"click"],["class","card","style","margin-bottom: 5px;",4,"ngFor","ngForOf"],[1,"card",2,"margin-bottom","5px"],[1,"row","no-gutters"],["class","col-auto","style","cursor:pointer;",3,"routerLink",4,"ngIf"],[1,"col",2,"cursor","pointer",3,"routerLink"],[1,"card-title"],["style","color: blue;",4,"ngIf"],["style","color: red;",4,"ngIf"],[1,"col-auto",2,"cursor","pointer",3,"routerLink"],[1,"card-img-left",2,"width","318px","height","200",3,"src","alt"],[2,"color","blue"],[2,"color","red"],["max","5","readonly","true",3,"rate","rateChange"],[1,"rating-star-front"]],template:function(n,r){1&n&&(H(0,"div",0),me(1,HK,29,9,"div",1),j()),2&n&&(G(1),ee("ngIf",r.filteredListings()))},dependencies:[to,fr,Dd,Fc,Hw,wT,DT,ma,Wg,Hg,A0,$l,Zg,I0,gp,Tw]}),t})();function qK(e,t){if(1&e&&(H(0,"small",18)(1,"i",19),ne(2),j()()),2&e){const i=ue();G(2),Cn(i.error)}}let WK=(()=>{var e;class t{constructor(n,r,s){this.db=n,this.user=r,this.location=s,this.error="",this.form=new Sd({login:new On,password:new On,keepSignedIn:new On})}ngOnInit(){}logIn(){let n=this.form.getRawValue();this.db.signIn(n.login,n.password).then(r=>{this.user.storeCookie=n.keepSignedIn,this.user.setUser(r),this.location.back()}).catch(r=>this.error=r.error.message)}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(hs),oe(Bc),oe(Kv))},e.\u0275cmp=In({type:e,selectors:[["app-login"]],decls:28,vars:3,consts:[[2,"margin","10px"],[1,"container"],[1,"row"],[1,"offset-md-2","col-md-8","offset-lg-3","col-lg-6"],[1,"card"],[1,"card-body"],[3,"formGroup","ngSubmit"],[1,"form-group"],["for","inputEmail"],["type","text","id","inputEmail","placeholder","Enter Email / Username","formControlName","login",1,"form-control"],["for","inputPassword"],["type","password","id","inputPassword","placeholder","Password","formControlName","password",1,"form-control"],[1,"form-check"],["type","checkbox","id","checkBox","formControlName","keepSignedIn",1,"form-check-input"],["for","checkBox",1,"form-check-label"],["class","form-text",4,"ngIf"],["type","submit",1,"btn","btn-primary","btn-block",3,"disabled"],["routerLink","/signup"],[1,"form-text"],[2,"color","red"]],template:function(n,r){1&n&&(H(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1"),ne(5,"Log In"),j(),H(6,"div",4)(7,"div",5)(8,"form",6),nt("ngSubmit",function(){return r.logIn()}),H(9,"div",7)(10,"label",8),ne(11," Email address / Username "),j(),Rt(12,"input",9),j(),H(13,"div",7)(14,"label",10),ne(15," Password "),j(),Rt(16,"input",11),j(),H(17,"div",12),Rt(18,"input",13),H(19,"label",14),ne(20," Keep me signed in "),j()(),H(21,"div"),me(22,qK,3,1,"small",15),j(),H(23,"button",16),ne(24," LOG IN "),j(),H(25,"div")(26,"a",17),ne(27," Create new account "),j()()()()()()()()()),2&n&&(G(8),ee("formGroup",r.form),G(14),ee("ngIf",r.error),G(1),ee("disabled",!(r.form.getRawValue().login&&r.form.getRawValue().password)))},dependencies:[fr,Fc,yp,ma,Hg,$l,_p,Md,Pu]}),t})();const ZK=function(){return["red","red","orange","green"]},YK=function(){return["Very weak","Weak","Medium","Strong"]};function XK(e,t){if(1&e&&(H(0,"i"),ne(1),j()),2&e){const i=t.ngIf;Jr("color: "+Tg(3,ZK)[i-1]),G(1),Ft(" ","\u2022".repeat(i)+" "+Tg(4,YK)[i-1]," ")}}function KK(e,t){if(1&e&&(H(0,"small",16),me(1,XK,2,5,"i",17),j()),2&e){const i=ue().ngIf,n=ue();G(1),ee("ngIf",n.user.passwordStrength(i.newPassword))}}function QK(e,t){1&e&&(H(0,"small",16)(1,"i",18),ne(2,"Passwords don't match"),j()())}function JK(e,t){if(1&e&&(H(0,"small",16)(1,"i",18),ne(2),j()()),2&e){const i=ue(2);G(2),Cn(i.error)}}function eQ(e,t){if(1&e){const i=zt();H(0,"form",7),nt("ngSubmit",function(){return _e(i),Ie(ue().changePassword())}),H(1,"div",8)(2,"label",9),ne(3," Old Password "),j(),Rt(4,"input",10),j(),H(5,"div",8)(6,"label",9),ne(7," New Password "),j(),Rt(8,"input",11),me(9,KK,2,1,"small",12),j(),H(10,"div",8)(11,"label",13),ne(12," Repeat New Password "),j(),Rt(13,"input",14),me(14,QK,3,0,"small",12),j(),H(15,"button",15),ne(16," CHANGE PASSWORD "),j(),me(17,JK,3,1,"small",12),j()}if(2&e){const i=t.ngIf,n=ue();ee("formGroup",n.form),G(9),ee("ngIf",i.newPassword),G(5),ee("ngIf",i.oldPassword&&i.newPassword&&i.repeatPassword&&i.newPassword!==i.repeatPassword),G(1),ee("disabled",!(i.oldPassword&&i.newPassword&&i.repeatPassword)),G(2),ee("ngIf",n.error)}}let tQ=(()=>{var e;class t{constructor(n,r,s){this.db=n,this.user=r,this.route=s,this.error="",r.isLoggedIn()||this.route.navigateByUrl("/login"),this.form=new Sd({oldPassword:new On,newPassword:new On,repeatPassword:new On})}ngOnInit(){}changePassword(){let n=this.form.getRawValue();this.db.changePassword(n.oldPassword,n.newPassword,this.user.getLoginToken()).then(r=>{this.route.navigateByUrl("/profile")}).catch(r=>this.error=r.error.message)}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(hs),oe(Bc),oe(Lr))},e.\u0275cmp=In({type:e,selectors:[["app-change-password"]],decls:9,vars:1,consts:[[2,"margin","10px"],[1,"container"],[1,"row"],[1,"offset-md-2","col-md-8","offset-lg-3","col-lg-6"],[1,"card"],[1,"card-body"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"form-group"],["for","inputPassword"],["type","password","id","inputPassword","placeholder","Old Password","formControlName","oldPassword",1,"form-control"],["type","password","id","inputPassword","placeholder","New Password","formControlName","newPassword",1,"form-control"],["class","form-text",4,"ngIf"],["for","inputRepeatPassword"],["type","password","id","inputRepeatPassword","placeholder","Repeat New Password","formControlName","repeatPassword",1,"form-control"],["type","submit",1,"btn","btn-primary","btn-block",3,"disabled"],[1,"form-text"],[3,"style",4,"ngIf"],[2,"color","red"]],template:function(n,r){1&n&&(H(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1"),ne(5,"Change password"),j(),H(6,"div",4)(7,"div",5),me(8,eQ,18,5,"form",6),j()()()()()()),2&n&&(G(8),ee("ngIf",r.form.getRawValue()))},dependencies:[fr,yp,ma,$l,_p,Md,Pu]}),t})();function nQ(e,t){1&e&&(H(0,"div",10)(1,"label",29),ne(2," First Name "),j(),Rt(3,"input",30),j())}function iQ(e,t){1&e&&(H(0,"div",10)(1,"label",31),ne(2," Last Name "),j(),Rt(3,"input",32),j())}function rQ(e,t){1&e&&(H(0,"div",10)(1,"label",33),ne(2," Organisation "),j(),Rt(3,"input",34),j())}function oQ(e,t){1&e&&(H(0,"div",10)(1,"label",35),ne(2," Gender "),j(),Rt(3,"input",36),j())}function sQ(e,t){1&e&&(H(0,"div",10)(1,"label",37),ne(2," Birth Date "),j(),Rt(3,"input",38),j())}function aQ(e,t){if(1&e&&(H(0,"div",39),Rt(1,"img",40),j()),2&e){const i=ue();G(1),ee("src",i.imgSrc,cs)}}function lQ(e,t){if(1&e){const i=zt();H(0,"button",41),nt("click",function(){return _e(i),Ie(ue().imgSrc=null)}),ne(1,"Remove picture"),j()}}function cQ(e,t){if(1&e&&(H(0,"small",27)(1,"i",12),ne(2),j()()),2&e){const i=ue();G(2),Cn(i.imgError)}}function dQ(e,t){if(1&e&&(H(0,"small",27)(1,"i",12),ne(2),j()()),2&e){const i=ue();G(2),Cn(i.error)}}let uQ=(()=>{var e;class t{constructor(n,r,s,d,m){this.user=n,this.route=r,this.db=s,this.image=d,this.ps=m,this.properties={},n.isLoggedIn()||this.route.navigateByUrl("/login"),this.form=new Sd({firstName:new On,lastName:new On,organisation:new On,email:new On,userName:new On,gender:new On,address:new On,birthDate:new On,phoneNumber:new On})}ngOnInit(){this.db.getUserData(this.user.getId(),this.user.getLoginToken()).then(n=>{Object.keys(n).forEach(r=>{"profilePicture"===r?this.imgSrc=n[r]:this.form.get(r).setValue(n[r])})}).catch(n=>this.error=n.error.message)}updateProfile(){let n=this.form.getRawValue();n.profilePicture=this.imgSrc,this.db.postUserData(this.user.getId(),this.user.getLoginToken(),n).then(r=>{this.user.setUser({id:this.user.getId(),userName:n.userName,accessToken:this.user.getLoginToken()}),this.route.navigateByUrl("/")}).catch(r=>this.error=r.error.message)}fileSelected(n){if(0===n.target.files.length)return;this.imgError=void 0,this.imgSrc=void 0;let r=n.target.files[0];this.fileName=r.name,this.image.convertFileToJpegBase64(r,s=>{this.imgSrc=s},s=>{this.imgError=s},300,300)}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Bc),oe(Lr),oe(hs),oe(Cm),oe(xp))},e.\u0275cmp=In({type:e,selectors:[["app-profile"]],decls:56,vars:12,consts:[[2,"margin","10px"],[1,"container"],[1,"row"],[1,"offset-md-2","col-md-8","offset-lg-3","col-lg-6"],[1,"col"],["routerLink","/profile/changePassword",1,"btn","btn-block","btn-info"],[1,"card"],[1,"card-body"],[3,"formGroup","ngSubmit"],["class","form-group",4,"ngIf"],[1,"form-group"],["for","inputEmail"],[2,"color","red"],["type","email","id","inputEmail","placeholder","Enter email","formControlName","email",1,"form-control"],["for","inputUsername"],["type","text","id","inputUsername","placeholder","Enter username","formControlName","userName",1,"form-control"],["for","inputAddress"],["type","text","id","inputAddress","placeholder","Enter Address","formControlName","address",1,"form-control"],["for","inputPhoneNumber"],["type","text","id","inputPhoneNumber","placeholder","Enter Phone Number","formControlName","phoneNumber",1,"form-control"],["for","inputImage"],["id","inputImage",1,"custom-file"],["type","file","id","customFile",1,"custom-file-input",3,"change"],["for","customFile",1,"custom-file-label"],["style","display: flex;justify-content: center;",4,"ngIf"],["type","button","class","btn btn-outline-danger btn-block",3,"click",4,"ngIf"],["class","form-text",4,"ngIf"],[1,"form-text"],["type","submit",1,"btn","btn-primary","btn-block",3,"disabled"],["for","inputFirstName"],["type","text","id","inputFirstName","placeholder","Enter First Name","formControlName","firstName",1,"form-control"],["for","inputLastName"],["type","text","id","inputLastName","placeholder","Enter Last Name","formControlName","lastName",1,"form-control"],["for","inputOrganisation"],["type","text","id","inputOrganisation","placeholder","Enter Organisation","formControlName","organisation",1,"form-control"],["for","inputGender"],["type","text","id","inputGender","placeholder","Enter Gender","formControlName","gender",1,"form-control"],["for","inputBirthDate"],["type","date","id","inputBirthDate","placeholder","Enter Birth Date","formControlName","birthDate",1,"form-control"],[2,"display","flex","justify-content","center"],[2,"width","200px","height","200px","border-radius","50%",3,"src"],["type","button",1,"btn","btn-outline-danger","btn-block",3,"click"]],template:function(n,r){1&n&&(H(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",2)(5,"div",4)(6,"h1"),ne(7,"Edit User Data"),j()(),H(8,"div",4)(9,"button",5),ne(10," CHANGE PASSWORD "),j()()(),H(11,"div",6)(12,"div",7)(13,"form",8),nt("ngSubmit",function(){return r.updateProfile()}),me(14,nQ,4,0,"div",9),me(15,iQ,4,0,"div",9),me(16,rQ,4,0,"div",9),H(17,"div",10)(18,"label",11),ne(19," Email Address "),H(20,"i",12),ne(21,"*"),j()(),Rt(22,"input",13),j(),H(23,"div",10)(24,"label",14),ne(25," Username "),H(26,"i",12),ne(27,"*"),j()(),Rt(28,"input",15),j(),me(29,oQ,4,0,"div",9),H(30,"div",10)(31,"label",16),ne(32," Address "),j(),Rt(33,"input",17),j(),me(34,sQ,4,0,"div",9),H(35,"div",10)(36,"label",18),ne(37," Phone number "),j(),Rt(38,"input",19),j(),H(39,"div",10)(40,"label",20),ne(41," Profile picture "),j(),H(42,"div",21)(43,"input",22),nt("change",function(d){return r.fileSelected(d)}),j(),H(44,"label",23),ne(45),j()(),me(46,aQ,2,1,"div",24),me(47,lQ,2,0,"button",25),me(48,cQ,3,1,"small",26),j(),H(49,"small",27)(50,"i",12),ne(51,"*"),j(),ne(52," Required "),j(),H(53,"button",28),ne(54," UPDATE PROFILE "),j(),me(55,dQ,3,1,"small",26),j()()()()()()()),2&n&&(G(13),ee("formGroup",r.form),G(1),ee("ngIf",null==r.ps.properties["User Type"]?null:r.ps.properties["User Type"].includes("Person")),G(1),ee("ngIf",null==r.ps.properties["User Type"]?null:r.ps.properties["User Type"].includes("Person")),G(1),ee("ngIf",null==r.ps.properties["User Type"]?null:r.ps.properties["User Type"].includes("Organisation")),G(13),ee("ngIf",null==r.ps.properties["User Type"]?null:r.ps.properties["User Type"].includes("Person")),G(5),ee("ngIf",null==r.ps.properties["User Type"]?null:r.ps.properties["User Type"].includes("Person")),G(11),Ft(" ",r.fileName?r.fileName:"Choose Image"," "),G(1),ee("ngIf",r.imgSrc),G(1),ee("ngIf",r.imgSrc),G(1),ee("ngIf",r.imgError),G(5),ee("disabled",!r.form.getRawValue().email),G(2),ee("ngIf",r.error))},dependencies:[fr,Fc,yp,ma,$l,_p,Md,Pu]}),t})();function hQ(e,t){1&e&&(H(0,"div",9)(1,"label",33),ne(2," First Name "),j(),Rt(3,"input",34),j())}function pQ(e,t){1&e&&(H(0,"div",9)(1,"label",35),ne(2," Last Name "),j(),Rt(3,"input",36),j())}function fQ(e,t){1&e&&(H(0,"div",9)(1,"label",37),ne(2," Organisation "),j(),Rt(3,"input",38),j())}function mQ(e,t){1&e&&(H(0,"div",9)(1,"label",39),ne(2," Gender "),j(),Rt(3,"input",40),j())}function _Q(e,t){1&e&&(H(0,"div",9)(1,"label",41),ne(2," Birth Date "),j(),Rt(3,"input",42),j())}function gQ(e,t){if(1&e&&(H(0,"div",43),Rt(1,"img",44),j()),2&e){const i=ue(2);G(1),ee("src",i.imgSrc,cs)}}function yQ(e,t){if(1&e){const i=zt();H(0,"button",45),nt("click",function(){return _e(i),Ie(ue(2).imgSrc=null)}),ne(1," Remove picture "),j()}}function vQ(e,t){if(1&e&&(H(0,"small",30)(1,"i",11),ne(2),j()()),2&e){const i=ue(2);G(2),Cn(i.imgError)}}const bQ=function(){return["red","red","orange","green"]},xQ=function(){return["Very weak","Weak","Medium","Strong"]};function wQ(e,t){if(1&e&&(H(0,"i"),ne(1),j()),2&e){const i=t.ngIf;Jr("color: "+Tg(3,bQ)[i-1]),G(1),Ft(" ","\u2022".repeat(i)+" "+Tg(4,xQ)[i-1]," ")}}function CQ(e,t){if(1&e&&(H(0,"small",30),me(1,wQ,2,5,"i",46),j()),2&e){const i=ue().ngIf,n=ue();G(1),ee("ngIf",n.user.passwordStrength(i.password))}}function DQ(e,t){1&e&&(H(0,"small",30)(1,"i",11),ne(2,"Passwords don't match"),j()())}function EQ(e,t){if(1&e&&(H(0,"small",30)(1,"i",11),ne(2),j()()),2&e){const i=ue(2);G(2),Cn(i.error)}}function TQ(e,t){if(1&e){const i=zt();H(0,"form",7),nt("ngSubmit",function(){return _e(i),Ie(ue().signUp())}),me(1,hQ,4,0,"div",8),me(2,pQ,4,0,"div",8),me(3,fQ,4,0,"div",8),H(4,"div",9)(5,"label",10),ne(6," Email Address "),H(7,"i",11),ne(8,"*"),j()(),Rt(9,"input",12),j(),H(10,"div",9)(11,"label",13),ne(12," Username "),H(13,"i",11),ne(14,"*"),j()(),Rt(15,"input",14),j(),me(16,mQ,4,0,"div",8),H(17,"div",9)(18,"label",15),ne(19," Address "),j(),Rt(20,"input",16),j(),me(21,_Q,4,0,"div",8),H(22,"div",9)(23,"label",17),ne(24," Phone number "),j(),Rt(25,"input",18),j(),H(26,"div",9)(27,"label",19),ne(28," Profile picture "),j(),H(29,"div",20)(30,"input",21),nt("change",function(r){return _e(i),Ie(ue().fileSelected(r))}),j(),H(31,"label",22),ne(32),j()(),me(33,gQ,2,1,"div",23),me(34,yQ,2,0,"button",24),me(35,vQ,3,1,"small",25),j(),H(36,"div",9)(37,"label",26),ne(38," Password "),H(39,"i",11),ne(40,"*"),j()(),Rt(41,"input",27),me(42,CQ,2,1,"small",25),j(),H(43,"div",9)(44,"label",28),ne(45," Repeat Password "),H(46,"i",11),ne(47,"*"),j()(),Rt(48,"input",29),me(49,DQ,3,0,"small",25),j(),H(50,"small",30)(51,"i",11),ne(52,"*"),j(),ne(53," Required "),j(),H(54,"button",31),ne(55," SIGN UP "),j(),me(56,EQ,3,1,"small",25),H(57,"a",32),ne(58," Already have an account? Log In "),j()()}if(2&e){const i=t.ngIf,n=ue();ee("formGroup",n.form),G(1),ee("ngIf",null==n.ps.properties["User Type"]?null:n.ps.properties["User Type"].includes("Person")),G(1),ee("ngIf",null==n.ps.properties["User Type"]?null:n.ps.properties["User Type"].includes("Person")),G(1),ee("ngIf",null==n.ps.properties["User Type"]?null:n.ps.properties["User Type"].includes("Organisation")),G(13),ee("ngIf",null==n.ps.properties["User Type"]?null:n.ps.properties["User Type"].includes("Person")),G(5),ee("ngIf",null==n.ps.properties["User Type"]?null:n.ps.properties["User Type"].includes("Person")),G(11),Ft(" ",n.fileName?n.fileName:"Choose Image"," "),G(1),ee("ngIf",n.imgSrc),G(1),ee("ngIf",n.imgSrc),G(1),ee("ngIf",n.imgError),G(7),ee("ngIf",i.password),G(7),ee("ngIf",i.password&&i.repeatPassword&&i.password!==i.repeatPassword),G(5),ee("disabled",!(i.userName&&i.email&&i.password&&i.repeatPassword&&i.password===i.repeatPassword)),G(2),ee("ngIf",n.error)}}let SQ=(()=>{var e;class t{constructor(n,r,s,d){this.db=n,this.route=r,this.image=s,this.ps=d,this.error="",this.properties={},this.form=new Sd({firstName:new On,lastName:new On,organisation:new On,email:new On,userName:new On,gender:new On,address:new On,birthDate:new On,phoneNumber:new On,password:new On,repeatPassword:new On})}ngOnInit(){}signUp(){let n=this.form.getRawValue();delete n.repeatPassword,n.profilePicture=this.imgSrc,this.db.signUp(n).then(r=>{this.route.navigateByUrl("/login")}).catch(r=>this.error=r.error.message)}fileSelected(n){if(0===n.target.files.length)return;this.imgError=void 0,this.imgSrc=void 0;let r=n.target.files[0];this.fileName=r.name,this.image.convertFileToJpegBase64(r,s=>{this.imgSrc=s},s=>{this.imgError=s},300,300)}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(hs),oe(Lr),oe(Cm),oe(xp))},e.\u0275cmp=In({type:e,selectors:[["app-signup"]],decls:9,vars:1,consts:[[2,"margin","10px"],[1,"container"],[1,"row"],[1,"offset-md-2","col-md-8","offset-lg-3","col-lg-6"],[1,"card"],[1,"card-body"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],["class","form-group",4,"ngIf"],[1,"form-group"],["for","inputEmail"],[2,"color","red"],["type","email","id","inputEmail","placeholder","Enter email","formControlName","email",1,"form-control"],["for","inputUsername"],["type","text","id","inputUsername","placeholder","Enter username","formControlName","userName",1,"form-control"],["for","inputAddress"],["type","text","id","inputAddress","placeholder","Enter Address","formControlName","address",1,"form-control"],["for","inputPhoneNumber"],["type","text","id","inputPhoneNumber","placeholder","Enter Phone Number","formControlName","phoneNumber",1,"form-control"],["for","inputImage"],["id","inputImage",1,"custom-file"],["type","file","id","customFile",1,"custom-file-input",3,"change"],["for","customFile",1,"custom-file-label"],["style","display: flex;justify-content: center;",4,"ngIf"],["type","button","class","btn btn-outline-danger btn-block",3,"click",4,"ngIf"],["class","form-text",4,"ngIf"],["for","inputPassword"],["type","password","id","inputPassword","placeholder","Password","formControlName","password",1,"form-control"],["for","inputRepeatPassword"],["type","password","id","inputRepeatPassword","placeholder","Repeat Password","formControlName","repeatPassword",1,"form-control"],[1,"form-text"],["type","submit",1,"btn","btn-primary","btn-block",3,"disabled"],["routerLink","/login"],["for","inputFirstName"],["type","text","id","inputFirstName","placeholder","Enter First Name","formControlName","firstName",1,"form-control"],["for","inputLastName"],["type","text","id","inputLastName","placeholder","Enter Last Name","formControlName","lastName",1,"form-control"],["for","inputOrganisation"],["type","text","id","inputOrganisation","placeholder","Enter Organisation","formControlName","organisation",1,"form-control"],["for","inputGender"],["type","text","id","inputGender","placeholder","Enter Gender","formControlName","gender",1,"form-control"],["for","inputBirthDate"],["type","date","id","inputBirthDate","placeholder","Enter Birth Date","formControlName","birthDate",1,"form-control"],[2,"display","flex","justify-content","center"],[2,"width","200px","height","200px","border-radius","50%",3,"src"],["type","button",1,"btn","btn-outline-danger","btn-block",3,"click"],[3,"style",4,"ngIf"]],template:function(n,r){1&n&&(H(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1"),ne(5,"Sign Up"),j(),H(6,"div",4)(7,"div",5),me(8,TQ,59,14,"form",6),j()()()()()()),2&n&&(G(8),ee("ngIf",r.form.getRawValue()))},dependencies:[fr,Fc,yp,ma,$l,_p,Md,Pu]}),t})();const jN=function(e){return["/transactions","details",e]};function MQ(e,t){if(1&e&&(H(0,"div",13),Rt(1,"img",14),j()),2&e){const i=ue().$implicit,n=ue();ee("routerLink",$a(3,jN,i.transactionID)),G(1),ee("src",i.Listing.picture?i.Listing.picture:n.image.getPlaceholderImage(),cs)("alt",i.Listing.name)}}function AQ(e,t){1&e&&(H(0,"b",15),ne(1," (CANCELLED) "),j())}function IQ(e,t){if(1&e&&(H(0,"div"),ne(1," Date: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Cn(i.Listing.date)}}function RQ(e,t){if(1&e&&(H(0,"div"),ne(1,"Quantity: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Cn(i.numberOfAssets)}}function kQ(e,t){if(1&e&&(H(0,"div"),ne(1,"Price: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Ft("\u20ac",i.price,"")}}function PQ(e,t){if(1&e&&(H(0,"div"),ne(1," Total Price: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Ft("\u20ac",i.price*i.numberOfAssets,"")}}function OQ(e,t){if(1&e&&(H(0,"div"),ne(1,"Address: "),H(2,"b"),ne(3),j()()),2&e){const i=ue().$implicit;G(3),Cn(i.sendAddress)}}function FQ(e,t){if(1&e&&(H(0,"div")(1,"a",16),ne(2,"Event File"),j()()),2&e){const i=ue().$implicit;G(1),ee("routerLink",$a(1,jN,i.transactionID))}}function NQ(e,t){1&e&&(H(0,"th",22),ne(1,"Time"),j())}function LQ(e,t){if(1&e&&(H(0,"td"),ne(1),j()),2&e){const i=ue().$implicit;G(1),Cg(" ",i.startTime," - ",i.endTime," ")}}function BQ(e,t){if(1&e&&(H(0,"tr")(1,"td"),ne(2),j(),me(3,LQ,2,2,"td",5),H(4,"td"),ne(5),j()()),2&e){const i=t.$implicit,n=ue(4);G(2),Ft(" ",i.startDate===i.endDate?i.startDate:i.startDate+" - "+i.endDate," "),G(1),ee("ngIf",null==n.ps.properties["Time Unit"]?null:n.ps.properties["Time Unit"].includes("Hour")),G(2),Ft(" ",i.info," ")}}function zQ(e,t){if(1&e&&(H(0,"table",18)(1,"thead",19)(2,"tr")(3,"th",20),ne(4,"Date"),j(),me(5,NQ,2,0,"th",21),H(6,"th",22),ne(7,"Info"),j()()(),H(8,"tbody"),me(9,BQ,6,3,"tr",23),j()()),2&e){const i=ue(2).$implicit,n=ue();G(5),ee("ngIf",null==n.ps.properties["Time Unit"]?null:n.ps.properties["Time Unit"].includes("Hour")),G(4),ee("ngForOf",i.bookings)}}function VQ(e,t){1&e&&(H(0,"div")(1,"b"),ne(2,"No Bookings On this transaction"),j()())}function jQ(e,t){if(1&e&&(H(0,"div"),ne(1," Bookings: "),me(2,zQ,10,2,"table",17),me(3,VQ,3,0,"div",5),j()),2&e){const i=ue().$implicit;G(2),ee("ngIf",i.bookings&&i.bookings.length>0),G(1),ee("ngIf",!i.bookings||0===i.bookings.length)}}function UQ(e,t){if(1&e){const i=zt();H(0,"button",28),nt("click",function(){_e(i);const r=ue(2).$implicit;return Ie(ue().contactOwner(r))}),ne(1," Message Seller "),j()}}function $Q(e,t){if(1&e){const i=zt();H(0,"button",29),nt("click",function(){_e(i);const r=ue(2).$implicit,s=ue();return s.selectedTransactionForReview=r.transactionID,s.form.reset(),s.rating=0,Ie(s.hoverRating=0)}),ne(1," Review "),j()}}function HQ(e,t){if(1&e){const i=zt();H(0,"div")(1,"div",24),me(2,UQ,2,0,"button",25),H(3,"button",26),nt("click",function(){_e(i);const r=ue().$implicit;return Ie(ue().cancelTransaction(r.transactionID))}),ne(4," CANCEL "),j(),me(5,$Q,2,0,"button",27),j()()}if(2&e){const i=ue().$implicit,n=ue();G(2),ee("ngIf",n.user.isLoggedIn()&&(null==n.ps.properties["Conversation System"]?null:n.ps.properties["Conversation System"].includes("Transaction Conversation"))),G(3),ee("ngIf",n.selectedTransactionForReview!==i.transactionID&&i.reviewable&&(null==n.ps.properties["Review By"]?null:n.ps.properties["Review By"].includes("By Customer")))}}function GQ(e,t){if(1&e&&(H(0,"span"),ne(1," \u2605 "),j()),2&e){const i=t.index,n=ue(3);Jr("font-size: 50px;color: "+(i<n.hoverRating&&i>=n.rating?"#FAB81E":i<n.hoverRating?"orange":i>=n.rating?"gray":"#FFC300"))}}function qQ(e,t){if(1&e){const i=zt();H(0,"div",0)(1,"form",30),nt("ngSubmit",function(){return _e(i),Ie(ue(2).postReview())}),H(2,"h4"),ne(3," Review: "),H(4,"ngb-rating",31),nt("rateChange",function(r){return _e(i),Ie(ue(2).rating=r)})("hover",function(r){return _e(i),Ie(ue(2).hoverRating=r)})("leave",function(){return _e(i),Ie(ue(2).hoverRating=0)}),me(5,GQ,2,2,"ng-template"),j()(),H(6,"div",32)(7,"label",33),ne(8," Comment (optional) "),j(),H(9,"textarea",34),ne(10,"                      "),j()(),H(11,"div",24)(12,"button",35),nt("click",function(){return _e(i),Ie(ue(2).selectedTransactionForReview=-1)}),ne(13," Cancel Review "),j(),H(14,"button",36),ne(15," Post Review "),j()()()()}if(2&e){const i=ue(2);G(1),ee("formGroup",i.form),G(3),ee("rate",i.rating),G(10),ee("disabled",0===i.rating)}}function WQ(e,t){if(1&e&&(H(0,"div",6)(1,"div",7),me(2,MQ,2,5,"div",8),H(3,"div",3)(4,"div",9)(5,"div",7)(6,"div",3)(7,"h5",10),ne(8),me(9,AQ,2,0,"b",11),j(),H(10,"div"),me(11,IQ,4,1,"div",5),me(12,RQ,4,1,"div",5),me(13,kQ,4,1,"div",5),me(14,PQ,4,1,"div",5),H(15,"div"),ne(16,"Status: "),H(17,"b"),ne(18),j()(),me(19,OQ,4,1,"div",5),me(20,FQ,3,3,"div",5),me(21,jQ,4,2,"div",5),j()()(),me(22,HQ,6,2,"div",5),j()()(),me(23,qQ,16,3,"div",12),j()),2&e){const i=t.$implicit,n=ue();G(2),ee("ngIf",!(null!=n.ps.properties["Listing Type"]&&n.ps.properties["Listing Type"].includes("Digital Good"))),G(6),Ft("",i.Listing.name," "),G(1),ee("ngIf","cancelled"===i.status),G(2),ee("ngIf",(null==n.ps.properties["Listing Kind"]?null:n.ps.properties["Listing Kind"].includes("Service"))&&(null==n.ps.properties.Frequency?null:n.ps.properties.Frequency.includes("One-Time"))),G(1),ee("ngIf",!(null!=n.ps.properties.Quantity&&n.ps.properties.Quantity.includes("One")||null!=n.ps.properties.Frequency&&n.ps.properties.Frequency.includes("Recurring"))),G(1),ee("ngIf",!(null!=n.ps.properties["Price Calculation"]&&n.ps.properties["Price Calculation"].includes("By Quantity"))),G(1),ee("ngIf",null==n.ps.properties["Price Calculation"]?null:n.ps.properties["Price Calculation"].includes("By Quantity")),G(4),Cn(i.status),G(1),ee("ngIf",null==n.ps.properties["Listing Type"]?null:n.ps.properties["Listing Type"].includes("Physical Good")),G(1),ee("ngIf",null==n.ps.properties["Listing Type"]?null:n.ps.properties["Listing Type"].includes("Digital Good")),G(1),ee("ngIf",(null==n.ps.properties["Listing Kind"]?null:n.ps.properties["Listing Kind"].includes("Service"))&&(null==n.ps.properties.Frequency?null:n.ps.properties.Frequency.includes("Recurring"))),G(1),ee("ngIf","cancelled"!==i.status),G(1),ee("ngIf",n.selectedTransactionForReview===i.transactionID)}}function ZQ(e,t){1&e&&(H(0,"div")(1,"b"),ne(2,"No Transactions Found"),j()())}let YQ=(()=>{var e;class t{constructor(n,r,s,d,m,b){this.db=n,this.user=r,this.route=s,this.image=d,this.router=m,this.ps=b,this.hasCancelled=!1,this.transactions=[],this.rating=0,this.selectedTransactionForReview=-1,this.form=new Sd({comment:new On("")})}ngOnInit(){this.fetchTransactions()}fetchTransactions(){this.db.getUserTransactions(this.user.getLoginToken()).then(n=>{this.transactions=n.transactions.sort((r,s)=>new Date(s.createdAt).getTime()-new Date(r.createdAt).getTime()),this.ps.properties["Listing Kind"]?.includes("Service")&&this.ps.properties.Frequency?.includes("Recurring")&&this.transactions.forEach(r=>{this.db.getTransactionBookings(this.user.getLoginToken(),r.transactionID).then(s=>{r.bookings=s.bookings})})})}logBookings(n){return n.map(r=>`(${r.startDate}) ${r.startTime} - ${r.endTime} (${r.endDate})`)}cancelTransaction(n){this.db.cancelTransaction(n,this.user.getLoginToken()).then(r=>this.fetchTransactions())}postReview(){let n=this.form.getRawValue();n.score=this.rating,this.db.postReview(this.user.getLoginToken(),this.selectedTransactionForReview,n).then(r=>{this.router.navigateByUrl("/listings/details/"+r.listingID)})}contactOwner(n){this.router.navigateByUrl(`/messages?id=${n.Listing.userID}`)}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(hs),oe(Bc),oe(Ga),oe(Cm),oe(Lr),oe(xp))},e.\u0275cmp=In({type:e,selectors:[["app-transactions"]],decls:7,vars:2,consts:[[2,"margin","10px"],[1,"row"],[1,"container"],[1,"col"],["class","card","style","margin-bottom: 5px;",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"card",2,"margin-bottom","5px"],[1,"row","no-gutters"],["class","col-auto","style","cursor:pointer;",3,"routerLink",4,"ngIf"],[1,"card-body"],[1,"card-title"],["style","color: red;",4,"ngIf"],["style","margin:10px",4,"ngIf"],[1,"col-auto",2,"cursor","pointer",3,"routerLink"],[1,"card-img-left",2,"max-width","100%","height","auto","display","block","margin","0 auto",3,"src","alt"],[2,"color","red"],[2,"cursor","pointer",3,"routerLink"],["class","table",4,"ngIf"],[1,"table"],[1,"thead-light"],["scope","col"],["score","col",4,"ngIf"],["score","col"],[4,"ngFor","ngForOf"],["role","group",1,"btn-group"],["class","btn-primary",3,"click",4,"ngIf"],[1,"btn","btn-danger",3,"click"],["class","btn btn-success",3,"click",4,"ngIf"],[1,"btn-primary",3,"click"],[1,"btn","btn-success",3,"click"],[3,"formGroup","ngSubmit"],["max","5",3,"rate","rateChange","hover","leave"],[1,"form-group"],["for","textareaComment"],["id","textareaComment","placeholder","Enter comment","rows","3","formControlName","comment",1,"form-control"],["type","button",1,"btn","btn-danger",3,"click"],[1,"btn","btn-success",3,"disabled"]],template:function(n,r){1&n&&(H(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",1)(4,"div",3),me(5,WQ,24,13,"div",4),me(6,ZQ,3,0,"div",5),j()()()()()),2&n&&(G(5),ee("ngForOf",r.transactions),G(1),ee("ngIf",void 0!==r.transactions&&0===r.transactions.length))},dependencies:[to,fr,Fc,Hw,yp,ma,$l,_p,Md,Pu],styles:[".rating-star-back[_ngcontent-%COMP%], .rating-star-back-filled[_ngcontent-%COMP%]{position:relative;display:inline-block;font-size:20px;color:gray}.rating-star-back-filled[_ngcontent-%COMP%]{color:#fab81e}.rating-star-front[_ngcontent-%COMP%]{position:absolute;display:inline-block;overflow:hidden;color:#fab81e}.detail-tab-radio-button[_ngcontent-%COMP%]{border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-style:hidden;box-shadow:none!important;outline:0px!important}"]}),t})();function XQ(e,t){if(1&e&&Rt(0,"img",5),2&e){const i=ue(2);ee("src",i.transaction.listing.file,cs)("alt",i.transaction.listing.name)}}function KQ(e,t){if(1&e&&(H(0,"div",2)(1,"div",3),me(2,XQ,1,2,"img",4),j()()),2&e){const i=ue();G(2),ee("ngIf",i.transaction)}}let UN=(()=>{var e;class t{constructor(n,r){this.route=n,this.db=r}ngOnInit(){this.route.params.subscribe(n=>{this.db.getTransaction(n.id).then(r=>{this.transaction=r})})}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Ga),oe(hs))},e.\u0275cmp=In({type:e,selectors:[["app-transactiondetail"]],decls:2,vars:1,consts:[[2,"margin","10px"],["class","container",4,"ngIf"],[1,"container"],[1,"col-auto",2,"cursor","pointer"],["class","card-img-left","style","width: 318px;height: 200;",3,"src","alt",4,"ngIf"],[1,"card-img-left",2,"width","318px","height","200",3,"src","alt"]],template:function(n,r){1&n&&(H(0,"div",0),me(1,KQ,3,1,"div",1),j()),2&n&&(G(1),ee("ngIf",r.transaction))},dependencies:[fr]}),t})(),QQ=(()=>{var e;class t{transform(n,r){if(Array.isArray(n))return n.sort((s,d)=>s.value[r]<d.value[r]?-1:s[r]>d[r]?1:0),n}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275pipe=tr({name:"orderBy",type:e,pure:!0}),t})();function JQ(e,t){1&e&&(H(0,"sup"),ne(1,"m"),j())}function eJ(e,t){1&e&&(H(0,"sup"),ne(1,"o"),j())}function tJ(e,t){if(1&e){const i=zt();H(0,"div",0)(1,"p"),ne(2),j(),H(3,"button",2),nt("click",function(){return _e(i),Ie(ue(3).showPopup=!1)}),ne(4,"Close"),j()()}if(2&e){const i=ue(2).$implicit;G(2),Cn(i.value.description)}}function nJ(e,t){1&e&&me(0,tJ,5,1,"div",8),2&e&&ee("ngIf",ue(2).showPopup)}function iJ(e,t){1&e&&(H(0,"sup"),ne(1,"e"),j())}function rJ(e,t){1&e&&(H(0,"sup"),ne(1,", "),j())}function oJ(e,t){1&e&&(H(0,"sup"),ne(1,"d"),j())}function sJ(e,t){if(1&e){const i=zt();H(0,"div",9)(1,"input",10),nt("click",function(r){const d=_e(i).$implicit,m=ue().$implicit;return Ie(ue().onCheckboxChange(r,d,m.key))}),j(),H(2,"label",11),ne(3),me(4,iJ,2,0,"sup",5),me(5,rJ,2,0,"sup",5),me(6,oJ,2,0,"sup",5),j()()}if(2&e){const i=t.$implicit;G(1),bg("id",i.value),ee("value",i.value)("checked",i.selected)("disabled",!i.selectable),G(1),bg("for",i.value),G(1),Ft(" ",i.value," "),G(1),ee("ngIf",i.exclusive),G(1),ee("ngIf",i.dependency&&i.exclusive),G(1),ee("ngIf",i.dependency)}}function aJ(e,t){if(1&e){const i=zt();H(0,"div")(1,"span",3),nt("click",function(){return _e(i),Ie(ue().showPopup=!0)}),H(2,"h4",4),ne(3),me(4,JQ,2,0,"sup",5),me(5,eJ,2,0,"sup",5),j()(),me(6,nJ,1,1,"ng-template",null,6,us),me(8,sJ,7,9,"div",7),j()}if(2&e){const i=t.$implicit,n=Ho(7);G(1),ee("ngbPopover",n),G(2),Ft("",i.key," "),G(1),ee("ngIf",i.value.mandatory),G(1),ee("ngIf",!i.value.mandatory),G(3),ee("ngForOf",i.value)}}let lJ=(()=>{var e;class t{constructor(n,r,s){this.db=n,this.formBuilder=r,this.companyService=s,this.taxonomy={},this.showPopup=!1,this.taxonomyForm=this.formBuilder.group({dimensionValue:this.formBuilder.array([])})}ngOnInit(){this.fetchCompany(),this.propertyValuesFormArray=this.taxonomyForm.get("dimensionValue"),this.fetchConstraints()}fetchTaxonomy(){this.db.getTaxonomy().then(n=>{n.taxonomy.forEach(r=>{r.dimension in this.taxonomy?this.taxonomy[r.dimension].push({value:r.dimensionValue,selected:r.selected,exclusive:r.exclusive,selectable:1}):(this.taxonomy[r.dimension]=[{value:r.dimensionValue,selected:r.selected,exclusive:r.exclusive,selectable:1}],this.taxonomy[r.dimension].mandatory=r.mandatory,this.taxonomy[r.dimension].orderNr=r.orderNrDimension,this.taxonomy[r.dimension].description=r.description),r.selected&&this.propertyValuesFormArray.push(new On(r.dimensionValue))});for(const[r,s]of Object.entries(this.taxonomy))s.forEach(d=>{d.selected&&(this.checkDependencyConstraint(d),this.checkExclusiveConstraint(r,d))})})}fetchConstraints(){this.db.getConstraints().then(n=>{this.constraints=n.constraints})}checkDependencyConstraint(n){typeof this.constraints<"u"&&Array.isArray(this.constraints)&&this.constraints.forEach(r=>{if(r.value===n.value){const s=this.taxonomy[r.dimension].findIndex(d=>d.value===r.constraintsValue);-1!==s&&(n.selected?(this.taxonomy[r.dimension][s].selectable=0,this.taxonomy[r.dimension][s].selected=0,this.taxonomy[r.dimension][s].dependency=1,this.db.deleteProperty(this.companyName,this.taxonomy[r.dimension][s].value)):this.taxonomy[r.dimension][s].selectable=1)}})}checkExclusiveConstraint(n,r){r.exclusive&&this.taxonomy[n].forEach(s=>{s.value!==r.value&&(r.selected?(s.selectable=0,s.selected&&(s.selected=0,this.db.deleteProperty(this.companyName,s.value))):s.selectable=1)})}onCheckboxChange(n,r,s){if(n.target.checked)this.propertyValuesFormArray.push(new On(n.target.value)),this.db.createProperty(this.companyName,n.target.value),r.selected=1;else{const d=this.propertyValuesFormArray.controls.findIndex(m=>m.value===n.target.value);this.propertyValuesFormArray.removeAt(d),r.selected=0,this.db.deleteProperty(this.companyName,n.target.value)}this.checkDependencyConstraint(r),this.checkExclusiveConstraint(s,r)}fetchCompany(){var n=this;return BN(function*(){n.companyName=n.companyService.companyName,n.db.createCompany({company:n.companyName}),n.fetchTaxonomy()})()}checkMandatoryValues(){const n=[];for(let s in this.taxonomy){const d=this.taxonomy[s];if(d.mandatory){var r=0;d.forEach(m=>{r+=m.selected}),0==r&&n.push(s)}}n.length>0?alert(`Please select a value for the following mandatory dimensions: ${n.join(", ")}`):alert("Saved")}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(hs),oe(J$),oe(C0))},e.\u0275cmp=In({type:e,selectors:[["app-taxonomy"]],decls:26,vars:7,consts:[[1,"text-center"],[4,"ngFor","ngForOf"],[1,"button",3,"click"],["triggers","click",1,"clickable",3,"ngbPopover","click"],[1,"display-6"],[4,"ngIf"],["popoverContent",""],["class","form-check form-check-inline",4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],[1,"form-check","form-check-inline"],["type","checkbox","autocomplete","off",1,"form-check-input",3,"id","value","checked","disabled","click"],[1,"form-check-label",3,"for"]],template:function(n,r){1&n&&(H(0,"div",0)(1,"H1"),ne(2,"Taxonomy"),j(),ne(3," Select Company: "),H(4,"div")(5,"p"),ne(6),j()(),H(7,"sup"),ne(8,"m"),j(),ne(9," = mandatory, "),H(10,"sup"),ne(11,"e"),j(),ne(12," = exclusive, "),H(13,"sup"),ne(14,"o"),j(),ne(15," = optional, "),H(16,"sup"),ne(17,"d"),j(),ne(18," = dependent "),Rt(19,"br"),me(20,aJ,9,5,"div",1),TD(21,"orderBy"),TD(22,"keyvalue"),Rt(23,"br"),H(24,"button",2),nt("click",function(){return r.checkMandatoryValues()}),ne(25,"Save"),j()()),2&n&&(G(6),Cn(r.companyName),G(14),ee("ngForOf",gI(21,2,function _I(e,t,i){const n=e+ln,r=ce(),s=Es(r,n);return Wv(r,n)?uI(r,Tt(),t,s.transform,i,s):s.transform(i)}(22,5,r.taxonomy),"orderNr")))},dependencies:[to,fr,_Y,iR,QQ],styles:[".add-option[_ngcontent-%COMP%]{background-color:#fff;color:#00f;text-align:center}.central[_ngcontent-%COMP%]{display:inline-block;flex-wrap:nowrap;flex-direction:row}.display-6[_ngcontent-%COMP%]{margin-top:10px}.button[_ngcontent-%COMP%]{background-color:#00f;color:#fff}.icon-background2[_ngcontent-%COMP%]{color:#0288d1}.fa-info[_ngcontent-%COMP%]{color:#fff;font-size:10px}.fa-circle[_ngcontent-%COMP%]{font-size:20px}.circle-container[_ngcontent-%COMP%]{display:inline-block;position:relative;cursor:pointer}.circle[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;background-color:#007bff;color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px}.question-mark[_ngcontent-%COMP%]{font-size:1.5em}.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:background-color .2s}.clickable[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}"]}),t})(),cJ=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=In({type:e,selectors:[["app-not-found"]],decls:2,vars:0,template:function(n,r){1&n&&(H(0,"h1"),ne(1,"404 Page Not Found"),j())},encapsulation:2}),t})();const dJ=["*"];let Gw;function eb(e){return function uJ(){if(void 0===Gw&&(Gw=null,typeof window<"u")){const e=window;void 0!==e.trustedTypes&&(Gw=e.trustedTypes.createPolicy("angular#components",{createHTML:t=>t}))}return Gw}()?.createHTML(e)||e}function $N(e){return Error(`Unable to find icon with the name "${e}"`)}function HN(e){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${e}".`)}function GN(e){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${e}".`)}class km{constructor(t,i,n){this.url=t,this.svgText=i,this.options=n}}let qw=(()=>{var e;class t{constructor(n,r,s,d){this._httpClient=n,this._sanitizer=r,this._errorHandler=d,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["material-icons","mat-ligature-font"],this._document=s}addSvgIcon(n,r,s){return this.addSvgIconInNamespace("",n,r,s)}addSvgIconLiteral(n,r,s){return this.addSvgIconLiteralInNamespace("",n,r,s)}addSvgIconInNamespace(n,r,s,d){return this._addSvgIconConfig(n,r,new km(s,null,d))}addSvgIconResolver(n){return this._resolvers.push(n),this}addSvgIconLiteralInNamespace(n,r,s,d){const m=this._sanitizer.sanitize(Kr.HTML,s);if(!m)throw GN(s);const b=eb(m);return this._addSvgIconConfig(n,r,new km("",b,d))}addSvgIconSet(n,r){return this.addSvgIconSetInNamespace("",n,r)}addSvgIconSetLiteral(n,r){return this.addSvgIconSetLiteralInNamespace("",n,r)}addSvgIconSetInNamespace(n,r,s){return this._addSvgIconSetConfig(n,new km(r,null,s))}addSvgIconSetLiteralInNamespace(n,r,s){const d=this._sanitizer.sanitize(Kr.HTML,r);if(!d)throw GN(r);const m=eb(d);return this._addSvgIconSetConfig(n,new km("",m,s))}registerFontClassAlias(n,r=n){return this._fontCssClassesByAlias.set(n,r),this}classNameForFontAlias(n){return this._fontCssClassesByAlias.get(n)||n}setDefaultFontSetClass(...n){return this._defaultFontSetClass=n,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(n){const r=this._sanitizer.sanitize(Kr.RESOURCE_URL,n);if(!r)throw HN(n);const s=this._cachedIconsByUrl.get(r);return s?Vt(Ww(s)):this._loadSvgIconFromConfig(new km(n,null)).pipe(Nr(d=>this._cachedIconsByUrl.set(r,d)),Xt(d=>Ww(d)))}getNamedSvgIcon(n,r=""){const s=qN(r,n);let d=this._svgIconConfigs.get(s);if(d)return this._getSvgFromConfig(d);if(d=this._getIconConfigFromResolvers(r,n),d)return this._svgIconConfigs.set(s,d),this._getSvgFromConfig(d);const m=this._iconSetConfigs.get(r);return m?this._getSvgFromIconSetConfigs(n,m):sm($N(s))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(n){return n.svgText?Vt(Ww(this._svgElementFromConfig(n))):this._loadSvgIconFromConfig(n).pipe(Xt(r=>Ww(r)))}_getSvgFromIconSetConfigs(n,r){const s=this._extractIconWithNameFromAnySet(n,r);return s?Vt(s):Qk(r.filter(m=>!m.svgText).map(m=>this._loadSvgIconSetFromConfig(m).pipe(lm(b=>{const I=`Loading icon set URL: ${this._sanitizer.sanitize(Kr.RESOURCE_URL,m.url)} failed: ${b.message}`;return this._errorHandler.handleError(new Error(I)),Vt(null)})))).pipe(Xt(()=>{const m=this._extractIconWithNameFromAnySet(n,r);if(!m)throw $N(n);return m}))}_extractIconWithNameFromAnySet(n,r){for(let s=r.length-1;s>=0;s--){const d=r[s];if(d.svgText&&d.svgText.toString().indexOf(n)>-1){const m=this._svgElementFromConfig(d),b=this._extractSvgIconFromSet(m,n,d.options);if(b)return b}}return null}_loadSvgIconFromConfig(n){return this._fetchIcon(n).pipe(Nr(r=>n.svgText=r),Xt(()=>this._svgElementFromConfig(n)))}_loadSvgIconSetFromConfig(n){return n.svgText?Vt(null):this._fetchIcon(n).pipe(Nr(r=>n.svgText=r))}_extractSvgIconFromSet(n,r,s){const d=n.querySelector(`[id="${r}"]`);if(!d)return null;const m=d.cloneNode(!0);if(m.removeAttribute("id"),"svg"===m.nodeName.toLowerCase())return this._setSvgAttributes(m,s);if("symbol"===m.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(m),s);const b=this._svgElementFromString(eb("<svg></svg>"));return b.appendChild(m),this._setSvgAttributes(b,s)}_svgElementFromString(n){const r=this._document.createElement("DIV");r.innerHTML=n;const s=r.querySelector("svg");if(!s)throw Error("<svg> tag not found");return s}_toSvgElement(n){const r=this._svgElementFromString(eb("<svg></svg>")),s=n.attributes;for(let d=0;d<s.length;d++){const{name:m,value:b}=s[d];"id"!==m&&r.setAttribute(m,b)}for(let d=0;d<n.childNodes.length;d++)n.childNodes[d].nodeType===this._document.ELEMENT_NODE&&r.appendChild(n.childNodes[d].cloneNode(!0));return r}_setSvgAttributes(n,r){return n.setAttribute("fit",""),n.setAttribute("height","100%"),n.setAttribute("width","100%"),n.setAttribute("preserveAspectRatio","xMidYMid meet"),n.setAttribute("focusable","false"),r&&r.viewBox&&n.setAttribute("viewBox",r.viewBox),n}_fetchIcon(n){const{url:r,options:s}=n,d=s?.withCredentials??!1;if(!this._httpClient)throw function hJ(){return Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==r)throw Error(`Cannot fetch icon from URL "${r}".`);const m=this._sanitizer.sanitize(Kr.RESOURCE_URL,r);if(!m)throw HN(r);const b=this._inProgressUrlFetches.get(m);if(b)return b;const E=this._httpClient.get(m,{responseType:"text",withCredentials:d}).pipe(Xt(I=>eb(I)),Og(()=>this._inProgressUrlFetches.delete(m)),Me());return this._inProgressUrlFetches.set(m,E),E}_addSvgIconConfig(n,r,s){return this._svgIconConfigs.set(qN(n,r),s),this}_addSvgIconSetConfig(n,r){const s=this._iconSetConfigs.get(n);return s?s.push(r):this._iconSetConfigs.set(n,[r]),this}_svgElementFromConfig(n){if(!n.svgElement){const r=this._svgElementFromString(n.svgText);this._setSvgAttributes(r,n.options),n.svgElement=r}return n.svgElement}_getIconConfigFromResolvers(n,r){for(let s=0;s<this._resolvers.length;s++){const d=this._resolvers[s](r,n);if(d)return fJ(d)?new km(d.url,null,d.options):new km(d,null)}}}return(e=t).\u0275fac=function(n){return new(n||e)(je(iw,8),je(kE),je(Sn,8),je(fo))},e.\u0275prov=Re({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function Ww(e){return e.cloneNode(!0)}function qN(e,t){return e+":"+t}function fJ(e){return!(!e.url||!e.options)}const mJ=FO(class{constructor(e){this._elementRef=e}}),_J=new mt("MAT_ICON_DEFAULT_OPTIONS"),gJ=new mt("mat-icon-location",{providedIn:"root",factory:function yJ(){const e=ft(Sn),t=e?e.location:null;return{getPathname:()=>t?t.pathname+t.search:""}}}),WN=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],vJ=WN.map(e=>`[${e}]`).join(", "),bJ=/^url\(['"]?#(.*?)['"]?\)$/;let ZN=(()=>{var e;class t extends mJ{get inline(){return this._inline}set inline(n){this._inline=Qg(n)}get svgIcon(){return this._svgIcon}set svgIcon(n){n!==this._svgIcon&&(n?this._updateSvgIcon(n):this._svgIcon&&this._clearSvgElement(),this._svgIcon=n)}get fontSet(){return this._fontSet}set fontSet(n){const r=this._cleanupFontValue(n);r!==this._fontSet&&(this._fontSet=r,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(n){const r=this._cleanupFontValue(n);r!==this._fontIcon&&(this._fontIcon=r,this._updateFontIconClasses())}constructor(n,r,s,d,m,b){super(n),this._iconRegistry=r,this._location=d,this._errorHandler=m,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=un.EMPTY,b&&(b.color&&(this.color=this.defaultColor=b.color),b.fontSet&&(this.fontSet=b.fontSet)),s||n.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(n){if(!n)return["",""];const r=n.split(":");switch(r.length){case 1:return["",r[0]];case 2:return r;default:throw Error(`Invalid icon name: "${n}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const n=this._elementsWithExternalReferences;if(n&&n.size){const r=this._location.getPathname();r!==this._previousPath&&(this._previousPath=r,this._prependPathToReferences(r))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(n){this._clearSvgElement();const r=this._location.getPathname();this._previousPath=r,this._cacheChildrenWithExternalReferences(n),this._prependPathToReferences(r),this._elementRef.nativeElement.appendChild(n)}_clearSvgElement(){const n=this._elementRef.nativeElement;let r=n.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();r--;){const s=n.childNodes[r];(1!==s.nodeType||"svg"===s.nodeName.toLowerCase())&&s.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const n=this._elementRef.nativeElement,r=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(s=>s.length>0);this._previousFontSetClass.forEach(s=>n.classList.remove(s)),r.forEach(s=>n.classList.add(s)),this._previousFontSetClass=r,this.fontIcon!==this._previousFontIconClass&&!r.includes("mat-ligature-font")&&(this._previousFontIconClass&&n.classList.remove(this._previousFontIconClass),this.fontIcon&&n.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(n){return"string"==typeof n?n.trim().split(" ")[0]:n}_prependPathToReferences(n){const r=this._elementsWithExternalReferences;r&&r.forEach((s,d)=>{s.forEach(m=>{d.setAttribute(m.name,`url('${n}#${m.value}')`)})})}_cacheChildrenWithExternalReferences(n){const r=n.querySelectorAll(vJ),s=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let d=0;d<r.length;d++)WN.forEach(m=>{const b=r[d],E=b.getAttribute(m),I=E?E.match(bJ):null;if(I){let O=s.get(b);O||(O=[],s.set(b,O)),O.push({name:m,value:I[1]})}})}_updateSvgIcon(n){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),n){const[r,s]=this._splitIconName(n);r&&(this._svgNamespace=r),s&&(this._svgName=s),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(s,r).pipe(no(1)).subscribe(d=>this._setSvgElement(d),d=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${r}:${s}! ${d.message}`))})}}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Tn),oe(qw),oa("aria-hidden"),oe(gJ),oe(fo),oe(_J,8))},e.\u0275cmp=In({type:e,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:8,hostBindings:function(n,r){2&n&&(Fn("data-mat-icon-type",r._usingFontIcon()?"font":"svg")("data-mat-icon-name",r._svgName||r.fontIcon)("data-mat-icon-namespace",r._svgNamespace||r.fontSet)("fontIcon",r._usingFontIcon()?r.fontIcon:null),kn("mat-icon-inline",r.inline)("mat-icon-no-color","primary"!==r.color&&"accent"!==r.color&&"warn"!==r.color))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],features:[Yt],ngContentSelectors:dJ,decls:1,vars:0,template:function(n,r){1&n&&(em(),Su(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0}),t})(),tb=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[xm,xm]}),t})();const xJ=["chat"];function wJ(e,t){1&e&&(H(0,"div",7)(1,"h1"),ne(2,"Messages"),j()())}function CJ(e,t){if(1&e){const i=zt();H(0,"div",11)(1,"button",12),nt("click",function(){return _e(i),Ie(ue(2).selected=-1)}),H(2,"mat-icon",13),ne(3,"keyboard_arrow_left"),j()()()}}function DJ(e,t){if(1&e&&(H(0,"div",8),me(1,CJ,4,0,"div",9),H(2,"div",10)(3,"h1"),ne(4),j()()()),2&e){const i=ue();G(1),ee("ngIf",i.focus),G(3),Cn(i.selectedUserName)}}function EJ(e,t){1&e&&(H(0,"span",20),ne(1,"New Messages"),j())}function TJ(e,t){if(1&e){const i=zt();H(0,"li",17)(1,"button",18),nt("click",function(){const s=_e(i).$implicit;return Ie(ue(2).selectPerson(s))}),H(2,"h6"),ne(3),me(4,EJ,2,0,"span",19),j(),ne(5),j()()}if(2&e){const i=t.$implicit,n=ue(2);kn("active",i.receiverID===n.selected||i.senderID===n.selected),G(1),Jr("width:100%;height:100%;text-align:left;"+(i.receiverID!==n.user.getId()||i.viewed?"":"font-weight: bold;")),G(2),Ft(" ",i.senderID===n.user.getId()?i.receiver:i.sender," "),G(1),ee("ngIf",i.receiverID===n.user.getId()&&!i.viewed),G(1),Ft(" ",i.message," ")}}function SJ(e,t){if(1&e&&(H(0,"div",14)(1,"ul",15),me(2,TJ,6,7,"li",16),j()()),2&e){const i=ue();G(2),ee("ngForOf",i.lastMessages)}}function MJ(e,t){if(1&e&&(H(0,"div",32)(1,"small"),ne(2),j()()),2&e){const i=ue().$implicit,n=ue(2);G(2),Cn(n.simplifyDate(i.createdAt))}}function AJ(e,t){if(1&e&&(H(0,"li",28),me(1,MJ,3,1,"div",29),H(2,"div",1)(3,"div",30)(4,"p",31),ne(5),j()()()()),2&e){const i=t.$implicit,n=t.index,r=ue(2);G(1),ee("ngIf",0===n||r.simplifyDate(i.createdAt)!==r.simplifyDate(r.messages[n-1].createdAt)),G(2),kn("flex-row-reverse",i.senderID!==r.selected),G(2),Ft(" ",i.message," ")}}function IJ(e,t){if(1&e){const i=zt();H(0,"div",33)(1,"div",34)(2,"input",35),nt("ngModelChange",function(r){return _e(i),Ie(ue(2).message=r)})("keypress",function(r){return _e(i),Ie(ue(2).keyPressed(r))}),j(),H(3,"button",36),nt("click",function(){return _e(i),Ie(ue(2).sendMessage())}),H(4,"mat-icon",13),ne(5,"send"),j()()()()}if(2&e){const i=ue(2);G(1),kn("disabled",i.locked),G(1),ee("ngModel",i.message)}}function RJ(e,t){if(1&e&&(H(0,"div",21)(1,"div",22)(2,"div",23)(3,"ul",24,25),me(5,AJ,6,4,"li",26),j(),me(6,IJ,6,3,"div",27),j()()()),2&e){const i=ue();G(5),ee("ngForOf",i.messages),G(1),ee("ngIf",i.selected>=0)}}const kJ=[{path:"",redirectTo:"/listings",pathMatch:"full"},{path:"signup",component:SQ},{path:"login",component:WK},{path:"profile",component:uQ},{path:"profile/changePassword",component:tQ},{path:"listings",component:vK},{path:"mylistings",component:GK},{path:"listings/details/:id",component:NN},{path:"listings/details/:id/:type",component:NN},{path:"listings/createEditListing",component:jX},{path:"categories",component:iH},{path:"transactions",component:YQ},{path:"transactions/details/:id",component:UN},{path:"transactions/details/:id/:type",component:UN},{path:"taxonomy",component:lJ},{path:"messages",component:(()=>{var e;class t{onResize(n){this.focus=window.innerWidth<1e3}constructor(n,r,s){this.db=n,this.route=r,this.user=s,this.lastMessages=[],this.messages=[],this.message="",this.selected=-1,this.selectedUserName="",this.locked=!1,this.scrollToBottomNeeded=!1,this.timeToRefresh=1e3,this.focus=!1,this.interval=setInterval(()=>{this.fetchMessages()},this.timeToRefresh)}ngAfterViewChecked(){this.scrollToBottomNeeded&&(this.scrollToBottom(),this.scrollToBottomNeeded=!1)}scrollToBottom(){try{this.myScrollContainer.nativeElement.scrollTop=this.myScrollContainer.nativeElement.scrollHeight}catch{}}ngOnInit(){this.db.getLastMessages(this.user.getLoginToken()).then(n=>this.lastMessages=n.messages),this.route.queryParamMap.subscribe(n=>{let r=n.params.id;r?this.db.getUserData(r,this.user.getLoginToken()).then(s=>{this.focus=!0,this.selected=parseInt(r),this.selectedUserName=s.userName,this.fetchMessages()}):(this.focus=!1,this.selected=1,this.messages=[],this.message="",this.selectedUserName="")})}ngOnDestroy(){clearInterval(this.interval)}selectPerson(n){this.locked||(this.messages=[],this.selected=n.senderID===this.user.getId()?n.receiverID:n.senderID,this.selectedUserName=n.senderID===this.user.getId()?n.receiver:n.sender,this.db.getMessages(this.user.getLoginToken(),this.selected).then(r=>{this.messages=r.messages,this.scrollToBottomNeeded=!0}),this.message="")}fetchMessages(){this.db.getLastMessages(this.user.getLoginToken()).then(n=>this.lastMessages=n.messages),!(this.selected<0)&&this.db.getMessages(this.user.getLoginToken(),this.selected).then(n=>{let r=n.messages;if(r.length>this.messages.length){for(let s=this.messages.length;s<r.length;s++)this.messages.push(r[s]);this.scrollToBottomNeeded=!0}})}keyPressed(n){"Enter"===n.key&&this.sendMessage()}sendMessage(){this.locked=!0,this.db.postMessage(this.user.getLoginToken(),this.selected,this.message).then(n=>{this.message="";let r=n.message;this.messages.push(r),r.sender=this.user.getUserName(),r.receiver=this.selectedUserName,this.moveLastMessageUp(r),this.locked=!1,this.scrollToBottomNeeded=!0})}moveLastMessageUp(n){for(let r=0;r<this.lastMessages.length;r++)if(this.lastMessages[r].receiverID===this.selected||this.lastMessages[r].senderID===this.selected)return this.lastMessages.unshift(...this.lastMessages.splice(r,1)),void(this.lastMessages[0].message=n.message);this.lastMessages.unshift(n)}simplifyDate(n){return n.split("T")[0]}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(hs),oe(Ga),oe(Bc))},e.\u0275cmp=In({type:e,selectors:[["app-messages"]],viewQuery:function(n,r){if(1&n&&Ls(xJ,5),2&n){let s;$n(s=Hn())&&(r.myScrollContainer=s.first)}},hostBindings:function(n,r){1&n&&nt("resize",function(d){return r.onResize(d)},0,S1)},decls:8,vars:4,consts:[[1,"container-fluid",2,"max-width","none"],[1,"row"],["class","col","style","max-width: 300px;",4,"ngIf"],["class","col row",4,"ngIf"],[1,"row",2,"height","85vh"],["class","col","style","padding-left: 0px;max-width: 300px;",4,"ngIf"],["class","col",4,"ngIf"],[1,"col",2,"max-width","300px"],[1,"col","row"],["class","col-auto",4,"ngIf"],[1,"col",2,"text-align","center"],[1,"col-auto"],[1,"btn","btn-secondary-outline",2,"border-radius","100%",3,"click"],[2,"vertical-align","middle"],[1,"col",2,"padding-left","0px","max-width","300px"],[1,"list-group"],["class","list-group-item","style","padding:0px","aria-current","true",3,"active",4,"ngFor","ngForOf"],["aria-current","true",1,"list-group-item",2,"padding","0px"],["type","button",1,"btn","btn-secondary-outline","d-inline-block","text-truncate",3,"click"],["class","badge bg-secondary",4,"ngIf"],[1,"badge","bg-secondary"],[1,"col"],[1,"card",2,"height","100%"],[1,"card-body",2,"padding","0"],[1,"list-group","overflow-auto",2,"max-height","81vh"],["chat",""],["class","list-group-item no-border",4,"ngFor","ngForOf"],["style","position:absolute;bottom:0;right:0;left:0",4,"ngIf"],[1,"list-group-item","no-border"],["class","row","style","text-align: center;",4,"ngIf"],[1,"col","d-flex"],[1,"message"],[1,"row",2,"text-align","center"],[2,"position","absolute","bottom","0","right","0","left","0"],[1,"input-group"],["type","text","placeholder","Write your message here...","aria-describedby","send-message-button",1,"form-control",3,"ngModel","ngModelChange","keypress"],["type","button","id","send-message-button",1,"btn","btn-primary",3,"click"]],template:function(n,r){1&n&&(H(0,"div",0)(1,"div",1),me(2,wJ,3,0,"div",2),me(3,DJ,5,2,"div",3),j(),H(4,"div",4),me(5,SJ,3,1,"div",5),me(6,RJ,7,2,"div",6),j()(),Rt(7,"div")),2&n&&(G(2),ee("ngIf",r.selected<0||!r.focus),G(1),ee("ngIf",r.selected>=0||!r.focus),G(2),ee("ngIf",r.selected<0||!r.focus),G(1),ee("ngIf",r.selected>=0||!r.focus))},dependencies:[to,fr,ma,$l,gp,ZN],styles:[".no-border[_ngcontent-%COMP%]{border-style:none}.message[_ngcontent-%COMP%]{max-width:60%;height:-moz-fit-content;height:fit-content;margin-bottom:0;padding:5px 10px;border-radius:5px;color:#fff;background-color:#0d6efd}"]}),t})()},{path:"**",component:cJ}];let nb=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[Ok.forRoot(kJ),Ok]}),t})();const PJ=function(e){return{id:e}};function OJ(e,t){if(1&e&&(H(0,"li",6)(1,"a",10),ne(2," My Listings "),j()()),2&e){const i=ue();G(1),ee("queryParams",$a(1,PJ,i.user.getId()))}}function FJ(e,t){1&e&&(H(0,"li",6)(1,"a",11),ne(2," My Transactions "),j()())}function NJ(e,t){1&e&&(H(0,"ul",12)(1,"li",6)(2,"a",13),ne(3," Sign Up "),j()(),H(4,"li",6)(5,"a",14),ne(6," Log In "),j()()())}function LJ(e,t){if(1&e&&(H(0,"span",27),ne(1),j()),2&e){const i=ue(2);G(1),Ft(" ",i.unseenMessages," ")}}function BJ(e,t){if(1&e&&(H(0,"span",27),ne(1),j()),2&e){const i=ue(2);G(1),Ft(" ",i.getUnreadNotificationsAmount()," ")}}function zJ(e,t){if(1&e){const i=zt();H(0,"div",28)(1,"button",29),nt("click",function(){return _e(i),Ie(ue(2).deleteNotifications())}),ne(2,"DELETE ALL"),j()()}}function VJ(e,t){if(1&e&&(H(0,"div"),ne(1),j()),2&e){const i=ue().$implicit,n=ue(2);G(1),Ft("- ",n.getNotificationMessage(i),"")}}function jJ(e,t){if(1&e&&(H(0,"b"),ne(1),j()),2&e){const i=ue().$implicit,n=ue(2);G(1),Ft("- ",n.getNotificationMessage(i),"")}}function UJ(e,t){if(1&e){const i=zt();H(0,"li")(1,"a",30),nt("click",function(){const s=_e(i).$implicit;return Ie(ue(2).clickedNotification(s))}),me(2,VJ,2,1,"div",31),me(3,jJ,2,1,"b",31),j()()}if(2&e){const i=t.$implicit;G(2),ee("ngIf",i.viewed),G(1),ee("ngIf",!i.viewed)}}function $J(e,t){1&e&&(H(0,"li",32),ne(1," No notifications "),j())}const HJ=function(){return["/listings","createEditListing"]};function GJ(e,t){if(1&e){const i=zt();H(0,"ul",12)(1,"li",6)(2,"a",15)(3,"mat-icon"),ne(4,"question_answer"),j(),me(5,LJ,2,1,"span",16),j()(),H(6,"li",17)(7,"a",18)(8,"mat-icon"),ne(9),j(),me(10,BJ,2,1,"span",16),j(),H(11,"ul",19),me(12,zJ,3,0,"div",20),me(13,UJ,4,2,"li",21),me(14,$J,2,0,"li",22),j()(),H(15,"li",6)(16,"a",23),ne(17),Rt(18,"img",24),j()(),H(19,"li",6)(20,"a",25),nt("click",function(){return _e(i),Ie(ue().user.logOut())}),ne(21," log out "),j()(),H(22,"button",26),ne(23,"+ Create Listing"),j()()}if(2&e){const i=ue();G(5),ee("ngIf",i.unseenMessages>0),G(4),Ft(" ","notifications"+(i.getUnreadNotificationsAmount()>0?"_active":""),""),G(1),ee("ngIf",i.getUnreadNotificationsAmount()>0),G(2),ee("ngIf",i.notifications.length>0),G(1),ee("ngForOf",i.notifications),G(1),ee("ngIf",0===i.notifications.length),G(3),Ft(" ",i.user.getUserName()," "),G(1),ee("src",i.user.getProfilePicture(),cs),G(4),ee("routerLink",Tg(9,HJ))}}let qJ=(()=>{var e;class t{constructor(n,r,s,d,m){this.user=n,this.db=r,this.router=s,this.companyService=d,this.properties=m,this.title="Marketplace",this.notifications=[],this.unseenMessages=0,this.timeToRefresh=5e3,this.fetchNotifications(),this.fetchMessageNotifications(),setInterval(()=>{this.fetchNotifications(),this.fetchMessageNotifications()},this.timeToRefresh)}ngOnInit(){this.title=this.companyService.companyName}changeCompany(n){this.companyService.companyName=n,this.properties.fetchProperties(),this.title=this.companyService.companyName;let r=this.router.url;this.router.navigateByUrl("/tmp",{skipLocationChange:!0}).then(()=>{this.router.navigateByUrl(r)})}getNotificationMessage(n){let r=n.Transaction.Listing.name;switch(n.type){case"new transaction":return`A new transaction was made on your ${r}`;case"cancellation":return n.Transaction.customerID===this.user.getId()?`Your transaction on ${r} has been cancelled`:`A transaction on your ${r} has been cancelled`;case"payment confirmation":return`Your payment on ${r} has been confirmed`;case"reviewable":return`You can review your recent transaction of ${r}`}}clickedNotification(n){this.db.markNotificationAsViewed(n.notificationID,this.user.getLoginToken()).then(r=>{switch(n.type){case"new transaction":this.router.navigate(["/listings/details",n.transaction.listingID,"transactions"]);break;case"cancellation":n.transaction.customerID===this.user.getId()?this.router.navigate(["/listings"],{queryParams:{transactions:!0}}):this.router.navigate(["/listings/details",n.transaction.listingID,"transactions"]);break;case"payment confirmation":case"reviewable":this.router.navigate(["/transactions"])}})}fetchNotifications(){this.user.isLoggedIn()&&this.db.getUserNotifications(this.user.getLoginToken()).then(n=>this.notifications=n.notifications.sort((r,s)=>s.notificationID-r.notificationID))}fetchMessageNotifications(){this.user.isLoggedIn()&&this.db.getNewMessagesAmount(this.user.getLoginToken()).then(n=>this.unseenMessages=n.messageAmount)}getUnreadNotificationsAmount(){return this.notifications.filter(n=>!n.viewed).length}deleteNotifications(){this.db.deleteNotifications(this.user.getLoginToken()).then(n=>{this.fetchNotifications()})}}return(e=t).\u0275fac=function(n){return new(n||e)(oe(Bc),oe(hs),oe(Lr),oe(C0),oe(xp))},e.\u0275cmp=In({type:e,selectors:[["app-root"]],decls:16,vars:5,consts:[[1,"navbar","navbar-expand-lg","navbar-dark","bg-dark"],["routerLink","/",1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarSupportedContent","aria-controls","navbarSupportedContent","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarSupportedContent",1,"collapse","navbar-collapse"],[1,"navbar-nav","me-auto"],[1,"nav-item"],["routerLink","/listings",1,"nav-link"],["class","nav-item",4,"ngIf"],["class","navbar-nav my-2 my-lg-0",4,"ngIf"],["routerLink","/mylistings",1,"nav-link",3,"queryParams"],["routerLink","/transactions",1,"nav-link"],[1,"navbar-nav","my-2","my-lg-0"],["routerLink","/signup",1,"nav-link"],["routerLink","/login",1,"nav-link"],["routerLink","/messages",1,"nav-link"],["class","badge rounded-pill bg-danger",4,"ngIf"],[1,"nav-item","dropdown"],["href","#","id","notificationsDropdown","role","button","data-bs-toggle","dropdown","aria-expanded","false",1,"nav-link"],["aria-labelledby","notificationsDropdown",1,"dropdown-menu","overflow-auto",2,"max-height","81vh"],["class","text-end",4,"ngIf"],[4,"ngFor","ngForOf"],["class","dropdown-item",4,"ngIf"],["routerLink","/profile",1,"nav-link"],[2,"border-radius","50%","height","30px","width","30px",3,"src"],["routerLink","/login",1,"nav-link",2,"margin-top","3px",3,"click"],[1,"btn","btn-success",3,"routerLink"],[1,"badge","rounded-pill","bg-danger"],[1,"text-end"],[1,"btn","btn-block","btn-outline-danger","text-center",3,"click"],[1,"dropdown-item",2,"width","300px","white-space","pre-wrap",3,"click"],[4,"ngIf"],[1,"dropdown-item"]],template:function(n,r){1&n&&(H(0,"nav",0)(1,"a",1),ne(2),j(),H(3,"button",2),Rt(4,"span",3),j(),H(5,"div",4)(6,"ul",5)(7,"li",6)(8,"a",7),ne(9," Listings "),j()(),me(10,OJ,3,3,"li",8),me(11,FJ,3,0,"li",8),j(),me(12,NJ,7,0,"ul",9),me(13,GJ,24,10,"ul",9),j()(),Rt(14,"router-outlet"),ne(15," \xa0\n")),2&n&&(G(2),Ft(" ",r.title," "),G(8),ee("ngIf",r.user.isLoggedIn()),G(1),ee("ngIf",r.user.isLoggedIn()),G(1),ee("ngIf",!r.user.isLoggedIn()),G(1),ee("ngIf",r.user.isLoggedIn()))},dependencies:[to,fr,ZE,Fc,ZN]}),t})();function YN(e){return new He(3e3,!1)}function Dp(e){switch(e.length){case 0:return new z0;case 1:return e[0];default:return new YO(e)}}function XN(e,t,i=new Map,n=new Map){const r=[],s=[];let d=-1,m=null;if(t.forEach(b=>{const E=b.get("offset"),I=E==d,O=I&&m||new Map;b.forEach((q,Y)=>{let pe=Y,Te=q;if("offset"!==Y)switch(pe=e.normalizePropertyName(pe,r),Te){case"!":Te=i.get(Y);break;case Ou:Te=n.get(Y);break;default:Te=e.normalizeStyleValue(Y,pe,Te,r)}O.set(pe,Te)}),I||s.push(O),m=O,d=E}),r.length)throw function mee(e){return new He(3502,!1)}();return s}function BS(e,t,i,n){switch(t){case"start":e.onStart(()=>n(i&&zS(i,"start",e)));break;case"done":e.onDone(()=>n(i&&zS(i,"done",e)));break;case"destroy":e.onDestroy(()=>n(i&&zS(i,"destroy",e)))}}function zS(e,t,i){const s=VS(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,i.totalTime??e.totalTime,!!i.disabled),d=e._data;return null!=d&&(s._data=d),s}function VS(e,t,i,n,r="",s=0,d){return{element:e,triggerName:t,fromState:i,toState:n,phaseName:r,totalTime:s,disabled:!!d}}function Xa(e,t,i){let n=e.get(t);return n||e.set(t,n=i),n}function KN(e){const t=e.indexOf(":");return[e.substring(1,t),e.slice(t+1)]}const See=(()=>typeof document>"u"?null:document.documentElement)();function jS(e){const t=e.parentNode||e.host||null;return t===See?null:t}let Pm=null,QN=!1;function JN(e,t){for(;t;){if(t===e)return!0;t=jS(t)}return!1}function eL(e,t,i){if(i)return Array.from(e.querySelectorAll(t));const n=e.querySelector(t);return n?[n]:[]}let tL=(()=>{var e;class t{validateStyleProperty(n){return function Aee(e){Pm||(Pm=function Iee(){return typeof document<"u"?document.body:null}()||{},QN=!!Pm.style&&"WebkitAppearance"in Pm.style);let t=!0;return Pm.style&&!function Mee(e){return"ebkit"==e.substring(1,6)}(e)&&(t=e in Pm.style,!t&&QN&&(t="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in Pm.style)),t}(n)}matchesElement(n,r){return!1}containsElement(n,r){return JN(n,r)}getParentElement(n){return jS(n)}query(n,r,s){return eL(n,r,s)}computeStyle(n,r,s){return s||""}animate(n,r,s,d,m,b=[],E){return new z0(s,d)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})(),US=(()=>{class t{}return t.NOOP=new tL,t})();const Ree=1e3,$S="ng-enter",Zw="ng-leave",Yw="ng-trigger",Xw=".ng-trigger",iL="ng-animating",HS=".ng-animating";function Nu(e){if("number"==typeof e)return e;const t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:GS(parseFloat(t[1]),t[2])}function GS(e,t){return"s"===t?e*Ree:e}function Kw(e,t,i){return e.hasOwnProperty("duration")?e:function Pee(e,t,i){let r,s=0,d="";if("string"==typeof e){const m=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===m)return t.push(YN()),{duration:0,delay:0,easing:""};r=GS(parseFloat(m[1]),m[2]);const b=m[3];null!=b&&(s=GS(parseFloat(b),m[4]));const E=m[5];E&&(d=E)}else r=e;if(!i){let m=!1,b=t.length;r<0&&(t.push(function WJ(){return new He(3100,!1)}()),m=!0),s<0&&(t.push(function ZJ(){return new He(3101,!1)}()),m=!0),m&&t.splice(b,0,YN())}return{duration:r,delay:s,easing:d}}(e,t,i)}function ib(e,t={}){return Object.keys(e).forEach(i=>{t[i]=e[i]}),t}function rL(e){const t=new Map;return Object.keys(e).forEach(i=>{t.set(i,e[i])}),t}function Ep(e,t=new Map,i){if(i)for(let[n,r]of i)t.set(n,r);for(let[n,r]of e)t.set(n,r);return t}function kd(e,t,i){t.forEach((n,r)=>{const s=WS(r);i&&!i.has(r)&&i.set(r,e.style[s]),e.style[s]=n})}function Om(e,t){t.forEach((i,n)=>{const r=WS(n);e.style[r]=""})}function rb(e){return Array.isArray(e)?1==e.length?e[0]:WO(e):e}const qS=new RegExp("{{\\s*(.+?)\\s*}}","g");function sL(e){let t=[];if("string"==typeof e){let i;for(;i=qS.exec(e);)t.push(i[1]);qS.lastIndex=0}return t}function ob(e,t,i){const n=e.toString(),r=n.replace(qS,(s,d)=>{let m=t[d];return null==m&&(i.push(function XJ(e){return new He(3003,!1)}()),m=""),m.toString()});return r==n?e:r}function Qw(e){const t=[];let i=e.next();for(;!i.done;)t.push(i.value),i=e.next();return t}const Nee=/-+([a-z0-9])/g;function WS(e){return e.replace(Nee,(...t)=>t[1].toUpperCase())}function Ka(e,t,i){switch(t.type){case 7:return e.visitTrigger(t,i);case 0:return e.visitState(t,i);case 1:return e.visitTransition(t,i);case 2:return e.visitSequence(t,i);case 3:return e.visitGroup(t,i);case 4:return e.visitAnimate(t,i);case 5:return e.visitKeyframes(t,i);case 6:return e.visitStyle(t,i);case 8:return e.visitReference(t,i);case 9:return e.visitAnimateChild(t,i);case 10:return e.visitAnimateRef(t,i);case 11:return e.visitQuery(t,i);case 12:return e.visitStagger(t,i);default:throw function KJ(e){return new He(3004,!1)}()}}function aL(e,t){return window.getComputedStyle(e)[t]}const Jw="*";function zee(e,t){const i=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(n=>function Vee(e,t,i){if(":"==e[0]){const b=function jee(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(i,n)=>parseFloat(n)>parseFloat(i);case":decrement":return(i,n)=>parseFloat(n)<parseFloat(i);default:return t.push(function uee(e){return new He(3016,!1)}()),"* => *"}}(e,i);if("function"==typeof b)return void t.push(b);e=b}const n=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==n||n.length<4)return i.push(function dee(e){return new He(3015,!1)}()),t;const r=n[1],s=n[2],d=n[3];t.push(lL(r,d));"<"==s[0]&&!(r==Jw&&d==Jw)&&t.push(lL(d,r))}(n,i,t)):i.push(e),i}const eC=new Set(["true","1"]),tC=new Set(["false","0"]);function lL(e,t){const i=eC.has(e)||tC.has(e),n=eC.has(t)||tC.has(t);return(r,s)=>{let d=e==Jw||e==r,m=t==Jw||t==s;return!d&&i&&"boolean"==typeof r&&(d=r?eC.has(e):tC.has(e)),!m&&n&&"boolean"==typeof s&&(m=s?eC.has(t):tC.has(t)),d&&m}}const Uee=new RegExp("s*:selfs*,?","g");function ZS(e,t,i,n){return new $ee(e).build(t,i,n)}class $ee{constructor(t){this._driver=t}build(t,i,n){const r=new qee(i);return this._resetContextStyleTimingState(r),Ka(this,rb(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,i){let n=i.queryCount=0,r=i.depCount=0;const s=[],d=[];return"@"==t.name.charAt(0)&&i.errors.push(function JJ(){return new He(3006,!1)}()),t.definitions.forEach(m=>{if(this._resetContextStyleTimingState(i),0==m.type){const b=m,E=b.name;E.toString().split(/\s*,\s*/).forEach(I=>{b.name=I,s.push(this.visitState(b,i))}),b.name=E}else if(1==m.type){const b=this.visitTransition(m,i);n+=b.queryCount,r+=b.depCount,d.push(b)}else i.errors.push(function eee(){return new He(3007,!1)}())}),{type:7,name:t.name,states:s,transitions:d,queryCount:n,depCount:r,options:null}}visitState(t,i){const n=this.visitStyle(t.styles,i),r=t.options&&t.options.params||null;if(n.containsDynamicStyles){const s=new Set,d=r||{};n.styles.forEach(m=>{m instanceof Map&&m.forEach(b=>{sL(b).forEach(E=>{d.hasOwnProperty(E)||s.add(E)})})}),s.size&&(Qw(s.values()),i.errors.push(function tee(e,t){return new He(3008,!1)}()))}return{type:0,name:t.name,style:n,options:r?{params:r}:null}}visitTransition(t,i){i.queryCount=0,i.depCount=0;const n=Ka(this,rb(t.animation),i);return{type:1,matchers:zee(t.expr,i.errors),animation:n,queryCount:i.queryCount,depCount:i.depCount,options:Fm(t.options)}}visitSequence(t,i){return{type:2,steps:t.steps.map(n=>Ka(this,n,i)),options:Fm(t.options)}}visitGroup(t,i){const n=i.currentTime;let r=0;const s=t.steps.map(d=>{i.currentTime=n;const m=Ka(this,d,i);return r=Math.max(r,i.currentTime),m});return i.currentTime=r,{type:3,steps:s,options:Fm(t.options)}}visitAnimate(t,i){const n=function Zee(e,t){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return YS(Kw(e,t).duration,0,"");const i=e;if(i.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=YS(0,0,"");return s.dynamic=!0,s.strValue=i,s}const r=Kw(i,t);return YS(r.duration,r.delay,r.easing)}(t.timings,i.errors);i.currentAnimateTimings=n;let r,s=t.styles?t.styles:Lc({});if(5==s.type)r=this.visitKeyframes(s,i);else{let d=t.styles,m=!1;if(!d){m=!0;const E={};n.easing&&(E.easing=n.easing),d=Lc(E)}i.currentTime+=n.duration+n.delay;const b=this.visitStyle(d,i);b.isEmptyStep=m,r=b}return i.currentAnimateTimings=null,{type:4,timings:n,style:r,options:null}}visitStyle(t,i){const n=this._makeStyleAst(t,i);return this._validateStyleAst(n,i),n}_makeStyleAst(t,i){const n=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let m of r)"string"==typeof m?m===Ou?n.push(m):i.errors.push(new He(3002,!1)):n.push(rL(m));let s=!1,d=null;return n.forEach(m=>{if(m instanceof Map&&(m.has("easing")&&(d=m.get("easing"),m.delete("easing")),!s))for(let b of m.values())if(b.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:n,easing:d,offset:t.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(t,i){const n=i.currentAnimateTimings;let r=i.currentTime,s=i.currentTime;n&&s>0&&(s-=n.duration+n.delay),t.styles.forEach(d=>{"string"!=typeof d&&d.forEach((m,b)=>{const E=i.collectedStyles.get(i.currentQuerySelector),I=E.get(b);let O=!0;I&&(s!=r&&s>=I.startTime&&r<=I.endTime&&(i.errors.push(function iee(e,t,i,n,r){return new He(3010,!1)}()),O=!1),s=I.startTime),O&&E.set(b,{startTime:s,endTime:r}),i.options&&function Fee(e,t,i){const n=t.params||{},r=sL(e);r.length&&r.forEach(s=>{n.hasOwnProperty(s)||i.push(function YJ(e){return new He(3001,!1)}())})}(m,i.options,i.errors)})})}visitKeyframes(t,i){const n={type:5,styles:[],options:null};if(!i.currentAnimateTimings)return i.errors.push(function ree(){return new He(3011,!1)}()),n;let s=0;const d=[];let m=!1,b=!1,E=0;const I=t.steps.map(Ge=>{const Oe=this._makeStyleAst(Ge,i);let pt=null!=Oe.offset?Oe.offset:function Wee(e){if("string"==typeof e)return null;let t=null;if(Array.isArray(e))e.forEach(i=>{if(i instanceof Map&&i.has("offset")){const n=i;t=parseFloat(n.get("offset")),n.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const i=e;t=parseFloat(i.get("offset")),i.delete("offset")}return t}(Oe.styles),rt=0;return null!=pt&&(s++,rt=Oe.offset=pt),b=b||rt<0||rt>1,m=m||rt<E,E=rt,d.push(rt),Oe});b&&i.errors.push(function oee(){return new He(3012,!1)}()),m&&i.errors.push(function see(){return new He(3200,!1)}());const O=t.steps.length;let q=0;s>0&&s<O?i.errors.push(function aee(){return new He(3202,!1)}()):0==s&&(q=1/(O-1));const Y=O-1,pe=i.currentTime,Te=i.currentAnimateTimings,ke=Te.duration;return I.forEach((Ge,Oe)=>{const pt=q>0?Oe==Y?1:q*Oe:d[Oe],rt=pt*ke;i.currentTime=pe+Te.delay+rt,Te.duration=rt,this._validateStyleAst(Ge,i),Ge.offset=pt,n.styles.push(Ge)}),n}visitReference(t,i){return{type:8,animation:Ka(this,rb(t.animation),i),options:Fm(t.options)}}visitAnimateChild(t,i){return i.depCount++,{type:9,options:Fm(t.options)}}visitAnimateRef(t,i){return{type:10,animation:this.visitReference(t.animation,i),options:Fm(t.options)}}visitQuery(t,i){const n=i.currentQuerySelector,r=t.options||{};i.queryCount++,i.currentQuery=t;const[s,d]=function Hee(e){const t=!!e.split(/\s*,\s*/).find(i=>":self"==i);return t&&(e=e.replace(Uee,"")),e=e.replace(/@\*/g,Xw).replace(/@\w+/g,i=>Xw+"-"+i.slice(1)).replace(/:animating/g,HS),[e,t]}(t.selector);i.currentQuerySelector=n.length?n+" "+s:s,Xa(i.collectedStyles,i.currentQuerySelector,new Map);const m=Ka(this,rb(t.animation),i);return i.currentQuery=null,i.currentQuerySelector=n,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:d,animation:m,originalSelector:t.selector,options:Fm(t.options)}}visitStagger(t,i){i.currentQuery||i.errors.push(function lee(){return new He(3013,!1)}());const n="full"===t.timings?{duration:0,delay:0,easing:"full"}:Kw(t.timings,i.errors,!0);return{type:12,animation:Ka(this,rb(t.animation),i),timings:n,options:null}}}class qee{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Fm(e){return e?(e=ib(e)).params&&(e.params=function Gee(e){return e?ib(e):null}(e.params)):e={},e}function YS(e,t,i){return{duration:e,delay:t,easing:i}}function XS(e,t,i,n,r,s,d=null,m=!1){return{type:1,element:e,keyframes:t,preStyleProps:i,postStyleProps:n,duration:r,delay:s,totalTime:r+s,easing:d,subTimeline:m}}class nC{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,i){let n=this._map.get(t);n||this._map.set(t,n=[]),n.push(...i)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const Kee=new RegExp(":enter","g"),Jee=new RegExp(":leave","g");function KS(e,t,i,n,r,s=new Map,d=new Map,m,b,E=[]){return(new ete).buildKeyframes(e,t,i,n,r,s,d,m,b,E)}class ete{buildKeyframes(t,i,n,r,s,d,m,b,E,I=[]){E=E||new nC;const O=new QS(t,i,E,r,s,I,[]);O.options=b;const q=b.delay?Nu(b.delay):0;O.currentTimeline.delayNextStep(q),O.currentTimeline.setStyles([d],null,O.errors,b),Ka(this,n,O);const Y=O.timelines.filter(pe=>pe.containsAnimation());if(Y.length&&m.size){let pe;for(let Te=Y.length-1;Te>=0;Te--){const ke=Y[Te];if(ke.element===i){pe=ke;break}}pe&&!pe.allowOnlyTimelineStyles()&&pe.setStyles([m],null,O.errors,b)}return Y.length?Y.map(pe=>pe.buildKeyframes()):[XS(i,[],[],[],0,q,"",!1)]}visitTrigger(t,i){}visitState(t,i){}visitTransition(t,i){}visitAnimateChild(t,i){const n=i.subInstructions.get(i.element);if(n){const r=i.createSubContext(t.options),s=i.currentTimeline.currentTime,d=this._visitSubInstructions(n,r,r.options);s!=d&&i.transformIntoNewTimeline(d)}i.previousNode=t}visitAnimateRef(t,i){const n=i.createSubContext(t.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],i,n),this.visitReference(t.animation,n),i.transformIntoNewTimeline(n.currentTimeline.currentTime),i.previousNode=t}_applyAnimationRefDelays(t,i,n){for(const r of t){const s=r?.delay;if(s){const d="number"==typeof s?s:Nu(ob(s,r?.params??{},i.errors));n.delayNextStep(d)}}}_visitSubInstructions(t,i,n){let s=i.currentTimeline.currentTime;const d=null!=n.duration?Nu(n.duration):null,m=null!=n.delay?Nu(n.delay):null;return 0!==d&&t.forEach(b=>{const E=i.appendInstructionToTimeline(b,d,m);s=Math.max(s,E.duration+E.delay)}),s}visitReference(t,i){i.updateOptions(t.options,!0),Ka(this,t.animation,i),i.previousNode=t}visitSequence(t,i){const n=i.subContextCount;let r=i;const s=t.options;if(s&&(s.params||s.delay)&&(r=i.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=iC);const d=Nu(s.delay);r.delayNextStep(d)}t.steps.length&&(t.steps.forEach(d=>Ka(this,d,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>n&&r.transformIntoNewTimeline()),i.previousNode=t}visitGroup(t,i){const n=[];let r=i.currentTimeline.currentTime;const s=t.options&&t.options.delay?Nu(t.options.delay):0;t.steps.forEach(d=>{const m=i.createSubContext(t.options);s&&m.delayNextStep(s),Ka(this,d,m),r=Math.max(r,m.currentTimeline.currentTime),n.push(m.currentTimeline)}),n.forEach(d=>i.currentTimeline.mergeTimelineCollectedStyles(d)),i.transformIntoNewTimeline(r),i.previousNode=t}_visitTiming(t,i){if(t.dynamic){const n=t.strValue;return Kw(i.params?ob(n,i.params,i.errors):n,i.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,i){const n=i.currentAnimateTimings=this._visitTiming(t.timings,i),r=i.currentTimeline;n.delay&&(i.incrementTime(n.delay),r.snapshotCurrentStyles());const s=t.style;5==s.type?this.visitKeyframes(s,i):(i.incrementTime(n.duration),this.visitStyle(s,i),r.applyStylesToKeyframe()),i.currentAnimateTimings=null,i.previousNode=t}visitStyle(t,i){const n=i.currentTimeline,r=i.currentAnimateTimings;!r&&n.hasCurrentStyleProperties()&&n.forwardFrame();const s=r&&r.easing||t.easing;t.isEmptyStep?n.applyEmptyStep(s):n.setStyles(t.styles,s,i.errors,i.options),i.previousNode=t}visitKeyframes(t,i){const n=i.currentAnimateTimings,r=i.currentTimeline.duration,s=n.duration,m=i.createSubContext().currentTimeline;m.easing=n.easing,t.styles.forEach(b=>{m.forwardTime((b.offset||0)*s),m.setStyles(b.styles,b.easing,i.errors,i.options),m.applyStylesToKeyframe()}),i.currentTimeline.mergeTimelineCollectedStyles(m),i.transformIntoNewTimeline(r+s),i.previousNode=t}visitQuery(t,i){const n=i.currentTimeline.currentTime,r=t.options||{},s=r.delay?Nu(r.delay):0;s&&(6===i.previousNode.type||0==n&&i.currentTimeline.hasCurrentStyleProperties())&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=iC);let d=n;const m=i.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,i.errors);i.currentQueryTotal=m.length;let b=null;m.forEach((E,I)=>{i.currentQueryIndex=I;const O=i.createSubContext(t.options,E);s&&O.delayNextStep(s),E===i.element&&(b=O.currentTimeline),Ka(this,t.animation,O),O.currentTimeline.applyStylesToKeyframe(),d=Math.max(d,O.currentTimeline.currentTime)}),i.currentQueryIndex=0,i.currentQueryTotal=0,i.transformIntoNewTimeline(d),b&&(i.currentTimeline.mergeTimelineCollectedStyles(b),i.currentTimeline.snapshotCurrentStyles()),i.previousNode=t}visitStagger(t,i){const n=i.parentContext,r=i.currentTimeline,s=t.timings,d=Math.abs(s.duration),m=d*(i.currentQueryTotal-1);let b=d*i.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":b=m-b;break;case"full":b=n.currentStaggerTime}const I=i.currentTimeline;b&&I.delayNextStep(b);const O=I.currentTime;Ka(this,t.animation,i),i.previousNode=t,n.currentStaggerTime=r.currentTime-O+(r.startTime-n.currentTimeline.startTime)}}const iC={};class QS{constructor(t,i,n,r,s,d,m,b){this._driver=t,this.element=i,this.subInstructions=n,this._enterClassName=r,this._leaveClassName=s,this.errors=d,this.timelines=m,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=iC,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=b||new rC(this._driver,i,0),m.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,i){if(!t)return;const n=t;let r=this.options;null!=n.duration&&(r.duration=Nu(n.duration)),null!=n.delay&&(r.delay=Nu(n.delay));const s=n.params;if(s){let d=r.params;d||(d=this.options.params={}),Object.keys(s).forEach(m=>{(!i||!d.hasOwnProperty(m))&&(d[m]=ob(s[m],d,this.errors))})}}_copyOptions(){const t={};if(this.options){const i=this.options.params;if(i){const n=t.params={};Object.keys(i).forEach(r=>{n[r]=i[r]})}}return t}createSubContext(t=null,i,n){const r=i||this.element,s=new QS(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,n||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(t),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(t){return this.previousNode=iC,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,i,n){const r={duration:i??t.duration,delay:this.currentTimeline.currentTime+(n??0)+t.delay,easing:""},s=new tte(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,i,n,r,s,d){let m=[];if(r&&m.push(this.element),t.length>0){t=(t=t.replace(Kee,"."+this._enterClassName)).replace(Jee,"."+this._leaveClassName);let E=this._driver.query(this.element,t,1!=n);0!==n&&(E=n<0?E.slice(E.length+n,E.length):E.slice(0,n)),m.push(...E)}return!s&&0==m.length&&d.push(function cee(e){return new He(3014,!1)}()),m}}class rC{constructor(t,i,n,r){this._driver=t,this.element=i,this.startTime=n,this._elementTimelineStylesLookup=r,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(i),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(i,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const i=1===this._keyframes.size&&this._pendingStyles.size;this.duration||i?(this.forwardTime(this.currentTime+t),i&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,i){return this.applyStylesToKeyframe(),new rC(this._driver,t,i||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,i){this._localTimelineStyles.set(t,i),this._globalTimelineStyles.set(t,i),this._styleSummary.set(t,{time:this.currentTime,value:i})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[i,n]of this._globalTimelineStyles)this._backFill.set(i,n||Ou),this._currentKeyframe.set(i,Ou);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,i,n,r){i&&this._previousKeyframe.set("easing",i);const s=r&&r.params||{},d=function nte(e,t){const i=new Map;let n;return e.forEach(r=>{if("*"===r){n=n||t.keys();for(let s of n)i.set(s,Ou)}else Ep(r,i)}),i}(t,this._globalTimelineStyles);for(let[m,b]of d){const E=ob(b,s,n);this._pendingStyles.set(m,E),this._localTimelineStyles.has(m)||this._backFill.set(m,this._globalTimelineStyles.get(m)??Ou),this._updateStyle(m,E)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,i)=>{this._currentKeyframe.set(i,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,i)=>{this._currentKeyframe.has(i)||this._currentKeyframe.set(i,t)}))}snapshotCurrentStyles(){for(let[t,i]of this._localTimelineStyles)this._pendingStyles.set(t,i),this._updateStyle(t,i)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let i in this._currentKeyframe)t.push(i);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((i,n)=>{const r=this._styleSummary.get(n);(!r||i.time>r.time)&&this._updateStyle(n,i.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,i=new Set,n=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((m,b)=>{const E=Ep(m,new Map,this._backFill);E.forEach((I,O)=>{"!"===I?t.add(O):I===Ou&&i.add(O)}),n||E.set("offset",b/this.duration),r.push(E)});const s=t.size?Qw(t.values()):[],d=i.size?Qw(i.values()):[];if(n){const m=r[0],b=new Map(m);m.set("offset",0),b.set("offset",1),r=[m,b]}return XS(this.element,r,s,d,this.duration,this.startTime,this.easing,!1)}}class tte extends rC{constructor(t,i,n,r,s,d,m=!1){super(t,i,d.delay),this.keyframes=n,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=m,this.timings={duration:d.duration,delay:d.delay,easing:d.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:i,duration:n,easing:r}=this.timings;if(this._stretchStartingKeyframe&&i){const s=[],d=n+i,m=i/d,b=Ep(t[0]);b.set("offset",0),s.push(b);const E=Ep(t[0]);E.set("offset",uL(m)),s.push(E);const I=t.length-1;for(let O=1;O<=I;O++){let q=Ep(t[O]);const Y=q.get("offset");q.set("offset",uL((i+Y*n)/d)),s.push(q)}n=d,i=0,r="",t=s}return XS(this.element,t,this.preStyleProps,this.postStyleProps,n,i,r,!0)}}function uL(e,t=3){const i=Math.pow(10,t-1);return Math.round(e*i)/i}class JS{}const ite=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class rte extends JS{normalizePropertyName(t,i){return WS(t)}normalizeStyleValue(t,i,n,r){let s="";const d=n.toString().trim();if(ite.has(i)&&0!==n&&"0"!==n)if("number"==typeof n)s="px";else{const m=n.match(/^[+-]?[\d\.]+([a-z]*)$/);m&&0==m[1].length&&r.push(function QJ(e,t){return new He(3005,!1)}())}return d+s}}function hL(e,t,i,n,r,s,d,m,b,E,I,O,q){return{type:0,element:e,triggerName:t,isRemovalTransition:r,fromState:i,fromStyles:s,toState:n,toStyles:d,timelines:m,queriedElements:b,preStyleProps:E,postStyleProps:I,totalTime:O,errors:q}}const eM={};class pL{constructor(t,i,n){this._triggerName=t,this.ast=i,this._stateStyles=n}match(t,i,n,r){return function ote(e,t,i,n,r){return e.some(s=>s(t,i,n,r))}(this.ast.matchers,t,i,n,r)}buildStyles(t,i,n){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(t?.toString())||r),r?r.buildStyles(i,n):new Map}build(t,i,n,r,s,d,m,b,E,I){const O=[],q=this.ast.options&&this.ast.options.params||eM,pe=this.buildStyles(n,m&&m.params||eM,O),Te=b&&b.params||eM,ke=this.buildStyles(r,Te,O),Ge=new Set,Oe=new Map,pt=new Map,rt="void"===r,At={params:ste(Te,q),delay:this.ast.options?.delay},Wt=I?[]:KS(t,i,this.ast.animation,s,d,pe,ke,At,E,O);let en=0;if(Wt.forEach(pi=>{en=Math.max(pi.duration+pi.delay,en)}),O.length)return hL(i,this._triggerName,n,r,rt,pe,ke,[],[],Oe,pt,en,O);Wt.forEach(pi=>{const wi=pi.element,Br=Xa(Oe,wi,new Set);pi.preStyleProps.forEach(_r=>Br.add(_r));const Zo=Xa(pt,wi,new Set);pi.postStyleProps.forEach(_r=>Zo.add(_r)),wi!==i&&Ge.add(wi)});const Mn=Qw(Ge.values());return hL(i,this._triggerName,n,r,rt,pe,ke,Wt,Mn,Oe,pt,en)}}function ste(e,t){const i=ib(t);for(const n in e)e.hasOwnProperty(n)&&null!=e[n]&&(i[n]=e[n]);return i}class ate{constructor(t,i,n){this.styles=t,this.defaultParams=i,this.normalizer=n}buildStyles(t,i){const n=new Map,r=ib(this.defaultParams);return Object.keys(t).forEach(s=>{const d=t[s];null!==d&&(r[s]=d)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((d,m)=>{d&&(d=ob(d,r,i));const b=this.normalizer.normalizePropertyName(m,i);d=this.normalizer.normalizeStyleValue(m,b,d,i),n.set(m,d)})}),n}}class cte{constructor(t,i,n){this.name=t,this.ast=i,this._normalizer=n,this.transitionFactories=[],this.states=new Map,i.states.forEach(r=>{this.states.set(r.name,new ate(r.style,r.options&&r.options.params||{},n))}),fL(this.states,"true","1"),fL(this.states,"false","0"),i.transitions.forEach(r=>{this.transitionFactories.push(new pL(t,r,this.states))}),this.fallbackTransition=function dte(e,t,i){return new pL(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(d,m)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,i,n,r){return this.transitionFactories.find(d=>d.match(t,i,n,r))||null}matchStyles(t,i,n){return this.fallbackTransition.buildStyles(t,i,n)}}function fL(e,t,i){e.has(t)?e.has(i)||e.set(i,e.get(t)):e.has(i)&&e.set(t,e.get(i))}const ute=new nC;class hte{constructor(t,i,n){this.bodyNode=t,this._driver=i,this._normalizer=n,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,i){const n=[],s=ZS(this._driver,i,n,[]);if(n.length)throw function _ee(e){return new He(3503,!1)}();this._animations.set(t,s)}_buildPlayer(t,i,n){const r=t.element,s=XN(this._normalizer,t.keyframes,i,n);return this._driver.animate(r,s,t.duration,t.delay,t.easing,[],!0)}create(t,i,n={}){const r=[],s=this._animations.get(t);let d;const m=new Map;if(s?(d=KS(this._driver,i,s,$S,Zw,new Map,new Map,n,ute,r),d.forEach(I=>{const O=Xa(m,I.element,new Map);I.postStyleProps.forEach(q=>O.set(q,null))})):(r.push(function gee(){return new He(3300,!1)}()),d=[]),r.length)throw function yee(e){return new He(3504,!1)}();m.forEach((I,O)=>{I.forEach((q,Y)=>{I.set(Y,this._driver.computeStyle(O,Y,Ou))})});const E=Dp(d.map(I=>{const O=m.get(I.element);return this._buildPlayer(I,new Map,O)}));return this._playersById.set(t,E),E.onDestroy(()=>this.destroy(t)),this.players.push(E),E}destroy(t){const i=this._getPlayer(t);i.destroy(),this._playersById.delete(t);const n=this.players.indexOf(i);n>=0&&this.players.splice(n,1)}_getPlayer(t){const i=this._playersById.get(t);if(!i)throw function vee(e){return new He(3301,!1)}();return i}listen(t,i,n,r){const s=VS(i,"","","");return BS(this._getPlayer(t),n,s,r),()=>{}}command(t,i,n,r){if("register"==n)return void this.register(t,r[0]);if("create"==n)return void this.create(t,i,r[0]||{});const s=this._getPlayer(t);switch(n){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const mL="ng-animate-queued",tM="ng-animate-disabled",gte=[],_L={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},yte={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},$c="__ng_removed";class nM{get params(){return this.options.params}constructor(t,i=""){this.namespaceId=i;const n=t&&t.hasOwnProperty("value");if(this.value=function wte(e){return e??null}(n?t.value:t),n){const s=ib(t);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}absorbOptions(t){const i=t.params;if(i){const n=this.options.params;Object.keys(i).forEach(r=>{null==n[r]&&(n[r]=i[r])})}}}const sb="void",iM=new nM(sb);class vte{constructor(t,i,n){this.id=t,this.hostElement=i,this._engine=n,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,Gl(i,this._hostClassName)}listen(t,i,n,r){if(!this._triggers.has(i))throw function bee(e,t){return new He(3302,!1)}();if(null==n||0==n.length)throw function xee(e){return new He(3303,!1)}();if(!function Cte(e){return"start"==e||"done"==e}(n))throw function wee(e,t){return new He(3400,!1)}();const s=Xa(this._elementListeners,t,[]),d={name:i,phase:n,callback:r};s.push(d);const m=Xa(this._engine.statesByElement,t,new Map);return m.has(i)||(Gl(t,Yw),Gl(t,Yw+"-"+i),m.set(i,iM)),()=>{this._engine.afterFlush(()=>{const b=s.indexOf(d);b>=0&&s.splice(b,1),this._triggers.has(i)||m.delete(i)})}}register(t,i){return!this._triggers.has(t)&&(this._triggers.set(t,i),!0)}_getTrigger(t){const i=this._triggers.get(t);if(!i)throw function Cee(e){return new He(3401,!1)}();return i}trigger(t,i,n,r=!0){const s=this._getTrigger(i),d=new rM(this.id,i,t);let m=this._engine.statesByElement.get(t);m||(Gl(t,Yw),Gl(t,Yw+"-"+i),this._engine.statesByElement.set(t,m=new Map));let b=m.get(i);const E=new nM(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&b&&E.absorbOptions(b.options),m.set(i,E),b||(b=iM),E.value!==sb&&b.value===E.value){if(!function Tte(e,t){const i=Object.keys(e),n=Object.keys(t);if(i.length!=n.length)return!1;for(let r=0;r<i.length;r++){const s=i[r];if(!t.hasOwnProperty(s)||e[s]!==t[s])return!1}return!0}(b.params,E.params)){const Te=[],ke=s.matchStyles(b.value,b.params,Te),Ge=s.matchStyles(E.value,E.params,Te);Te.length?this._engine.reportError(Te):this._engine.afterFlush(()=>{Om(t,ke),kd(t,Ge)})}return}const q=Xa(this._engine.playersByElement,t,[]);q.forEach(Te=>{Te.namespaceId==this.id&&Te.triggerName==i&&Te.queued&&Te.destroy()});let Y=s.matchTransition(b.value,E.value,t,E.params),pe=!1;if(!Y){if(!r)return;Y=s.fallbackTransition,pe=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:i,transition:Y,fromState:b,toState:E,player:d,isFallbackTransition:pe}),pe||(Gl(t,mL),d.onStart(()=>{fy(t,mL)})),d.onDone(()=>{let Te=this.players.indexOf(d);Te>=0&&this.players.splice(Te,1);const ke=this._engine.playersByElement.get(t);if(ke){let Ge=ke.indexOf(d);Ge>=0&&ke.splice(Ge,1)}}),this.players.push(d),q.push(d),d}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(i=>i.delete(t)),this._elementListeners.forEach((i,n)=>{this._elementListeners.set(n,i.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const i=this._engine.playersByElement.get(t);i&&(i.forEach(n=>n.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,i){const n=this._engine.driver.query(t,Xw,!0);n.forEach(r=>{if(r[$c])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(d=>d.triggerLeaveAnimation(r,i,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,i,n,r){const s=this._engine.statesByElement.get(t),d=new Map;if(s){const m=[];if(s.forEach((b,E)=>{if(d.set(E,b.value),this._triggers.has(E)){const I=this.trigger(t,E,sb,r);I&&m.push(I)}}),m.length)return this._engine.markElementAsRemoved(this.id,t,!0,i,d),n&&Dp(m).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const i=this._elementListeners.get(t),n=this._engine.statesByElement.get(t);if(i&&n){const r=new Set;i.forEach(s=>{const d=s.name;if(r.has(d))return;r.add(d);const b=this._triggers.get(d).fallbackTransition,E=n.get(d)||iM,I=new nM(sb),O=new rM(this.id,d,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:d,transition:b,fromState:E,toState:I,player:O,isFallbackTransition:!0})})}}removeNode(t,i){const n=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,i),this.triggerLeaveAnimation(t,i,!0))return;let r=!1;if(n.totalAnimations){const s=n.players.length?n.playersByQueriedElement.get(t):[];if(s&&s.length)r=!0;else{let d=t;for(;d=d.parentNode;)if(n.statesByElement.get(d)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)n.markElementAsRemoved(this.id,t,!1,i);else{const s=t[$c];(!s||s===_L)&&(n.afterFlush(()=>this.clearElementCache(t)),n.destroyInnerAnimations(t),n._onRemovalComplete(t,i))}}insertNode(t,i){Gl(t,this._hostClassName)}drainQueuedTransitions(t){const i=[];return this._queue.forEach(n=>{const r=n.player;if(r.destroyed)return;const s=n.element,d=this._elementListeners.get(s);d&&d.forEach(m=>{if(m.name==n.triggerName){const b=VS(s,n.triggerName,n.fromState.value,n.toState.value);b._data=t,BS(n.player,m.phase,b,m.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):i.push(n)}),this._queue=[],i.sort((n,r)=>{const s=n.transition.ast.depCount,d=r.transition.ast.depCount;return 0==s||0==d?s-d:this._engine.driver.containsElement(n.element,r.element)?1:-1})}destroy(t){this.players.forEach(i=>i.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}}class bte{_onRemovalComplete(t,i){this.onRemovalComplete(t,i)}constructor(t,i,n){this.bodyNode=t,this.driver=i,this._normalizer=n,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}get queuedPlayers(){const t=[];return this._namespaceList.forEach(i=>{i.players.forEach(n=>{n.queued&&t.push(n)})}),t}createNamespace(t,i){const n=new vte(t,i,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,i)?this._balanceNamespaceList(n,i):(this.newHostElements.set(i,n),this.collectEnterElement(i)),this._namespaceLookup[t]=n}_balanceNamespaceList(t,i){const n=this._namespaceList,r=this.namespacesByHostElement;if(n.length-1>=0){let d=!1,m=this.driver.getParentElement(i);for(;m;){const b=r.get(m);if(b){const E=n.indexOf(b);n.splice(E+1,0,t),d=!0;break}m=this.driver.getParentElement(m)}d||n.unshift(t)}else n.push(t);return r.set(i,t),t}register(t,i){let n=this._namespaceLookup[t];return n||(n=this.createNamespace(t,i)),n}registerTrigger(t,i,n){let r=this._namespaceLookup[t];r&&r.register(i,n)&&this.totalAnimations++}destroy(t,i){t&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const n=this._fetchNamespace(t);this.namespacesByHostElement.delete(n.hostElement);const r=this._namespaceList.indexOf(n);r>=0&&this._namespaceList.splice(r,1),n.destroy(i),delete this._namespaceLookup[t]}))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const i=new Set,n=this.statesByElement.get(t);if(n)for(let r of n.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&i.add(s)}return i}trigger(t,i,n,r){if(oC(i)){const s=this._fetchNamespace(t);if(s)return s.trigger(i,n,r),!0}return!1}insertNode(t,i,n,r){if(!oC(i))return;const s=i[$c];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const d=this.collectedLeaveElements.indexOf(i);d>=0&&this.collectedLeaveElements.splice(d,1)}if(t){const d=this._fetchNamespace(t);d&&d.insertNode(i,n)}r&&this.collectEnterElement(i)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,i){i?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Gl(t,tM)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),fy(t,tM))}removeNode(t,i,n){if(oC(i)){const r=t?this._fetchNamespace(t):null;r?r.removeNode(i,n):this.markElementAsRemoved(t,i,!1,n);const s=this.namespacesByHostElement.get(i);s&&s.id!==t&&s.removeNode(i,n)}else this._onRemovalComplete(i,n)}markElementAsRemoved(t,i,n,r,s){this.collectedLeaveElements.push(i),i[$c]={namespaceId:t,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:s}}listen(t,i,n,r,s){return oC(i)?this._fetchNamespace(t).listen(i,n,r,s):()=>{}}_buildInstruction(t,i,n,r,s){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,n,r,t.fromState.options,t.toState.options,i,s)}destroyInnerAnimations(t){let i=this.driver.query(t,Xw,!0);i.forEach(n=>this.destroyActiveAnimationsForElement(n)),0!=this.playersByQueriedElement.size&&(i=this.driver.query(t,HS,!0),i.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(t){const i=this.playersByElement.get(t);i&&i.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(t){const i=this.playersByQueriedElement.get(t);i&&i.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Dp(this.players).onDone(()=>t());t()})}processLeaveNode(t){const i=t[$c];if(i&&i.setForRemoval){if(t[$c]=_L,i.namespaceId){this.destroyInnerAnimations(t);const n=this._fetchNamespace(i.namespaceId);n&&n.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}t.classList?.contains(tM)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(t=-1){let i=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,r)=>this._balanceNamespaceList(n,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++)Gl(this.collectedEnterElements[n],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const n=[];try{i=this._flushAnimations(n,t)}finally{for(let r=0;r<n.length;r++)n[r]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++)this.processLeaveNode(this.collectedLeaveElements[n]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){const n=this._whenQuietFns;this._whenQuietFns=[],i.length?Dp(i).onDone(()=>{n.forEach(r=>r())}):n.forEach(r=>r())}}reportError(t){throw function Dee(e){return new He(3402,!1)}()}_flushAnimations(t,i){const n=new nC,r=[],s=new Map,d=[],m=new Map,b=new Map,E=new Map,I=new Set;this.disabledNodes.forEach(kt=>{I.add(kt);const $t=this.driver.query(kt,".ng-animate-queued",!0);for(let on=0;on<$t.length;on++)I.add($t[on])});const O=this.bodyNode,q=Array.from(this.statesByElement.keys()),Y=vL(q,this.collectedEnterElements),pe=new Map;let Te=0;Y.forEach((kt,$t)=>{const on=$S+Te++;pe.set($t,on),kt.forEach(Bn=>Gl(Bn,on))});const ke=[],Ge=new Set,Oe=new Set;for(let kt=0;kt<this.collectedLeaveElements.length;kt++){const $t=this.collectedLeaveElements[kt],on=$t[$c];on&&on.setForRemoval&&(ke.push($t),Ge.add($t),on.hasAnimation?this.driver.query($t,".ng-star-inserted",!0).forEach(Bn=>Ge.add(Bn)):Oe.add($t))}const pt=new Map,rt=vL(q,Array.from(Ge));rt.forEach((kt,$t)=>{const on=Zw+Te++;pt.set($t,on),kt.forEach(Bn=>Gl(Bn,on))}),t.push(()=>{Y.forEach((kt,$t)=>{const on=pe.get($t);kt.forEach(Bn=>fy(Bn,on))}),rt.forEach((kt,$t)=>{const on=pt.get($t);kt.forEach(Bn=>fy(Bn,on))}),ke.forEach(kt=>{this.processLeaveNode(kt)})});const At=[],Wt=[];for(let kt=this._namespaceList.length-1;kt>=0;kt--)this._namespaceList[kt].drainQueuedTransitions(i).forEach(on=>{const Bn=on.player,gr=on.element;if(At.push(Bn),this.collectedEnterElements.length){const zr=gr[$c];if(zr&&zr.setForMove){if(zr.previousTriggersValues&&zr.previousTriggersValues.has(on.triggerName)){const js=zr.previousTriggersValues.get(on.triggerName),fs=this.statesByElement.get(on.element);if(fs&&fs.has(on.triggerName)){const my=fs.get(on.triggerName);my.value=js,fs.set(on.triggerName,my)}}return void Bn.destroy()}}const va=!O||!this.driver.containsElement(O,gr),yo=pt.get(gr),Qa=pe.get(gr),Di=this._buildInstruction(on,n,Qa,yo,va);if(Di.errors&&Di.errors.length)return void Wt.push(Di);if(va)return Bn.onStart(()=>Om(gr,Di.fromStyles)),Bn.onDestroy(()=>kd(gr,Di.toStyles)),void r.push(Bn);if(on.isFallbackTransition)return Bn.onStart(()=>Om(gr,Di.fromStyles)),Bn.onDestroy(()=>kd(gr,Di.toStyles)),void r.push(Bn);const Hc=[];Di.timelines.forEach(zr=>{zr.stretchStartingKeyframe=!0,this.disabledNodes.has(zr.element)||Hc.push(zr)}),Di.timelines=Hc,n.append(gr,Di.timelines),d.push({instruction:Di,player:Bn,element:gr}),Di.queriedElements.forEach(zr=>Xa(m,zr,[]).push(Bn)),Di.preStyleProps.forEach((zr,js)=>{if(zr.size){let fs=b.get(js);fs||b.set(js,fs=new Set),zr.forEach((my,Lm)=>fs.add(Lm))}}),Di.postStyleProps.forEach((zr,js)=>{let fs=E.get(js);fs||E.set(js,fs=new Set),zr.forEach((my,Lm)=>fs.add(Lm))})});if(Wt.length){const kt=[];Wt.forEach($t=>{kt.push(function Eee(e,t){return new He(3505,!1)}())}),At.forEach($t=>$t.destroy()),this.reportError(kt)}const en=new Map,Mn=new Map;d.forEach(kt=>{const $t=kt.element;n.has($t)&&(Mn.set($t,$t),this._beforeAnimationBuild(kt.player.namespaceId,kt.instruction,en))}),r.forEach(kt=>{const $t=kt.element;this._getPreviousPlayers($t,!1,kt.namespaceId,kt.triggerName,null).forEach(Bn=>{Xa(en,$t,[]).push(Bn),Bn.destroy()})});const pi=ke.filter(kt=>xL(kt,b,E)),wi=new Map;yL(wi,this.driver,Oe,E,Ou).forEach(kt=>{xL(kt,b,E)&&pi.push(kt)});const Zo=new Map;Y.forEach((kt,$t)=>{yL(Zo,this.driver,new Set(kt),b,"!")}),pi.forEach(kt=>{const $t=wi.get(kt),on=Zo.get(kt);wi.set(kt,new Map([...$t?.entries()??[],...on?.entries()??[]]))});const _r=[],Pd=[],Od={};d.forEach(kt=>{const{element:$t,player:on,instruction:Bn}=kt;if(n.has($t)){if(I.has($t))return on.onDestroy(()=>kd($t,Bn.toStyles)),on.disabled=!0,on.overrideTotalTime(Bn.totalTime),void r.push(on);let gr=Od;if(Mn.size>1){let yo=$t;const Qa=[];for(;yo=yo.parentNode;){const Di=Mn.get(yo);if(Di){gr=Di;break}Qa.push(yo)}Qa.forEach(Di=>Mn.set(Di,gr))}const va=this._buildAnimation(on.namespaceId,Bn,en,s,Zo,wi);if(on.setRealPlayer(va),gr===Od)_r.push(on);else{const yo=this.playersByElement.get(gr);yo&&yo.length&&(on.parentPlayer=Dp(yo)),r.push(on)}}else Om($t,Bn.fromStyles),on.onDestroy(()=>kd($t,Bn.toStyles)),Pd.push(on),I.has($t)&&r.push(on)}),Pd.forEach(kt=>{const $t=s.get(kt.element);if($t&&$t.length){const on=Dp($t);kt.setRealPlayer(on)}}),r.forEach(kt=>{kt.parentPlayer?kt.syncPlayerEvents(kt.parentPlayer):kt.destroy()});for(let kt=0;kt<ke.length;kt++){const $t=ke[kt],on=$t[$c];if(fy($t,Zw),on&&on.hasAnimation)continue;let Bn=[];if(m.size){let va=m.get($t);va&&va.length&&Bn.push(...va);let yo=this.driver.query($t,HS,!0);for(let Qa=0;Qa<yo.length;Qa++){let Di=m.get(yo[Qa]);Di&&Di.length&&Bn.push(...Di)}}const gr=Bn.filter(va=>!va.destroyed);gr.length?Dte(this,$t,gr):this.processLeaveNode($t)}return ke.length=0,_r.forEach(kt=>{this.players.push(kt),kt.onDone(()=>{kt.destroy();const $t=this.players.indexOf(kt);this.players.splice($t,1)}),kt.play()}),_r}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,i,n,r,s){let d=[];if(i){const m=this.playersByQueriedElement.get(t);m&&(d=m)}else{const m=this.playersByElement.get(t);if(m){const b=!s||s==sb;m.forEach(E=>{E.queued||!b&&E.triggerName!=r||d.push(E)})}}return(n||r)&&(d=d.filter(m=>!(n&&n!=m.namespaceId||r&&r!=m.triggerName))),d}_beforeAnimationBuild(t,i,n){const s=i.element,d=i.isRemovalTransition?void 0:t,m=i.isRemovalTransition?void 0:i.triggerName;for(const b of i.timelines){const E=b.element,I=E!==s,O=Xa(n,E,[]);this._getPreviousPlayers(E,I,d,m,i.toState).forEach(Y=>{const pe=Y.getRealPlayer();pe.beforeDestroy&&pe.beforeDestroy(),Y.destroy(),O.push(Y)})}Om(s,i.fromStyles)}_buildAnimation(t,i,n,r,s,d){const m=i.triggerName,b=i.element,E=[],I=new Set,O=new Set,q=i.timelines.map(pe=>{const Te=pe.element;I.add(Te);const ke=Te[$c];if(ke&&ke.removedBeforeQueried)return new z0(pe.duration,pe.delay);const Ge=Te!==b,Oe=function Ete(e){const t=[];return bL(e,t),t}((n.get(Te)||gte).map(en=>en.getRealPlayer())).filter(en=>!!en.element&&en.element===Te),pt=s.get(Te),rt=d.get(Te),At=XN(this._normalizer,pe.keyframes,pt,rt),Wt=this._buildPlayer(pe,At,Oe);if(pe.subTimeline&&r&&O.add(Te),Ge){const en=new rM(t,m,Te);en.setRealPlayer(Wt),E.push(en)}return Wt});E.forEach(pe=>{Xa(this.playersByQueriedElement,pe.element,[]).push(pe),pe.onDone(()=>function xte(e,t,i){let n=e.get(t);if(n){if(n.length){const r=n.indexOf(i);n.splice(r,1)}0==n.length&&e.delete(t)}return n}(this.playersByQueriedElement,pe.element,pe))}),I.forEach(pe=>Gl(pe,iL));const Y=Dp(q);return Y.onDestroy(()=>{I.forEach(pe=>fy(pe,iL)),kd(b,i.toStyles)}),O.forEach(pe=>{Xa(r,pe,[]).push(Y)}),Y}_buildPlayer(t,i,n){return i.length>0?this.driver.animate(t.element,i,t.duration,t.delay,t.easing,n):new z0(t.duration,t.delay)}}class rM{constructor(t,i,n){this.namespaceId=t,this.triggerName=i,this.element=n,this._player=new z0,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((i,n)=>{i.forEach(r=>BS(t,n,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const i=this._player;i.triggerCallback&&t.onStart(()=>i.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,i){Xa(this._queuedCallbacks,t,[]).push(i)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const i=this._player;i.triggerCallback&&i.triggerCallback(t)}}function oC(e){return e&&1===e.nodeType}function gL(e,t){const i=e.style.display;return e.style.display=t??"none",i}function yL(e,t,i,n,r){const s=[];i.forEach(b=>s.push(gL(b)));const d=[];n.forEach((b,E)=>{const I=new Map;b.forEach(O=>{const q=t.computeStyle(E,O,r);I.set(O,q),(!q||0==q.length)&&(E[$c]=yte,d.push(E))}),e.set(E,I)});let m=0;return i.forEach(b=>gL(b,s[m++])),d}function vL(e,t){const i=new Map;if(e.forEach(m=>i.set(m,[])),0==t.length)return i;const r=new Set(t),s=new Map;function d(m){if(!m)return 1;let b=s.get(m);if(b)return b;const E=m.parentNode;return b=i.has(E)?E:r.has(E)?1:d(E),s.set(m,b),b}return t.forEach(m=>{const b=d(m);1!==b&&i.get(b).push(m)}),i}function Gl(e,t){e.classList?.add(t)}function fy(e,t){e.classList?.remove(t)}function Dte(e,t,i){Dp(i).onDone(()=>e.processLeaveNode(t))}function bL(e,t){for(let i=0;i<e.length;i++){const n=e[i];n instanceof YO?bL(n.players,t):t.push(n)}}function xL(e,t,i){const n=i.get(e);if(!n)return!1;let r=t.get(e);return r?n.forEach(s=>r.add(s)):t.set(e,n),i.delete(e),!0}class sC{constructor(t,i,n){this.bodyNode=t,this._driver=i,this._normalizer=n,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new bte(t,i,n),this._timelineEngine=new hte(t,i,n),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(t,i,n,r,s){const d=t+"-"+r;let m=this._triggerCache[d];if(!m){const b=[],I=ZS(this._driver,s,b,[]);if(b.length)throw function fee(e,t){return new He(3404,!1)}();m=function lte(e,t,i){return new cte(e,t,i)}(r,I,this._normalizer),this._triggerCache[d]=m}this._transitionEngine.registerTrigger(i,r,m)}register(t,i){this._transitionEngine.register(t,i)}destroy(t,i){this._transitionEngine.destroy(t,i)}onInsert(t,i,n,r){this._transitionEngine.insertNode(t,i,n,r)}onRemove(t,i,n){this._transitionEngine.removeNode(t,i,n)}disableAnimations(t,i){this._transitionEngine.markElementAsDisabled(t,i)}process(t,i,n,r){if("@"==n.charAt(0)){const[s,d]=KN(n);this._timelineEngine.command(s,i,d,r)}else this._transitionEngine.trigger(t,i,n,r)}listen(t,i,n,r,s){if("@"==n.charAt(0)){const[d,m]=KN(n);return this._timelineEngine.listen(d,i,m,s)}return this._transitionEngine.listen(t,i,n,r,s)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(t){this._transitionEngine.afterFlushAnimationsDone(t)}}let Mte=(()=>{class t{constructor(n,r,s){this._element=n,this._startStyles=r,this._endStyles=s,this._state=0;let d=t.initialStylesByElement.get(n);d||t.initialStylesByElement.set(n,d=new Map),this._initialStyles=d}start(){this._state<1&&(this._startStyles&&kd(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(kd(this._element,this._initialStyles),this._endStyles&&(kd(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(t.initialStylesByElement.delete(this._element),this._startStyles&&(Om(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Om(this._element,this._endStyles),this._endStyles=null),kd(this._element,this._initialStyles),this._state=3)}}return t.initialStylesByElement=new WeakMap,t})();function oM(e){let t=null;return e.forEach((i,n)=>{(function Ate(e){return"display"===e||"position"===e})(n)&&(t=t||new Map,t.set(n,i))}),t}class wL{constructor(t,i,n,r){this.element=t,this.keyframes=i,this.options=n,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const i=[];return t.forEach(n=>{i.push(Object.fromEntries(n))}),i}_triggerWebAnimation(t,i,n){return t.animate(this._convertKeyframesToObject(i),n)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,r)=>{"offset"!==r&&t.set(r,this._finished?n:aL(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const i="start"===t?this._onStartFns:this._onDoneFns;i.forEach(n=>n()),i.length=0}}class Ite{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,i){return!1}containsElement(t,i){return JN(t,i)}getParentElement(t){return jS(t)}query(t,i,n){return eL(t,i,n)}computeStyle(t,i,n){return window.getComputedStyle(t)[i]}animate(t,i,n,r,s,d=[]){const b={duration:n,delay:r,fill:0==r?"both":"forwards"};s&&(b.easing=s);const E=new Map,I=d.filter(Y=>Y instanceof wL);(function Lee(e,t){return 0===e||0===t})(n,r)&&I.forEach(Y=>{Y.currentSnapshot.forEach((pe,Te)=>E.set(Te,pe))});let O=function Oee(e){return e.length?e[0]instanceof Map?e:e.map(t=>rL(t)):[]}(i).map(Y=>Ep(Y));O=function Bee(e,t,i){if(i.size&&t.length){let n=t[0],r=[];if(i.forEach((s,d)=>{n.has(d)||r.push(d),n.set(d,s)}),r.length)for(let s=1;s<t.length;s++){let d=t[s];r.forEach(m=>d.set(m,aL(e,m)))}}return t}(t,O,E);const q=function Ste(e,t){let i=null,n=null;return Array.isArray(t)&&t.length?(i=oM(t[0]),t.length>1&&(n=oM(t[t.length-1]))):t instanceof Map&&(i=oM(t)),i||n?new Mte(e,i,n):null}(t,O);return new wL(t,O,b,q)}}let Rte=(()=>{var e;class t extends qO{constructor(n,r){super(),this._nextAnimationId=0,this._renderer=n.createRenderer(r.body,{id:"0",encapsulation:wo.None,styles:[],data:{animation:[]}})}build(n){const r=this._nextAnimationId.toString();this._nextAnimationId++;const s=Array.isArray(n)?WO(n):n;return CL(this._renderer,null,r,"register",[s]),new kte(r,this._renderer)}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Ba),je(Sn))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();class kte extends d7{constructor(t,i){super(),this._id=t,this._renderer=i}create(t,i){return new Pte(this._id,t,i||{},this._renderer)}}class Pte{constructor(t,i,n,r){this.id=t,this.element=i,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",n)}_listen(t,i){return this._renderer.listen(this.element,`@@${this.id}:${t}`,i)}_command(t,...i){return CL(this._renderer,this.element,this.id,t,i)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function CL(e,t,i,n,r){return e.setProperty(t,`@@${i}:${n}`,r)}const DL="@.disabled";let Ote=(()=>{var e;class t{constructor(n,r,s){this.delegate=n,this.engine=r,this._zone=s,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,r.onRemovalComplete=(d,m)=>{const b=m?.parentNode(d);b&&m.removeChild(b,d)}}createRenderer(n,r){const d=this.delegate.createRenderer(n,r);if(!(n&&r&&r.data&&r.data.animation)){let O=this._rendererCache.get(d);return O||(O=new EL("",d,this.engine,()=>this._rendererCache.delete(d)),this._rendererCache.set(d,O)),O}const m=r.id,b=r.id+"-"+this._currentId;this._currentId++,this.engine.register(b,n);const E=O=>{Array.isArray(O)?O.forEach(E):this.engine.registerTrigger(m,b,n,O.name,O)};return r.data.animation.forEach(E),new Fte(this,b,d,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(n,r,s){n>=0&&n<this._microtaskId?this._zone.run(()=>r(s)):(0==this._animationCallbacksBuffer.length&&queueMicrotask(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(d=>{const[m,b]=d;m(b)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([r,s]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Ba),je(sC),je(_n))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();class EL{constructor(t,i,n,r){this.namespaceId=t,this.delegate=i,this.engine=n,this._onDestroy=r}get data(){return this.delegate.data}destroyNode(t){this.delegate.destroyNode?.(t)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(t,i){return this.delegate.createElement(t,i)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,i){this.delegate.appendChild(t,i),this.engine.onInsert(this.namespaceId,i,t,!1)}insertBefore(t,i,n,r=!0){this.delegate.insertBefore(t,i,n),this.engine.onInsert(this.namespaceId,i,t,r)}removeChild(t,i,n){this.engine.onRemove(this.namespaceId,i,this.delegate)}selectRootElement(t,i){return this.delegate.selectRootElement(t,i)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,i,n,r){this.delegate.setAttribute(t,i,n,r)}removeAttribute(t,i,n){this.delegate.removeAttribute(t,i,n)}addClass(t,i){this.delegate.addClass(t,i)}removeClass(t,i){this.delegate.removeClass(t,i)}setStyle(t,i,n,r){this.delegate.setStyle(t,i,n,r)}removeStyle(t,i,n){this.delegate.removeStyle(t,i,n)}setProperty(t,i,n){"@"==i.charAt(0)&&i==DL?this.disableAnimations(t,!!n):this.delegate.setProperty(t,i,n)}setValue(t,i){this.delegate.setValue(t,i)}listen(t,i,n){return this.delegate.listen(t,i,n)}disableAnimations(t,i){this.engine.disableAnimations(t,i)}}class Fte extends EL{constructor(t,i,n,r,s){super(i,n,r,s),this.factory=t,this.namespaceId=i}setProperty(t,i,n){"@"==i.charAt(0)?"."==i.charAt(1)&&i==DL?this.disableAnimations(t,n=void 0===n||!!n):this.engine.process(this.namespaceId,t,i.slice(1),n):this.delegate.setProperty(t,i,n)}listen(t,i,n){if("@"==i.charAt(0)){const r=function Nte(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(t);let s=i.slice(1),d="";return"@"!=s.charAt(0)&&([s,d]=function Lte(e){const t=e.indexOf(".");return[e.substring(0,t),e.slice(t+1)]}(s)),this.engine.listen(this.namespaceId,r,s,d,m=>{this.factory.scheduleListenerCallback(m._data||-1,n,m)})}return this.delegate.listen(t,i,n)}}let Bte=(()=>{var e;class t extends sC{constructor(n,r,s,d){super(n.body,r,s)}ngOnDestroy(){this.flush()}}return(e=t).\u0275fac=function(n){return new(n||e)(je(Sn),je(US),je(JS),je(Rc))},e.\u0275prov=Re({token:e,factory:e.\u0275fac}),t})();const TL=[{provide:qO,useClass:Rte},{provide:JS,useFactory:function zte(){return new rte}},{provide:sC,useClass:Bte},{provide:Ba,useFactory:function Vte(e,t,i){return new Ote(e,t,i)},deps:[ME,sC,_n]}],sM=[{provide:US,useFactory:()=>new Ite},{provide:xu,useValue:"BrowserAnimations"},...TL],SL=[{provide:US,useClass:tL},{provide:xu,useValue:"NoopAnimations"},...TL];let ab=(()=>{var e;class t{static withConfig(n){return{ngModule:t,providers:n.disableAnimations?SL:sM}}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({providers:sM,imports:[Rg]}),t})(),jte=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[Rg,ab,x0,nb,py,R0,k0,ry,ty,tb]}),t})(),Ute=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[Rg,ab,x0,nb,py,R0,k0,ry,ty,tb]}),t})(),$te=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({imports:[Rg,ab,x0,nb,py,R0,k0,ry,ty,tb]}),t})(),Hte=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e}),e.\u0275inj=yt({providers:[Bc],imports:[Rg,ab,x0,nb,py,R0,k0,ry,ty,tb]}),t})(),Gte=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qt({type:e,bootstrap:[qJ]}),e.\u0275inj=yt({providers:[sF,C0,ry,ty],imports:[Rg,ab,x0,nb,py,R0,k0,ry,ty,tb,jte,Ute,$te,Hte,py]}),t})();Pj().bootstrapModule(Gte).catch(e=>console.error(e))},574:function(_y){_y.exports=function(){"use strict";var Lu,Bu,ql;function Tp(f,at){if(Lu)if(Bu){var Vr="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Lu+")(sharedChunk); ("+Bu+")(sharedChunk); self.onerror = null;",Po={};Lu(Po),ql=at(Po),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(ql.workerUrl=window.URL.createObjectURL(new Blob([Vr],{type:"text/javascript"})))}else Bu=at;else Lu=at}return Tp(0,function(f){var at=typeof self<"u"?self:{},Vr="2.15.0";let Po;const gn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Po){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Po=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch{Po=a}}return Po},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!gn.API_URL)return null;try{const a=new URL(gn.API_URL);return"api.mapbox.cn"===a.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===a.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},yn={supported:!1,testSupport:function(a){!Yo&&ro&&(Ja?Gn(a):un=a)}};let un,ro,Yo=!1,Ja=!1;function Gn(a){const o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,ro),a.isContextLost())return;yn.supported=!0}catch{}a.deleteTexture(o),Yo=!0}at.document&&(ro=at.document.createElement("img"),ro.onload=function(){un&&Gn(un),un=null,Ja=!0},ro.onerror=function(){Yo=!0,un=null},ro.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Wl="01";function ms(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Gc=oo;function oo(a,o,l,u){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(u-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=l,this.p2y=u}oo.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(void 0===o&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,u=0;u<8;u++){var p=this.sampleCurveX(l)-a;if(Math.abs(p)<o)return l;var g=this.sampleCurveDerivativeX(l);if(Math.abs(g)<1e-6)break;l-=p/g}var v=0,w=1;for(l=a,u=0;u<20&&(p=this.sampleCurveX(l),!(Math.abs(p-a)<o));u++)a>p?v=l:w=l,l=.5*(w-v)+v;return l},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};var Us=ms(Gc),Zl=Xo;function Xo(a,o){this.x=a,this.y=o}Xo.prototype={clone:function(){return new Xo(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,l=a.y-this.y;return o*o+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),l=Math.sin(a),u=l*this.x+o*this.y;return this.x=o*this.x-l*this.y,this.y=u,this},_rotateAround:function(a,o){var l=Math.cos(a),u=Math.sin(a),p=o.y+u*(this.x-o.x)+l*(this.y-o.y);return this.x=o.x+l*(this.x-o.x)-u*(this.y-o.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Xo.convert=function(a){return a instanceof Xo?a:Array.isArray(a)?new Xo(a[0],a[1]):a};var ot=ms(Zl);const zu=Math.PI/180,zm=180/Math.PI;function mn(a){return a*zu}function yr(a){return a*zm}const Vu=[[0,0],[1,0],[1,1],[0,1]];function vn(a){if(a<=0)return 0;if(a>=1)return 1;const o=a*a,l=o*a;return 4*(a<.5?l:3*(a-o)+l-.75)}function qc(a,o,l,u){const p=new Us(a,o,l,u);return function(g){return p.solve(g)}}const jr=qc(.25,.1,.25,1);function hn(a,o,l){return Math.min(l,Math.max(o,a))}function Xt(a,o,l){return(l=hn((l-a)/(o-a),0,1))*l*(3-2*l)}function lr(a,o,l){const u=l-o,p=((a-o)%u+u)%u+o;return p===o?l:p}function vr(a,o,l){if(!a.length)return l(null,[]);let u=a.length;const p=new Array(a.length);let g=null;a.forEach((v,w)=>{o(v,(D,T)=>{D&&(g=D),p[w]=T,0==--u&&l(g,p)})})}function xa(a){const o=[];for(const l in a)o.push(a[l]);return o}function Hi(a,...o){for(const l of o)for(const u in l)a[u]=l[u];return a}let el=1;function Oo(){return el++}function Yl(){return function a(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function wa(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function ju(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function tl(a,o){a.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function Xl(a,o){return-1!==a.indexOf(o,a.length-o.length)}function Dn(a,o,l){const u={};for(const p in a)u[p]=o.call(l||this,a[p],p,a);return u}function Wc(a,o,l){const u={};for(const p in a)o.call(l||this,a[p],p,a)&&(u[p]=a[p]);return u}function Fo(a){return Array.isArray(a)?a.map(Fo):"object"==typeof a&&a?Dn(a,Fo):a}const Kl={};function Ei(a){Kl[a]||(typeof console<"u"&&console.warn(a),Kl[a]=!0)}function Ko(a,o,l){return(l.y-a.y)*(o.x-a.x)>(o.y-a.y)*(l.x-a.x)}function Uu(a){let o=0;for(let l,u,p=0,g=a.length,v=g-1;p<g;v=p++)l=a[p],u=a[v],o+=(u.x-l.x)*(l.y+u.y);return o}function Ca(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ei(a){const o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,u,p,g)=>{const v=p||g;return o[u]=!v||v.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let $s=null;function Fd(a){if(null==$s){const o=a.navigator?a.navigator.userAgent:null;$s=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return $s}function Hs(a){try{const o=at[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ql(a,o){return[a[4*o],a[4*o+1],a[4*o+2],a[4*o+3]]}const _s="mapbox-tiles";let Qo,Jl,er=500,$u=50;function Gs(){try{return at.caches}catch{}}function gs(){Gs()&&!Qo&&(Qo=at.caches.open(_s))}function Da(a){const o=a.indexOf("?");if(o<0)return a;const u=function(p){const g=p.indexOf("?");return g>0?p.slice(g+1).split("&"):[]}(a).filter(p=>{const g=p.split("=");return"language"===g[0]||"worldview"===g[0]});return u.length?`${a.slice(0,o)}?${u.join("&")}`:a.slice(0,o)}let Vt=1/0;const qs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(qs);class nl extends Error{constructor(o,l,u){401===l&&Fe(u)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ec=Ca()?()=>self.worker&&self.worker.referrer:()=>("blob:"===at.location.protocol?at.parent:at).location.href,Ea=function(a,o){if(!(/^file:/.test(l=a.url)||/^file:/.test(ec())&&!/^\w+:/.test(l))){if(at.fetch&&at.Request&&at.AbortController&&at.Request.prototype.hasOwnProperty("signal"))return function(u,p){const g=new at.AbortController,v=new at.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:ec(),referrerPolicy:u.referrerPolicy,signal:g.signal});let w=!1,D=!1;const T=(R=v.url).indexOf("sku=")>0&&Fe(R);var R;"json"===u.type&&v.headers.set("Accept","application/json");const P=(B,z,$)=>{if(D)return;if(B&&"SecurityError"!==B.message&&Ei(B.toString()),z&&$)return F(z);const Q=Date.now();at.fetch(v).then(ae=>{if(ae.ok){const ve=T?ae.clone():null;return F(ae,ve,Q)}return p(new nl(ae.statusText,ae.status,u.url))}).catch(ae=>{"AbortError"!==ae.name&&p(new Error(`${ae.message} ${u.url}`))})},F=(B,z,$)=>{("arrayBuffer"===u.type?B.arrayBuffer():"json"===u.type?B.json():B.text()).then(Q=>{D||(z&&$&&function(ae,ve,le){if(gs(),!Qo)return;const ge={status:ve.status,statusText:ve.statusText,headers:new at.Headers};ve.headers.forEach((ze,Le)=>ge.headers.set(Le,ze));const xe=ei(ve.headers.get("Cache-Control")||"");if(xe["no-store"])return;xe["max-age"]&&ge.headers.set("Expires",new Date(le+1e3*xe["max-age"]).toUTCString());const be=ge.headers.get("Expires");be&&(new Date(be).getTime()-le<42e4||function(ze,Le){if(void 0===Jl)try{new Response(new ReadableStream),Jl=!0}catch{Jl=!1}Jl?Le(ze.body):ze.blob().then(Le)}(ve,ze=>{const Le=new at.Response(ze,ge);gs(),Qo&&Qo.then(Ze=>Ze.put(Da(ae.url),Le)).catch(Ze=>Ei(Ze.message))}))}(v,z,$),w=!0,p(null,Q,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(Q=>{D||p(new Error(Q.message))})};return T?function(B,z){if(gs(),!Qo)return z(null);const $=Da(B.url);Qo.then(Q=>{Q.match($).then(ae=>{const ve=function(le){if(!le)return!1;const ge=new Date(le.headers.get("Expires")||0),xe=ei(le.headers.get("Cache-Control")||"");return ge>Date.now()&&!xe["no-cache"]}(ae);Q.delete($),ve&&Q.put($,ae.clone()),z(null,ae,ve)}).catch(z)}).catch(z)}(v,P):P(null,null),{cancel:()=>{D=!0,w||g.abort()}}}(a,o);if(Ca()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var l;return function(u,p){const g=new at.XMLHttpRequest;g.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(g.responseType="arraybuffer");for(const v in u.headers)g.setRequestHeader(v,u.headers[v]);return"json"===u.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===u.credentials,g.onerror=()=>{p(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let v=g.response;if("json"===u.type)try{v=JSON.parse(g.response)}catch(w){return p(w)}p(null,v,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else p(new nl(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(a,o)},Zc=function(a,o){return Ea(Hi(a,{type:"arrayBuffer"}),o)};function Hu(a){const o=at.document.createElement("a");return o.href=a,o.protocol===at.document.location.protocol&&o.host===at.document.location.host}const ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let W,X;W=[],X=0;const fe=function(a,o){if(yn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),X>=gn.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return W.push(g),g}X++;let l=!1;const u=()=>{if(!l)for(l=!0,X--;W.length&&X<gn.MAX_PARALLEL_IMAGE_REQUESTS;){const g=W.shift(),{requestParameters:v,callback:w,cancelled:D}=g;D||(g.cancel=fe(v,w).cancel)}},p=Zc(a,(g,v,w,D)=>{u(),g?o(g):v&&(at.createImageBitmap?function(T,R){const P=new at.Blob([new Uint8Array(T)],{type:"image/png"});at.createImageBitmap(P).then(F=>{R(null,F)}).catch(F=>{R(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(T,R)=>o(T,R,w,D)):function(T,R){const P=new at.Image,F=at.URL;P.onload=()=>{R(null,P),F.revokeObjectURL(P.src),P.onload=null,at.requestAnimationFrame(()=>{P.src=ye})},P.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new at.Blob([new Uint8Array(T)],{type:"image/png"});P.src=T.byteLength?F.createObjectURL(B):ye}(v,(T,R)=>o(T,R,w,D)))});return{cancel:()=>{p.cancel(),u()}}},we="NO_ACCESS_TOKEN";function Me(a){return 0===a.indexOf("mapbox:")}function Fe(a){return gn.API_URL_REGEX.test(a)}function Ne(a){return gn.API_CDN_URL_REGEX.test(a)}function Ae(a){return gn.API_STYLE_REGEX.test(a)&&!Ue(a)}function Ue(a){return gn.API_SPRITE_REGEX.test(a)}const ht=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function _t(a){const o=a.match(ht);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Xe(a){const o=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${o}`}const Kt="mapbox.eventData";function Ut(a){if(!a)return null;const o=a.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(at.atob(o[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class tn{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const l=Ut(gn.ACCESS_TOKEN);let u="";return u=l&&l.u?at.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(p,g)=>String.fromCharCode(+("0x"+g)))):gn.ACCESS_TOKEN||"",o?`${Kt}.${o}:${u}`:`${Kt}:${u}`}fetchEventData(){const o=Hs("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{const p=at.localStorage.getItem(l);p&&(this.eventData=JSON.parse(p));const g=at.localStorage.getItem(u);g&&(this.anonId=g)}catch{Ei("Unable to read from LocalStorage")}}saveEventData(){const o=Hs("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{at.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&at.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{Ei("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,l,u,p){if(!gn.EVENTS_URL)return;const g=_t(gn.EVENTS_URL);g.params.push(`access_token=${p||gn.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(o).toISOString()},w=l?Hi(v,l):v,D={url:Xe(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};var R;this.pendingRequest=(R=T=>{this.pendingRequest=null,u(T),this.saveEventData(),this.processRequests(p)},Ea(Hi(D,{method:"POST"}),R))}queueRequest(o,l){this.queue.push(o),this.processRequests(l)}}const bn=new class extends tn{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,o){gn.EVENTS_URL&&gn.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>Me(l)||Fe(l))&&this.queueRequest(Date.now(),o)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=Ut(gn.ACCESS_TOKEN),l=o?o.u:gn.ACCESS_TOKEN;let u=l!==this.eventData.tokenU;ju(this.anonId)||(this.anonId=Yl(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),v=new Date(p),w=(p-this.eventData.lastSuccess)/864e5;u=u||w>=1||w<-1||g.getDate()!==v.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Vr,skuId:Wl,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=p,this.eventData.tokenU=l)},a):this.processRequests()}},wt=bn.postTurnstileEvent.bind(bn),Pt=new class extends tn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,o,l,u){this.skuToken=o,this.errorCb=u,gn.EVENTS_URL&&(l||gn.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(we)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),ju(this.anonId)||(this.anonId=Yl()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Vr,skuId:Wl,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},a))}},Fi=Pt.postMapLoadEvent.bind(Pt),br=new class extends tn{constructor(){super("gljs.performance")}postPerformanceEvent(a,o){gn.EVENTS_URL&&(a||gn.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},a)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:l}=this.queue.shift(),u=function(p){const g=at.performance.getEntriesByType("resource"),v=at.performance.getEntriesByType("mark"),w=function(F){const B={};if(F)for(const z in F)if("other"!==z)for(const $ of F[z]){const Q=`${z}ResolveRangeMin`,ae=`${z}ResolveRangeMax`,ve=`${z}RequestCount`,le=`${z}RequestCachedCount`;B[Q]=Math.min(B[Q]||1/0,$.startTime),B[ae]=Math.max(B[ae]||-1/0,$.responseEnd);const ge=xe=>{void 0===B[xe]&&(B[xe]=0),++B[xe]};void 0!==$.transferSize&&0===$.transferSize&&ge(le),ge(ve)}return B}(function(F,B){const z={};if(F)for(const $ of F){const Q=B($);void 0===z[Q]&&(z[Q]=[]),z[Q].push($)}return z}(g,Vm)),D=at.devicePixelRatio,T=at.navigator.connection||at.navigator.mozConnection||at.navigator.webkitConnection,R={counters:[],metadata:[],attributes:[]},P=(F,B,z)=>{null!=z&&F.push({name:B,value:z.toString()})};for(const F in w)P(R.counters,F,w[F]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(P(R.counters,"interactionRangeMin",p.interactionRange[0]),P(R.counters,"interactionRangeMax",p.interactionRange[1])),v)for(const F of Object.keys(nn)){const B=nn[F],z=v.find($=>$.name===B);z&&P(R.counters,B,z.startTime)}return P(R.counters,"visibilityHidden",p.visibilityHidden),P(R.attributes,"style",function(F){if(F)for(const B of F){const z=B.name.split("?")[0];if(Ae(z)){const $=z.split("/").slice(-2);if(2===$.length)return`mapbox://styles/${$[0]}/${$[1]}`}}}(g)),P(R.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),P(R.attributes,"fogEnabled",p.fogEnabled?"true":"false"),P(R.attributes,"projection",p.projection),P(R.attributes,"zoom",p.zoom),P(R.metadata,"devicePixelRatio",D),P(R.metadata,"connectionEffectiveType",T?T.effectiveType:void 0),P(R.metadata,"navigatorUserAgent",at.navigator.userAgent),P(R.metadata,"screenWidth",at.screen.width),P(R.metadata,"screenHeight",at.screen.height),P(R.metadata,"windowWidth",at.innerWidth),P(R.metadata,"windowHeight",at.innerHeight),P(R.metadata,"mapWidth",p.width/D),P(R.metadata,"mapHeight",p.height/D),P(R.metadata,"webglRenderer",p.renderer),P(R.metadata,"webglVendor",p.vendor),P(R.metadata,"sdkVersion",Vr),P(R.metadata,"sdkIdentifier","mapbox-gl-js"),R}(l);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(o,u,()=>{},a)}},cr=br.postPerformanceEvent.bind(br),ys=new class extends tn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,o,l,u){if(!gn.API_URL||!gn.SESSION_PATH)return;const p=_t(gn.API_URL+gn.SESSION_PATH);p.params.push(`sku=${o||""}`),p.params.push(`access_token=${u||gn.ACCESS_TOKEN||""}`);const g={url:Xe(p),headers:{"Content-Type":"text/plain"}};var w;this.pendingRequest=(w=v=>{this.pendingRequest=null,l(v),this.saveEventData(),this.processRequests(u)},Ea(Hi(g,{method:"GET"}),w))}getSessionAPI(a,o,l,u){this.skuToken=o,this.errorCb=u,gn.SESSION_PATH&&gn.API_URL&&(l||gn.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(we)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||this.getSession(l,this.skuToken,u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},a)}},He=ys.getSessionAPI.bind(ys),xr=new Set,nn={create:"create",load:"load",fullLoad:"fullLoad"},ti={mark(a){at.performance.mark(a)},measure(a,o,l){at.performance.measure(a,o,l)}};function Vm(a){const o=a.name.split("?")[0];return Ne(o)&&o.includes("mapbox-gl.js")?"javascript":Ne(o)&&o.includes("mapbox-gl.css")?"css":gn.API_FONTS_REGEX.test(o)?"fontRange":Ue(o)?"sprite":Ae(o)?"style":gn.API_TILEJSON_REGEX.test(o)?"tilejson":"other"}const qn=at.performance;function Sp(a){const o=a?a.url.toString():void 0;return qn.getEntriesByName(o)}let tc,so,Mp,Ws;const il={now:()=>void 0!==Mp?Mp:at.performance.now(),setNow(a){Mp=a},restoreNow(){Mp=void 0},frame(a){const o=at.requestAnimationFrame(a);return{cancel:()=>at.cancelAnimationFrame(o)}},getImageData(a,o=0){const{width:l,height:u}=a;Ws||(Ws=at.document.createElement("canvas"));const p=Ws.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(l>Ws.width||u>Ws.height)&&(Ws.width=l,Ws.height=u),p.clearRect(-o,-o,l+2*o,u+2*o),p.drawImage(a,0,0,l,u),p.getImageData(-o,-o,l+2*o,u+2*o)},resolveURL:a=>(tc||(tc=at.document.createElement("a")),tc.href=a,tc.href),get devicePixelRatio(){return at.devicePixelRatio},get prefersReducedMotion(){return!!at.matchMedia&&(null==so&&(so=at.matchMedia("(prefers-reduced-motion: reduce)")),so.matches)}};function Ta(a,o,l){l[a]&&-1!==l[a].indexOf(o)||(l[a]=l[a]||[],l[a].push(o))}function jm(a,o,l){if(l&&l[a]){const u=l[a].indexOf(o);-1!==u&&l[a].splice(u,1)}}class Yc{constructor(o,l={}){Hi(this,l),this.type=o}}class rl extends Yc{constructor(o,l={}){super("error",Hi({error:o},l))}}class Gu{on(o,l){return this._listeners=this._listeners||{},Ta(o,l,this._listeners),this}off(o,l){return jm(o,l,this._listeners),jm(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Ta(o,l,this._oneTimeListeners),this):new Promise(u=>this.once(o,u))}fire(o,l){"string"==typeof o&&(o=new Yc(o,l||{}));const u=o.type;if(this.listens(u)){o.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const w of p)w.call(this,o);const g=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const w of g)jm(u,w,this._oneTimeListeners),w.call(this,o);const v=this._eventedParent;v&&(Hi(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(o))}else o instanceof rl&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}var We=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ol(a,...o){for(const l of o)for(const u in l)a[u]=l[u];return a}function Gi(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Sr(a){if(Array.isArray(a))return a.map(Sr);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const o={};for(const l in a)o[l]=Sr(a[l]);return o}return Gi(a)}class No extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}var qt=No;class Um{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[u,p]of l)this.bindings[u]=p}concat(o){return new Um(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var gy=Um;const Nd={kind:"null"},Re={kind:"number"},An={kind:"string"},yt={kind:"boolean"},Ur={kind:"color"},vs={kind:"object"},xn={kind:"value"},Lo={kind:"collator"},sl={kind:"formatted"},Zs={kind:"resolvedImage"};function vo(a,o){return{kind:"array",itemType:a,N:o}}function _i(a){if("array"===a.kind){const o=_i(a.itemType);return"number"==typeof a.N?`array<${o}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${o}>`}return a.kind}const $m=[Nd,Re,An,yt,Ur,sl,vs,vo(xn),Zs];function pn(a,o){if("error"===o.kind)return null;if("array"===a.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!pn(a.itemType,o.itemType))&&("number"!=typeof a.N||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if("value"===a.kind)for(const l of $m)if(!pn(l,o))return null}return`Expected ${_i(a)} but found ${_i(o)} instead.`}function nc(a,o){return o.some(l=>l.kind===a.kind)}function Xc(a,o){return o.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}var $r,Ap={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function qu(a){return(a=Math.round(a))<0?0:a>255?255:a}function Kn(a){return qu("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function Ip(a){return(o="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function Ld(a,o,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(o-a)*l*6:2*l<1?o:3*l<2?a+(o-a)*(2/3-l)*6:a}try{$r={}.parseCSSColor=function(a){var o,l=a.replace(/ /g,"").toLowerCase();if(l in Ap)return Ap[l].slice();if("#"===l[0])return 4===l.length?(o=parseInt(l.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===l.length&&(o=parseInt(l.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var u=l.indexOf("("),p=l.indexOf(")");if(-1!==u&&p+1===l.length){var g=l.substr(0,u),v=l.substr(u+1,p-(u+1)).split(","),w=1;switch(g){case"rgba":if(4!==v.length)return null;w=Ip(v.pop());case"rgb":return 3!==v.length?null:[Kn(v[0]),Kn(v[1]),Kn(v[2]),w];case"hsla":if(4!==v.length)return null;w=Ip(v.pop());case"hsl":if(3!==v.length)return null;var D=(parseFloat(v[0])%360+360)%360/360,T=Ip(v[1]),R=Ip(v[2]),P=R<=.5?R*(T+1):R+T-R*T,F=2*R-P;return[qu(255*Ld(F,P,D+1/3)),qu(255*Ld(F,P,D)),qu(255*Ld(F,P,D-1/3)),w];default:return null}}return null}}catch{}class Hr{constructor(o,l,u,p=1){this.r=o,this.g=l,this.b=u,this.a=p}static parse(o){if(!o)return;if(o instanceof Hr)return o;if("string"!=typeof o)return;const l=$r(o);return l?new Hr(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[o,l,u,p]=this.toArray();return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(u)},${p})`}toArray(){const{r:o,g:l,b:u,a:p}=this;return 0===p?[0,0,0,0]:[255*o/p,255*l/p,255*u/p,p]}toArray01(){const{r:o,g:l,b:u,a:p}=this;return 0===p?[0,0,0,0]:[o/p,l/p,u/p,p]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:u,a:p}=this;return[o,l,u,p]}}Hr.black=new Hr(0,0,0,1),Hr.white=new Hr(1,1,1,1),Hr.transparent=new Hr(0,0,0,0),Hr.red=new Hr(1,0,0,1),Hr.blue=new Hr(0,0,1,1);var ki=Hr;class Wu{constructor(o,l,u){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Bd{constructor(o,l,u,p,g){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=u,this.fontStack=p,this.textColor=g}}class bo{constructor(o){this.sections=o}static fromString(o){return new bo([new Bd(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof bo?o:bo.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){o.push(["image",l.image.name]);continue}o.push(l.text);const u={};l.fontStack&&(u["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(u["font-scale"]=l.scale),l.textColor&&(u["text-color"]=["rgba"].concat(l.textColor.toArray())),o.push(u)}return o}}class xo{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new xo({name:o,available:!1}):null}serialize(){return["image",this.name]}}function yy(a,o,l,u){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[a,o,l,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[a,o,l,u]:[a,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Zu(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof ki||a instanceof Wu||a instanceof bo||a instanceof xo)return!0;if(Array.isArray(a)){for(const o of a)if(!Zu(o))return!1;return!0}if("object"==typeof a){for(const o in a)if(!Zu(a[o]))return!1;return!0}return!1}function Bi(a){if(null===a)return Nd;if("string"==typeof a)return An;if("boolean"==typeof a)return yt;if("number"==typeof a)return Re;if(a instanceof ki)return Ur;if(a instanceof Wu)return Lo;if(a instanceof bo)return sl;if(a instanceof xo)return Zs;if(Array.isArray(a)){const o=a.length;let l;for(const u of a){const p=Bi(u);if(l){if(l===p)continue;l=xn;break}l=p}return vo(l||xn,o)}return vs}function Yu(a){const o=typeof a;return null===a?"":"string"===o||"number"===o||"boolean"===o?String(a):a instanceof ki||a instanceof bo||a instanceof xo?a.toString():JSON.stringify(a)}class Hm{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(2!==o.length)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Zu(o[1]))return l.error("invalid value");const u=o[1];let p=Bi(u);const g=l.expectedType;return"array"!==p.kind||0!==p.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(p=g),new Hm(p,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ki?["rgba"].concat(this.value.toArray()):this.value instanceof bo?this.value.serialize():this.value}}var bs=Hm,dr=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const Kc={string:An,number:Re,boolean:yt,object:vs};class Rp{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let u,p=1;const g=o[0];if("array"===g){let w,D;if(o.length>2){const T=o[1];if("string"!=typeof T||!(T in Kc)||"object"===T)return l.error('The item type argument of "array" must be one of string, number, boolean',1);w=Kc[T],p++}else w=xn;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);D=o[2],p++}u=vo(w,D)}else u=Kc[g];const v=[];for(;p<o.length;p++){const w=l.parse(o[p],p,xn);if(!w)return null;v.push(w)}return new Rp(u,v)}evaluate(o){for(let l=0;l<this.args.length;l++){const u=this.args[l].evaluate(o);if(!pn(this.type,Bi(u)))return u;if(l===this.args.length-1)throw new dr(`Expected value to be of type ${_i(this.type)}, but found ${_i(Bi(u))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if("array"===o.kind){const u=o.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){l.push(u.kind);const p=o.N;("number"==typeof p||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map(u=>u.serialize()))}}var Sa=Rp;class al{constructor(o){this.type=sl,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[1];if(!Array.isArray(u)&&"object"==typeof u)return l.error("First argument must be an image or text section.");const p=[];let g=!1;for(let v=1;v<=o.length-1;++v){const w=o[v];if(g&&"object"==typeof w&&!Array.isArray(w)){g=!1;let D=null;if(w["font-scale"]&&(D=l.parse(w["font-scale"],1,Re),!D))return null;let T=null;if(w["text-font"]&&(T=l.parse(w["text-font"],1,vo(An)),!T))return null;let R=null;if(w["text-color"]&&(R=l.parse(w["text-color"],1,Ur),!R))return null;const P=p[p.length-1];P.scale=D,P.font=T,P.textColor=R}else{const D=l.parse(o[v],1,xn);if(!D)return null;const T=D.type.kind;if("string"!==T&&"value"!==T&&"null"!==T&&"resolvedImage"!==T)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:D,scale:null,font:null,textColor:null})}}return new al(p)}evaluate(o){return new bo(this.sections.map(l=>{const u=l.content.evaluate(o);return Bi(u)===Zs?new Bd("",u,null,null,null):new Bd(Yu(u),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const u={};l.scale&&(u["font-scale"]=l.scale.serialize()),l.font&&(u["text-font"]=l.font.serialize()),l.textColor&&(u["text-color"]=l.textColor.serialize()),o.push(u)}return o}}class zd{constructor(o){this.type=Zs,this.input=o}static parse(o,l){if(2!==o.length)return l.error("Expected two arguments.");const u=l.parse(o[1],1,An);return u?new zd(u):l.error("No image name provided.")}evaluate(o){const l=this.input.evaluate(o),u=xo.fromString(l);return u&&o.availableImages&&(u.available=o.availableImages.indexOf(l)>-1),u}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Qc={"to-boolean":yt,"to-color":Ur,"to-number":Re,"to-string":An};class kp{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[0];if(("to-boolean"===u||"to-string"===u)&&2!==o.length)return l.error("Expected one argument.");const p=Qc[u],g=[];for(let v=1;v<o.length;v++){const w=l.parse(o[v],v,xn);if(!w)return null;g.push(w)}return new kp(p,g)}evaluate(o){if("boolean"===this.type.kind)return!!this.args[0].evaluate(o);if("color"===this.type.kind){let l,u;for(const p of this.args){if(l=p.evaluate(o),u=null,l instanceof ki)return l;if("string"==typeof l){const g=o.parseColor(l);if(g)return g}else if(Array.isArray(l)&&(u=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:yy(l[0],l[1],l[2],l[3]),!u))return new ki(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new dr(u||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const u of this.args){if(l=u.evaluate(o),null===l)return 0;const p=Number(l);if(!isNaN(p))return p}throw new dr(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?bo.fromString(Yu(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?xo.fromString(Yu(this.args[0].evaluate(o))):Yu(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new al([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new zd(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Bo=kp;const Ys=["Unknown","Point","LineString","Polygon"];var je=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ys[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*o-a[0])+this.featureDistanceData.bearing[1]*(u*o-a[1])}return 0}parseColor(a){let o=this._parseColorCache[a];return o||(o=this._parseColorCache[a]=ki.parse(a)),o}};class ll{constructor(o,l,u,p){this.name=o,this.type=l,this._evaluate=u,this.args=p}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const u=o[0],p=ll.definitions[u];if(!p)return l.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(p)?p[0]:p.type,v=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=v.filter(([T])=>!Array.isArray(T)||T.length===o.length-1);let D=null;for(const[T,R]of w){D=new Op(l.registry,l.path,null,l.scope);const P=[];let F=!1;for(let B=1;B<o.length;B++){const z=o[B],$=Array.isArray(T)?T[B-1]:T.type,Q=D.parse(z,1+P.length,$);if(!Q){F=!0;break}P.push(Q)}if(!F)if(Array.isArray(T)&&T.length!==P.length)D.error(`Expected ${T.length} arguments, but found ${P.length} instead.`);else{for(let B=0;B<P.length;B++){const z=Array.isArray(T)?T[B]:T.type,$=P[B];D.concat(B+1).checkSubtype(z,$.type)}if(0===D.errors.length)return new ll(u,g,R,P)}}if(1===w.length)l.errors.push(...D.errors);else{const T=(w.length?w:v).map(([P])=>{return F=P,Array.isArray(F)?`(${F.map(_i).join(", ")})`:`(${_i(F.type)}...)`;var F}).join(" | "),R=[];for(let P=1;P<o.length;P++){const F=l.parse(o[P],1+R.length);if(!F)return null;R.push(_i(F.type))}l.error(`Expected arguments of type ${T}, but found (${R.join(", ")}) instead.`)}return null}static register(o,l){ll.definitions=l;for(const u in l)o[u]=ll}}var ft=ll;class cl{constructor(o,l,u){this.type=Lo,this.locale=u,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(2!==o.length)return l.error("Expected one argument.");const u=o[1];if("object"!=typeof u||Array.isArray(u))return l.error("Collator options argument must be an object.");const p=l.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,yt);if(!p)return null;const g=l.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,yt);if(!g)return null;let v=null;return u.locale&&(v=l.parse(u.locale,1,An),!v)?null:new cl(p,g,v)}evaluate(o){return new Wu(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const xs=8192;function dl(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function Jc(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function Vd(a,o){const l=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,p=Math.pow(2,o.z);return[Math.round(l*p*xs),Math.round(u*p*xs)]}function Gm(a,o,l){const u=a[0]-o[0],p=a[1]-o[1],g=a[0]-l[0],v=a[1]-l[1];return u*v-g*p==0&&u*g<=0&&p*v<=0}function Jo(a,o){let l=!1;for(let v=0,w=o.length;v<w;v++){const D=o[v];for(let T=0,R=D.length;T<R-1;T++){if(Gm(a,D[T],D[T+1]))return!1;(p=D[T])[1]>(u=a)[1]!=(g=D[T+1])[1]>u[1]&&u[0]<(g[0]-p[0])*(u[1]-p[1])/(g[1]-p[1])+p[0]&&(l=!l)}}var u,p,g;return l}function ed(a,o){for(let l=0;l<o.length;l++)if(Jo(a,o[l]))return!0;return!1}function wo(a,o,l,u){const p=u[0]-l[0],g=u[1]-l[1],v=(a[0]-l[0])*g-p*(a[1]-l[1]),w=(o[0]-l[0])*g-p*(o[1]-l[1]);return v>0&&w<0||v<0&&w>0}function ao(a,o,l){for(const T of l)for(let R=0;R<T.length-1;++R)if((w=[(v=T[R+1])[0]-(g=T[R])[0],v[1]-g[1]])[0]*(D=[(p=o)[0]-(u=a)[0],p[1]-u[1]])[1]-w[1]*D[0]!=0&&wo(u,p,g,v)&&wo(g,v,u,p))return!0;var u,p,g,v,w,D;return!1}function jt(a,o){for(let l=0;l<a.length;++l)if(!Jo(a[l],o))return!1;for(let l=0;l<a.length-1;++l)if(ao(a[l],a[l+1],o))return!1;return!0}function Xu(a,o){for(let l=0;l<o.length;l++)if(jt(a,o[l]))return!0;return!1}function jd(a,o,l){const u=[];for(let p=0;p<a.length;p++){const g=[];for(let v=0;v<a[p].length;v++){const w=Vd(a[p][v],l);dl(o,w),g.push(w)}u.push(g)}return u}function Ku(a,o,l){const u=[];for(let p=0;p<a.length;p++){const g=jd(a[p],o,l);u.push(g)}return u}function Qu(a,o,l,u){if(a[0]<l[0]||a[0]>l[2]){const p=.5*u;let g=a[0]-l[0]>p?-u:l[0]-a[0]>p?u:0;0===g&&(g=a[0]-l[2]>p?-u:l[2]-a[0]>p?u:0),a[0]+=g}dl(o,a)}function Xs(a,o,l,u){const p=Math.pow(2,u.z)*xs,g=[u.x*xs,u.y*xs],v=[];if(!a)return v;for(const w of a)for(const D of w){const T=[D.x+g[0],D.y+g[1]];Qu(T,o,l,p),v.push(T)}return v}function ic(a,o,l,u){const p=Math.pow(2,u.z)*xs,g=[u.x*xs,u.y*xs],v=[];if(!a)return v;for(const D of a){const T=[];for(const R of D){const P=[R.x+g[0],R.y+g[1]];dl(o,P),T.push(P)}v.push(T)}if(o[2]-o[0]<=p/2){(w=o)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const D of v)for(const T of D)Qu(T,o,l,p)}var w;return v}class rc{constructor(o,l){this.type=yt,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Zu(o[1])){const u=o[1];if("FeatureCollection"===u.type)for(let p=0;p<u.features.length;++p){const g=u.features[p].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new rc(u,u.features[p].geometry)}else if("Feature"===u.type){const p=u.geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new rc(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new rc(u,u)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(l,u){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if("Polygon"===u.type){const w=jd(u.coordinates,g,v),D=Xs(l.geometry(),p,g,v);if(!Jc(p,g))return!1;for(const T of D)if(!Jo(T,w))return!1}if("MultiPolygon"===u.type){const w=Ku(u.coordinates,g,v),D=Xs(l.geometry(),p,g,v);if(!Jc(p,g))return!1;for(const T of D)if(!ed(T,w))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(l,u){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if("Polygon"===u.type){const w=jd(u.coordinates,g,v),D=ic(l.geometry(),p,g,v);if(!Jc(p,g))return!1;for(const T of D)if(!jt(T,w))return!1}if("MultiPolygon"===u.type){const w=Ku(u.coordinates,g,v),D=ic(l.geometry(),p,g,v);if(!Jc(p,g))return!1;for(const T of D)if(!Xu(T,w))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Ud=rc;function ul(a){if(a instanceof ft&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof Ud)return!1;let o=!0;return a.eachChild(l=>{o&&!ul(l)&&(o=!1)}),o}function Ks(a){if(a instanceof ft&&"feature-state"===a.name)return!1;let o=!0;return a.eachChild(l=>{o&&!Ks(l)&&(o=!1)}),o}function hl(a,o){if(a instanceof ft&&o.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(u=>{l&&!hl(u,o)&&(l=!1)}),l}class pl{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(2!==o.length||"string"!=typeof o[1])return l.error("'var' expression requires exactly one string literal argument.");const u=o[1];return l.scope.has(u)?new pl(u,l.scope.get(u)):l.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Pp=pl;class td{constructor(o,l=[],u,p=new gy,g=[]){this.registry=o,this.path=l,this.key=l.map(v=>`[${v}]`).join(""),this.scope=p,this.errors=g,this.expectedType=u}parse(o,l,u,p,g={}){return l?this.concat(l,u,p)._parse(o,g):this._parse(o,g)}_parse(o,l){function u(p,g,v){return"assert"===v?new Sa(g,[p]):"coerce"===v?new Bo(g,[p]):p}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=o[0];if("string"!=typeof p)return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[p];if(g){let v=g.parse(o,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,D=v.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==D.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==D.kind&&"string"!==D.kind){if(this.checkSubtype(w,D))return null}else v=u(v,w,l.typeAnnotation||"coerce");else v=u(v,w,l.typeAnnotation||"assert")}if(!(v instanceof bs)&&"resolvedImage"!==v.type.kind&&Ju(v)){const w=new je;try{v=new bs(v.type,v.evaluate(w))}catch(D){return this.error(D.message),null}}return v}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,u){const p="number"==typeof o?this.path.concat(o):this.path,g=u?this.scope.concat(u):this.scope;return new td(this.registry,p,l||null,g,this.errors)}error(o,...l){const u=`${this.key}${l.map(p=>`[${p}]`).join("")}`;this.errors.push(new qt(u,o))}checkSubtype(o,l){const u=pn(o,l);return u&&this.error(u),u}}var Op=td;function Ju(a){if(a instanceof Pp)return Ju(a.boundExpression);if(a instanceof ft&&"error"===a.name||a instanceof cl||a instanceof Ud)return!1;const o=a instanceof Bo||a instanceof Sa;let l=!0;return a.eachChild(u=>{l=o?l&&Ju(u):l&&u instanceof bs}),!!l&&ul(a)&&hl(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function eh(a,o){const l=a.length-1;let u,p,g=0,v=l,w=0;for(;g<=v;)if(w=Math.floor((g+v)/2),u=a[w],p=a[w+1],u<=o){if(w===l||o<p)return w;g=w+1}else{if(!(u>o))throw new dr("Input is not a number.");v=w-1}return 0}class th{constructor(o,l,u){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[p,g]of u)this.labels.push(p),this.outputs.push(g)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const u=l.parse(o[1],1,Re);if(!u)return null;const p=[];let g=null;l.expectedType&&"value"!==l.expectedType.kind&&(g=l.expectedType);for(let v=1;v<o.length;v+=2){const w=1===v?-1/0:o[v],D=o[v+1],T=v,R=v+1;if("number"!=typeof w)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(p.length&&p[p.length-1][0]>=w)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const P=l.parse(D,R,g);if(!P)return null;g=g||P.type,p.push([w,P])}return new th(g,u,p)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const p=this.input.evaluate(o);if(p<=l[0])return u[0].evaluate(o);const g=l.length;return p>=l[g-1]?u[g-1].evaluate(o):u[eh(l,p)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}var zo=th;function Ln(a,o,l){return a*(1-l)+o*l}var nd=Object.freeze({__proto__:null,array:function(a,o,l){return a.map((u,p)=>Ln(u,o[p],l))},color:function(a,o,l){return new ki(Ln(a.r,o.r,l),Ln(a.g,o.g,l),Ln(a.b,o.b,l),Ln(a.a,o.a,l))},number:Ln});const Wm=4/29,oc=6/29,nh=3*oc*oc,vy=oc*oc*oc,by=Math.PI/180,xy=180/Math.PI;function In(a){return a>vy?Math.pow(a,1/3):a/nh+Wm}function Np(a){return a>oc?a*a*a:nh*(a-Wm)}function Lp(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function ih(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Qt(a){const o=ih(a.r),l=ih(a.g),u=ih(a.b),p=In((.4124564*o+.3575761*l+.1804375*u)/.95047),g=In((.2126729*o+.7151522*l+.072175*u)/1);return{l:116*g-16,a:500*(p-g),b:200*(g-In((.0193339*o+.119192*l+.9503041*u)/1.08883)),alpha:a.a}}function Zm(a){let o=(a.l+16)/116,l=isNaN(a.a)?o:o+a.a/500,u=isNaN(a.b)?o:o-a.b/200;return o=1*Np(o),l=.95047*Np(l),u=1.08883*Np(u),new ki(Lp(3.2404542*l-1.5371385*o-.4985314*u),Lp(-.969266*l+1.8760108*o+.041556*u),Lp(.0556434*l-.2040259*o+1.0572252*u),a.alpha)}function Ym(a,o,l){const u=o-a;return a+l*(u>180||u<-180?u-360*Math.round(u/360):u)}const gt={forward:Qt,reverse:Zm,interpolate:function(a,o,l){return{l:Ln(a.l,o.l,l),a:Ln(a.a,o.a,l),b:Ln(a.b,o.b,l),alpha:Ln(a.alpha,o.alpha,l)}}},tr={forward:function(a){const{l:o,a:l,b:u}=Qt(a),p=Math.atan2(u,l)*xy;return{h:p<0?p+360:p,c:Math.sqrt(l*l+u*u),l:o,alpha:a.a}},reverse:function(a){const o=a.h*by,l=a.c;return Zm({l:a.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:a.alpha})},interpolate:function(a,o,l){return{h:Ym(a.h,o.h,l),c:Ln(a.c,o.c,l),l:Ln(a.l,o.l,l),alpha:Ln(a.alpha,o.alpha,l)}}};var zn=Object.freeze({__proto__:null,hcl:tr,lab:gt});class qi{constructor(o,l,u,p,g){this.type=o,this.operator=l,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(const[v,w]of g)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(o,l,u,p){let g=0;if("exponential"===o.name)g=Mr(l,o.base,u,p);else if("linear"===o.name)g=Mr(l,1,u,p);else if("cubic-bezier"===o.name){const v=o.controlPoints;g=new Us(v[0],v[1],v[2],v[3]).solve(Mr(l,1,u,p))}return g}static parse(o,l){let[u,p,g,...v]=o;if(!Array.isArray(p)||0===p.length)return l.error("Expected an interpolation type expression.",1);if("linear"===p[0])p={name:"linear"};else if("exponential"===p[0]){const T=p[1];if("number"!=typeof T)return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:T}}else{if("cubic-bezier"!==p[0])return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const T=p.slice(1);if(4!==T.length||T.some(R=>"number"!=typeof R||R<0||R>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:T}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(g=l.parse(g,2,Re),!g)return null;const w=[];let D=null;"interpolate-hcl"===u||"interpolate-lab"===u?D=Ur:l.expectedType&&"value"!==l.expectedType.kind&&(D=l.expectedType);for(let T=0;T<v.length;T+=2){const R=v[T],P=v[T+1],F=T+3,B=T+4;if("number"!=typeof R)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(w.length&&w[w.length-1][0]>=R)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const z=l.parse(P,B,D);if(!z)return null;D=D||z.type,w.push([R,z])}return"number"===D.kind||"color"===D.kind||"array"===D.kind&&"number"===D.itemType.kind&&"number"==typeof D.N?new qi(D,u,p,g,w):l.error(`Type ${_i(D)} is not interpolatable.`)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const p=this.input.evaluate(o);if(p<=l[0])return u[0].evaluate(o);const g=l.length;if(p>=l[g-1])return u[g-1].evaluate(o);const v=eh(l,p),w=qi.interpolationFactor(this.interpolation,p,l[v],l[v+1]),D=u[v].evaluate(o),T=u[v+1].evaluate(o);return"interpolate"===this.operator?nd[this.type.kind.toLowerCase()](D,T,w):"interpolate-hcl"===this.operator?tr.reverse(tr.interpolate(tr.forward(D),tr.forward(T),w)):gt.reverse(gt.interpolate(gt.forward(D),gt.forward(T),w))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,o,this.input.serialize()];for(let u=0;u<this.labels.length;u++)l.push(this.labels[u],this.outputs[u].serialize());return l}}function Mr(a,o,l,u){const p=u-l,g=a-l;return 0===p?0:1===o?g/p:(Math.pow(o,g)-1)/(Math.pow(o,p)-1)}var lo=qi;class Gr{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let u=null;const p=l.expectedType;p&&"value"!==p.kind&&(u=p);const g=[];for(const w of o.slice(1)){const D=l.parse(w,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!D)return null;u=u||D.type,g.push(D)}const v=p&&g.some(w=>pn(p,w.type));return new Gr(v?xn:u,g)}evaluate(o){let l,u=null,p=0;for(const g of this.args){if(p++,u=g.evaluate(o),u&&u instanceof xo&&!u.available&&(l||(l=u),u=null,p===this.args.length))return l;if(null!==u)break}return u}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var rh=Gr;class $d{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const u=[];for(let g=1;g<o.length-1;g+=2){const v=o[g];if("string"!=typeof v)return l.error(`Expected string, but found ${typeof v} instead.`,g);if(/[^a-zA-Z0-9_]/.test(v))return l.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=l.parse(o[g+1],g+1);if(!w)return null;u.push([v,w])}const p=l.parse(o[o.length-1],o.length-1,l.expectedType,u);return p?new $d(u,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,u]of this.bindings)o.push(l,u.serialize());return o.push(this.result.serialize()),o}}var Hd=$d;class Bp{constructor(o,l,u){this.type=o,this.index=l,this.input=u}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Re),p=l.parse(o[2],2,vo(l.expectedType||xn));return u&&p?new Bp(p.type.itemType,u,p):null}evaluate(o){const l=this.index.evaluate(o),u=this.input.evaluate(o);if(l<0)throw new dr(`Array index out of bounds: ${l} < 0.`);if(l>=u.length)throw new dr(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l!==Math.floor(l))throw new dr(`Array index must be an integer, but found ${l} instead.`);return u[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var wy=Bp;class Ni{constructor(o,l){this.type=yt,this.needle=o,this.haystack=l}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,xn),p=l.parse(o[2],2,xn);return u&&p?nc(u.type,[yt,An,Re,Nd,xn])?new Ni(u,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${_i(u.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(null==u)return!1;if(!Xc(l,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${_i(Bi(l))} instead.`);if(!Xc(u,["string","array"]))throw new dr(`Expected second argument to be of type array or string, but found ${_i(Bi(u))} instead.`);return u.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var It=Ni;class an{constructor(o,l,u){this.type=Re,this.needle=o,this.haystack=l,this.fromIndex=u}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,xn),p=l.parse(o[2],2,xn);if(!u||!p)return null;if(!nc(u.type,[yt,An,Re,Nd,xn]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${_i(u.type)} instead`);if(4===o.length){const g=l.parse(o[3],3,Re);return g?new an(u,p,g):null}return new an(u,p)}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(!Xc(l,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${_i(Bi(l))} instead.`);if(!Xc(u,["string","array"]))throw new dr(`Expected second argument to be of type array or string, but found ${_i(Bi(u))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(o);return u.indexOf(l,p)}return u.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ti=an;class Vo{constructor(o,l,u,p,g,v){this.inputType=o,this.type=l,this.input=u,this.cases=p,this.outputs=g,this.otherwise=v}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let u,p;l.expectedType&&"value"!==l.expectedType.kind&&(p=l.expectedType);const g={},v=[];for(let T=2;T<o.length-1;T+=2){let R=o[T];const P=o[T+1];Array.isArray(R)||(R=[R]);const F=l.concat(T);if(0===R.length)return F.error("Expected at least one branch label.");for(const z of R){if("number"!=typeof z&&"string"!=typeof z)return F.error("Branch labels must be numbers or strings.");if("number"==typeof z&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof z&&Math.floor(z)!==z)return F.error("Numeric branch labels must be integer values.");if(u){if(F.checkSubtype(u,Bi(z)))return null}else u=Bi(z);if(void 0!==g[String(z)])return F.error("Branch labels must be unique.");g[String(z)]=v.length}const B=l.parse(P,T,p);if(!B)return null;p=p||B.type,v.push(B)}const w=l.parse(o[1],1,xn);if(!w)return null;const D=l.parse(o[o.length-1],o.length-1,p);return D?"value"!==w.type.kind&&l.concat(1).checkSubtype(u,w.type)?null:new Vo(u,p,w,g,v,D):null}evaluate(o){const l=this.input.evaluate(o);return(Bi(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),u=[],p={};for(const v of l){const w=p[this.cases[v]];void 0===w?(p[this.cases[v]]=u.length,u.push([this.cases[v],[v]])):u[w][1].push(v)}const g=v=>"number"===this.inputType.kind?Number(v):v;for(const[v,w]of u)o.push(1===w.length?g(w[0]):w.map(g)),o.push(this.outputs[v].serialize());return o.push(this.otherwise.serialize()),o}}var Gd=Vo;class wr{constructor(o,l,u){this.type=o,this.branches=l,this.otherwise=u}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let u;l.expectedType&&"value"!==l.expectedType.kind&&(u=l.expectedType);const p=[];for(let v=1;v<o.length-1;v+=2){const w=l.parse(o[v],v,yt);if(!w)return null;const D=l.parse(o[v+1],v+1,u);if(!D)return null;p.push([w,D]),u=u||D.type}const g=l.parse(o[o.length-1],o.length-1,u);return g?new wr(u,p,g):null}evaluate(o){for(const[l,u]of this.branches)if(l.evaluate(o))return u.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,u]of this.branches)o(l),o(u);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var sc=wr;class Si{constructor(o,l,u,p){this.type=o,this.input=l,this.beginIndex=u,this.endIndex=p}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,xn),p=l.parse(o[2],2,Re);if(!u||!p)return null;if(!nc(u.type,[vo(xn),An,xn]))return l.error(`Expected first argument to be of type array or string, but found ${_i(u.type)} instead`);if(4===o.length){const g=l.parse(o[3],3,Re);return g?new Si(u.type,u,p,g):null}return new Si(u.type,u,p)}evaluate(o){const l=this.input.evaluate(o),u=this.beginIndex.evaluate(o);if(!Xc(l,["string","array"]))throw new dr(`Expected first argument to be of type array or string, but found ${_i(Bi(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(o);return l.slice(u,p)}return l.slice(u)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ma=Si;function Aa(a,o){return"=="===a||"!="===a?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function fn(a,o,l,u){return 0===u.compare(o,l)}function Qs(a,o,l){const u="=="!==a&&"!="!==a;return class LL{constructor(g,v,w){this.type=yt,this.lhs=g,this.rhs=v,this.collator=w,this.hasUntypedArgument="value"===g.type.kind||"value"===v.type.kind}static parse(g,v){if(3!==g.length&&4!==g.length)return v.error("Expected two or three arguments.");const w=g[0];let D=v.parse(g[1],1,xn);if(!D)return null;if(!Aa(w,D.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${_i(D.type)}'.`);let T=v.parse(g[2],2,xn);if(!T)return null;if(!Aa(w,T.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${_i(T.type)}'.`);if(D.type.kind!==T.type.kind&&"value"!==D.type.kind&&"value"!==T.type.kind)return v.error(`Cannot compare types '${_i(D.type)}' and '${_i(T.type)}'.`);u&&("value"===D.type.kind&&"value"!==T.type.kind?D=new Sa(T.type,[D]):"value"!==D.type.kind&&"value"===T.type.kind&&(T=new Sa(D.type,[T])));let R=null;if(4===g.length){if("string"!==D.type.kind&&"string"!==T.type.kind&&"value"!==D.type.kind&&"value"!==T.type.kind)return v.error("Cannot use collator to compare non-string types.");if(R=v.parse(g[3],3,Lo),!R)return null}return new LL(D,T,R)}evaluate(g){const v=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const D=Bi(v),T=Bi(w);if(D.kind!==T.kind||"string"!==D.kind&&"number"!==D.kind)throw new dr(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${D.kind}, ${T.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const D=Bi(v),T=Bi(w);if("string"!==D.kind||"string"!==T.kind)return o(g,v,w)}return this.collator?l(g,v,w,this.collator.evaluate(g)):o(g,v,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild(v=>{g.push(v.serialize())}),g}}}const Xm=Qs("==",function(a,o,l){return o===l},fn),id=Qs("!=",function(a,o,l){return o!==l},function(a,o,l,u){return!fn(0,o,l,u)}),Wi=Qs("<",function(a,o,l){return o<l},function(a,o,l,u){return u.compare(o,l)<0}),qd=Qs(">",function(a,o,l){return o>l},function(a,o,l,u){return u.compare(o,l)>0}),rd=Qs("<=",function(a,o,l){return o<=l},function(a,o,l,u){return u.compare(o,l)<=0}),ws=Qs(">=",function(a,o,l){return o>=l},function(a,o,l,u){return u.compare(o,l)>=0});class fl{constructor(o,l,u,p,g,v){this.type=An,this.number=o,this.locale=l,this.currency=u,this.unit=p,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(o,l){if(3!==o.length)return l.error("Expected two arguments.");const u=l.parse(o[1],1,Re);if(!u)return null;const p=o[2];if("object"!=typeof p||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let g=null;if(p.locale&&(g=l.parse(p.locale,1,An),!g))return null;let v=null;if(p.currency&&(v=l.parse(p.currency,1,An),!v))return null;let w=null;if(p.unit&&(w=l.parse(p.unit,1,An),!w))return null;let D=null;if(p["min-fraction-digits"]&&(D=l.parse(p["min-fraction-digits"],1,Re),!D))return null;let T=null;return p["max-fraction-digits"]&&(T=l.parse(p["max-fraction-digits"],1,Re),!T)?null:new fl(u,g,v,w,D,T)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class ac{constructor(o){this.type=Re,this.input=o}static parse(o,l){if(2!==o.length)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const u=l.parse(o[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?l.error(`Expected argument of type string or array, but found ${_i(u.type)} instead.`):new ac(u):null}evaluate(o){const l=this.input.evaluate(o);if("string"==typeof l||Array.isArray(l))return l.length;throw new dr(`Expected value to be of type string or array, but found ${_i(Bi(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}const Ia={"==":Xm,"!=":id,">":qd,"<":Wi,">=":ws,"<=":rd,array:Sa,at:wy,boolean:Sa,case:sc,coalesce:rh,collator:cl,format:al,image:zd,in:It,"index-of":Ti,interpolate:lo,"interpolate-hcl":lo,"interpolate-lab":lo,length:ac,let:Hd,literal:bs,match:Gd,number:Sa,"number-format":fl,object:Sa,slice:Ma,step:zo,string:Sa,"to-boolean":Bo,"to-color":Bo,"to-number":Bo,"to-string":Bo,var:Pp,within:Ud};function Js(a,[o,l,u,p]){o=o.evaluate(a),l=l.evaluate(a),u=u.evaluate(a);const g=p?p.evaluate(a):1,v=yy(o,l,u,g);if(v)throw new dr(v);return new ki(o/255*g,l/255*g,u/255*g,g)}function es(a,o){return a in o}function lc(a,o){const l=o[a];return void 0===l?null:l}function ln(a){return{type:a}}ft.register(Ia,{error:[{kind:"error"},[An],(a,[o])=>{throw new dr(o.evaluate(a))}],typeof:[An,[xn],(a,[o])=>_i(Bi(o.evaluate(a)))],"to-rgba":[vo(Re,4),[Ur],(a,[o])=>o.evaluate(a).toArray()],rgb:[Ur,[Re,Re,Re],Js],rgba:[Ur,[Re,Re,Re,Re],Js],has:{type:yt,overloads:[[[An],(a,[o])=>es(o.evaluate(a),a.properties())],[[An,vs],(a,[o,l])=>es(o.evaluate(a),l.evaluate(a))]]},get:{type:xn,overloads:[[[An],(a,[o])=>lc(o.evaluate(a),a.properties())],[[An,vs],(a,[o,l])=>lc(o.evaluate(a),l.evaluate(a))]]},"feature-state":[xn,[An],(a,[o])=>lc(o.evaluate(a),a.featureState||{})],properties:[vs,[],a=>a.properties()],"geometry-type":[An,[],a=>a.geometryType()],id:[xn,[],a=>a.id()],zoom:[Re,[],a=>a.globals.zoom],pitch:[Re,[],a=>a.globals.pitch||0],"distance-from-center":[Re,[],a=>a.distanceFromCenter()],"heatmap-density":[Re,[],a=>a.globals.heatmapDensity||0],"line-progress":[Re,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[Re,[],a=>a.globals.skyRadialProgress||0],accumulated:[xn,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[Re,ln(Re),(a,o)=>{let l=0;for(const u of o)l+=u.evaluate(a);return l}],"*":[Re,ln(Re),(a,o)=>{let l=1;for(const u of o)l*=u.evaluate(a);return l}],"-":{type:Re,overloads:[[[Re,Re],(a,[o,l])=>o.evaluate(a)-l.evaluate(a)],[[Re],(a,[o])=>-o.evaluate(a)]]},"/":[Re,[Re,Re],(a,[o,l])=>o.evaluate(a)/l.evaluate(a)],"%":[Re,[Re,Re],(a,[o,l])=>o.evaluate(a)%l.evaluate(a)],ln2:[Re,[],()=>Math.LN2],pi:[Re,[],()=>Math.PI],e:[Re,[],()=>Math.E],"^":[Re,[Re,Re],(a,[o,l])=>Math.pow(o.evaluate(a),l.evaluate(a))],sqrt:[Re,[Re],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[Re,[Re],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[Re,[Re],(a,[o])=>Math.log(o.evaluate(a))],log2:[Re,[Re],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[Re,[Re],(a,[o])=>Math.sin(o.evaluate(a))],cos:[Re,[Re],(a,[o])=>Math.cos(o.evaluate(a))],tan:[Re,[Re],(a,[o])=>Math.tan(o.evaluate(a))],asin:[Re,[Re],(a,[o])=>Math.asin(o.evaluate(a))],acos:[Re,[Re],(a,[o])=>Math.acos(o.evaluate(a))],atan:[Re,[Re],(a,[o])=>Math.atan(o.evaluate(a))],min:[Re,ln(Re),(a,o)=>Math.min(...o.map(l=>l.evaluate(a)))],max:[Re,ln(Re),(a,o)=>Math.max(...o.map(l=>l.evaluate(a)))],abs:[Re,[Re],(a,[o])=>Math.abs(o.evaluate(a))],round:[Re,[Re],(a,[o])=>{const l=o.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[Re,[Re],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[Re,[Re],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[yt,[An,xn],(a,[o,l])=>a.properties()[o.value]===l.value],"filter-id-==":[yt,[xn],(a,[o])=>a.id()===o.value],"filter-type-==":[yt,[An],(a,[o])=>a.geometryType()===o.value],"filter-<":[yt,[An,xn],(a,[o,l])=>{const u=a.properties()[o.value],p=l.value;return typeof u==typeof p&&u<p}],"filter-id-<":[yt,[xn],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l<u}],"filter->":[yt,[An,xn],(a,[o,l])=>{const u=a.properties()[o.value],p=l.value;return typeof u==typeof p&&u>p}],"filter-id->":[yt,[xn],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l>u}],"filter-<=":[yt,[An,xn],(a,[o,l])=>{const u=a.properties()[o.value],p=l.value;return typeof u==typeof p&&u<=p}],"filter-id-<=":[yt,[xn],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l<=u}],"filter->=":[yt,[An,xn],(a,[o,l])=>{const u=a.properties()[o.value],p=l.value;return typeof u==typeof p&&u>=p}],"filter-id->=":[yt,[xn],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l>=u}],"filter-has":[yt,[xn],(a,[o])=>o.value in a.properties()],"filter-has-id":[yt,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[yt,[vo(An)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[yt,[vo(xn)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[yt,[An,vo(xn)],(a,[o,l])=>l.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[yt,[An,vo(xn)],(a,[o,l])=>function(u,p,g,v){for(;g<=v;){const w=g+v>>1;if(p[w]===u)return!0;p[w]>u?v=w-1:g=w+1}return!1}(a.properties()[o.value],l.value,0,l.value.length-1)],all:{type:yt,overloads:[[[yt,yt],(a,[o,l])=>o.evaluate(a)&&l.evaluate(a)],[ln(yt),(a,o)=>{for(const l of o)if(!l.evaluate(a))return!1;return!0}]]},any:{type:yt,overloads:[[[yt,yt],(a,[o,l])=>o.evaluate(a)||l.evaluate(a)],[ln(yt),(a,o)=>{for(const l of o)if(l.evaluate(a))return!0;return!1}]]},"!":[yt,[yt],(a,[o])=>!o.evaluate(a)],"is-supported-script":[yt,[An],(a,[o])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(o.evaluate(a))}],upcase:[An,[An],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[An,[An],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[An,ln(xn),(a,o)=>o.map(l=>Yu(l.evaluate(a))).join("")],"resolved-locale":[An,[Lo],(a,[o])=>o.evaluate(a).resolvedLocale()]});var oh=Ia;function sh(a){return{result:"success",value:a}}function ml(a){return{result:"error",value:a}}function co(a){return"data-driven"===a["property-type"]}function cc(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Ra(a){return!!a.expression&&a.expression.interpolated}function Rn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function Zi(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function Cy(a){return a}function Ar(a,o){const l="color"===o.type,u=a.stops&&"object"==typeof a.stops[0][0],p=u||!(u||void 0!==a.property),g=a.type||(Ra(o)?"exponential":"interval");if(l&&((a=ol({},a)).stops&&(a.stops=a.stops.map(T=>[T[0],ki.parse(T[1])])),a.default=ki.parse(a.default?a.default:o.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!zn[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let v,w,D;if("exponential"===g)v=ts;else if("interval"===g)v=ea;else if("categorical"===g){v=ah,w=Object.create(null);for(const T of a.stops)w[T[0]]=T[1];D=typeof a.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);v=ns}if(u){const T={},R=[];for(let B=0;B<a.stops.length;B++){const z=a.stops[B],$=z[0].zoom;void 0===T[$]&&(T[$]={zoom:$,type:a.type,property:a.property,default:a.default,stops:[]},R.push($)),T[$].stops.push([z[0].value,z[1]])}const P=[];for(const B of R)P.push([T[B].zoom,Ar(T[B],o)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:lo.interpolationFactor.bind(void 0,F),zoomStops:P.map(B=>B[0]),evaluate:({zoom:B},z)=>ts({stops:P,base:a.base},o,B).evaluate(B,z)}}if(p){const T="exponential"===g?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:lo.interpolationFactor.bind(void 0,T),zoomStops:a.stops.map(R=>R[0]),evaluate:({zoom:R})=>v(a,o,R,w,D)}}return{kind:"source",evaluate(T,R){const P=R&&R.properties?R.properties[a.property]:void 0;return void 0===P?ur(a.default,o.default):v(a,o,P,w,D)}}}function ur(a,o,l){return void 0!==a?a:void 0!==o?o:void 0!==l?l:void 0}function ah(a,o,l,u,p){return ur(typeof l===p?u[l]:void 0,a.default,o.default)}function ea(a,o,l){if("number"!==Rn(l))return ur(a.default,o.default);const u=a.stops.length;if(1===u||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[u-1][0])return a.stops[u-1][1];const p=eh(a.stops.map(g=>g[0]),l);return a.stops[p][1]}function ts(a,o,l){const u=void 0!==a.base?a.base:1;if("number"!==Rn(l))return ur(a.default,o.default);const p=a.stops.length;if(1===p||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[p-1][0])return a.stops[p-1][1];const g=eh(a.stops.map(R=>R[0]),l),v=function(R,P,F,B){const z=B-F,$=R-F;return 0===z?0:1===P?$/z:(Math.pow(P,$)-1)/(Math.pow(P,z)-1)}(l,u,a.stops[g][0],a.stops[g+1][0]),w=a.stops[g][1],D=a.stops[g+1][1];let T=nd[o.type]||Cy;if(a.colorSpace&&"rgb"!==a.colorSpace){const R=zn[a.colorSpace];T=(P,F)=>R.reverse(R.interpolate(R.forward(P),R.forward(F),v))}return"function"==typeof w.evaluate?{evaluate(...R){const P=w.evaluate.apply(void 0,R),F=D.evaluate.apply(void 0,R);if(void 0!==P&&void 0!==F)return T(P,F,v)}}:T(w,D,v)}function ns(a,o,l){return"color"===o.type?l=ki.parse(l):"formatted"===o.type?l=bo.fromString(l.toString()):"resolvedImage"===o.type?l=xo.fromString(l.toString()):Rn(l)===o.type||"enum"===o.type&&o.values[l]||(l=void 0),ur(l,a.default,o.default)}class od{constructor(o,l){var u;this.expression=o,this._warningHistory={},this._evaluator=new je,this._defaultValue=l?"color"===(u=l).type&&(Zi(u.default)||Array.isArray(u.default))?new ki(0,0,0,0):"color"===u.type?ki.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(o,l,u,p,g,v,w,D){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=u,this._evaluator.canonical=p||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=D||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,u,p,g,v,w,D){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=D||null;try{const T=this.expression.evaluate(this._evaluator);if(null==T||"number"==typeof T&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new dr(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function sd(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in oh}function ad(a,o){const l=new Op(oh,[],o?function(p){const g={color:Ur,string:An,number:Re,enum:An,boolean:yt,formatted:sl,resolvedImage:Zs};return"array"===p.type?vo(g[p.value]||xn,p.length):g[p.type]}(o):void 0),u=l.parse(a,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return u?sh(new od(u,o)):ml(l.errors)}class Km{constructor(o,l){this.kind=o,this._styleExpression=l,this.isStateDependent="constant"!==o&&!Ks(l.expression)}evaluateWithoutErrorHandling(o,l,u,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,p,g,v)}evaluate(o,l,u,p,g,v){return this._styleExpression.evaluate(o,l,u,p,g,v)}}class Wd{constructor(o,l,u,p){this.kind=o,this.zoomStops=u,this._styleExpression=l,this.isStateDependent="camera"!==o&&!Ks(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(o,l,u,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,p,g,v)}evaluate(o,l,u,p,g,v){return this._styleExpression.evaluate(o,l,u,p,g,v)}interpolationFactor(o,l,u){return this.interpolationType?lo.interpolationFactor(this.interpolationType,o,l,u):0}}function Zd(a,o){if("error"===(a=ad(a,o)).result)return a;const l=a.value.expression,u=ul(l);if(!u&&!co(o))return ml([new qt("","data expressions not supported")]);const p=hl(l,["zoom","pitch","distance-from-center"]);if(!p&&!cc(o))return ml([new qt("","zoom expressions not supported")]);const g=Vp(l);return g||p?g instanceof qt?ml([g]):g instanceof lo&&!Ra(o)?ml([new qt("",'"interpolate" expressions cannot be used with this property')]):sh(g?new Wd(u?"camera":"composite",a.value,g.labels,g instanceof lo?g.interpolation:void 0):new Km(u?"constant":"source",a.value)):ml([new qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class zp{constructor(o,l){this._parameters=o,this._specification=l,ol(this,Ar(this._parameters,this._specification))}static deserialize(o){return new zp(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Vp(a){let o=null;if(a instanceof Hd)o=Vp(a.result);else if(a instanceof rh){for(const l of a.args)if(o=Vp(l),o)break}else(a instanceof zo||a instanceof lo)&&a.input instanceof ft&&"zoom"===a.input.name&&(o=a);return o instanceof qt||a.eachChild(l=>{const u=Vp(l);u instanceof qt?o=u:!o&&u?o=new qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&u&&o!==u&&(o=new qt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class Dt{constructor(o,l,u,p){this.message=(o?`${o}: `:"")+u,p&&(this.identifier=p),null!=l&&l.__line__&&(this.line=l.__line__)}}function ta(a){const o=a.key,l=a.value,u=a.valueSpec||{},p=a.objectElementValidators||{},g=a.style,v=a.styleSpec;let w=[];const D=Rn(l);if("object"!==D)return[new Dt(o,l,`object expected, ${D} found`)];for(const T in l){const R=T.split(".")[0];let P;p[R]?P=p[R]:u[R]?P=Rr:p["*"]?P=p["*"]:u["*"]&&(P=Rr),P?w=w.concat(P({key:(o&&`${o}.`)+T,value:l[T],valueSpec:u[R]||u["*"],style:g,styleSpec:v,object:l,objectKey:T},l)):w.push(new Dt(o,l[T],`unknown property "${T}"`))}for(const T in u)p[T]||u[T].required&&void 0===u[T].default&&void 0===l[T]&&w.push(new Dt(o,l,`missing required property "${T}"`));return w}function Dy(a){const o=a.value,l=a.valueSpec,u=a.style,p=a.styleSpec,g=a.key,v=a.arrayElementValidator||Rr;if("array"!==Rn(o))return[new Dt(g,o,`array expected, ${Rn(o)} found`)];if(l.length&&o.length!==l.length)return[new Dt(g,o,`array length ${l.length} expected, length ${o.length} found`)];if(l["min-length"]&&o.length<l["min-length"])return[new Dt(g,o,`array length at least ${l["min-length"]} expected, length ${o.length} found`)];let w={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};p.$version<7&&(w.function=l.function),"object"===Rn(l.value)&&(w=l.value);let D=[];for(let T=0;T<o.length;T++)D=D.concat(v({array:o,arrayIndex:T,value:o[T],valueSpec:w,style:u,styleSpec:p,key:`${g}[${T}]`}));return D}function lh(a){const o=a.key,l=a.value,u=a.valueSpec;let p=Rn(l);if("number"===p&&l!=l&&(p="NaN"),"number"!==p)return[new Dt(o,l,`number expected, ${p} found`)];if("minimum"in u){let g=u.minimum;if("array"===Rn(u.minimum)&&(g=u.minimum[a.arrayIndex]),l<g)return[new Dt(o,l,`${l} is less than the minimum value ${g}`)]}if("maximum"in u){let g=u.maximum;if("array"===Rn(u.maximum)&&(g=u.maximum[a.arrayIndex]),l>g)return[new Dt(o,l,`${l} is greater than the maximum value ${g}`)]}return[]}function ch(a){const o=a.valueSpec,l=Gi(a.value.type);let u,p,g,v={};const w="categorical"!==l&&void 0===a.value.property,D=!w,T="array"===Rn(a.value.stops)&&"array"===Rn(a.value.stops[0])&&"object"===Rn(a.value.stops[0][0]),R=ta({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(B){if("identity"===l)return[new Dt(B.key,B.value,'identity function may not have a "stops" property')];let z=[];const $=B.value;return z=z.concat(Dy({key:B.key,value:$,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:P})),"array"===Rn($)&&0===$.length&&z.push(new Dt(B.key,$,"array must have at least one stop")),z},default:function(B){return Rr({key:B.key,value:B.value,valueSpec:o,style:B.style,styleSpec:B.styleSpec})}}});return"identity"===l&&w&&R.push(new Dt(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||R.push(new Dt(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!Ra(a.valueSpec)&&R.push(new Dt(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(D&&!co(a.valueSpec)?R.push(new Dt(a.key,a.value,"property functions not supported")):w&&!cc(a.valueSpec)&&R.push(new Dt(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!T||void 0!==a.value.property||R.push(new Dt(a.key,a.value,'"property" property is required')),R;function P(B){let z=[];const $=B.value,Q=B.key;if("array"!==Rn($))return[new Dt(Q,$,`array expected, ${Rn($)} found`)];if(2!==$.length)return[new Dt(Q,$,`array length 2 expected, length ${$.length} found`)];if(T){if("object"!==Rn($[0]))return[new Dt(Q,$,`object expected, ${Rn($[0])} found`)];if(void 0===$[0].zoom)return[new Dt(Q,$,"object stop key must have zoom")];if(void 0===$[0].value)return[new Dt(Q,$,"object stop key must have value")];const ae=Gi($[0].zoom);if("number"!=typeof ae)return[new Dt(Q,$[0].zoom,"stop zoom values must be numbers")];if(g&&g>ae)return[new Dt(Q,$[0].zoom,"stop zoom values must appear in ascending order")];ae!==g&&(g=ae,p=void 0,v={}),z=z.concat(ta({key:`${Q}[0]`,value:$[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:lh,value:F}}))}else z=z.concat(F({key:`${Q}[0]`,value:$[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},$));return sd(Sr($[1]))?z.concat([new Dt(`${Q}[1]`,$[1],"expressions are not allowed in function stops.")]):z.concat(Rr({key:`${Q}[1]`,value:$[1],valueSpec:o,style:B.style,styleSpec:B.styleSpec}))}function F(B,z){const $=Rn(B.value),Q=Gi(B.value),ae=null!==B.value?B.value:z;if(u){if($!==u)return[new Dt(B.key,ae,`${$} stop domain type must match previous stop domain type ${u}`)]}else u=$;if("number"!==$&&"string"!==$&&"boolean"!==$&&"number"!=typeof Q&&"string"!=typeof Q&&"boolean"!=typeof Q)return[new Dt(B.key,ae,"stop domain value must be a number, string, or boolean")];if("number"!==$&&"categorical"!==l){let ve=`number expected, ${$} found`;return co(o)&&void 0===l&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Dt(B.key,ae,ve)]}return"categorical"!==l||"number"!==$||"number"==typeof Q&&isFinite(Q)&&Math.floor(Q)===Q?"categorical"!==l&&"number"===$&&"number"==typeof Q&&"number"==typeof p&&void 0!==p&&Q<p?[new Dt(B.key,ae,"stop domain values must appear in ascending order")]:(p=Q,"categorical"===l&&Q in v?[new Dt(B.key,ae,"stop domain values must be unique")]:(v[Q]=!0,[])):[new Dt(B.key,ae,`integer expected, found ${String(Q)}`)]}}function Ir(a){const o=("property"===a.expressionContext?Zd:ad)(Sr(a.value),a.valueSpec);if("error"===o.result)return o.value.map(u=>new Dt(`${a.key}${u.key}`,a.value,u.message));const l=o.value.expression||o.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new Dt(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!Ks(l))return[new Dt(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return dh(l,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!hl(l,["zoom","feature-state"]))return[new Dt(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!ul(l))return[new Dt(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function dh(a,o){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const p of o.valueSpec.expression.parameters)l.delete(p);if(0===l.size)return[];const u=[];return a instanceof ft&&l.has(a.name)?[new Dt(o.key,o.value,`["${a.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(a.eachChild(p=>{u.push(...dh(p,o))}),u)}function jp(a){const o=a.key,l=a.value,u=a.valueSpec,p=[];return Array.isArray(u.values)?-1===u.values.indexOf(Gi(l))&&p.push(new Dt(o,l,`expected one of [${u.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(u.values).indexOf(Gi(l))&&p.push(new Dt(o,l,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(l)} found`)),p}function Qm(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const o of a.slice(1))if(!Qm(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function Up(a,o="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Qm(a)||(a=dc(a));const l=a;let u=!0;try{u=function(T){if(!Xd(T))return T;let R=Sr(T);return Yd(R),R=$p(R),R}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const p=We[`filter_${o}`],g=ad(u,p);let v=null;if("error"===g.result)throw new Error(g.value.map(T=>`${T.key}: ${T.message}`).join(", "));v=(T,R,P)=>g.value.evaluate(T,R,{},P);let w=null,D=null;if(u!==l){const T=ad(l,p);if("error"===T.result)throw new Error(T.value.map(R=>`${R.key}: ${R.message}`).join(", "));w=(R,P,F,B,z)=>T.value.evaluate(R,P,{},F,void 0,void 0,B,z),D=!ul(T.value.expression)}return{filter:v,dynamicFilter:w||void 0,needGeometry:_l(u),needFeature:!!D}}function $p(a){if(!Array.isArray(a))return a;const o=function(l){if(Jm.has(l[0]))for(let u=1;u<l.length;u++)if(Xd(l[u]))return!0;return l}(a);return!0===o?o:o.map(l=>$p(l))}function Yd(a){let o=!1;const l=[];if("case"===a[0]){for(let u=1;u<a.length-1;u+=2)o=o||Xd(a[u]),l.push(a[u+1]);l.push(a[a.length-1])}else if("match"===a[0]){o=o||Xd(a[1]);for(let u=2;u<a.length-1;u+=2)l.push(a[u+1]);l.push(a[a.length-1])}else if("step"===a[0]){o=o||Xd(a[1]);for(let u=1;u<a.length-1;u+=2)l.push(a[u+1])}o&&(a.length=0,a.push("any",...l));for(let u=1;u<a.length;u++)Yd(a[u])}function Xd(a){if(!Array.isArray(a))return!1;if("pitch"===(o=a[0])||"distance-from-center"===o)return!0;var o;for(let l=1;l<a.length;l++)if(Xd(a[l]))return!0;return!1}const Jm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function lb(a,o){return a<o?-1:a>o?1:0}function _l(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let o=1;o<a.length;o++)if(_l(a[o]))return!0;return!1}function dc(a){if(!a)return!0;const o=a[0];return a.length<=1?"any"!==o:"=="===o?e_(a[1],a[2],"=="):"!="===o?hh(e_(a[1],a[2],"==")):"<"===o||">"===o||"<="===o||">="===o?e_(a[1],a[2],o):"any"===o?(l=a.slice(1),["any"].concat(l.map(dc))):"all"===o?["all"].concat(a.slice(1).map(dc)):"none"===o?["all"].concat(a.slice(1).map(dc).map(hh)):"in"===o?Kd(a[1],a.slice(2)):"!in"===o?hh(Kd(a[1],a.slice(2))):"has"===o?uh(a[1]):"!has"===o?hh(uh(a[1])):"within"!==o||a;var l}function e_(a,o,l){switch(a){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,a,o]}}function Kd(a,o){if(0===o.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",a,["literal",o.sort(lb)]]:["filter-in-small",a,["literal",o]]}}function uh(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function hh(a){return["!",a]}function Qd(a){return Qm(Sr(a.value))?Ir(ol({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):Jd(a)}function Jd(a){const o=a.value,l=a.key;if("array"!==Rn(o))return[new Dt(l,o,`array expected, ${Rn(o)} found`)];const u=a.styleSpec;let p,g=[];if(o.length<1)return[new Dt(l,o,"filter array must have at least 1 element")];switch(g=g.concat(jp({key:`${l}[0]`,value:o[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),Gi(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===Gi(o[1])&&g.push(new Dt(l,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&g.push(new Dt(l,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(p=Rn(o[1]),"string"!==p&&g.push(new Dt(`${l}[1]`,o[1],`string expected, ${p} found`)));for(let v=2;v<o.length;v++)p=Rn(o[v]),"$type"===Gi(o[1])?g=g.concat(jp({key:`${l}[${v}]`,value:o[v],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&g.push(new Dt(`${l}[${v}]`,o[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<o.length;v++)g=g.concat(Jd({key:`${l}[${v}]`,value:o[v],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":p=Rn(o[1]),2!==o.length?g.push(new Dt(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==p&&g.push(new Dt(`${l}[1]`,o[1],`string expected, ${p} found`));break;case"within":p=Rn(o[1]),2!==o.length?g.push(new Dt(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==p&&g.push(new Dt(`${l}[1]`,o[1],`object expected, ${p} found`))}return g}function t_(a,o){const l=a.key,u=a.style,p=a.styleSpec,g=a.value,v=a.objectKey,w=p[`${o}_${a.layerType}`];if(!w)return[];const D=v.match(/^(.*)-transition$/);if("paint"===o&&D&&w[D[1]]&&w[D[1]].transition)return Rr({key:l,value:g,valueSpec:p.transition,style:u,styleSpec:p});const T=a.valueSpec||w[v];if(!T)return[new Dt(l,g,`unknown property "${v}"`)];let R;if("string"===Rn(g)&&co(T)&&!T.tokens&&(R=/^{([^}]+)}$/.exec(g))){const F=`\`{ "type": "identity", "property": ${R?JSON.stringify(R[1]):'"_"'} }\``;return[new Dt(l,g,`"${v}" does not support interpolation syntax\nUse an identity property function instead: ${F}.`)]}const P=[];return"symbol"===a.layerType&&("text-field"===v&&u&&!u.glyphs&&P.push(new Dt(l,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&Zi(Sr(g))&&"identity"===Gi(g.type)&&P.push(new Dt(l,g,'"text-font" does not support identity functions'))),P.concat(Rr({key:a.key,value:g,valueSpec:T,style:u,styleSpec:p,expressionContext:"property",propertyType:o,propertyKey:v}))}function n_(a){return t_(a,"paint")}function is(a){return t_(a,"layout")}function eu(a){let o=[];const l=a.value,u=a.key,p=a.style,g=a.styleSpec;l.type||l.ref||o.push(new Dt(u,l,'either "type" or "ref" is required'));let v=Gi(l.type);const w=Gi(l.ref);if(l.id){const D=Gi(l.id);for(let T=0;T<a.arrayIndex;T++){const R=p.layers[T];Gi(R.id)===D&&o.push(new Dt(u,l.id,`duplicate layer id "${l.id}", previously used at line ${R.id.__line__}`))}}if("ref"in l){let D;["type","source","source-layer","filter","layout"].forEach(T=>{T in l&&o.push(new Dt(u,l[T],`"${T}" is prohibited for ref layers`))}),p.layers.forEach(T=>{Gi(T.id)===w&&(D=T)}),D?D.ref?o.push(new Dt(u,l.ref,"ref cannot reference another ref layer")):v=Gi(D.type):"string"==typeof w&&o.push(new Dt(u,l.ref,`ref layer "${w}" not found`))}else if("background"!==v&&"sky"!==v)if(l.source){const D=p.sources&&p.sources[l.source],T=D&&Gi(D.type);D?"vector"===T&&"raster"===v?o.push(new Dt(u,l.source,`layer "${l.id}" requires a raster source`)):"raster"===T&&"raster"!==v?o.push(new Dt(u,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==T||l["source-layer"]?"raster-dem"===T&&"hillshade"!==v?o.push(new Dt(u,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==v||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===T&&D.lineMetrics||o.push(new Dt(u,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new Dt(u,l,`layer "${l.id}" must specify a "source-layer"`)):o.push(new Dt(u,l.source,`source "${l.source}" not found`))}else o.push(new Dt(u,l,'missing required property "source"'));return o=o.concat(ta({key:u,value:l,valueSpec:g.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Rr({key:`${u}.type`,value:l.type,valueSpec:g.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:D=>Qd(ol({layerType:v},D)),layout:D=>ta({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":T=>is(ol({layerType:v},T))}}),paint:D=>ta({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":T=>n_(ol({layerType:v},T))}})}})),o}function Mi(a){const o=a.value,l=a.key,u=Rn(o);return"string"!==u?[new Dt(l,o,`string expected, ${u} found`)]:[]}const Hp={promoteId:function({key:a,value:o}){if("string"===Rn(o))return Mi({key:a,value:o});{const l=[];for(const u in o)l.push(...Mi({key:`${a}.${u}`,value:o[u]}));return l}}};function Ey(a){const o=a.value,l=a.key,u=a.styleSpec,p=a.style;if(!o.type)return[new Dt(l,o,'"type" is required')];const g=Gi(o.type);let v;switch(g){case"vector":case"raster":case"raster-dem":return v=ta({key:l,value:o,valueSpec:u[`source_${g.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:Hp}),v;case"geojson":if(v=ta({key:l,value:o,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:Hp}),o.cluster)for(const w in o.clusterProperties){const[D,T]=o.clusterProperties[w],R="string"==typeof D?[D,["accumulated"],["get",w]]:D;v.push(...Ir({key:`${l}.${w}.map`,value:T,expressionContext:"cluster-map"})),v.push(...Ir({key:`${l}.${w}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return v;case"video":return ta({key:l,value:o,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return ta({key:l,value:o,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new Dt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return jp({key:`${l}.type`,value:o.type,valueSpec:{values:Gp(u)},style:p,styleSpec:u})}}function Gp(a){return a.source.reduce((o,l)=>{const u=a[l];return"enum"===u.type.type&&(o=o.concat(Object.keys(u.type.values))),o},[])}function ph(a){const o=a.value,l=a.styleSpec,u=l.light,p=a.style;let g=[];const v=Rn(o);if(void 0===o)return g;if("object"!==v)return g=g.concat([new Dt("light",o,`object expected, ${v} found`)]),g;for(const w in o){const D=w.match(/^(.*)-transition$/);g=g.concat(D&&u[D[1]]&&u[D[1]].transition?Rr({key:w,value:o[w],valueSpec:l.transition,style:p,styleSpec:l}):u[w]?Rr({key:w,value:o[w],valueSpec:u[w],style:p,styleSpec:l}):[new Dt(w,o[w],`unknown property "${w}"`)])}return g}function ld(a){const o=a.value,l=a.key,u=a.style,p=a.styleSpec,g=p.terrain;let v=[];const w=Rn(o);if(void 0===o)return v;if("object"!==w)return v=v.concat([new Dt("terrain",o,`object expected, ${w} found`)]),v;for(const D in o){const T=D.match(/^(.*)-transition$/);v=v.concat(T&&g[T[1]]&&g[T[1]].transition?Rr({key:D,value:o[D],valueSpec:p.transition,style:u,styleSpec:p}):g[D]?Rr({key:D,value:o[D],valueSpec:g[D],style:u,styleSpec:p}):[new Dt(D,o[D],`unknown property "${D}"`)])}if(o.source){const D=u.sources&&u.sources[o.source],T=D&&Gi(D.type);D?"raster-dem"!==T&&v.push(new Dt(l,o.source,`terrain cannot be used with a source of type ${String(T)}, it only be used with a "raster-dem" source type`)):v.push(new Dt(l,o.source,`source "${o.source}" not found`))}else v.push(new Dt(l,o,'terrain is missing required property "source"'));return v}function i_(a){const o=a.value,l=a.style,u=a.styleSpec,p=u.fog;let g=[];const v=Rn(o);if(void 0===o)return g;if("object"!==v)return g=g.concat([new Dt("fog",o,`object expected, ${v} found`)]),g;for(const w in o){const D=w.match(/^(.*)-transition$/);g=g.concat(D&&p[D[1]]&&p[D[1]].transition?Rr({key:w,value:o[w],valueSpec:u.transition,style:l,styleSpec:u}):p[w]?Rr({key:w,value:o[w],valueSpec:p[w],style:l,styleSpec:u}):[new Dt(w,o[w],`unknown property "${w}"`)])}return g}const Ty={"*":()=>[],array:Dy,boolean:function(a){const o=a.value,l=a.key,u=Rn(o);return"boolean"!==u?[new Dt(l,o,`boolean expected, ${u} found`)]:[]},number:lh,color:function(a){const o=a.key,l=a.value,u=Rn(l);return"string"!==u?[new Dt(o,l,`color expected, ${u} found`)]:null===$r(l)?[new Dt(o,l,`color expected, "${l}" found`)]:[]},enum:jp,filter:Qd,function:ch,layer:eu,object:ta,source:Ey,light:ph,terrain:ld,fog:i_,string:Mi,formatted:function(a){return 0===Mi(a).length?[]:Ir(a)},resolvedImage:function(a){return 0===Mi(a).length?[]:Ir(a)},projection:function(a){const o=a.value,l=a.styleSpec,u=l.projection,p=a.style;let g=[];const v=Rn(o);if("object"===v)for(const w in o)g=g.concat(Rr({key:w,value:o[w],valueSpec:u[w],style:p,styleSpec:l}));else"string"!==v&&(g=g.concat([new Dt("projection",o,`object or string expected, ${v} found`)]));return g}};function Rr(a){const o=a.value,l=a.valueSpec,u=a.styleSpec;return l.expression&&Zi(Gi(o))?ch(a):l.expression&&sd(Sr(o))?Ir(a):l.type&&Ty[l.type]?Ty[l.type](a):ta(ol({},a,{valueSpec:l.type?u[l.type]:l}))}function qp(a){const o=a.value,l=a.key,u=Mi(a);return u.length||(-1===o.indexOf("{fontstack}")&&u.push(new Dt(l,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&u.push(new Dt(l,o,'"glyphs" url must include a "{range}" token'))),u}function r_(a,o=We){return Cs(Rr({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:qp,"*":()=>[]}}))}const fh=a=>Cs(n_(a)),Sy=a=>Cs(is(a));function Cs(a){return a.slice().sort((o,l)=>o.line&&l.line?o.line-l.line:0)}function My(a,o){let l=!1;if(o&&o.length)for(const u of o)a.fire(new rl(new Error(u.message))),l=!0;return l}var o_=na,rs=3;function na(a,o,l){var u=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var p=new Int32Array(this.arrayBuffer);a=p[0],this.d=(o=p[1])+2*(l=p[2]);for(var g=0;g<this.d*this.d;g++){var v=p[rs+g],w=p[rs+g+1];u.push(v===w?null:p.subarray(v,w))}var D=p[rs+u.length+1];this.keys=p.subarray(p[rs+u.length],D),this.bboxes=p.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var T=0;T<this.d*this.d;T++)u.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=l,this.scale=o/a,this.uid=0;var R=l/o*a;this.min=-R,this.max=a+R}na.prototype.insert=function(a,o,l,u,p){this._forEachCell(o,l,u,p,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(p)},na.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},na.prototype._insertCell=function(a,o,l,u,p,g){this.cells[p].push(g)},na.prototype.query=function(a,o,l,u,p){var g=this.min,v=this.max;if(a<=g&&o<=g&&v<=l&&v<=u&&!p)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(a,o,l,u,this._queryCell,w,{},p),w},na.prototype._queryCell=function(a,o,l,u,p,g,v,w){var D=this.cells[p];if(null!==D)for(var T=this.keys,R=this.bboxes,P=0;P<D.length;P++){var F=D[P];if(void 0===v[F]){var B=4*F;(w?w(R[B+0],R[B+1],R[B+2],R[B+3]):a<=R[B+2]&&o<=R[B+3]&&l>=R[B+0]&&u>=R[B+1])?(v[F]=!0,g.push(T[F])):v[F]=!1}}},na.prototype._forEachCell=function(a,o,l,u,p,g,v,w){for(var D=this._convertToCellCoord(a),T=this._convertToCellCoord(o),R=this._convertToCellCoord(l),P=this._convertToCellCoord(u),F=D;F<=R;F++)for(var B=T;B<=P;B++){var z=this.d*B+F;if((!w||w(this._convertFromCellCoord(F),this._convertFromCellCoord(B),this._convertFromCellCoord(F+1),this._convertFromCellCoord(B+1)))&&p.call(this,a,o,l,u,z,g,v,w))return}},na.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},na.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},na.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=rs+this.cells.length+1+1,l=0,u=0;u<this.cells.length;u++)l+=this.cells[u].length;var p=new Int32Array(o+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var g=o,v=0;v<a.length;v++){var w=a[v];p[rs+v]=g,p.set(w,g),g+=w.length}return p[rs+a.length]=g,p.set(this.keys,g),p[rs+a.length+1]=g+=this.keys.length,p.set(this.bboxes,g),g+=this.bboxes.length,p.buffer};var uc=ms(o_);const Ci={};function Et(a,o,l={}){Object.defineProperty(a,"_classRegistryKey",{value:o,writeable:!1}),Ci[o]={klass:a,omit:l.omit||[]}}Et(Object,"Object"),uc.serialize=function(a,o){const l=a.toArrayBuffer();return o&&o.push(l),{buffer:l}},uc.deserialize=function(a){return new uc(a.buffer)},Object.defineProperty(uc,"name",{value:"Grid"}),Et(uc,"Grid"),Et(ki,"Color"),Et(Error,"Error"),Et(nl,"AJAXError"),Et(xo,"ResolvedImage"),Et(zp,"StylePropertyFunction"),Et(od,"StyleExpression",{omit:["_evaluator"]}),Et(Wd,"ZoomDependentExpression"),Et(Km,"ZoomConstantExpression"),Et(ft,"CompoundExpression",{omit:["_evaluate"]});for(const a in oh)Ci[oh[a]._classRegistryKey]||Et(oh[a],`Expression${a}`);function Wp(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function Zp(a){return at.ImageBitmap&&a instanceof at.ImageBitmap}function hc(a,o){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Wp(a)||Zp(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return o&&o.push(l.buffer),l}if(a instanceof at.ImageData)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const u of a)l.push(hc(u,o));return l}if("object"==typeof a){const l=a.constructor,u=l._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const p=l.serialize?l.serialize(a,o):{};if(!l.serialize){for(const g in a)a.hasOwnProperty(g)&&(Ci[u].omit.indexOf(g)>=0||(p[g]=hc(a[g],o)));a instanceof Error&&(p.message=a.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(p.$name=u),p}throw new Error("can't serialize object of type "+typeof a)}function gl(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Wp(a)||Zp(a)||ArrayBuffer.isView(a)||a instanceof at.ImageData)return a;if(Array.isArray(a))return a.map(gl);if("object"==typeof a){const o=a.$name||"Object",{klass:l}=Ci[o];if(!l)throw new Error(`can't deserialize unregistered class ${o}`);if(l.deserialize)return l.deserialize(a);const u=Object.create(l.prototype);for(const p of Object.keys(a))"$name"!==p&&(u[p]=gl(a[p]));return u}throw new Error("can't deserialize object of type "+typeof a)}const xt={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function tu(a){for(const o of a)if(mh(o.charCodeAt(0)))return!0;return!1}function Ay(a){for(const o of a)if(!Ds(o.charCodeAt(0)))return!1;return!0}function Ds(a){return!(xt.Arabic(a)||xt["Arabic Supplement"](a)||xt["Arabic Extended-A"](a)||xt["Arabic Presentation Forms-A"](a)||xt["Arabic Presentation Forms-B"](a))}function mh(a){return!(746!==a&&747!==a&&(a<4352||!(xt["Bopomofo Extended"](a)||xt.Bopomofo(a)||xt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||xt["CJK Compatibility Ideographs"](a)||xt["CJK Compatibility"](a)||xt["CJK Radicals Supplement"](a)||xt["CJK Strokes"](a)||!(!xt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||xt["CJK Unified Ideographs Extension A"](a)||xt["CJK Unified Ideographs"](a)||xt["Enclosed CJK Letters and Months"](a)||xt["Hangul Compatibility Jamo"](a)||xt["Hangul Jamo Extended-A"](a)||xt["Hangul Jamo Extended-B"](a)||xt["Hangul Jamo"](a)||xt["Hangul Syllables"](a)||xt.Hiragana(a)||xt["Ideographic Description Characters"](a)||xt.Kanbun(a)||xt["Kangxi Radicals"](a)||xt["Katakana Phonetic Extensions"](a)||xt.Katakana(a)&&12540!==a||!(!xt["Halfwidth and Fullwidth Forms"](a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!xt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||xt["Unified Canadian Aboriginal Syllabics"](a)||xt["Unified Canadian Aboriginal Syllabics Extended"](a)||xt["Vertical Forms"](a)||xt["Yijing Hexagram Symbols"](a)||xt["Yi Syllables"](a)||xt["Yi Radicals"](a))))}function Yp(a){return!(mh(a)||(o=a,xt["Latin-1 Supplement"](o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||xt["General Punctuation"](o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||xt["Letterlike Symbols"](o)||xt["Number Forms"](o)||xt["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||xt["Control Pictures"](o)&&9251!==o||xt["Optical Character Recognition"](o)||xt["Enclosed Alphanumerics"](o)||xt["Geometric Shapes"](o)||xt["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||xt["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||xt["CJK Symbols and Punctuation"](o)||xt.Katakana(o)||xt["Private Use Area"](o)||xt["CJK Compatibility Forms"](o)||xt["Small Form Variants"](o)||xt["Halfwidth and Fullwidth Forms"](o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function gi(a){return a>=1424&&a<=2303||xt["Arabic Presentation Forms-A"](a)||xt["Arabic Presentation Forms-B"](a)}function Iy(a,o){return!(!o&&gi(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||xt.Khmer(a))}function _h(a){for(const o of a)if(gi(o.charCodeAt(0)))return!0;return!1}const qr="deferred",Xp="loading",gh="loaded";let Es=null,_="unavailable",c=null;const h=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(_="error"),Es&&Es(a)};function y(){x.fire(new Yc("pluginStateChange",{pluginStatus:_,pluginURL:c}))}const x=new Gu,C=function(){return _},S=function(){if(_!==qr||!c)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_=Xp,y(),c&&Zc({url:c},a=>{a?h(a):(_=gh,y())})},M={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_===gh||null!=M.applyArabicShaping,isLoading:()=>_===Xp,setState(a){_=a.pluginStatus,c=a.pluginURL},isParsed:()=>null!=M.applyArabicShaping&&null!=M.processBidirectionalText&&null!=M.processStyledBidirectionalText,getPluginURL:()=>c};class k{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(o){return function(l,u){for(const p of l)if(!Iy(p.charCodeAt(0),u))return!1;return!0}(o,M.isLoaded())}}class L{constructor(o,l){this.property=o,this.value=l,this.expression=function(u,p){if(Zi(u))return new zp(u,p);if(sd(u)){const g=Zd(u,p);if("error"===g.result)throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));return g.value}{let g=u;return"string"==typeof u&&"color"===p.type&&(g=ki.parse(u)),{kind:"constant",evaluate:()=>g}}}(void 0===l?o.specification.default:l,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,l,u){return this.property.possiblyEvaluate(this,o,l,u)}}class N{constructor(o){this.property=o,this.value=new L(o,void 0)}transitioned(o,l){return new K(this.property,this.value,l,Hi({},o.transition,this.transition),o.now)}untransitioned(){return new K(this.property,this.value,null,{},0)}}class V{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return Fo(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new N(this._values[o].property)),this._values[o].value=new L(this._values[o].property,null===l?void 0:Fo(l))}getTransition(o){return Fo(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new N(this._values[o].property)),this._values[o].transition=Fo(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u);const p=this.getTransition(l);void 0!==p&&(o[`${l}-transition`]=p)}return o}transitioned(o,l){const u=new te(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].transitioned(o,l._values[p]);return u}untransitioned(){const o=new te(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class K{constructor(o,l,u,p,g){const v=p.delay||0,w=p.duration||0;g=g||0,this.property=o,this.value=l,this.begin=g+v,this.end=this.begin+w,o.specification.transition&&(p.delay||p.duration)&&(this.prior=u)}possiblyEvaluate(o,l,u){const p=o.now||0,g=this.value.possiblyEvaluate(o,l,u),v=this.prior;if(v){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return v.possiblyEvaluate(o,l,u);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(o,l,u),g,vn(w))}}return g}}class te{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,u){const p=new se(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(o,l,u);return p}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class re{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return Fo(this._values[o].value)}setValue(o,l){this._values[o]=new L(this._values[o].property,null===l?void 0:Fo(l))}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u)}return o}possiblyEvaluate(o,l,u){const p=new se(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(o,l,u);return p}}class ie{constructor(o,l,u){this.property=o,this.value=l,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,l,u,p){return this.property.evaluate(this.value,this.parameters,o,l,u,p)}}class se{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class U{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,u){const p=nd[this.specification.type];return p?p(o,l,u):o}}class J{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,u,p){return new ie(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(l,null,{},u,p)}:o.expression,l)}interpolate(o,l,u){if("constant"!==o.value.kind||"constant"!==l.value.kind)return o;if(void 0===o.value.value||void 0===l.value.value)return new ie(this,{kind:"constant",value:void 0},o.parameters);const p=nd[this.specification.type];return p?new ie(this,{kind:"constant",value:p(o.value.value,l.value.value,u)},o.parameters):o}evaluate(o,l,u,p,g,v){return"constant"===o.kind?o.value:o.evaluate(l,u,p,g,v)}}class de{constructor(o){this.specification=o}possiblyEvaluate(o,l,u,p){return!!o.expression.evaluate(l,null,{},u,p)}interpolate(){return!1}}class he{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new k(0,{});for(const u in o){const p=o[u];p.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new L(p,void 0),v=this.defaultTransitionablePropertyValues[u]=new N(p);this.defaultTransitioningPropertyValues[u]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate(l)}}}function Ce(a,o){return 256*(a=hn(Math.floor(a),0,255))+hn(Math.floor(o),0,255)}Et(J,"DataDrivenProperty"),Et(U,"DataConstantProperty"),Et(de,"ColorRampProperty");const Se={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ee{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ce{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function De(a,o=1){let l=0,u=0;return{members:a.map(p=>{const g=Se[p.type].BYTES_PER_ELEMENT,v=l=_e(l,Math.max(o,g)),w=p.components||1;return u=Math.max(u,g),l+=g*w,{name:p.name,type:p.type,components:w,offset:v}}),size:_e(l,Math.max(u,o)),alignment:o}}function _e(a,o){return Math.ceil(a/o)*o}class Ie extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const p=2*o;return this.int16[p+0]=l,this.int16[p+1]=u,o}}Ie.prototype.bytesPerElement=4,Et(Ie,"StructArrayLayout2i4");class Pe extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,u)}emplace(o,l,u,p){const g=3*o;return this.int16[g+0]=l,this.int16[g+1]=u,this.int16[g+2]=p,o}}Pe.prototype.bytesPerElement=6,Et(Pe,"StructArrayLayout3i6");class Ke extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,o,l,u,p)}emplace(o,l,u,p,g){const v=4*o;return this.int16[v+0]=l,this.int16[v+1]=u,this.int16[v+2]=p,this.int16[v+3]=g,o}}Ke.prototype.bytesPerElement=8,Et(Ke,"StructArrayLayout4i8");class Ve extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,p,g,v,w){const D=this.length;return this.resize(D+1),this.emplace(D,o,l,u,p,g,v,w)}emplace(o,l,u,p,g,v,w,D){const T=6*o,R=12*o,P=3*o;return this.int16[T+0]=l,this.int16[T+1]=u,this.uint8[R+4]=p,this.uint8[R+5]=g,this.uint8[R+6]=v,this.uint8[R+7]=w,this.float32[P+2]=D,o}}Ve.prototype.bytesPerElement=12,Et(Ve,"StructArrayLayout2i4ub1f12");class et extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,o,l,u,p)}emplace(o,l,u,p,g){const v=4*o;return this.float32[v+0]=l,this.float32[v+1]=u,this.float32[v+2]=p,this.float32[v+3]=g,o}}et.prototype.bytesPerElement=16,Et(et,"StructArrayLayout4f16");class Be extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,p,g)}emplace(o,l,u,p,g,v){const w=6*o,D=3*o;return this.uint16[w+0]=l,this.uint16[w+1]=u,this.uint16[w+2]=p,this.uint16[w+3]=g,this.float32[D+2]=v,o}}Be.prototype.bytesPerElement=12,Et(Be,"StructArrayLayout4ui1f12");class Ye extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,o,l,u,p)}emplace(o,l,u,p,g){const v=4*o;return this.uint16[v+0]=l,this.uint16[v+1]=u,this.uint16[v+2]=p,this.uint16[v+3]=g,o}}Ye.prototype.bytesPerElement=8,Et(Ye,"StructArrayLayout4ui8");class ct extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,o,l,u,p,g,v)}emplace(o,l,u,p,g,v,w){const D=6*o;return this.int16[D+0]=l,this.int16[D+1]=u,this.int16[D+2]=p,this.int16[D+3]=g,this.int16[D+4]=v,this.int16[D+5]=w,o}}ct.prototype.bytesPerElement=12,Et(ct,"StructArrayLayout6i12");class tt extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,p,g,v,w,D,T,R,P,F){const B=this.length;return this.resize(B+1),this.emplace(B,o,l,u,p,g,v,w,D,T,R,P,F)}emplace(o,l,u,p,g,v,w,D,T,R,P,F,B){const z=12*o;return this.int16[z+0]=l,this.int16[z+1]=u,this.int16[z+2]=p,this.int16[z+3]=g,this.uint16[z+4]=v,this.uint16[z+5]=w,this.uint16[z+6]=D,this.uint16[z+7]=T,this.int16[z+8]=R,this.int16[z+9]=P,this.int16[z+10]=F,this.int16[z+11]=B,o}}tt.prototype.bytesPerElement=24,Et(tt,"StructArrayLayout4i4ui4i24");class dt extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,o,l,u,p,g,v)}emplace(o,l,u,p,g,v,w){const D=10*o,T=5*o;return this.int16[D+0]=l,this.int16[D+1]=u,this.int16[D+2]=p,this.float32[T+2]=g,this.float32[T+3]=v,this.float32[T+4]=w,o}}dt.prototype.bytesPerElement=20,Et(dt,"StructArrayLayout3i3f20");class Tt extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}Tt.prototype.bytesPerElement=4,Et(Tt,"StructArrayLayout1ul4");class Ht extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,p,g,v,w,D,T,R,P,F,B){const z=this.length;return this.resize(z+1),this.emplace(z,o,l,u,p,g,v,w,D,T,R,P,F,B)}emplace(o,l,u,p,g,v,w,D,T,R,P,F,B,z){const $=20*o,Q=10*o;return this.int16[$+0]=l,this.int16[$+1]=u,this.int16[$+2]=p,this.int16[$+3]=g,this.int16[$+4]=v,this.float32[Q+3]=w,this.float32[Q+4]=D,this.float32[Q+5]=T,this.float32[Q+6]=R,this.int16[$+14]=P,this.uint32[Q+8]=F,this.uint16[$+18]=B,this.uint16[$+19]=z,o}}Ht.prototype.bytesPerElement=40,Et(Ht,"StructArrayLayout5i4f1i1ul2ui40");class Mt extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,p,g,v,w){const D=this.length;return this.resize(D+1),this.emplace(D,o,l,u,p,g,v,w)}emplace(o,l,u,p,g,v,w,D){const T=8*o;return this.int16[T+0]=l,this.int16[T+1]=u,this.int16[T+2]=p,this.int16[T+4]=g,this.int16[T+5]=v,this.int16[T+6]=w,this.int16[T+7]=D,o}}Mt.prototype.bytesPerElement=16,Et(Mt,"StructArrayLayout3i2i2i16");class Lt extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,p,g)}emplace(o,l,u,p,g,v){const w=4*o,D=8*o;return this.float32[w+0]=l,this.float32[w+1]=u,this.float32[w+2]=p,this.int16[D+6]=g,this.int16[D+7]=v,o}}Lt.prototype.bytesPerElement=16,Et(Lt,"StructArrayLayout2f1f2i16");class Jt extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,o,l,u,p)}emplace(o,l,u,p,g){const v=12*o,w=3*o;return this.uint8[v+0]=l,this.uint8[v+1]=u,this.float32[w+1]=p,this.float32[w+2]=g,o}}Jt.prototype.bytesPerElement=12,Et(Jt,"StructArrayLayout2ub2f12");class wn extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,u)}emplace(o,l,u,p){const g=3*o;return this.float32[g+0]=l,this.float32[g+1]=u,this.float32[g+2]=p,o}}wn.prototype.bytesPerElement=12,Et(wn,"StructArrayLayout3f12");class Ot extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,l,u)}emplace(o,l,u,p){const g=3*o;return this.uint16[g+0]=l,this.uint16[g+1]=u,this.uint16[g+2]=p,o}}Ot.prototype.bytesPerElement=6,Et(Ot,"StructArrayLayout3ui6");class Wn extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,p,g,v,w,D,T,R,P,F,B,z,$,Q,ae,ve,le,ge,xe){const be=this.length;return this.resize(be+1),this.emplace(be,o,l,u,p,g,v,w,D,T,R,P,F,B,z,$,Q,ae,ve,le,ge,xe)}emplace(o,l,u,p,g,v,w,D,T,R,P,F,B,z,$,Q,ae,ve,le,ge,xe,be){const ze=30*o,Le=15*o,Ze=60*o;return this.int16[ze+0]=l,this.int16[ze+1]=u,this.int16[ze+2]=p,this.float32[Le+2]=g,this.float32[Le+3]=v,this.uint16[ze+8]=w,this.uint16[ze+9]=D,this.uint32[Le+5]=T,this.uint32[Le+6]=R,this.uint32[Le+7]=P,this.uint16[ze+16]=F,this.uint16[ze+17]=B,this.uint16[ze+18]=z,this.float32[Le+10]=$,this.float32[Le+11]=Q,this.uint8[Ze+48]=ae,this.uint8[Ze+49]=ve,this.uint8[Ze+50]=le,this.uint32[Le+13]=ge,this.int16[ze+28]=xe,this.uint8[Ze+58]=be,o}}Wn.prototype.bytesPerElement=60,Et(Wn,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ni extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,p,g,v,w,D,T,R,P,F,B,z,$,Q,ae,ve,le,ge,xe,be,ze,Le,Ze,lt,$e,Qe,Je,it){const st=this.length;return this.resize(st+1),this.emplace(st,o,l,u,p,g,v,w,D,T,R,P,F,B,z,$,Q,ae,ve,le,ge,xe,be,ze,Le,Ze,lt,$e,Qe,Je,it)}emplace(o,l,u,p,g,v,w,D,T,R,P,F,B,z,$,Q,ae,ve,le,ge,xe,be,ze,Le,Ze,lt,$e,Qe,Je,it,st){const qe=38*o,vt=19*o;return this.int16[qe+0]=l,this.int16[qe+1]=u,this.int16[qe+2]=p,this.float32[vt+2]=g,this.float32[vt+3]=v,this.int16[qe+8]=w,this.int16[qe+9]=D,this.int16[qe+10]=T,this.int16[qe+11]=R,this.int16[qe+12]=P,this.int16[qe+13]=F,this.uint16[qe+14]=B,this.uint16[qe+15]=z,this.uint16[qe+16]=$,this.uint16[qe+17]=Q,this.uint16[qe+18]=ae,this.uint16[qe+19]=ve,this.uint16[qe+20]=le,this.uint16[qe+21]=ge,this.uint16[qe+22]=xe,this.uint16[qe+23]=be,this.uint16[qe+24]=ze,this.uint16[qe+25]=Le,this.uint16[qe+26]=Ze,this.uint16[qe+27]=lt,this.uint16[qe+28]=$e,this.uint32[vt+15]=Qe,this.float32[vt+16]=Je,this.float32[vt+17]=it,this.float32[vt+18]=st,o}}ni.prototype.bytesPerElement=76,Et(ni,"StructArrayLayout3i2f6i15ui1ul3f76");class Yn extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}Yn.prototype.bytesPerElement=4,Et(Yn,"StructArrayLayout1f4");class Xn extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,p,g)}emplace(o,l,u,p,g,v){const w=5*o;return this.float32[w+0]=l,this.float32[w+1]=u,this.float32[w+2]=p,this.float32[w+3]=g,this.float32[w+4]=v,o}}Xn.prototype.bytesPerElement=20,Et(Xn,"StructArrayLayout5f20");class kr extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,o,l,u,p)}emplace(o,l,u,p,g){const v=6*o;return this.uint32[3*o+0]=l,this.uint16[v+2]=u,this.uint16[v+3]=p,this.uint16[v+4]=g,o}}kr.prototype.bytesPerElement=12,Et(kr,"StructArrayLayout1ul3ui12");class nr extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const p=2*o;return this.uint16[p+0]=l,this.uint16[p+1]=u,o}}nr.prototype.bytesPerElement=4,Et(nr,"StructArrayLayout2ui4");class os extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}os.prototype.bytesPerElement=2,Et(os,"StructArrayLayout1ui2");class Ts extends ce{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const p=2*o;return this.float32[p+0]=l,this.float32[p+1]=u,o}}Ts.prototype.bytesPerElement=8,Et(Ts,"StructArrayLayout2f8");class fi extends Ee{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}fi.prototype.size=40;class Qn extends Ht{get(o){return new fi(this,o)}}Et(Qn,"CollisionBoxArray");class Vn extends Ee{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}Vn.prototype.size=60;class zi extends Wn{get(o){return new Vn(this,o)}}Et(zi,"PlacedSymbolArray");class Wr extends Ee{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Wr.prototype.size=76;class ai extends ni{get(o){return new Wr(this,o)}}Et(ai,"SymbolInstanceArray");class Co extends Yn{getoffsetX(o){return this.float32[1*o+0]}}Et(Co,"GlyphOffsetArray");class yh extends Ie{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}Et(yh,"SymbolLineVertexArray");class Yi extends Ee{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Yi.prototype.size=12;class Ss extends kr{get(o){return new Yi(this,o)}}Et(Ss,"FeatureIndexArray");class Jn extends nr{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}Et(Jn,"FillExtrusionCentroidArray");const ka=De([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),pc=De([{name:"a_dash",components:4,type:"Uint16"}]);var nu={exports:{}},Kp=function(a,o){var l,u,p,g,v,w,D,T;for(u=a.length-(l=3&a.length),p=o,v=3432918353,w=461845907,T=0;T<u;)D=255&a.charCodeAt(T)|(255&a.charCodeAt(++T))<<8|(255&a.charCodeAt(++T))<<16|(255&a.charCodeAt(++T))<<24,++T,p=27492+(65535&(g=5*(65535&(p=(p^=D=(65535&(D=(D=(65535&D)*v+(((D>>>16)*v&65535)<<16)&4294967295)<<15|D>>>17))*w+(((D>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(D=0,l){case 3:D^=(255&a.charCodeAt(T+2))<<16;case 2:D^=(255&a.charCodeAt(T+1))<<8;case 1:p^=D=(65535&(D=(D=(65535&(D^=255&a.charCodeAt(T)))*v+(((D>>>16)*v&65535)<<16)&4294967295)<<15|D>>>17))*w+(((D>>>16)*w&65535)<<16)&4294967295}return p^=a.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0},cd=function(a,o){for(var l,u=a.length,p=o^u,g=0;u>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(g)|(255&a.charCodeAt(++g))<<8|(255&a.charCodeAt(++g))<<16|(255&a.charCodeAt(++g))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),u-=4,++g;switch(u){case 3:p^=(255&a.charCodeAt(g+2))<<16;case 2:p^=(255&a.charCodeAt(g+1))<<8;case 1:p=1540483477*(65535&(p^=255&a.charCodeAt(g)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};nu.exports=Kp,nu.exports.murmur3=Kp,nu.exports.murmur2=cd;var ky=ms(nu.exports);class ru{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,l,u,p){this.ids.push(Qp(o)),this.positions.push(l,u,p)}getPositions(o){const l=Qp(o);let u=0,p=this.ids.length-1;for(;u<p;){const v=u+p>>1;this.ids[v]>=l?p=v:u=v+1}const g=[];for(;this.ids[u]===l;)g.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return g}static serialize(o,l){const u=new Float64Array(o.ids),p=new Uint32Array(o.positions);return bh(u,p,0,u.length-1),l&&l.push(u.buffer,p.buffer),{ids:u,positions:p}}static deserialize(o){const l=new ru;return l.ids=o.ids,l.positions=o.positions,l.indexed=!0,l}}function Qp(a){const o=+a;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:ky(String(a))}function bh(a,o,l,u){for(;l<u;){const p=a[l+u>>1];let g=l-1,v=u+1;for(;;){do{g++}while(a[g]<p);do{v--}while(a[v]>p);if(g>=v)break;xh(a,g,v),xh(o,3*g,3*v),xh(o,3*g+1,3*v+1),xh(o,3*g+2,3*v+2)}v-l<u-v?(bh(a,o,l,v),l=v+1):(bh(a,o,v+1,u),u=v)}}function xh(a,o,l){const u=a[o];a[o]=a[l],a[l]=u}Et(ru,"FeaturePositionMap");class yl{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}}class Jp extends yl{constructor(o){super(o),this.current=0}set(o,l,u){this.fetchUniformLocation(o,l)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class cb extends yl{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,u){this.fetchUniformLocation(o,l)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class ou extends yl{constructor(o){super(o),this.current=ki.transparent}set(o,l,u){this.fetchUniformLocation(o,l)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const ef=new Float32Array(16),cC=new Float32Array(9),lM=new Float32Array(4);function tf(a){return[Ce(255*a.r,255*a.g),Ce(255*a.b,255*a.a)]}class s_{constructor(o,l,u){this.value=o,this.uniformNames=l.map(p=>`u_${p}`),this.type=u}setUniform(o,l,u,p,g){l.set(o,g,p.constantOr(this.value))}getBinding(o,l){return"color"===this.type?new ou(o):new Jp(o)}}class wh{constructor(o,l){this.uniformNames=l.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,l,u,p,g){const v="u_pattern"===g||"u_dash"===g?this.pattern:"u_pixel_ratio"===g?this.pixelRatio:null;v&&l.set(o,g,v)}getBinding(o,l){return"u_pattern"===l||"u_dash"===l?new cb(o):new Jp(o)}}class fc{constructor(o,l,u,p){this.expression=o,this.type=u,this.maxValue=0,this.paintVertexAttributes=l.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(o,l,u,p,g,v){const w=this.paintVertexArray.length,D=this.expression.evaluate(new k(0),l,{},g,p,v);this.paintVertexArray.resize(o),this._setPaintValue(w,o,D)}updatePaintArray(o,l,u,p,g){const v=this.expression.evaluate({zoom:0},u,p,void 0,g);this._setPaintValue(o,l,v)}_setPaintValue(o,l,u){if("color"===this.type){const p=tf(u);for(let g=o;g<l;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=o;p<l;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class vl{constructor(o,l,u,p,g,v){this.expression=o,this.uniformNames=l.map(w=>`u_${w}_t`),this.type=u,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(o,l,u,p,g,v){const w=this.expression.evaluate(new k(this.zoom),l,{},g,p,v),D=this.expression.evaluate(new k(this.zoom+1),l,{},g,p,v),T=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(T,o,w,D)}updatePaintArray(o,l,u,p,g){const v=this.expression.evaluate({zoom:this.zoom},u,p,void 0,g),w=this.expression.evaluate({zoom:this.zoom+1},u,p,void 0,g);this._setPaintValue(o,l,v,w)}_setPaintValue(o,l,u,p){if("color"===this.type){const g=tf(u),v=tf(p);for(let w=o;w<l;w++)this.paintVertexArray.emplace(w,g[0],g[1],v[0],v[1])}else{for(let g=o;g<l;g++)this.paintVertexArray.emplace(g,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,u,p,g){const v=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,w=hn(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);l.set(o,g,w)}getBinding(o,l){return new Jp(o)}}class su{constructor(o,l,u,p,g){this.expression=o,this.layerId=g,this.paintVertexAttributes=("array"===u?pc:ka).members;for(let v=0;v<l.length;++v);this.paintVertexArray=new p}populatePaintArray(o,l,u){const p=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(p,o,l.patterns&&l.patterns[this.layerId],u)}updatePaintArray(o,l,u,p,g,v){this._setPaintValues(o,l,u.patterns&&u.patterns[this.layerId],v)}_setPaintValues(o,l,u,p){if(!p||!u)return;const g=p[u];if(!g)return;const{tl:v,br:w,pixelRatio:D}=g;for(let T=o;T<l;T++)this.paintVertexArray.emplace(T,v[0],v[1],w[0],w[1],D)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bl{constructor(o,l,u=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const g in o.paint._values){if(!u(g))continue;const v=o.paint.get(g);if(!(v instanceof ie&&co(v.property.specification)))continue;const w=nf(g,o.type),D=v.value,T=v.property.specification.type,R=!!v.property.useIntegerZoom,P="line-dasharray"===g||g.endsWith("pattern"),F="line-dasharray"===g&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==D.kind||F)if("source"===D.kind||F||P){const B=uC(g,T,"source");this.binders[g]=P?new su(D,w,T,B,o.id):new fc(D,w,T,B),p.push(`/a_${g}`)}else{const B=uC(g,T,"composite");this.binders[g]=new vl(D,w,T,R,l,B),p.push(`/z_${g}`)}else this.binders[g]=P?new wh(D.value,w):new s_(D.value,w,T),p.push(`/u_${g}`)}this.cacheKey=p.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof fc||l instanceof vl?l.maxValue:0}populatePaintArrays(o,l,u,p,g,v){for(const w in this.binders){const D=this.binders[w];(D instanceof fc||D instanceof vl||D instanceof su)&&D.populatePaintArray(o,l,u,p,g,v)}}setConstantPatternPositions(o){for(const l in this.binders){const u=this.binders[l];u instanceof wh&&u.setConstantPatternPositions(o)}}updatePaintArrays(o,l,u,p,g,v){let w=!1;for(const D in o){const T=l.getPositions(D);for(const R of T){const P=u.feature(R.index);for(const F in this.binders){const B=this.binders[F];if((B instanceof fc||B instanceof vl||B instanceof su)&&!0===B.expression.isStateDependent){const z=p.paint.get(F);B.expression=z.value,B.updatePaintArray(R.start,R.end,P,o[D],g,v),w=!0}}}}return w}defines(){const o=[];for(const l in this.binders){const u=this.binders[l];(u instanceof s_||u instanceof wh)&&o.push(...u.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof fc||u instanceof vl||u instanceof su)for(let p=0;p<u.paintVertexAttributes.length;p++)o.push(u.paintVertexAttributes[p].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof s_||u instanceof wh||u instanceof vl)for(const p of u.uniformNames)o.push(p)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof s_||p instanceof wh||p instanceof vl)for(const g of p.uniformNames)l.push({name:g,property:u,binding:p.getBinding(o,g)})}return l}setUniforms(o,l,u,p,g){for(const{name:v,property:w,binding:D}of u)this.binders[w].setUniform(o,D,g,p.get(w),v)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const l=this.binders[o];(l instanceof fc||l instanceof vl||l instanceof su)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(o){for(const l in this.binders){const u=this.binders[l];(u instanceof fc||u instanceof vl||u instanceof su)&&u.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof fc||l instanceof vl||l instanceof su)&&l.destroy()}}}class Pa{constructor(o,l,u=(()=>!0)){this.programConfigurations={};for(const p of o)this.programConfigurations[p.id]=new bl(p,l,u);this.needsUpload=!1,this._featureMap=new ru,this._bufferOffset=0}populatePaintArrays(o,l,u,p,g,v,w){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(o,l,p,g,v,w);void 0!==l.id&&this._featureMap.add(l.id,u,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,u,p,g){for(const v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(o,this._featureMap,l,v,p,g)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const dC={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function nf(a,o){return dC[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}const Py={"line-pattern":{source:Be,composite:Be},"fill-pattern":{source:Be,composite:Be},"fill-extrusion-pattern":{source:Be,composite:Be},"line-dasharray":{source:Ye,composite:Ye}},a_={color:{source:Ts,composite:et},number:{source:Yn,composite:Ts}};function uC(a,o,l){const u=Py[a];return u&&u[l]||a_[o][l]}Et(s_,"ConstantBinder"),Et(wh,"PatternConstantBinder"),Et(fc,"SourceExpressionBinder"),Et(su,"PatternCompositeBinder"),Et(vl,"CompositeExpressionBinder"),Et(bl,"ProgramConfiguration",{omit:["_buffers"]}),Et(Pa,"ProgramConfigurationSet");const Oy="-transition";class ia extends Gu{constructor(o,l){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),l.layout&&(this._unevaluatedLayout=new re(l.layout)),l.paint)){this._transitionablePaint=new V(l.paint);for(const u in o.paint)this.setPaintProperty(u,o.paint[u],{validate:!1});for(const u in o.layout)this.setLayoutProperty(u,o.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new se(l.paint)}}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l,u={}){null!=l&&this._validate(Sy,`layers.${this.id}.layout.${o}`,o,l,u)||("visibility"!==o?this._unevaluatedLayout.setValue(o,l):this.visibility=l)}getPaintProperty(o){return Xl(o,Oy)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l,u={}){if(null!=l&&this._validate(fh,`layers.${this.id}.paint.${o}`,o,l,u))return!1;if(Xl(o,Oy))return this._transitionablePaint.setTransition(o.slice(0,-11),l||void 0),!1;{const p=this._transitionablePaint._values[o],g=p.value.isDataDriven(),v=p.value;this._transitionablePaint.setValue(o,l),this._handleSpecialPaintPropertyUpdate(o);const w=this._transitionablePaint._values[o].value,D=w.isDataDriven(),T=Xl(o,"pattern")||"line-dasharray"===o;return D||g||T||this._handleOverridablePaintPropertyUpdate(o,v,w)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,l,u){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Wc(o,(l,u)=>!(void 0===l||"layout"===u&&!Object.keys(l).length||"paint"===u&&!Object.keys(l).length))}_validate(o,l,u,p,g={}){return(!g||!1!==g.validate)&&My(this,o.call(r_,{key:l,layerType:this.type,objectKey:u,value:p,styleSpec:We,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof ie&&co(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Up(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const hC=De([{name:"a_pos",components:2,type:"Int16"}],4),xl=De([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Xi{constructor(o=[]){this.segments=o}prepareSegment(o,l,u,p){let g=this.segments[this.segments.length-1];return o>Xi.MAX_VERTEX_ARRAY_LENGTH&&Ei(`Max vertices per segment is ${Xi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!g||g.vertexLength+o>Xi.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:l.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==p&&(g.sortKey=p),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,u,p){return new Xi([{vertexOffset:o,primitiveOffset:l,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])}}Xi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Et(Xi,"SegmentVector");var Bt=8192;class wl{constructor(o,l){o&&(l?this.setSouthWest(o).setNorthEast(l):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof Zn?new Zn(o.lng,o.lat):Zn.convert(o),this}setSouthWest(o){return this._sw=o instanceof Zn?new Zn(o.lng,o.lat):Zn.convert(o),this}extend(o){const l=this._sw,u=this._ne;let p,g;if(o instanceof Zn)p=o,g=o;else{if(!(o instanceof wl))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(wl.convert(o)):this.extend(Zn.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(Zn.convert(o)):this;if(p=o._sw,g=o._ne,!p||!g)return this}return l||u?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new Zn(p.lng,p.lat),this._ne=new Zn(g.lng,g.lat)),this}getCenter(){return new Zn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Zn(this.getWest(),this.getNorth())}getSouthEast(){return new Zn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:u}=Zn.convert(o);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}static convert(o){return!o||o instanceof wl?o:new wl(o)}}var rf=1e-6,uo=typeof Float32Array<"u"?Float32Array:Array;function l_(){var a=new uo(9);return uo!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function db(a,o,l){var u=o[0],p=o[1],g=o[2],v=o[3],w=o[4],D=o[5],T=o[6],R=o[7],P=o[8],F=l[0],B=l[1],z=l[2],$=l[3],Q=l[4],ae=l[5],ve=l[6],le=l[7],ge=l[8];return a[0]=F*u+B*v+z*T,a[1]=F*p+B*w+z*R,a[2]=F*g+B*D+z*P,a[3]=$*u+Q*v+ae*T,a[4]=$*p+Q*w+ae*R,a[5]=$*g+Q*D+ae*P,a[6]=ve*u+le*v+ge*T,a[7]=ve*p+le*w+ge*R,a[8]=ve*g+le*D+ge*P,a}function ra(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function c_(a,o){var l=o[0],u=o[1],p=o[2],g=o[3],v=o[4],w=o[5],D=o[6],T=o[7],R=o[8],P=o[9],F=o[10],B=o[11],z=o[12],$=o[13],Q=o[14],ae=o[15],ve=l*w-u*v,le=l*D-p*v,ge=l*T-g*v,xe=u*D-p*w,be=u*T-g*w,ze=p*T-g*D,Le=R*$-P*z,Ze=R*Q-F*z,lt=R*ae-B*z,$e=P*Q-F*$,Qe=P*ae-B*$,Je=F*ae-B*Q,it=ve*Je-le*Qe+ge*$e+xe*lt-be*Ze+ze*Le;return it?(a[0]=(w*Je-D*Qe+T*$e)*(it=1/it),a[1]=(p*Qe-u*Je-g*$e)*it,a[2]=($*ze-Q*be+ae*xe)*it,a[3]=(F*be-P*ze-B*xe)*it,a[4]=(D*lt-v*Je-T*Ze)*it,a[5]=(l*Je-p*lt+g*Ze)*it,a[6]=(Q*ge-z*ze-ae*le)*it,a[7]=(R*ze-F*ge+B*le)*it,a[8]=(v*Qe-w*lt+T*Le)*it,a[9]=(u*lt-l*Qe-g*Le)*it,a[10]=(z*be-$*ge+ae*ve)*it,a[11]=(P*ge-R*be-B*ve)*it,a[12]=(w*Ze-v*$e-D*Le)*it,a[13]=(l*$e-u*Ze+p*Le)*it,a[14]=($*le-z*xe-Q*ve)*it,a[15]=(R*xe-P*le+F*ve)*it,a):null}function dd(a,o,l){var u=o[0],p=o[1],g=o[2],v=o[3],w=o[4],D=o[5],T=o[6],R=o[7],P=o[8],F=o[9],B=o[10],z=o[11],$=o[12],Q=o[13],ae=o[14],ve=o[15],le=l[0],ge=l[1],xe=l[2],be=l[3];return a[0]=le*u+ge*w+xe*P+be*$,a[1]=le*p+ge*D+xe*F+be*Q,a[2]=le*g+ge*T+xe*B+be*ae,a[3]=le*v+ge*R+xe*z+be*ve,a[4]=(le=l[4])*u+(ge=l[5])*w+(xe=l[6])*P+(be=l[7])*$,a[5]=le*p+ge*D+xe*F+be*Q,a[6]=le*g+ge*T+xe*B+be*ae,a[7]=le*v+ge*R+xe*z+be*ve,a[8]=(le=l[8])*u+(ge=l[9])*w+(xe=l[10])*P+(be=l[11])*$,a[9]=le*p+ge*D+xe*F+be*Q,a[10]=le*g+ge*T+xe*B+be*ae,a[11]=le*v+ge*R+xe*z+be*ve,a[12]=(le=l[12])*u+(ge=l[13])*w+(xe=l[14])*P+(be=l[15])*$,a[13]=le*p+ge*D+xe*F+be*Q,a[14]=le*g+ge*T+xe*B+be*ae,a[15]=le*v+ge*R+xe*z+be*ve,a}function Ch(a,o,l){var u,p,g,v,w,D,T,R,P,F,B,z,$=l[0],Q=l[1],ae=l[2];return o===a?(a[12]=o[0]*$+o[4]*Q+o[8]*ae+o[12],a[13]=o[1]*$+o[5]*Q+o[9]*ae+o[13],a[14]=o[2]*$+o[6]*Q+o[10]*ae+o[14],a[15]=o[3]*$+o[7]*Q+o[11]*ae+o[15]):(p=o[1],g=o[2],v=o[3],w=o[4],D=o[5],T=o[6],R=o[7],P=o[8],F=o[9],B=o[10],z=o[11],a[0]=u=o[0],a[1]=p,a[2]=g,a[3]=v,a[4]=w,a[5]=D,a[6]=T,a[7]=R,a[8]=P,a[9]=F,a[10]=B,a[11]=z,a[12]=u*$+w*Q+P*ae+o[12],a[13]=p*$+D*Q+F*ae+o[13],a[14]=g*$+T*Q+B*ae+o[14],a[15]=v*$+R*Q+z*ae+o[15]),a}function au(a,o,l){var u=l[0],p=l[1],g=l[2];return a[0]=o[0]*u,a[1]=o[1]*u,a[2]=o[2]*u,a[3]=o[3]*u,a[4]=o[4]*p,a[5]=o[5]*p,a[6]=o[6]*p,a[7]=o[7]*p,a[8]=o[8]*g,a[9]=o[9]*g,a[10]=o[10]*g,a[11]=o[11]*g,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a}function Dh(a,o,l){var u=Math.sin(l),p=Math.cos(l),g=o[4],v=o[5],w=o[6],D=o[7],T=o[8],R=o[9],P=o[10],F=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=g*p+T*u,a[5]=v*p+R*u,a[6]=w*p+P*u,a[7]=D*p+F*u,a[8]=T*p-g*u,a[9]=R*p-v*u,a[10]=P*p-w*u,a[11]=F*p-D*u,a}function Cl(a,o,l){var u=Math.sin(l),p=Math.cos(l),g=o[0],v=o[1],w=o[2],D=o[3],T=o[8],R=o[9],P=o[10],F=o[11];return o!==a&&(a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=g*p-T*u,a[1]=v*p-R*u,a[2]=w*p-P*u,a[3]=D*p-F*u,a[8]=g*u+T*p,a[9]=v*u+R*p,a[10]=w*u+P*p,a[11]=D*u+F*p,a}function ub(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Fy(a,o,l){var u,p,g,v=l[0],w=l[1],D=l[2],T=Math.hypot(v,w,D);return T<rf?null:(v*=T=1/T,w*=T,D*=T,u=Math.sin(o),p=Math.cos(o),a[0]=v*v*(g=1-p)+p,a[1]=w*v*g+D*u,a[2]=D*v*g-w*u,a[3]=0,a[4]=v*w*g-D*u,a[5]=w*w*g+p,a[6]=D*w*g+v*u,a[7]=0,a[8]=v*D*g+w*u,a[9]=w*D*g-v*u,a[10]=D*D*g+p,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var hb=dd;function lu(){var a=new uo(3);return uo!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function pb(a){var o=new uo(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o}function Pr(a){return Math.hypot(a[0],a[1],a[2])}function Eh(a,o,l){var u=new uo(3);return u[0]=a,u[1]=o,u[2]=l,u}function mi(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a}function sf(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a}function fb(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a[2]=o[2]*l[2],a}function Th(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a[2]=Math.min(o[2],l[2]),a}function oa(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a[2]=Math.max(o[2],l[2]),a}function Zr(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a}function Dl(a,o,l,u){return a[0]=o[0]+l[0]*u,a[1]=o[1]+l[1]*u,a[2]=o[2]+l[2]*u,a}function hr(a,o){var l=o[0],u=o[1],p=o[2],g=l*l+u*u+p*p;return g>0&&(g=1/Math.sqrt(g)),a[0]=o[0]*g,a[1]=o[1]*g,a[2]=o[2]*g,a}function Ms(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]}function af(a,o,l){var u=o[0],p=o[1],g=o[2],v=l[0],w=l[1],D=l[2];return a[0]=p*D-g*w,a[1]=g*v-u*D,a[2]=u*w-p*v,a}function yi(a,o,l){var u=o[0],p=o[1],g=o[2],v=l[3]*u+l[7]*p+l[11]*g+l[15];return a[0]=(l[0]*u+l[4]*p+l[8]*g+l[12])/(v=v||1),a[1]=(l[1]*u+l[5]*p+l[9]*g+l[13])/v,a[2]=(l[2]*u+l[6]*p+l[10]*g+l[14])/v,a}function pC(a,o,l){var u=l[0],p=l[1],g=l[2],v=o[0],w=o[1],D=o[2],T=p*D-g*w,R=g*v-u*D,P=u*w-p*v,F=p*P-g*R,B=g*T-u*P,z=u*R-p*T,$=2*l[3];return R*=$,P*=$,B*=2,z*=2,a[0]=v+(T*=$)+(F*=2),a[1]=w+R+B,a[2]=D+P+z,a}var lf,El=sf,cM=fb,dM=Pr;function fC(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a}function mC(a,o){var l=o[0],u=o[1],p=o[2],g=o[3],v=l*l+u*u+p*p+g*g;return v>0&&(v=1/Math.sqrt(v)),a[0]=l*v,a[1]=u*v,a[2]=p*v,a[3]=g*v,a}function Sh(a,o,l){var u=o[0],p=o[1],g=o[2],v=o[3];return a[0]=l[0]*u+l[4]*p+l[8]*g+l[12]*v,a[1]=l[1]*u+l[5]*p+l[9]*g+l[13]*v,a[2]=l[2]*u+l[6]*p+l[10]*g+l[14]*v,a[3]=l[3]*u+l[7]*p+l[11]*g+l[15]*v,a}function cu(){var a=new uo(4);return uo!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function mb(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function _b(a,o,l){l*=.5;var u=o[0],p=o[1],g=o[2],v=o[3],w=Math.sin(l),D=Math.cos(l);return a[0]=u*D+v*w,a[1]=p*D+g*w,a[2]=g*D-p*w,a[3]=v*D-u*w,a}function Cr(a,o,l){l*=.5;var u=o[0],p=o[1],g=o[2],v=o[3],w=Math.sin(l),D=Math.cos(l);return a[0]=u*D-g*w,a[1]=p*D+v*w,a[2]=g*D+u*w,a[3]=v*D-p*w,a}lu(),lf=new uo(4),uo!=Float32Array&&(lf[0]=0,lf[1]=0,lf[2]=0,lf[3]=0);var _C=mC;lu(),Eh(1,0,0),Eh(0,1,0),cu(),cu(),l_();const cf=De([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:gb}=cf,As=De([{name:"a_pos_3",components:3,type:"Int16"}]);var Tl=De([{name:"a_pos",type:"Int16",components:2}]);class d_{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,u){const p=Ms(l,this.dir);if(Math.abs(p)<1e-6)return!1;const g=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/p;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,u[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(o,l,u){if($=(B=this.pos)[0],Q=B[1],ae=B[2],ve=(z=o)[0],le=z[1],ge=z[2],Math.abs($-ve)<=rf*Math.max(1,Math.abs($),Math.abs(ve))&&Math.abs(Q-le)<=rf*Math.max(1,Math.abs(Q),Math.abs(le))&&Math.abs(ae-ge)<=rf*Math.max(1,Math.abs(ae),Math.abs(ge))||0===l)return u[0]=u[1]=u[2]=0,!1;var B,z,$,Q,ae,ve,le,ge;const[p,g,v]=this.dir,w=this.pos[0]-o[0],D=this.pos[1]-o[1],T=this.pos[2]-o[2],R=p*p+g*g+v*v,P=2*(w*p+D*g+T*v),F=P*P-4*R*(w*w+D*D+T*T-l*l);if(F<0){const B=Math.max(-P/2,0),z=w+p*B,$=D+g*B,Q=T+v*B,ae=Math.hypot(z,$,Q);return u[0]=z*l/ae,u[1]=$*l/ae,u[2]=Q*l/ae,!1}{const B=(-P-Math.sqrt(F))/(2*R);if(B<0){const z=Math.hypot(w,D,T);return u[0]=w*l/z,u[1]=D*l/z,u[2]=T*l/z,!1}return u[0]=w+p*B,u[1]=D+g*B,u[2]=T+v*B,!0}}}class Mh{constructor(o,l,u,p,g){this.TL=o,this.TR=l,this.BR=u,this.BL=p,this.horizon=g}static fromInvProjectionMatrix(o,l,u){const p=[-1,1,1],g=[1,1,1],v=[1,-1,1],w=[-1,-1,1],D=yi(p,p,o),T=yi(g,g,o),R=yi(v,v,o),P=yi(w,w,o);return new Mh(D,T,R,P,l/u)}}class du{constructor(o,l){this.points=o,this.planes=l}static fromInvProjectionMatrix(o,l,u,p){const g=Math.pow(2,u),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const T=Sh([],D,o),R=1/T[3]/l*g;return(P=T)[0]=(F=T)[0]*(B=[R,R,p?1/T[3]:R,R])[0],P[1]=F[1]*B[1],P[2]=F[2]*B[2],P[3]=F[3]*B[3],P;var P,F,B}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const T=hr([],af([],El([],v[D[0]],v[D[1]]),El([],v[D[2]],v[D[1]]))),R=-Ms(T,v[D[1]]);return T.concat(R)});return new du(v,w)}}class Do{static fromPoints(o){const l=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const p of o)Th(l,l,p),oa(u,u,p);return new Do(l,u)}static applyTransform(o,l){const u=o.getCorners();for(let p=0;p<u.length;++p)yi(u[p],u[p],l);return Do.fromPoints(u)}constructor(o,l){this.min=o,this.max=l,this.center=Zr([],mi([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],u=pb(this.min),p=pb(this.max);for(let g=0;g<l.length;g++)u[g]=l[g]?this.min[g]:this.center[g],p[g]=l[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new Do(u,p)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){const l=this.getCorners();let u=!0;for(let p=0;p<o.planes.length;p++){const g=o.planes[p];let v=0;for(let w=0;w<l.length;w++)v+=Ms(g,l[w])+g[3]>=0;if(0===v)return 0;v!==l.length&&(u=!1)}if(u)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<o.points.length;w++){const D=o.points[w][p]-this.min[p];g=Math.min(g,D),v=Math.max(v,D)}if(v<0||g>this.max[p]-this.min[p])return 0}return 1}}const yb=5,vb=6,mc=Bt/Math.PI/2,Is=16383,Sl=[64,32,16],Oa=-mc,Rs=mc,gC=[new Do([Oa,Oa,Oa],[Rs,Rs,Rs]),new Do([Oa,Oa,Oa],[0,0,Rs]),new Do([0,Oa,Oa],[Rs,0,Rs]),new Do([Oa,0,Oa],[0,Rs,Rs]),new Do([0,0,Oa],[Rs,Rs,Rs])];function u_(a){return a*mc/hf}function bb(a,o,l,u=!0){const p=Zr([],a._camera.position,a.worldSize),g=[o,l,1,1];Sh(g,g,a.pixelMatrixInverse),fC(g,g,1/g[3]);const v=hr([],El([],g,p)),w=a.globeMatrix,D=[w[12],w[13],w[14]],T=El([],D,p),R=Pr(T),P=hr([],T),F=a.worldSize/(2*Math.PI),B=Ms(P,v),z=Math.asin(F/R);if(z<Math.acos(B)){if(!u)return null;const lt=[],$e=[];Zr(lt,v,R/B),hr($e,El($e,lt,T)),hr(v,mi(v,T,Zr(v,$e,Math.tan(z)*R)))}const $=[];new d_(p,v).closestPointOnSphere(D,F,$);const Q=hr([],Ql(w,0)),ae=hr([],Ql(w,1)),ve=hr([],Ql(w,2)),le=Ms(Q,$),ge=Ms(ae,$),xe=Ms(ve,$),be=yr(Math.asin(-ge/F));let ze=yr(Math.atan2(le,xe));ze=a.center.lng+function(lt,$e){const Qe=($e-lt+180)%360-180;return Qe<-180?Qe+360:Qe}(a.center.lng,ze);const Le=kl(ze),Ze=hn(Fa(be),0,1);return new pf(Le,Ze)}class yC{constructor(o,l,u){this.a=El([],o,u),this.b=El([],l,u),this.center=u;const p=hr([],this.a),g=hr([],this.b);this.angle=Math.acos(Ms(p,g))}}function Ny(a,o){if(0===a.angle)return null;let l;return l=0===a.a[o]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[o]/a.a[o]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(u,p,g,v){const w=Math.sin(g);return u*(Math.sin((1-v)*g)/w)+p*(Math.sin(v*g)/w)}(a.a[o],a.b[o],a.angle,hn(l,0,1))+a.center[o]}function Ml(a){if(a.z<=1)return gC[a.z+2*a.y+a.x];const o=Il(h_(a));return Do.fromPoints(o)}function gc(a,o,l){return Zr(a,a,1-l),Dl(a,a,o,l)}function df(a,o){const l=Rl(o.zoom);if(0===l)return Ml(a);const u=h_(a),p=Il(u),g=kl(u.getWest())*o.worldSize,v=kl(u.getEast())*o.worldSize,w=Fa(u.getNorth())*o.worldSize,D=Fa(u.getSouth())*o.worldSize,T=[g,w,0],R=[v,w,0],P=[g,D,0],F=[v,D,0],B=c_([],o.globeMatrix);return yi(T,T,B),yi(R,R,B),yi(P,P,B),yi(F,F,B),p[0]=gc(p[0],P,l),p[1]=gc(p[1],F,l),p[2]=gc(p[2],R,l),p[3]=gc(p[3],T,l),Do.fromPoints(p)}function xb(a,o,l){for(const u of a)yi(u,u,o),Zr(u,u,l)}function h_({x:a,y:o,z:l}){const u=1/(1<<l),p=new Zn(ss(a*u),ho((o+1)*u)),g=new Zn(ss((a+1)*u),ho(o*u));return new wl(p,g)}function Il(a){const o=mn(a.getNorth()),l=mn(a.getSouth()),u=Math.cos(o),p=Math.cos(l),g=Math.sin(o),v=Math.sin(l),w=a.getWest(),D=a.getEast();return[Ah(p,v,w),Ah(p,v,D),Ah(u,g,D),Ah(u,g,w)]}function Ah(a,o,l,u=mc){return l=mn(l),[a*Math.sin(l)*u,-o*u,a*Math.cos(l)*u]}function uu(a,o,l){return Ah(Math.cos(mn(a)),Math.sin(mn(a)),o,l)}function hu(a,o,l,u){const p=1<<l.z,g=(a/Bt+l.x)/p;return uu(ho((o/Bt+l.y)/p),ss(g),u)}function pu({min:a,max:o}){return Is/Math.max(o[0]-a[0],o[1]-a[1],o[2]-a[2])}const Ly=new Float64Array(16);function uf(a){const o=pu(a),l=ub(Ly,[o,o,o]);return Ch(l,l,((u=[])[0]=-(p=a.min)[0],u[1]=-p[1],u[2]=-p[2],u));var u,p}function By(a){const o=(u=a.min,(l=Ly)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=u[0],l[13]=u[1],l[14]=u[2],l[15]=1,l);var l,u;const p=1/pu(a);return au(o,o,[p,p,p])}function fu(a,o,l,u,p){const g=function(D){const T=Bt/(2*Math.PI);return D/(2*Math.PI)/T}(l),v=[a,o,-l/(2*Math.PI)],w=ra(new Float64Array(16));return Ch(w,w,v),au(w,w,[g,g,g]),Dh(w,w,mn(-p)),Cl(w,w,mn(-u)),w}function Rl(a){return Xt(yb,vb,a)}function wb(a,o){const l=uu(o.lat,o.lng);return v=(p=sf([],function(z){const $=uu(z._center.lat,z._center.lng);let Q=af([],Eh(0,1,0),$);const ae=Fy([],-z.angle,$);Q=yi(Q,Q,ae),Fy(ae,-z._pitch,Q);const ve=hr([],$);return Zr(ve,ve,u_(z.cameraToCenterDistance/z.pixelsPerMeter)),yi(ve,ve,ae),mi([],$,ve)}(a),l))[0],w=p[1],D=p[2],T=(g=l)[0],R=g[1],P=g[2],B=(F=Math.sqrt(v*v+w*w+D*D)*Math.sqrt(T*T+R*R+P*P))&&Ms(p,g)/F,Math.acos(Math.min(Math.max(B,-1),1));var p,g,v,w,D,T,R,P,F,B}function Cb(a,o){return wb(a,o)>Math.PI/2*1.01}const zy=mn(85),vC=Math.cos(zy),uM=Math.sin(zy),hf=6371008.8,Db=2*Math.PI*hf;class ud{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ud(lr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,u=this.lat*l,p=o.lat*l,g=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((o.lng-this.lng)*l);return hf*Math.acos(Math.min(g,1))}toBounds(o=0){const l=360*o/40075017,u=l/Math.cos(Math.PI/180*this.lat);return new wl(new ud(this.lng-u,this.lat-l),new ud(this.lng+u,this.lat+l))}toEcef(o){const l=u_(o);return uu(this.lat,this.lng,mc+l)}static convert(o){if(o instanceof ud)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new ud(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new ud(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Zn=ud;function p_(a){return Db*Math.cos(a*Math.PI/180)}function kl(a){return(180+a)/360}function Fa(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Pl(a,o){return a/p_(o)}function ss(a){return 360*a-180}function ho(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Eb(a,o){return a*p_(ho(o))}const Yr=85.051129;function f_(a){return 1/Math.cos(a*Math.PI/180)}class pf{constructor(o,l,u=0){this.x=+o,this.y=+l,this.z=+u}static fromLngLat(o,l=0){const u=Zn.convert(o);return new pf(kl(u.lng),Fa(u.lat),Pl(l,u.lat))}toLngLat(){return new Zn(ss(this.x),ho(this.y))}toAltitude(){return Eb(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Db*f_(ho(this.y))}}function Tb(a,o,l,u,p,g,v,w,D){const T=(o+u)/2,R=(l+p)/2,P=new ot(T,R);w(P),function(F,B,z,$,Q,ae){const ve=z-Q,le=$-ae;return Math.abs(($-B)*ve-(z-F)*le)/Math.hypot(ve,le)}(P.x,P.y,g.x,g.y,v.x,v.y)>=D?(Tb(a,o,l,T,R,g,P,w,D),Tb(a,T,R,u,p,P,v,w,D)):a.push(v)}function m_(a,o,l){let u=a[0],p=u.x,g=u.y;o(u);const v=[u];for(let w=1;w<a.length;w++){const D=a[w],{x:T,y:R}=D;o(D),Tb(v,p,g,T,R,u,D,o,l),p=T,g=R,u=D}return v}function Sb(a,o,l,u){if(u(o,l)){const p=o.add(l)._mult(.5);Sb(a,o,p,u),Sb(a,p,l,u)}else a.push(l)}function hM(a,o){let l=a[0];const u=[l];for(let p=1;p<a.length;p++){const g=a[p];Sb(u,l,g,o),l=g}return u}const Mb=Math.pow(2,14)-1,bC=-Mb-1;function pM(a,o){const l=Math.round(a.x*o),u=Math.round(a.y*o);return a.x=hn(l,bC,Mb),a.y=hn(u,bC,Mb),(l<a.x||l>a.x+1||u<a.y||u>a.y+1)&&Ei("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function yc(a,o,l){const u=a.loadGeometry(),p=a.extent,g=Bt/p;if(o&&l&&l.projection.isReprojectedInTileSpace){const v=1<<o.z,{scale:w,x:D,y:T,projection:R}=l,P=F=>{const B=ss((o.x+F.x/p)/v),z=ho((o.y+F.y/p)/v),$=R.project(B,z);F.x=($.x*w-D)*p,F.y=($.y*w-T)*p};for(let F=0;F<u.length;F++)if(1!==a.type)u[F]=m_(u[F],P,1);else{const B=[];for(const z of u[F])z.x<0||z.x>=p||z.y<0||z.y>=p||(P(z),B.push(z));u[F]=B}}for(const v of u)for(const w of v)pM(w,g);return u}function Ol(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?yc(a):[]}}function mu(a,o,l,u,p){a.emplaceBack(2*o+(u+1)/2,2*l+(p+1)/2)}function ff(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class __{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new Ie,this.indexArray=new Ot,this.segments=new Xi,this.programConfigurations=new Pa(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,u,p){const g=this.layers[0],v=[];let w=null;"circle"===g.type&&(w=g.layout.get("circle-sort-key"));for(const{feature:T,id:R,index:P,sourceLayerIndex:F}of o){const B=this.layers[0]._featureFilter.needGeometry,z=Ol(T,B);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),z,u))continue;const $=w?w.evaluate(z,{},u):void 0,Q={id:R,properties:T.properties,type:T.type,sourceLayerIndex:F,index:P,geometry:B?z.geometry:yc(T,u,p),patterns:{},sortKey:$};v.push(Q)}w&&v.sort((T,R)=>T.sortKey-R.sortKey);let D=null;"globe"===p.projection.name&&(this.globeExtVertexArray=new ct,D=p.projection);for(const T of v){const{geometry:R,index:P,sourceLayerIndex:F}=T,B=o[P].feature;this.addFeature(T,R,P,l.availableImages,u,D),l.featureIndex.insert(B,R,P,F,this.index)}}update(o,l,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,hC.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,xl.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,u,p,g,v){for(const w of l)for(const D of w){const T=D.x,R=D.y;if(T<0||T>=Bt||R<0||R>=Bt)continue;if(v){const B=v.projectTilePoint(T,R,g),z=v.upVector(g,T,R),$=this.globeExtVertexArray;ff($,B,z),ff($,B,z),ff($,B,z),ff($,B,z)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),F=P.vertexLength;mu(this.layoutVertexArray,T,R,-1,-1),mu(this.layoutVertexArray,T,R,1,-1),mu(this.layoutVertexArray,T,R,1,1),mu(this.layoutVertexArray,T,R,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,{},p,g)}}function Vy(a,o){for(let l=0;l<a.length;l++)if(_u(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(_u(a,o[l]))return!0;return!!Rh(a,o)}function Ih(a,o,l){return!!_u(a,o)||!!Fl(o,a,l)}function jy(a,o){if(1===a.length)return Rb(o,a[0]);for(let l=0;l<o.length;l++){const u=o[l];for(let p=0;p<u.length;p++)if(_u(a,u[p]))return!0}for(let l=0;l<a.length;l++)if(Rb(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(Rh(a,o[l]))return!0;return!1}function Ab(a,o,l){if(a.length>1){if(Rh(a,o))return!0;for(let u=0;u<o.length;u++)if(Fl(o[u],a,l))return!0}for(let u=0;u<a.length;u++)if(Fl(a[u],o,l))return!0;return!1}function Rh(a,o){if(0===a.length||0===o.length)return!1;for(let l=0;l<a.length-1;l++){const u=a[l],p=a[l+1];for(let g=0;g<o.length-1;g++)if(g_(u,p,o[g],o[g+1]))return!0}return!1}function g_(a,o,l,u){return Ko(a,l,u)!==Ko(o,l,u)&&Ko(a,o,l)!==Ko(a,o,u)}function Fl(a,o,l){const u=l*l;if(1===o.length)return a.distSqr(o[0])<u;for(let p=1;p<o.length;p++)if(Ib(a,o[p-1],o[p])<u)return!0;return!1}function Ib(a,o,l){const u=o.distSqr(l);if(0===u)return a.distSqr(o);const p=((a.x-o.x)*(l.x-o.x)+(a.y-o.y)*(l.y-o.y))/u;return a.distSqr(p<0?o:p>1?l:l.sub(o)._mult(p)._add(o))}function Rb(a,o){let l,u,p,g=!1;for(let v=0;v<a.length;v++){l=a[v];for(let w=0,D=l.length-1;w<l.length;D=w++)u=l[w],p=l[D],u.y>o.y!=p.y>o.y&&o.x<(p.x-u.x)*(o.y-u.y)/(p.y-u.y)+u.x&&(g=!g)}return g}function _u(a,o){let l=!1;for(let u=0,p=a.length-1;u<a.length;p=u++){const g=a[u],v=a[p];g.y>o.y!=v.y>o.y&&o.x<(v.x-g.x)*(o.y-g.y)/(v.y-g.y)+g.x&&(l=!l)}return l}function Uy(a,o,l,u,p){for(const v of a)if(o<=v.x&&l<=v.y&&u>=v.x&&p>=v.y)return!0;const g=[new ot(o,l),new ot(o,p),new ot(u,p),new ot(u,l)];if(a.length>2)for(const v of g)if(_u(a,v))return!0;for(let v=0;v<a.length-1;v++)if($y(a[v],a[v+1],g))return!0;return!1}function $y(a,o,l){const u=l[0],p=l[2];if(a.x<u.x&&o.x<u.x||a.x>p.x&&o.x>p.x||a.y<u.y&&o.y<u.y||a.y>p.y&&o.y>p.y)return!1;const g=Ko(a,o,l[0]);return g!==Ko(a,o,l[1])||g!==Ko(a,o,l[2])||g!==Ko(a,o,l[3])}function kh(a,o,l){const u=o.paint.get(a).value;return"constant"===u.kind?u.value:l.programConfigurations.get(o.id).getMaxValue(a)}function y_(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function kb(a,o,l,u,p){if(!o[0]&&!o[1])return a;const g=ot.convert(o)._mult(p);"viewport"===l&&g._rotate(-u);const v=[];for(let w=0;w<a.length;w++)v.push(a[w].sub(g));return v}function Hy(a,o,l,u){const p=ot.convert(a)._mult(u);return"viewport"===o&&p._rotate(-l),p}Et(__,"CircleBucket",{omit:["layers"]});const xC=new he({"circle-sort-key":new J(We.layout_circle["circle-sort-key"])});var wC={paint:new he({"circle-radius":new J(We.paint_circle["circle-radius"]),"circle-color":new J(We.paint_circle["circle-color"]),"circle-blur":new J(We.paint_circle["circle-blur"]),"circle-opacity":new J(We.paint_circle["circle-opacity"]),"circle-translate":new U(We.paint_circle["circle-translate"]),"circle-translate-anchor":new U(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new U(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new U(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new J(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new J(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new J(We.paint_circle["circle-stroke-opacity"])}),layout:xC};function jo(a,o,l,u,p,g,v,w,D){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(D*=a.pixelToTileUnitsFactor);const T=a.tileID.canonical,R=l.projection.upVectorScale(T,l.center.lat,l.worldSize).metersToTile;for(const P of o)for(const F of P){const B=F.add(w),z=p&&l.elevation?l.elevation.exaggeration()*p.getElevationAt(B.x,B.y,!0):0,$=l.projection.projectTilePoint(B.x,B.y,T);if(z>0){const le=l.projection.upVector(T,B.x,B.y);$.x+=le[0]*R*z,$.y+=le[1]*R*z,$.z+=le[2]*R*z}const Q=g?B:Gy($.x,$.y,$.z,u),ae=g?a.tilespaceRays.map(le=>Eo(le,z)):a.queryGeometry.screenGeometry,ve=Sh([],[$.x,$.y,$.z,1],u);if(!v&&g?D*=ve[3]/l.cameraToCenterDistance:v&&!g&&(D*=l.cameraToCenterDistance/ve[3]),g){const le=ho((F.y/Bt+T.y)/(1<<T.z));D/=l.projection.pixelsPerMeter(le,1)/Pl(1,le)}if(Ih(ae,Q,D))return!0}return!1}function Gy(a,o,l,u){const p=Sh([],[a,o,l,1],u);return new ot(p[0]/p[3],p[1]/p[3])}const qy=Eh(0,0,0),Wy=Eh(0,0,1);function Eo(a,o){const l=lu();return qy[2]=o,a.intersectsPlane(qy,Wy,l),new ot(l[0],l[1])}class Ph extends __{}function Zy(a,{width:o,height:l},u,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==o*l*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(o*l*u);return a.width=o,a.height=l,a.data=p,a}function Yy(a,o,l){const{width:u,height:p}=o;u===a.width&&p===a.height||(Xy(a,o,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,p)},l),a.width=u,a.height=p,a.data=o.data)}function Xy(a,o,l,u,p,g){if(0===p.width||0===p.height)return o;if(p.width>a.width||p.height>a.height||l.x>a.width-p.width||l.y>a.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>o.width||p.height>o.height||u.x>o.width-p.width||u.y>o.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const v=a.data,w=o.data;for(let D=0;D<p.height;D++){const T=((l.y+D)*a.width+l.x)*g,R=((u.y+D)*o.width+u.x)*g;for(let P=0;P<p.width*g;P++)w[R+P]=v[T+P]}return o}Et(Ph,"HeatmapBucket",{omit:["layers"]});class Nl{constructor(o,l){Zy(this,o,1,l)}resize(o){Yy(this,new Nl(o),1)}clone(){return new Nl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,p,g){Xy(o,l,u,p,g,1)}}class as{constructor(o,l){Zy(this,o,4,l)}resize(o){Yy(this,new as(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new as({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,p,g){Xy(o,l,u,p,g,4)}}Et(Nl,"AlphaImage"),Et(as,"RGBAImage");var Pb={paint:new he({"heatmap-radius":new J(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new J(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new U(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new de(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new U(We.paint_heatmap["heatmap-opacity"])})};function Ky(a){const o={},l=a.resolution||256,u=a.clips?a.clips.length:1,p=a.image||new as({width:l,height:u}),g=(v,w,D)=>{o[a.evaluationKey]=D;const T=a.expression.evaluate(o);p.data[v+w+0]=Math.floor(255*T.r/T.a),p.data[v+w+1]=Math.floor(255*T.g/T.a),p.data[v+w+2]=Math.floor(255*T.b/T.a),p.data[v+w+3]=Math.floor(255*T.a)};if(a.clips)for(let v=0,w=0;v<u;++v,w+=4*l)for(let D=0,T=0;D<l;D++,T+=4){const R=D/(l-1),{start:P,end:F}=a.clips[v];g(w,T,P*(1-R)+F*R)}else for(let v=0,w=0;v<l;v++,w+=4)g(0,w,v/(l-1));return p}var Ob={paint:new he({"hillshade-illumination-direction":new U(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new U(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new U(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new U(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new U(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new U(We.paint_hillshade["hillshade-accent-color"])})};const CC=De([{name:"a_pos",components:2,type:"Int16"}],4),{members:DC}=CC;var mf={exports:{}};function Oh(a,o,l){l=l||2;var u,p,g,v,w,D,T,R=o&&o.length,P=R?o[0]*l:a.length,F=Fb(a,0,P,l,!0),B=[];if(!F||F.next===F.prev)return B;if(R&&(F=function($,Q,ae,ve){var le,ge,xe,be=[];for(le=0,ge=Q.length;le<ge;le++)(xe=Fb($,Q[le]*ve,le<ge-1?Q[le+1]*ve:$.length,ve,!1))===xe.next&&(xe.steiner=!0),be.push(b_(xe));for(be.sort(Fh),le=0;le<be.length;le++)ae=v_(be[le],ae);return ae}(a,o,F,l)),a.length>80*l){u=g=a[0],p=v=a[1];for(var z=l;z<P;z+=l)(w=a[z])<u&&(u=w),(D=a[z+1])<p&&(p=D),w>g&&(g=w),D>v&&(v=D);T=0!==(T=Math.max(g-u,v-p))?32767/T:0}return _f(F,B,l,u,p,T,0),B}function Fb(a,o,l,u,p){var g,v;if(p===bf(a,o,l,u)>0)for(g=o;g<l;g+=u)v=D_(g,a[g],a[g+1],v);else for(g=l-u;g>=o;g-=u)v=D_(g,a[g],a[g+1],v);return v&&x_(v,v.next)&&(vf(v),v=v.next),v}function Na(a,o){if(!a)return a;o||(o=a);var l,u=a;do{if(l=!1,u.steiner||!x_(u,u.next)&&0!==Ki(u.prev,u,u.next))u=u.next;else{if(vf(u),(u=o=u.prev)===u.next)break;l=!0}}while(l||u!==o);return o}function _f(a,o,l,u,p,g,v){if(a){!v&&g&&function(R,P,F,B){var z=R;do{0===z.z&&(z.z=gf(z.x,z.y,P,F,B)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next}while(z!==R);z.prevZ.nextZ=null,z.prevZ=null,function($){var Q,ae,ve,le,ge,xe,be,ze,Le=1;do{for(ae=$,$=null,ge=null,xe=0;ae;){for(xe++,ve=ae,be=0,Q=0;Q<Le&&(be++,ve=ve.nextZ);Q++);for(ze=Le;be>0||ze>0&&ve;)0!==be&&(0===ze||!ve||ae.z<=ve.z)?(le=ae,ae=ae.nextZ,be--):(le=ve,ve=ve.nextZ,ze--),ge?ge.nextZ=le:$=le,le.prevZ=ge,ge=le;ae=ve}ge.nextZ=null,Le*=2}while(xe>1)}(z)}(a,u,p,g);for(var w,D,T=a;a.prev!==a.next;)if(w=a.prev,D=a.next,g?Nb(a,u,p,g):EC(a))o.push(w.i/l|0),o.push(a.i/l|0),o.push(D.i/l|0),vf(a),a=D.next,T=D.next;else if((a=D)===T){v?1===v?_f(a=Lb(Na(a),o,l),o,l,u,p,g,2):2===v&&Bb(a,o,l,u,p,g):_f(Na(a),o,l,u,p,g,1);break}}}function EC(a){var o=a.prev,l=a,u=a.next;if(Ki(o,l,u)>=0)return!1;for(var p=o.x,g=l.x,v=u.x,w=o.y,D=l.y,T=u.y,R=p<g?p<v?p:v:g<v?g:v,P=w<D?w<T?w:T:D<T?D:T,F=p>g?p>v?p:v:g>v?g:v,B=w>D?w>T?w:T:D>T?D:T,z=u.next;z!==o;){if(z.x>=R&&z.x<=F&&z.y>=P&&z.y<=B&&Nh(p,w,g,D,v,T,z.x,z.y)&&Ki(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function Nb(a,o,l,u){var p=a.prev,g=a,v=a.next;if(Ki(p,g,v)>=0)return!1;for(var w=p.x,D=g.x,T=v.x,R=p.y,P=g.y,F=v.y,B=w<D?w<T?w:T:D<T?D:T,z=R<P?R<F?R:F:P<F?P:F,$=w>D?w>T?w:T:D>T?D:T,Q=R>P?R>F?R:F:P>F?P:F,ae=gf(B,z,o,l,u),ve=gf($,Q,o,l,u),le=a.prevZ,ge=a.nextZ;le&&le.z>=ae&&ge&&ge.z<=ve;){if(le.x>=B&&le.x<=$&&le.y>=z&&le.y<=Q&&le!==p&&le!==v&&Nh(w,R,D,P,T,F,le.x,le.y)&&Ki(le.prev,le,le.next)>=0||(le=le.prevZ,ge.x>=B&&ge.x<=$&&ge.y>=z&&ge.y<=Q&&ge!==p&&ge!==v&&Nh(w,R,D,P,T,F,ge.x,ge.y)&&Ki(ge.prev,ge,ge.next)>=0))return!1;ge=ge.nextZ}for(;le&&le.z>=ae;){if(le.x>=B&&le.x<=$&&le.y>=z&&le.y<=Q&&le!==p&&le!==v&&Nh(w,R,D,P,T,F,le.x,le.y)&&Ki(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;ge&&ge.z<=ve;){if(ge.x>=B&&ge.x<=$&&ge.y>=z&&ge.y<=Q&&ge!==p&&ge!==v&&Nh(w,R,D,P,T,F,ge.x,ge.y)&&Ki(ge.prev,ge,ge.next)>=0)return!1;ge=ge.nextZ}return!0}function Lb(a,o,l){var u=a;do{var p=u.prev,g=u.next.next;!x_(p,g)&&Vb(p,u,u.next,g)&&hd(p,g)&&hd(g,p)&&(o.push(p.i/l|0),o.push(u.i/l|0),o.push(g.i/l|0),vf(u),vf(u.next),u=a=g),u=u.next}while(u!==a);return Na(u)}function Bb(a,o,l,u,p,g){var v=a;do{for(var w=v.next.next;w!==v.prev;){if(v.i!==w.i&&TC(v,w)){var D=C_(v,w);return v=Na(v,v.next),D=Na(D,D.next),_f(v,o,l,u,p,g,0),void _f(D,o,l,u,p,g,0)}w=w.next}v=v.next}while(v!==a)}function Fh(a,o){return a.x-o.x}function v_(a,o){var l=function(p,g){var v,w=g,D=p.x,T=p.y,R=-1/0;do{if(T<=w.y&&T>=w.next.y&&w.next.y!==w.y){var P=w.x+(T-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(P<=D&&P>R&&(R=P,v=w.x<w.next.x?w:w.next,P===D))return v}w=w.next}while(w!==g);if(!v)return null;var F,B=v,z=v.x,$=v.y,Q=1/0;w=v;do{D>=w.x&&w.x>=z&&D!==w.x&&Nh(T<$?D:R,T,z,$,T<$?R:D,T,w.x,w.y)&&(F=Math.abs(T-w.y)/(D-w.x),hd(w,p)&&(F<Q||F===Q&&(w.x>v.x||w.x===v.x&&zb(v,w)))&&(v=w,Q=F)),w=w.next}while(w!==B);return v}(a,o);if(!l)return o;var u=C_(l,a);return Na(u,u.next),Na(l,l.next)}function zb(a,o){return Ki(a.prev,a,o.prev)<0&&Ki(o.next,a,a.next)<0}function gf(a,o,l,u,p){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*p|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*p|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function b_(a){var o=a,l=a;do{(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next}while(o!==a);return l}function Nh(a,o,l,u,p,g,v,w){return(p-v)*(o-w)>=(a-v)*(g-w)&&(a-v)*(u-w)>=(l-v)*(o-w)&&(l-v)*(g-w)>=(p-v)*(u-w)}function TC(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(l,u){var p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==u.i&&p.next.i!==u.i&&Vb(p,p.next,l,u))return!0;p=p.next}while(p!==l);return!1}(a,o)&&(hd(a,o)&&hd(o,a)&&function(l,u){var p=l,g=!1,v=(l.x+u.x)/2,w=(l.y+u.y)/2;do{p.y>w!=p.next.y>w&&p.next.y!==p.y&&v<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(g=!g),p=p.next}while(p!==l);return g}(a,o)&&(Ki(a.prev,a,o.prev)||Ki(a,o.prev,o))||x_(a,o)&&Ki(a.prev,a,a.next)>0&&Ki(o.prev,o,o.next)>0)}function Ki(a,o,l){return(o.y-a.y)*(l.x-o.x)-(o.x-a.x)*(l.y-o.y)}function x_(a,o){return a.x===o.x&&a.y===o.y}function Vb(a,o,l,u){var p=yf(Ki(a,o,l)),g=yf(Ki(a,o,u)),v=yf(Ki(l,u,a)),w=yf(Ki(l,u,o));return p!==g&&v!==w||!(0!==p||!w_(a,l,o))||!(0!==g||!w_(a,u,o))||!(0!==v||!w_(l,a,u))||!(0!==w||!w_(l,o,u))}function w_(a,o,l){return o.x<=Math.max(a.x,l.x)&&o.x>=Math.min(a.x,l.x)&&o.y<=Math.max(a.y,l.y)&&o.y>=Math.min(a.y,l.y)}function yf(a){return a>0?1:a<0?-1:0}function hd(a,o){return Ki(a.prev,a,a.next)<0?Ki(a,o,a.next)>=0&&Ki(a,a.prev,o)>=0:Ki(a,o,a.prev)<0||Ki(a,a.next,o)<0}function C_(a,o){var l=new Qy(a.i,a.x,a.y),u=new Qy(o.i,o.x,o.y),p=a.next,g=o.prev;return a.next=o,o.prev=a,l.next=p,p.prev=l,u.next=l,l.prev=u,g.next=u,u.prev=g,u}function D_(a,o,l,u){var p=new Qy(a,o,l);return u?(p.next=u.next,p.prev=u,u.next.prev=p,u.next=p):(p.prev=p,p.next=p),p}function vf(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Qy(a,o,l){this.i=a,this.x=o,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bf(a,o,l,u){for(var p=0,g=o,v=l-u;g<l;g+=u)p+=(a[v]-a[g])*(a[g+1]+a[v+1]),v=g;return p}mf.exports=Oh,mf.exports.default=Oh,Oh.deviation=function(a,o,l,u){var p=o&&o.length,g=Math.abs(bf(a,0,p?o[0]*l:a.length,l));if(p)for(var v=0,w=o.length;v<w;v++)g-=Math.abs(bf(a,o[v]*l,v<w-1?o[v+1]*l:a.length,l));var D=0;for(v=0;v<u.length;v+=3){var T=u[v]*l,R=u[v+1]*l,P=u[v+2]*l;D+=Math.abs((a[T]-a[P])*(a[R+1]-a[T+1])-(a[T]-a[R])*(a[P+1]-a[T+1]))}return 0===g&&0===D?0:Math.abs((D-g)/g)},Oh.flatten=function(a){for(var o=a[0][0].length,l={vertices:[],holes:[],dimensions:o},u=0,p=0;p<a.length;p++){for(var g=0;g<a[p].length;g++)for(var v=0;v<o;v++)l.vertices.push(a[p][g][v]);p>0&&l.holes.push(u+=a[p-1].length)}return l};var E_=ms(mf.exports);function gu(a,o,l,u,p){Jy(a,o,l||0,u||a.length-1,p||SC)}function Jy(a,o,l,u,p){for(;u>l;){if(u-l>600){var g=u-l+1,v=o-l+1,w=Math.log(g),D=.5*Math.exp(2*w/3),T=.5*Math.sqrt(w*D*(g-D)/g)*(v-g/2<0?-1:1);Jy(a,o,Math.max(l,Math.floor(o-v*D/g+T)),Math.min(u,Math.floor(o+(g-v)*D/g+T)),p)}var R=a[o],P=l,F=u;for(Lh(a,l,o),p(a[u],R)>0&&Lh(a,l,u);P<F;){for(Lh(a,P,F),P++,F--;p(a[P],R)<0;)P++;for(;p(a[F],R)>0;)F--}0===p(a[l],R)?Lh(a,l,F):Lh(a,++F,u),F<=o&&(l=F+1),o<=F&&(u=F-1)}}function Lh(a,o,l){var u=a[o];a[o]=a[l],a[l]=u}function SC(a,o){return a<o?-1:a>o?1:0}function jb(a,o){const l=a.length;if(l<=1)return[a];const u=[];let p,g;for(let v=0;v<l;v++){const w=Uu(a[v]);0!==w&&(a[v].area=Math.abs(w),void 0===g&&(g=w<0),g===w<0?(p&&u.push(p),p=[a[v]]):p.push(a[v]))}if(p&&u.push(p),o>1)for(let v=0;v<u.length;v++)u[v].length<=o||(gu(u[v],o,1,u[v].length-1,T_),u[v]=u[v].slice(0,o));return u}function T_(a,o){return o.area-a.area}function ev(a,o,l){const u=l.patternDependencies;let p=!1;for(const g of o){const v=g.paint.get(`${a}-pattern`);v.isConstant()||(p=!0);const w=v.constantOr(null);w&&(p=!0,u[w]=!0)}return p}function S_(a,o,l,u,p){const g=p.patternDependencies;for(const v of o){const w=v.paint.get(`${a}-pattern`).value;if("constant"!==w.kind){let D=w.evaluate({zoom:u},l,{},p.availableImages);D=D&&D.name?D.name:D,g[D]=!0,l.patterns[v.id]=D}}return l}class xf{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ie,this.indexArray=new Ot,this.indexArray2=new nr,this.programConfigurations=new Pa(o.layers,o.zoom),this.segments=new Xi,this.segments2=new Xi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection}populate(o,l,u,p){this.hasPattern=ev("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:w,id:D,index:T,sourceLayerIndex:R}of o){const P=this.layers[0]._featureFilter.needGeometry,F=Ol(w,P);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),F,u))continue;const B=g?g.evaluate(F,{},u,l.availableImages):void 0,z={id:D,properties:w.properties,type:w.type,sourceLayerIndex:R,index:T,geometry:P?F.geometry:yc(w,u,p),patterns:{},sortKey:B};v.push(z)}g&&v.sort((w,D)=>w.sortKey-D.sortKey);for(const w of v){const{geometry:D,index:T,sourceLayerIndex:R}=w;if(this.hasPattern){const P=S_("fill",this.layers,w,this.zoom,l);this.patternFeatures.push(P)}else this.addFeature(w,D,T,u,{},l.availableImages);l.featureIndex.insert(o[T].feature,D,T,R,this.index)}}update(o,l,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,p)}addFeatures(o,l,u,p,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,l,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,DC),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,l,u,p,g,v=[]){for(const w of jb(l,500)){let D=0;for(const z of w)D+=z.length;const T=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),R=T.vertexLength,P=[],F=[];for(const z of w){if(0===z.length)continue;z!==w[0]&&F.push(P.length/2);const $=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),Q=$.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(Q+z.length-1,Q),P.push(z[0].x),P.push(z[0].y);for(let ae=1;ae<z.length;ae++)this.layoutVertexArray.emplaceBack(z[ae].x,z[ae].y),this.indexArray2.emplaceBack(Q+ae-1,Q+ae),P.push(z[ae].x),P.push(z[ae].y);$.vertexLength+=z.length,$.primitiveLength+=z.length}const B=E_(P,F);for(let z=0;z<B.length;z+=3)this.indexArray.emplaceBack(R+B[z],R+B[z+1],R+B[z+2]);T.vertexLength+=D,T.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,g,v,p)}}Et(xf,"FillBucket",{omit:["layers","patternFeatures"]});const Ub=new he({"fill-sort-key":new J(We.layout_fill["fill-sort-key"])});var tv={paint:new he({"fill-antialias":new U(We.paint_fill["fill-antialias"]),"fill-opacity":new J(We.paint_fill["fill-opacity"]),"fill-color":new J(We.paint_fill["fill-color"]),"fill-outline-color":new J(We.paint_fill["fill-outline-color"]),"fill-translate":new U(We.paint_fill["fill-translate"]),"fill-translate-anchor":new U(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new J(We.paint_fill["fill-pattern"])}),layout:Ub};const $b=De([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),M_=De([{name:"a_centroid_pos",components:2,type:"Uint16"}]),wf=De([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Hb}=$b;var Bh={},A_=Zl,nv=pd;function pd(a,o,l,u,p){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=u,this._values=p,a.readFields(Cf,this,o)}function Cf(a,o,l){1==a?o.id=l.readVarint():2==a?function(u,p){for(var g=u.readVarint()+u.pos;u.pos<g;){var v=p._keys[u.readVarint()],w=p._values[u.readVarint()];p.properties[v]=w}}(l,o):3==a?o.type=l.readVarint():4==a&&(o._geometry=l.pos)}function MC(a){for(var o,l,u=0,p=0,g=a.length,v=g-1;p<g;v=p++)u+=((l=a[v]).x-(o=a[p]).x)*(o.y+l.y);return u}pd.types=["Unknown","Point","LineString","Polygon"],pd.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,l=a.readVarint()+a.pos,u=1,p=0,g=0,v=0,w=[];a.pos<l;){if(p<=0){var D=a.readVarint();u=7&D,p=D>>3}if(p--,1===u||2===u)g+=a.readSVarint(),v+=a.readSVarint(),1===u&&(o&&w.push(o),o=[]),o.push(new A_(g,v));else{if(7!==u)throw new Error("unknown command "+u);o&&o.push(o[0].clone())}}return o&&w.push(o),w},pd.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,l=1,u=0,p=0,g=0,v=1/0,w=-1/0,D=1/0,T=-1/0;a.pos<o;){if(u<=0){var R=a.readVarint();l=7&R,u=R>>3}if(u--,1===l||2===l)(p+=a.readSVarint())<v&&(v=p),p>w&&(w=p),(g+=a.readSVarint())<D&&(D=g),g>T&&(T=g);else if(7!==l)throw new Error("unknown command "+l)}return[v,D,w,T]},pd.prototype.toGeoJSON=function(a,o,l){var u,p,g=this.extent*Math.pow(2,l),v=this.extent*a,w=this.extent*o,D=this.loadGeometry(),T=pd.types[this.type];function R(B){for(var z=0;z<B.length;z++){var $=B[z];B[z]=[360*($.x+v)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+w)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(u=0;u<D.length;u++)P[u]=D[u][0];R(D=P);break;case 2:for(u=0;u<D.length;u++)R(D[u]);break;case 3:for(D=function(B){var z=B.length;if(z<=1)return[B];for(var $,Q,ae=[],ve=0;ve<z;ve++){var le=MC(B[ve]);0!==le&&(void 0===Q&&(Q=le<0),Q===le<0?($&&ae.push($),$=[B[ve]]):$.push(B[ve]))}return $&&ae.push($),ae}(D),u=0;u<D.length;u++)for(p=0;p<D[u].length;p++)R(D[u][p])}1===D.length?D=D[0]:T="Multi"+T;var F={type:"Feature",geometry:{type:T,coordinates:D},properties:this.properties};return"id"in this&&(F.id=this.id),F};var Gb=nv,qb=Wb;function Wb(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(AC,this,o),this.length=this._features.length}function AC(a,o,l){15===a?o.version=l.readVarint():1===a?o.name=l.readString():5===a?o.extent=l.readVarint():2===a?o._features.push(l.pos):3===a?o._keys.push(l.readString()):4===a&&o._values.push(function(u){for(var p=null,g=u.readVarint()+u.pos;u.pos<g;){var v=u.readVarint()>>3;p=1===v?u.readString():2===v?u.readFloat():3===v?u.readDouble():4===v?u.readVarint64():5===v?u.readVarint():6===v?u.readSVarint():7===v?u.readBoolean():null}return p}(l))}Wb.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new Gb(this._pbf,o,this.extent,this._keys,this._values)};var Zb=qb;function Yb(a,o,l){if(3===a){var u=new Zb(l,l.readVarint()+l.pos);u.length&&(o[u.name]=u)}}var zh=Bh.VectorTile=function(a,o){this.layers=a.readFields(Yb,{},o)},Vh=Bh.VectorTileFeature=nv;function vc(a,o,l,u){const p=[],g=0===u?(v,w,D,T,R,P)=>{v.push(new ot(P,D+(P-w)/(T-w)*(R-D)))}:(v,w,D,T,R,P)=>{v.push(new ot(w+(P-D)/(R-D)*(T-w),P))};for(const v of a){const w=[];for(const D of v){if(D.length<=2)continue;const T=[];for(let F=0;F<D.length-1;F++){const B=D[F].x,z=D[F].y,$=D[F+1].x,Q=D[F+1].y,ae=0===u?B:z,ve=0===u?$:Q;ae<o?ve>o&&g(T,B,z,$,Q,o):ae>l?ve<l&&g(T,B,z,$,Q,l):T.push(D[F]),ve<o&&ae>=o&&g(T,B,z,$,Q,o),ve>l&&ae<=l&&g(T,B,z,$,Q,l)}let R=D[D.length-1];const P=0===u?R.x:R.y;P>=o&&P<=l&&T.push(R),T.length&&(R=T[T.length-1],T[0].x===R.x&&T[0].y===R.y||T.push(T[0]),w.push(T))}w.length&&p.push(w)}return p}Bh.VectorTileLayer=qb;const IC=Vh.types,RC=Math.pow(2,13);function I_(a,o,l,u,p,g,v,w){a.emplaceBack((o<<1)+v,(l<<1)+g,(Math.floor(u*RC)<<1)+p,Math.round(w))}function Df(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class R_{constructor(){this.acc=new ot(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ot(o.x,o.y),this.max=new ot(o.x,o.y))}append(o,l){this.currentPolyCount.edges++,this.acc._add(o);const u=this.min,p=this.max;o.x<u.x?u.x=o.x:o.x>p.x&&(p.x=o.x),o.y<u.y?u.y=o.y:o.y>p.y&&(p.y=o.y),((0===o.x||o.x===Bt)&&o.x===l.x)!=((0===o.y||o.y===Bt)&&o.y===l.y)&&this.processBorderOverlap(o,l),l.x<0!=o.x<0&&this.addBorderIntersection(0,Ln(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>Bt!=o.x>Bt&&this.addBorderIntersection(1,Ln(l.y,o.y,(Bt-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,Ln(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>Bt!=o.y>Bt&&this.addBorderIntersection(3,Ln(l.x,o.x,(Bt-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[o];l<u[0]&&(u[0]=l),l>u[1]&&(u[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const u=0===o.x?0:1;this.addBorderIntersection(u,l.y),this.addBorderIntersection(u,o.y)}else{const u=0===o.y?2:3;this.addBorderIntersection(u,l.x),this.addBorderIntersection(u,o.x)}}centroid(){const o=this.polyCount.reduce((l,u)=>l+u.edges,0);return 0!==o?this.acc.div(o)._round():new ot(0,0)}span(){return new ot(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0)}}class Ef{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new Ke,this.centroidVertexArray=new Jn,this.indexArray=new Ot,this.programConfigurations=new Pa(o.layers,o.zoom),this.segments=new Xi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=o.enableTerrain}populate(o,l,u,p){this.features=[],this.hasPattern=ev("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const v=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*v/(v*v+1)/Bt/(1<<g.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:g,id:v,index:w,sourceLayerIndex:D}of o){const T=this.layers[0]._featureFilter.needGeometry,R=Ol(g,T);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),R,u))continue;const P={id:v,sourceLayerIndex:D,index:w,geometry:T?R.geometry:yc(g,u,p),properties:g.properties,type:g.type,patterns:{}},F=this.layoutVertexArray.length;this.hasPattern?this.features.push(S_("fill-extrusion",this.layers,P,this.zoom,l)):this.addFeature(P,P.geometry,w,u,{},l.availableImages,p),l.featureIndex.insert(g,P.geometry,w,D,this.index,F)}this.sortBorders()}addFeatures(o,l,u,p,g){for(const v of this.features){const{geometry:w}=v;this.addFeature(v,w,v.index,l,u,p,g)}this.sortBorders()}update(o,l,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Hb),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,wf.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,M_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,u,p,g,v,w){const D=[new ot(0,0),new ot(Bt,Bt)],T=w.projection,R="globe"===T.name,P=this.enableTerrain&&!R?new R_:null,F="Polygon"===IC[o.type];R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ct);const B=jb(l,500);for(let ae=B.length-1;ae>=0;ae--){const ve=B[ae];(0===ve.length||(z=ve[0]).every(le=>le.x<=0)||z.every(le=>le.x>=Bt)||z.every(le=>le.y<=0)||z.every(le=>le.y>=Bt))&&B.splice(ae,1)}var z;let $;if(R)$=Xb(B,D,p);else{$=[];for(const ae of B)$.push({polygon:ae,bounds:D})}const Q=F?this.edgeRadius:0;for(const{polygon:ae,bounds:ve}of $){let le=0,ge=0;for(const be of ae)F&&!be[0].equals(be[be.length-1])&&be.push(be[0]),ge+=F?be.length-1:be.length;const xe=this.segments.prepareSegment((F?5:4)*ge,this.layoutVertexArray,this.indexArray);if(F){const be=[],ze=[];le=xe.vertexLength;for(const Ze of ae){let lt,$e;Ze.length&&Ze!==ae[0]&&ze.push(be.length/2),lt=Ze[1].sub(Ze[0])._perp()._unit();for(let Qe=1;Qe<Ze.length;Qe++){const Je=Ze[Qe],it=Ze[Qe===Ze.length-1?1:Qe+1];let{x:st,y:qe}=Je;if(Q){$e=it.sub(Je)._perp()._unit();const vt=lt.add($e)._unit(),St=Q*Math.min(4,1/(lt.x*vt.x+lt.y*vt.y));st+=St*vt.x,qe+=St*vt.y,lt=$e}I_(this.layoutVertexArray,st,qe,0,0,1,1,0),xe.vertexLength++,be.push(Je.x,Je.y),R&&Df(this.layoutVertexExtArray,T.projectTilePoint(st,qe,p),T.upVector(p,st,qe))}}const Le=E_(be,ze);for(let Ze=0;Ze<Le.length;Ze+=3)this.indexArray.emplaceBack(le+Le[Ze],le+Le[Ze+2],le+Le[Ze+1]),xe.primitiveLength++}for(const be of ae){P&&be.length&&P.startRing(be[0]);let ze,Le,Ze,lt=be.length>4&&rv(be[be.length-2],be[0],be[1]),$e=Q?k_(be[be.length-2],be[0],be[1],Q):0;Le=be[1].sub(be[0])._perp()._unit();let Qe=!0;for(let Je=1,it=0;Je<be.length;Je++){let st=be[Je-1],qe=be[Je];const vt=be[Je===be.length-1?1:Je+1];if(P&&F&&P.currentPolyCount.top++,iv(qe,st,ve)){Q&&(Le=vt.sub(qe)._perp()._unit(),Qe=!Qe);continue}P&&P.append(qe,st);const St=qe.sub(st)._perp(),bt=St.x/(Math.abs(St.x)+Math.abs(St.y)),rn=St.y>0?1:0,ut=st.dist(qe);if(it+ut>32768&&(it=0),Q){Ze=vt.sub(qe)._perp()._unit();let cn=P_(st,qe,vt,yu(Le,Ze),Q);isNaN(cn)&&(cn=0);const Gt=qe.sub(st)._unit();st=st.add(Gt.mult($e))._round(),qe=qe.add(Gt.mult(-cn))._round(),$e=cn,Le=Ze}const Nt=xe.vertexLength,Zt=be.length>4&&rv(st,qe,vt);let Pn=ov(it,lt,Qe);if(I_(this.layoutVertexArray,st.x,st.y,bt,rn,0,0,Pn),I_(this.layoutVertexArray,st.x,st.y,bt,rn,0,1,Pn),it+=ut,Pn=ov(it,Zt,!Qe),lt=Zt,I_(this.layoutVertexArray,qe.x,qe.y,bt,rn,0,0,Pn),I_(this.layoutVertexArray,qe.x,qe.y,bt,rn,0,1,Pn),xe.vertexLength+=4,this.indexArray.emplaceBack(Nt+0,Nt+1,Nt+2),this.indexArray.emplaceBack(Nt+1,Nt+3,Nt+2),xe.primitiveLength+=2,Q){const cn=le+(1===Je?be.length-2:Je-2),Gt=1===Je?le:cn+1;if(this.indexArray.emplaceBack(Nt+1,cn,Nt+3),this.indexArray.emplaceBack(cn,Gt,Nt+3),xe.primitiveLength+=2,void 0===ze&&(ze=Nt),!iv(vt,be[Je],ve)){const ci=Je===be.length-1?ze:xe.vertexLength;this.indexArray.emplaceBack(Nt+2,Nt+3,ci),this.indexArray.emplaceBack(Nt+3,ci+1,ci),this.indexArray.emplaceBack(Nt+3,Gt,ci+1),xe.primitiveLength+=3}Qe=!Qe}if(R){const cn=this.layoutVertexExtArray,Gt=T.projectTilePoint(st.x,st.y,p),ci=T.projectTilePoint(qe.x,qe.y,p),sn=T.upVector(p,st.x,st.y),dn=T.upVector(p,qe.x,qe.y);Df(cn,Gt,sn),Df(cn,Gt,sn),Df(cn,ci,dn),Df(cn,ci,dn)}}F&&(le+=be.length-1)}}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const ae=P.borders,ve=this.featuresOnBorder.push(P)-1;for(let le=0;le<4;le++)ae[le][0]!==Number.MAX_VALUE&&this.borders[le].push(ve)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,g,v,p)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((l,u)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[u].borders[o][0])}encodeCentroid(o,l,u=!0){let p,g;if(o)if(0!==o.y){const w=l.span()._mult(this.tileToMeter);p=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(w.x/10)),g=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else p=Math.ceil(7*(o.x+450)),g=0;else p=0,g=+u;let v=u?this.centroidVertexArray.length:l.vertexArrayOffset;for(const w of l.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let D=0;D<w.top;D++)this.centroidVertexArray.emplace(v++,p,g);for(let D=0;D<2*w.edges;D++)this.centroidVertexArray.emplace(v++,0,g),this.centroidVertexArray.emplace(v++,p,g)}}}function yu(a,o){const l=a.add(o)._unit();return a.x*l.x+a.y*l.y}function k_(a,o,l,u){const p=o.sub(a)._perp()._unit(),g=l.sub(o)._perp()._unit();return P_(a,o,l,yu(p,g),u)}function P_(a,o,l,u,p){const g=Math.sqrt(1-u*u);return Math.min(a.dist(o)/3,o.dist(l)/3,p*g/u)}function iv(a,o,l){return a.x<l[0].x&&o.x<l[0].x||a.x>l[1].x&&o.x>l[1].x||a.y<l[0].y&&o.y<l[0].y||a.y>l[1].y&&o.y>l[1].y}function rv(a,o,l){if(a.x<0||a.x>=Bt||o.x<0||o.x>=Bt||l.x<0||l.x>=Bt)return!1;const u=l.sub(o),p=u.perp(),g=a.sub(o);return(u.x*g.x+u.y*g.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(g.x*g.x+g.y*g.y))>-.866&&p.x*g.x+p.y*g.y<0}function ov(a,o,l){const u=o?2|a:-3&a;return l?1|u:-2&u}function fd(){const a=Math.PI/32,o=Math.tan(a),l=hf;return l*Math.sqrt(1+2*o*o)-l}function Xb(a,o,l){const u=1<<l.z,p=ss(l.x/u),g=ss((l.x+1)/u),v=ho(l.y/u),w=ho((l.y+1)/u);return function(D,T,R,P,F=0,B){const z=[];if(!D.length||!R||!P)return z;const $=(be,ze)=>{for(const Le of be)z.push({polygon:Le,bounds:ze})},Q=Math.ceil(Math.log2(R)),ae=Math.ceil(Math.log2(P)),ve=Q-ae,le=[];for(let be=0;be<Math.abs(ve);be++)le.push(ve>0?0:1);for(let be=0;be<Math.min(Q,ae);be++)le.push(0),le.push(1);let ge=D;if(ge=vc(ge,T[0].y-F,T[1].y+F,1),ge=vc(ge,T[0].x-F,T[1].x+F,0),!ge.length)return z;const xe=[];for(le.length?xe.push({polygons:ge,bounds:T,depth:0}):$(ge,T);xe.length;){const be=xe.pop(),ze=be.depth,Le=le[ze],Ze=be.bounds[0],lt=be.bounds[1],$e=0===Le?Ze.x:Ze.y,Qe=0===Le?lt.x:lt.y,Je=B?B(Le,$e,Qe):.5*($e+Qe),it=vc(be.polygons,$e-F,Je+F,Le),st=vc(be.polygons,Je-F,Qe+F,Le);if(it.length){const qe=[Ze,new ot(0===Le?Je:lt.x,1===Le?Je:lt.y)];le.length>ze+1?xe.push({polygons:it,bounds:qe,depth:ze+1}):$(it,qe)}if(st.length){const qe=[new ot(0===Le?Je:Ze.x,1===Le?Je:Ze.y),lt];le.length>ze+1?xe.push({polygons:st,bounds:qe,depth:ze+1}):$(st,qe)}}return z}(a,o,Math.ceil((g-p)/11.25),Math.ceil((v-w)/11.25),1,(D,T,R)=>{if(0===D)return.5*(T+R);{const P=ho((l.y+T/Bt)/u);return(Fa(.5*(ho((l.y+R/Bt)/u)+P))*u-l.y)*Bt}})}Et(Ef,"FillExtrusionBucket",{omit:["layers","features"]}),Et(R_,"PartMetadata");const kC=new he({"fill-extrusion-edge-radius":new U(We["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var PC={paint:new he({"fill-extrusion-opacity":new U(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new J(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new U(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new U(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new J(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new J(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new J(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new U(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new U(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new U(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new U(We["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:kC};function Kb(a,o,l){var u=2*Math.PI*6378137/256/Math.pow(2,l);return[a*u-2*Math.PI*6378137/2,o*u-2*Math.PI*6378137/2]}class O_{constructor(o,l,u){this.z=o,this.x=l,this.y=u,this.key=Tf(0,o,o,l,u)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const u=(v=this.y,w=this.z,D=Kb(256*(g=this.x),256*(v=Math.pow(2,w)-v-1),w),T=Kb(256*(g+1),256*(v+1),w),D[0]+","+D[1]+","+T[0]+","+T[1]),p=function(g,v,w){let D,T="";for(let R=g;R>0;R--)D=1<<R-1,T+=(v&D?1:0)+(w&D?2:0);return T}(this.z,this.x,this.y);var g,v,w,D,T;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ls{constructor(o,l){this.wrap=o,this.canonical=l,this.key=Tf(o,l.z,l.z,l.x,l.y)}}class Li{constructor(o,l,u,p,g){this.overscaledZ=o,this.wrap=l,this.canonical=new O_(u,+p,+g),this.key=0===l&&o===u?this.canonical.key:Tf(l,o,u,p,g)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new Li(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Li(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return Tf(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-o;return Tf(this.wrap*+l,o,o,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new Li(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new Li(l,this.wrap,l,u,p),new Li(l,this.wrap,l,u+1,p),new Li(l,this.wrap,l,u,p+1),new Li(l,this.wrap,l,u+1,p+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Li(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Li(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ls(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Tf(a,o,l,u,p){const g=1<<Math.min(l,22);let v=g*(p%g)+u%g;return a&&l<22&&(v+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*v+l)+(o-l)}Et(O_,"CanonicalTileID"),Et(Li,"OverscaledTileID",{omit:["projMatrix"]});class jh extends ot{constructor(o,l,u){super(o,l),this.z=u}}function Sf(a,o){return a.x*o.x+a.y*o.y}function Qb(a,o){if(1===a.length){let l=0;const u=o[l++];let p;for(;!p||u.equals(p);)if(p=o[l++],!p)return 1/0;for(;l<o.length;l++){const g=o[l],v=a[0],w=p.sub(u),D=g.sub(u),T=v.sub(u),R=Sf(w,w),P=Sf(w,D),F=Sf(D,D),B=Sf(T,w),z=Sf(T,D),$=R*F-P*P,Q=(F*B-P*z)/$,ae=(R*z-P*B)/$,ve=u.z*(1-Q-ae)+p.z*Q+g.z*ae;if(isFinite(ve))return ve}return 1/0}{let l=1/0;for(const u of o)l=Math.min(l,u.z);return l}}function Jb(a,o,l,u,p,g,v,w){const D=v*p.getElevationAt(a,o,!0,!0),T=0!==g[0],R=T?0===g[1]?v*(g[0]/7-450):v*function(P,F,B){const z=Math.floor(F[0]/8),$=Math.floor(F[1]/8),Q=10*(F[0]-8*z),ae=10*(F[1]-8*$),ve=P.getElevationAt(z,$,!0,!0),le=P.getMeterToDEM(B),ge=Math.floor(.5*(Q*le-1)),xe=Math.floor(.5*(ae*le-1)),be=P.tileCoordToPixel(z,$),ze=2*ge+1,Le=2*xe+1,Ze=(St=ze,bt=Le,[(st=P).getElevationAtPixel(qe=be.x-ge,vt=be.y-xe,!0),st.getElevationAtPixel(qe+bt,vt,!0),st.getElevationAtPixel(qe,vt+bt,!0),st.getElevationAtPixel(qe+St,vt+bt,!0)]),lt=Math.abs(Ze[0]-Ze[1]),$e=Math.abs(Ze[2]-Ze[3]),Qe=Math.abs(Ze[0]-Ze[2])+Math.abs(Ze[1]-Ze[3]),Je=Math.min(.25,.5*le*(lt+$e)/ze),it=Math.min(.25,.5*le*Qe/Le);var st,qe,vt,St,bt;return ve+Math.max(Je*Q,it*ae)}(p,g,w):D;return{base:D+(0===l)?-1:l,top:T?Math.max(R+u,D+l+2):D+u}}const OC=De([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:e1}=OC,FC=De([{name:"a_packed",components:4,type:"Float32"}]),{members:NC}=FC,LC=Vh.types,BC=Math.cos(Math.PI/180*37.5);class vu{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Ve,this.layoutVertexArray2=new et,this.indexArray=new Ot,this.programConfigurations=new Pa(o.layers,o.zoom),this.segments=new Xi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,u,p){this.hasPattern=ev("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),v=[];for(const{feature:R,id:P,index:F,sourceLayerIndex:B}of o){const z=this.layers[0]._featureFilter.needGeometry,$=Ol(R,z);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),$,u))continue;const Q=g?g.evaluate($,{},u):void 0,ae={id:P,properties:R.properties,type:R.type,sourceLayerIndex:B,index:F,geometry:z?$.geometry:yc(R,u,p),patterns:{},sortKey:Q};v.push(ae)}g&&v.sort((R,P)=>R.sortKey-P.sortKey);const{lineAtlas:w,featureIndex:D}=l,T=this.addConstantDashes(w);for(const R of v){const{geometry:P,index:F,sourceLayerIndex:B}=R;if(T&&this.addFeatureDashes(R,w),this.hasPattern){const z=S_("line",this.layers,R,this.zoom,l);this.patternFeatures.push(z)}else this.addFeature(R,P,F,u,w.positions,l.availableImages);D.insert(o[F].feature,P,F,B,this.index)}}addConstantDashes(o){let l=!1;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if("constant"!==p.kind||"constant"!==g.kind)l=!0;else{const v=g.value,w=p.value;if(!w)continue;o.addDash(w,v)}}return l}addFeatureDashes(o,l){const u=this.zoom;for(const p of this.layers){const g=p.paint.get("line-dasharray").value,v=p.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===v.kind)continue;let w,D;if("constant"===g.kind){if(w=g.value,!w)continue}else w=g.evaluate({zoom:u},o);D="constant"===v.kind?v.value:v.evaluate({zoom:u},o),l.addDash(w,D),o.patterns[p.id]=l.getKey(w,D)}}update(o,l,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,p)}addFeatures(o,l,u,p,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,l,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,NC)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,e1),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,u,p,g,v){const w=this.layers[0].layout,D=w.get("line-join").evaluate(o,{}),T=w.get("line-cap").evaluate(o,{}),R=w.get("line-miter-limit"),P=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const F of l)this.addLine(F,o,D,T,R,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,g,v,p)}addLine(o,l,u,p,g,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ae=0;ae<o.length-1;ae++)this.totalDistance+=o[ae].dist(o[ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===LC[l.type];let D=o.length;for(;D>=2&&o[D-1].equals(o[D-2]);)D--;let T=0;for(;T<D-1&&o[T].equals(o[T+1]);)T++;if(D<(w?3:2))return;"bevel"===u&&(g=1.05);const R=this.overscaling<=16?15*Bt/(512*this.overscaling):0,P=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let F,B,z,$,Q;this.e1=this.e2=-1,w&&(F=o[D-2],Q=o[T].sub(F)._unit()._perp());for(let ae=T;ae<D;ae++){if(z=ae===D-1?w?o[T+1]:void 0:o[ae+1],z&&o[ae].equals(z))continue;Q&&($=Q),F&&(B=F),F=o[ae],Q=z?z.sub(F)._unit()._perp():$,$=$||Q;let ve=$.add(Q);0===ve.x&&0===ve.y||ve._unit();const le=$.x*Q.x+$.y*Q.y,ge=ve.x*Q.x+ve.y*Q.y,xe=0!==ge?1/ge:1/0,be=2*Math.sqrt(2-2*ge),ze=ge<BC&&B&&z,Le=$.x*Q.y-$.y*Q.x>0;if(ze&&ae>T){const $e=F.dist(B);if($e>2*R){const Qe=F.sub(F.sub(B)._mult(R/$e)._round());this.updateDistance(B,Qe),this.addCurrentVertex(Qe,$,0,0,P),B=Qe}}const Ze=B&&z;let lt=Ze?u:w?"butt":p;if(Ze&&"round"===lt&&(xe<v?lt="miter":xe<=2&&(lt="fakeround")),"miter"===lt&&xe>g&&(lt="bevel"),"bevel"===lt&&(xe>2&&(lt="flipbevel"),xe<g&&(lt="miter")),B&&this.updateDistance(B,F),"miter"===lt)ve._mult(xe),this.addCurrentVertex(F,ve,0,0,P);else if("flipbevel"===lt){if(xe>100)ve=Q.mult(-1);else{const $e=xe*$.add(Q).mag()/$.sub(Q).mag();ve._perp()._mult($e*(Le?-1:1))}this.addCurrentVertex(F,ve,0,0,P),this.addCurrentVertex(F,ve.mult(-1),0,0,P)}else if("bevel"===lt||"fakeround"===lt){const $e=-Math.sqrt(xe*xe-1),Qe=Le?$e:0,Je=Le?0:$e;if(B&&this.addCurrentVertex(F,$,Qe,Je,P),"fakeround"===lt){const it=Math.round(180*be/Math.PI/20);for(let st=1;st<it;st++){let qe=st/it;if(.5!==qe){const St=qe-.5;qe+=qe*St*(qe-1)*((1.0904+le*(le*(3.55645-1.43519*le)-3.2452))*St*St+(.848013+le*(.215638*le-1.06021)))}const vt=Q.sub($)._mult(qe)._add($)._unit()._mult(Le?-1:1);this.addHalfVertex(F,vt.x,vt.y,!1,Le,0,P)}}z&&this.addCurrentVertex(F,Q,-Qe,-Je,P)}else if("butt"===lt)this.addCurrentVertex(F,ve,0,0,P);else if("square"===lt){const $e=B?1:-1;B||this.addCurrentVertex(F,ve,$e,$e,P),this.addCurrentVertex(F,ve,0,0,P),B&&this.addCurrentVertex(F,ve,$e,$e,P)}else"round"===lt&&(B&&(this.addCurrentVertex(F,$,0,0,P),this.addCurrentVertex(F,$,1,1,P,!0)),z&&(this.addCurrentVertex(F,Q,-1,-1,P,!0),this.addCurrentVertex(F,Q,0,0,P)));if(ze&&ae<D-1){const $e=F.dist(z);if($e>2*R){const Qe=F.add(z.sub(F)._mult(R/$e)._round());this.updateDistance(F,Qe),this.addCurrentVertex(Qe,Q,0,0,P),F=Qe}}}}addCurrentVertex(o,l,u,p,g,v=!1){const w=l.y*p-l.x,D=-l.y-l.x*p;this.addHalfVertex(o,l.x+l.y*u,l.y-l.x*u,v,!1,u,g),this.addHalfVertex(o,w,D,v,!0,-p,g)}addHalfVertex({x:o,y:l},u,p,g,v,w,D){this.layoutVertexArray.emplaceBack((o<<1)+(g?1:0),(l<<1)+(v?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const T=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),D.primitiveLength++),v?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,l){this.distance+=o.dist(l),this.updateScaledDistance()}}Et(vu,"LineBucket",{omit:["layers","patternFeatures"]});const bc=new he({"line-cap":new J(We.layout_line["line-cap"]),"line-join":new J(We.layout_line["line-join"]),"line-miter-limit":new U(We.layout_line["line-miter-limit"]),"line-round-limit":new U(We.layout_line["line-round-limit"]),"line-sort-key":new J(We.layout_line["line-sort-key"])});var Uh={paint:new he({"line-opacity":new J(We.paint_line["line-opacity"]),"line-color":new J(We.paint_line["line-color"]),"line-translate":new U(We.paint_line["line-translate"]),"line-translate-anchor":new U(We.paint_line["line-translate-anchor"]),"line-width":new J(We.paint_line["line-width"]),"line-gap-width":new J(We.paint_line["line-gap-width"]),"line-offset":new J(We.paint_line["line-offset"]),"line-blur":new J(We.paint_line["line-blur"]),"line-dasharray":new J(We.paint_line["line-dasharray"]),"line-pattern":new J(We.paint_line["line-pattern"]),"line-gradient":new de(We.paint_line["line-gradient"]),"line-trim-offset":new U(We.paint_line["line-trim-offset"])}),layout:bc};const sv=new class extends J{possiblyEvaluate(a,o){return o=new k(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(a,o)}evaluate(a,o,l,u){return o=Hi({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(a,o,l,u)}}(Uh.paint.properties["line-width"].specification);function av(a,o){return o>0?o+2*a:a}sv.useIntegerZoom=!0;const t1=De([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fM=De([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),mM=De([{name:"a_projected_pos",components:4,type:"Float32"}],4);De([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const _M=De([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),lv=De([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);De([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const F_=De([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),gM=De([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);De([{name:"triangle",components:3,type:"Uint16"}]),De([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),De([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),De([{type:"Float32",name:"offsetX"}]),De([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Xr=24;const sa=128;function cv(a,o){const{expression:l}=o;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new k(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:p}=l;let g=0;for(;g<u.length&&u[g]<=a;)g++;g=Math.max(0,g-1);let v=g;for(;v<u.length&&u[v]<a+1;)v++;v=Math.min(u.length-1,v);const w=u[g],D=u[v];return"composite"===l.kind?{kind:"composite",minZoom:w,maxZoom:D,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:D,minSize:l.evaluate(new k(w)),maxSize:l.evaluate(new k(D)),interpolationType:p}}}function N_(a,{uSize:o,uSizeT:l},{lowerSize:u,upperSize:p}){return"source"===a.kind?u/sa:"composite"===a.kind?Ln(u/sa,p/sa,l):o}function $h(a,o){let l=0,u=0;if("constant"===a.kind)u=a.layoutSize;else if("source"!==a.kind){const{interpolationType:p,minZoom:g,maxZoom:v}=a,w=p?hn(lo.interpolationFactor(p,o,g,v),0,1):0;"camera"===a.kind?u=Ln(a.minSize,a.maxSize,w):l=w}return{uSizeT:l,uSize:u}}var zC=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:sa,evaluateSizeForFeature:N_,evaluateSizeForZoom:$h,getSizeData:cv});function n1(a,o,l){return a.sections.forEach(u=>{u.text=function(p,g,v){const w=g.layout.get("text-transform").evaluate(v,{});return"uppercase"===w?p=p.toLocaleUpperCase():"lowercase"===w&&(p=p.toLocaleLowerCase()),M.applyArabicShaping&&(p=M.applyArabicShaping(p)),p}(u.text,o,l)}),a}const md={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function r1(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function dv(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var o1=li,Kr=function(a,o,l,u,p){var g,v,w=8*p-u-1,D=(1<<w)-1,T=D>>1,R=-7,P=l?p-1:0,F=l?-1:1,B=a[o+P];for(P+=F,g=B&(1<<-R)-1,B>>=-R,R+=w;R>0;g=256*g+a[o+P],P+=F,R-=8);for(v=g&(1<<-R)-1,g>>=-R,R+=u;R>0;v=256*v+a[o+P],P+=F,R-=8);if(0===g)g=1-T;else{if(g===D)return v?NaN:1/0*(B?-1:1);v+=Math.pow(2,u),g-=T}return(B?-1:1)*v*Math.pow(2,g-u)},s1=function(a,o,l,u,p,g){var v,w,D,T=8*g-p-1,R=(1<<T)-1,P=R>>1,F=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,B=u?0:g-1,z=u?1:-1,$=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,v=R):(v=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-v))<1&&(v--,D*=2),(o+=v+P>=1?F/D:F*Math.pow(2,1-P))*D>=2&&(v++,D/=2),v+P>=R?(w=0,v=R):v+P>=1?(w=(o*D-1)*Math.pow(2,p),v+=P):(w=o*Math.pow(2,P-1)*Math.pow(2,p),v=0));p>=8;a[l+B]=255&w,B+=z,w/=256,p-=8);for(v=v<<p|w,T+=p;T>0;a[l+B]=255&v,B+=z,v/=256,T-=8);a[l+B-z]|=128*$};function li(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}li.Varint=0,li.Fixed64=1,li.Bytes=2,li.Fixed32=5;var cs=4294967296,uv=1/cs,a1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function xc(a){return a.type===li.Bytes?a.readVarint()+a.pos:a.pos+1}function l1(a,o,l){var u=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));l.realloc(u);for(var p=l.pos-1;p>=a;p--)l.buf[p+u]=l.buf[p]}function c1(a,o){for(var l=0;l<a.length;l++)o.writeVarint(a[l])}function yM(a,o){for(var l=0;l<a.length;l++)o.writeSVarint(a[l])}function vM(a,o){for(var l=0;l<a.length;l++)o.writeFloat(a[l])}function Mf(a,o){for(var l=0;l<a.length;l++)o.writeDouble(a[l])}function mt(a,o){for(var l=0;l<a.length;l++)o.writeBoolean(a[l])}function Af(a,o){for(var l=0;l<a.length;l++)o.writeFixed32(a[l])}function d1(a,o){for(var l=0;l<a.length;l++)o.writeSFixed32(a[l])}function u1(a,o){for(var l=0;l<a.length;l++)o.writeFixed64(a[l])}function hv(a,o){for(var l=0;l<a.length;l++)o.writeSFixed64(a[l])}function Gh(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function qh(a,o,l){a[l]=o,a[l+1]=o>>>8,a[l+2]=o>>>16,a[l+3]=o>>>24}function pv(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}li.prototype={destroy:function(){this.buf=null},readFields:function(a,o,l){for(l=l||this.length;this.pos<l;){var u=this.readVarint(),p=u>>3,g=this.pos;this.type=7&u,a(p,o,this),this.pos===g&&this.skip(u)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=Gh(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=pv(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Gh(this.buf,this.pos)+Gh(this.buf,this.pos+4)*cs;return this.pos+=8,a},readSFixed64:function(){var a=Gh(this.buf,this.pos)+pv(this.buf,this.pos+4)*cs;return this.pos+=8,a},readFloat:function(){var a=Kr(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Kr(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,l,u=this.buf;return o=127&(l=u[this.pos++]),l<128?o:(o|=(127&(l=u[this.pos++]))<<7,l<128?o:(o|=(127&(l=u[this.pos++]))<<14,l<128?o:(o|=(127&(l=u[this.pos++]))<<21,l<128?o:function(p,g,v){var w,D,T=v.buf;if(w=(112&(D=T[v.pos++]))>>4,D<128||(w|=(127&(D=T[v.pos++]))<<3,D<128)||(w|=(127&(D=T[v.pos++]))<<10,D<128)||(w|=(127&(D=T[v.pos++]))<<17,D<128)||(w|=(127&(D=T[v.pos++]))<<24,D<128)||(w|=(1&(D=T[v.pos++]))<<31,D<128))return function Hh(a,o,l){return l?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}(p,w,g);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(l=u[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&a1?a1.decode(this.buf.subarray(o,a)):function(l,u,p){for(var g="",v=u;v<p;){var w,D,T,R=l[v],P=null,F=R>239?4:R>223?3:R>191?2:1;if(v+F>p)break;1===F?R<128&&(P=R):2===F?128==(192&(w=l[v+1]))&&(P=(31&R)<<6|63&w)<=127&&(P=null):3===F?(D=l[v+2],128==(192&(w=l[v+1]))&&128==(192&D)&&((P=(15&R)<<12|(63&w)<<6|63&D)<=2047||P>=55296&&P<=57343)&&(P=null)):4===F&&(D=l[v+2],T=l[v+3],128==(192&(w=l[v+1]))&&128==(192&D)&&128==(192&T)&&((P=(15&R)<<18|(63&w)<<12|(63&D)<<6|63&T)<=65535||P>=1114112)&&(P=null)),null===P?(P=65533,F=1):P>65535&&(P-=65536,g+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),g+=String.fromCharCode(P),v+=F}return g}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==li.Bytes)return a.push(this.readVarint(o));var l=xc(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==li.Bytes)return a.push(this.readSVarint());var o=xc(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==li.Bytes)return a.push(this.readBoolean());var o=xc(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==li.Bytes)return a.push(this.readFloat());var o=xc(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==li.Bytes)return a.push(this.readDouble());var o=xc(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==li.Bytes)return a.push(this.readFixed32());var o=xc(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==li.Bytes)return a.push(this.readSFixed32());var o=xc(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==li.Bytes)return a.push(this.readFixed64());var o=xc(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==li.Bytes)return a.push(this.readSFixed64());var o=xc(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===li.Varint)for(;this.buf[this.pos++]>127;);else if(o===li.Bytes)this.pos=this.readVarint()+this.pos;else if(o===li.Fixed32)this.pos+=4;else{if(o!==li.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var l=new Uint8Array(o);l.set(this.buf),this.buf=l,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),qh(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),qh(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),qh(this.buf,-1&a,this.pos),qh(this.buf,Math.floor(a*uv),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),qh(this.buf,-1&a,this.pos),qh(this.buf,Math.floor(a*uv),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,l){var u,p,g,w;if(o>=0?(u=o%4294967296|0,p=o/4294967296|0):(p=~(-o/4294967296),4294967295^(u=~(-o%4294967296))?u=u+1|0:(u=0,p=p+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),g=u,(w=l).buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7),function(g,v){var w=(7&g)<<4;v.buf[v.pos++]|=w|((g>>>=3)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g)))))}(p,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(u,p,g){for(var v,w,D=0;D<p.length;D++){if((v=p.charCodeAt(D))>55295&&v<57344){if(!w){v>56319||D+1===p.length?(u[g++]=239,u[g++]=191,u[g++]=189):w=v;continue}if(v<56320){u[g++]=239,u[g++]=191,u[g++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(u[g++]=239,u[g++]=191,u[g++]=189,w=null);v<128?u[g++]=v:(v<2048?u[g++]=v>>6|192:(v<65536?u[g++]=v>>12|224:(u[g++]=v>>18|240,u[g++]=v>>12&63|128),u[g++]=v>>6&63|128),u[g++]=63&v|128)}return g}(this.buf,a,this.pos);var l=this.pos-o;l>=128&&l1(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),s1(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),s1(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var l=0;l<o;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,o){this.pos++;var l=this.pos;a(o,this);var u=this.pos-l;u>=128&&l1(l,u,this),this.pos=l-1,this.writeVarint(u),this.pos+=u},writeMessage:function(a,o,l){this.writeTag(a,li.Bytes),this.writeRawMessage(o,l)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,c1,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,yM,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,mt,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,vM,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,Mf,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,Af,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,d1,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,u1,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,hv,o)},writeBytesField:function(a,o){this.writeTag(a,li.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,li.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,li.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,li.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,li.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,li.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,li.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,li.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,li.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,li.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,!!o)}};var If=ms(o1);const Wh=3;function bM(a,o,l){o.glyphs=[],1===a&&l.readMessage(fv,o)}function fv(a,o,l){if(3===a){const{id:u,bitmap:p,width:g,height:v,left:w,top:D,advance:T}=l.readMessage(VC,{});o.glyphs.push({id:u,bitmap:new Nl({width:g+2*Wh,height:v+2*Wh},p),metrics:{width:g,height:v,left:w,top:D,advance:T}})}else 4===a?o.ascender=l.readSVarint():5===a&&(o.descender=l.readSVarint())}function VC(a,o,l){1===a?o.id=l.readVarint():2===a?o.bitmap=l.readBytes():3===a?o.width=l.readVarint():4===a?o.height=l.readVarint():5===a?o.left=l.readSVarint():6===a?o.top=l.readSVarint():7===a&&(o.advance=l.readVarint())}const L_=Wh;function B_(a){let o=0,l=0;for(const v of a)o+=v.w*v.h,l=Math.max(l,v.w);a.sort((v,w)=>w.h-v.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let p=0,g=0;for(const v of a)for(let w=u.length-1;w>=0;w--){const D=u[w];if(!(v.w>D.w||v.h>D.h)){if(v.x=D.x,v.y=D.y,g=Math.max(g,v.y+v.h),p=Math.max(p,v.x+v.w),v.w===D.w&&v.h===D.h){const T=u.pop();w<u.length&&(u[w]=T)}else v.h===D.h?(D.x+=v.w,D.w-=v.w):v.w===D.w?(D.y+=v.h,D.h-=v.h):(u.push({x:D.x+v.w,y:D.y,w:D.w-v.w,h:v.h}),D.y+=v.h,D.h-=v.h);break}}return{w:p,h:g,fill:o/(p*g)||0}}const To=1;class wc{constructor(o,{pixelRatio:l,version:u,stretchX:p,stretchY:g,content:v}){this.paddedRect=o,this.pixelRatio=l,this.stretchX=p,this.stretchY=g,this.content=v,this.version=u}get tl(){return[this.paddedRect.x+To,this.paddedRect.y+To]}get br(){return[this.paddedRect.x+this.paddedRect.w-To,this.paddedRect.y+this.paddedRect.h-To]}get displaySize(){return[(this.paddedRect.w-2*To)/this.pixelRatio,(this.paddedRect.h-2*To)/this.pixelRatio]}}class h1{constructor(o,l){const u={},p={};this.haveRenderCallbacks=[];const g=[];this.addImages(o,u,g),this.addImages(l,p,g);const{w:v,h:w}=B_(g),D=new as({width:v||1,height:w||1});for(const T in o){const R=o[T],P=u[T].paddedRect;as.copy(R.data,D,{x:0,y:0},{x:P.x+To,y:P.y+To},R.data)}for(const T in l){const R=l[T],P=p[T].paddedRect,F=P.x+To,B=P.y+To,z=R.data.width,$=R.data.height;as.copy(R.data,D,{x:0,y:0},{x:F,y:B},R.data),as.copy(R.data,D,{x:0,y:$-1},{x:F,y:B-1},{width:z,height:1}),as.copy(R.data,D,{x:0,y:0},{x:F,y:B+$},{width:z,height:1}),as.copy(R.data,D,{x:z-1,y:0},{x:F-1,y:B},{width:1,height:$}),as.copy(R.data,D,{x:0,y:0},{x:F+z,y:B},{width:1,height:$})}this.image=D,this.iconPositions=u,this.patternPositions=p}addImages(o,l,u){for(const p in o){const g=o[p],v={x:0,y:0,w:g.data.width+2*To,h:g.data.height+2*To};u.push(v),l[p]=new wc(v,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(o,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>o.hasImage(u)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in o.updatedImages)this.patchUpdatedImage(this.iconPositions[u],o.getImage(u),l),this.patchUpdatedImage(this.patternPositions[u],o.getImage(u),l)}patchUpdatedImage(o,l,u){if(!o||!l||o.version===l.version)return;o.version=l.version;const[p,g]=o.tl;u.update(l.data,void 0,{x:p,y:g})}}Et(wc,"ImagePosition"),Et(h1,"ImageAtlas");const Uo={horizontal:1,vertical:2,horizontalOnly:3},Rf=-17;class kf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,l){const u=new kf;return u.scale=o||1,u.fontStack=l,u}static forImage(o){const l=new kf;return l.imageName=o,l}}class _d{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l){const u=new _d;for(let p=0;p<o.sections.length;p++){const g=o.sections[p];g.image?u.addImageSection(g):u.addTextSection(g,l)}return u}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(l,u){let p="";for(let g=0;g<l.length;g++){const v=l.charCodeAt(g+1)||null,w=l.charCodeAt(g-1)||null;p+=!u&&(v&&Yp(v)&&!md[l[g+1]]||w&&Yp(w)&&!md[l[g-1]])||!md[l[g]]?l[g]:md[l[g]]}return p}(this.text,o)}trim(){let o=0;for(let u=0;u<this.text.length&&Qr[this.text.charCodeAt(u)];u++)o++;let l=this.text.length;for(let u=this.text.length-1;u>=0&&u>=o&&Qr[this.text.charCodeAt(u)];u--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const u=new _d;return u.text=this.text.substring(o,l),u.sectionIndex=this.sectionIndex.slice(o,l),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(kf.forText(o.scale,o.fontStack||l));const u=this.sections.length-1;for(let p=0;p<o.text.length;++p)this.sectionIndex.push(u)}addImageSection(o){const l=o.image?o.image.name:"";if(0===l.length)return void Ei("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(kf.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Ei("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zh(a,o,l,u,p,g,v,w,D,T,R,P,F,B,z){const $=_d.fromFeature(a,p);P===Uo.vertical&&$.verticalizePunctuation(F);let Q=[];const ae=function(be,ze,Le,Ze,lt,$e){if(!be)return[];const Qe=[],Je=function(vt,St,bt,rn,ut,Nt){let Zt=0;for(let Pn=0;Pn<vt.length();Pn++){const cn=vt.getSection(Pn);Zt+=V_(vt.getCharCode(Pn),cn,rn,ut,St,Nt)}return Zt/Math.max(1,Math.ceil(Zt/bt))}(be,ze,Le,Ze,lt,$e),it=be.text.indexOf("\u200b")>=0;let st=0;for(let vt=0;vt<be.length();vt++){const St=be.getSection(vt),bt=be.getCharCode(vt);if(Qr[bt]||(st+=V_(bt,St,Ze,lt,ze,$e)),vt<be.length()-1){const rn=!((qe=bt)<11904||!(xt["Bopomofo Extended"](qe)||xt.Bopomofo(qe)||xt["CJK Compatibility Forms"](qe)||xt["CJK Compatibility Ideographs"](qe)||xt["CJK Compatibility"](qe)||xt["CJK Radicals Supplement"](qe)||xt["CJK Strokes"](qe)||xt["CJK Symbols and Punctuation"](qe)||xt["CJK Unified Ideographs Extension A"](qe)||xt["CJK Unified Ideographs"](qe)||xt["Enclosed CJK Letters and Months"](qe)||xt["Halfwidth and Fullwidth Forms"](qe)||xt.Hiragana(qe)||xt["Ideographic Description Characters"](qe)||xt["Kangxi Radicals"](qe)||xt["Katakana Phonetic Extensions"](qe)||xt.Katakana(qe)||xt["Vertical Forms"](qe)||xt["Yi Radicals"](qe)||xt["Yi Syllables"](qe)));(z_[bt]||rn||St.imageName)&&Qe.push(mv(vt+1,st,Je,Qe,jC(bt,be.getCharCode(vt+1),rn&&it),!1))}}var qe;return bu(mv(be.length(),st,Je,Qe,0,!0))}($,T,g,o,u,B),{processBidirectionalText:ve,processStyledBidirectionalText:le}=M;if(ve&&1===$.sections.length){const be=ve($.toString(),ae);for(const ze of be){const Le=new _d;Le.text=ze,Le.sections=$.sections;for(let Ze=0;Ze<ze.length;Ze++)Le.sectionIndex.push(0);Q.push(Le)}}else if(le){const be=le($.text,$.sectionIndex,ae);for(const ze of be){const Le=new _d;Le.text=ze[0],Le.sectionIndex=ze[1],Le.sections=$.sections,Q.push(Le)}}else Q=function(be,ze){const Le=[],Ze=be.text;let lt=0;for(const $e of ze)Le.push(be.substring(lt,$e)),lt=$e;return lt<Ze.length&&Le.push(be.substring(lt,Ze.length)),Le}($,ae);const ge=[],xe={positionedLines:ge,text:$.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(be,ze,Le,Ze,lt,$e,Qe,Je,it,st,qe,vt){let St=0,bt=0,rn=0;const ut="right"===Je?1:"left"===Je?0:.5;let Nt=!1;for(const sn of lt){const dn=sn.getSections();for(const ii of dn){if(ii.imageName)continue;const ri=ze[ii.fontStack];if(ri&&(Nt=void 0!==ri.ascender&&void 0!==ri.descender,!Nt))break}if(!Nt)break}let Zt=0;for(const sn of lt){sn.trim();const dn=sn.getMaxScale(),ii=(dn-1)*Xr,ri={positionedGlyphs:[],lineOffset:0};be.positionedLines[Zt]=ri;const oi=ri.positionedGlyphs;let Un=0;if(!sn.length()){bt+=$e,++Zt;continue}let Ai=0,Pi=0;for(let si=0;si<sn.length();si++){const ir=sn.getSection(si),Ii=sn.getSectionIndex(si),Oi=sn.getCharCode(si);let jn=ir.scale,Qi=null,di=null,Mo=null,Ji=Xr,Or=0;const Dr=!(it===Uo.horizontal||!qe&&!mh(Oi)||qe&&(Qr[Oi]||(Pn=Oi,xt.Arabic(Pn)||xt["Arabic Supplement"](Pn)||xt["Arabic Extended-A"](Pn)||xt["Arabic Presentation Forms-A"](Pn)||xt["Arabic Presentation Forms-B"](Pn))));if(ir.imageName){const mo=Ze[ir.imageName];if(!mo)continue;Mo=ir.imageName,be.iconsInText=be.iconsInText||!0,di=mo.paddedRect;const Yt=mo.displaySize;jn=jn*Xr/vt,Qi={width:Yt[0],height:Yt[1],left:To,top:-L_,advance:Dr?Yt[1]:Yt[0],localGlyph:!1},Or=Nt?-Qi.height*jn:Rf+dn*Xr-Yt[1]*jn,Ji=Qi.advance;const ja=(Dr?Yt[0]:Yt[1])*jn-Xr*dn;ja>0&&ja>Un&&(Un=ja)}else{const mo=Le[ir.fontStack];if(!mo)continue;mo[Oi]&&(di=mo[Oi]);const Yt=ze[ir.fontStack];if(!Yt)continue;const ja=Yt.glyphs[Oi];if(!ja)continue;if(Qi=ja.metrics,Ji=8203!==Oi?Xr:0,Nt){const Mc=void 0!==Yt.ascender?Math.abs(Yt.ascender):0,Xf=void 0!==Yt.descender?Math.abs(Yt.descender):0,Kf=(Mc+Xf)*jn;Ai<Kf&&(Ai=Kf,Pi=(Mc-Xf)/2*jn),Or=-Mc*jn}else Or=Rf+(dn-jn)*Xr}Dr?(be.verticalizable=!0,oi.push({glyph:Oi,imageName:Mo,x:St,y:bt+Or,vertical:Dr,scale:jn,localGlyph:Qi.localGlyph,fontStack:ir.fontStack,sectionIndex:Ii,metrics:Qi,rect:di}),St+=Ji*jn+st):(oi.push({glyph:Oi,imageName:Mo,x:St,y:bt+Or,vertical:Dr,scale:jn,localGlyph:Qi.localGlyph,fontStack:ir.fontStack,sectionIndex:Ii,metrics:Qi,rect:di}),St+=Qi.advance*jn+st)}0!==oi.length&&(rn=Math.max(St-st,rn),Nt?f1(oi,ut,Un,Pi,$e*dn/2):f1(oi,ut,Un,0,$e/2)),St=0;const Vi=$e*dn+Un;ri.lineOffset=Math.max(Un,ii),bt+=Vi,++Zt}var Pn;const cn=bt,{horizontalAlign:Gt,verticalAlign:ci}=_v(Qe);(function(sn,dn,ii,ri,oi,Un){const Ai=(dn-ii)*oi,Pi=-Un*ri;for(const Vi of sn)for(const si of Vi.positionedGlyphs)si.x+=Ai,si.y+=Pi})(be.positionedLines,ut,Gt,ci,rn,cn),be.top+=-ci*cn,be.bottom=be.top+cn,be.left+=-Gt*rn,be.right=be.left+rn,be.hasBaseline=Nt}(xe,o,l,u,Q,v,w,D,P,T,F,z),!function(be){for(const ze of be)if(0!==ze.positionedGlyphs.length)return!1;return!0}(ge)&&xe}const Qr={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},z_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function V_(a,o,l,u,p,g){if(o.imageName){const v=u[o.imageName];return v?v.displaySize[0]*o.scale*Xr/g+p:0}{const v=l[o.fontStack],w=v&&v.glyphs[a];return w?w.metrics.advance*o.scale+p:0}}function p1(a,o,l,u){const p=Math.pow(a-o,2);return u?a<o?p/2:2*p:p+Math.abs(l)*l}function jC(a,o,l){let u=0;return 10===a&&(u-=1e4),l&&(u+=150),40!==a&&65288!==a||(u+=50),41!==o&&65289!==o||(u+=50),u}function mv(a,o,l,u,p,g){let v=null,w=p1(o,l,p,g);for(const D of u){const T=p1(o-D.x,l,p,g)+D.badness;T<=w&&(v=D,w=T)}return{index:a,x:o,priorBreak:v,badness:w}}function bu(a){return a?bu(a.priorBreak).concat(a.index):[]}function _v(a){let o=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function f1(a,o,l,u,p){if(!(o||l||u||p))return;const g=a.length-1,v=a[g],w=(v.x+v.metrics.advance*v.scale)*o;for(let D=0;D<=g;D++)a[D].x-=w,a[D].y+=l+u+p}function UC(a,o,l){const{horizontalAlign:u,verticalAlign:p}=_v(l),g=o[0]-a.displaySize[0]*u,v=o[1]-a.displaySize[1]*p;return{image:a,top:v,bottom:v+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function j_(a,o,l,u,p,g){const v=a.image;let w;if(v.content){const Q=v.content,ae=v.pixelRatio||1;w=[Q[0]/ae,Q[1]/ae,v.displaySize[0]-Q[2]/ae,v.displaySize[1]-Q[3]/ae]}const D=o.left*g,T=o.right*g;let R,P,F,B;"width"===l||"both"===l?(B=p[0]+D-u[3],P=p[0]+T+u[1]):(B=p[0]+(D+T-v.displaySize[0])/2,P=B+v.displaySize[0]);const z=o.top*g,$=o.bottom*g;return"height"===l||"both"===l?(R=p[1]+z-u[0],F=p[1]+$+u[2]):(R=p[1]+(z+$-v.displaySize[1])/2,F=R+v.displaySize[1]),{image:v,top:R,right:P,bottom:F,left:B,collisionPadding:w}}class aa extends ot{constructor(o,l,u,p,g){super(o,l),this.angle=p,this.z=u,void 0!==g&&(this.segment=g)}clone(){return new aa(this.x,this.y,this.z,this.angle,this.segment)}}function m1(a,o,l,u,p){if(void 0===o.segment)return!0;let g=o,v=o.segment+1,w=0;for(;w>-l/2;){if(v--,v<0)return!1;w-=a[v].dist(g),g=a[v]}w+=a[v].dist(a[v+1]),v++;const D=[];let T=0;for(;w<l/2;){const R=a[v],P=a[v+1];if(!P)return!1;let F=a[v-1].angleTo(R)-R.angleTo(P);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:w,angleDelta:F}),T+=F;w-D[0].distance>u;)T-=D.shift().angleDelta;if(T>p)return!1;v++,w+=R.dist(P)}return!0}function gv(a){let o=0;for(let l=0;l<a.length-1;l++)o+=a[l].dist(a[l+1]);return o}function Ll(a,o,l){return a?.6*o*l:0}function $C(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function xu(a,o,l,u,p,g){const v=Ll(l,p,g),w=$C(l,u)*g;let D=0;const T=gv(a)/2;for(let R=0;R<a.length-1;R++){const P=a[R],F=a[R+1],B=P.dist(F);if(D+B>T){const z=(T-D)/B,$=Ln(P.x,F.x,z),Q=Ln(P.y,F.y,z),ae=new aa($,Q,0,F.angleTo(P),R);return!v||m1(a,ae,w,v,o)?ae:void 0}D+=B}}function yv(a,o,l,u,p,g,v,w,D){const T=Ll(u,g,v),R=$C(u,p),P=R*v,F=0===a[0].x||a[0].x===D||0===a[0].y||a[0].y===D;return o-P<o/4&&(o=P+o/4),_1(a,F?o/2*w%o:(R/2+2*g)*v*w%o,o,T,l,P,F,!1,D)}function _1(a,o,l,u,p,g,v,w,D){const T=g/2,R=gv(a);let P=0,F=o-l,B=[];for(let z=0;z<a.length-1;z++){const $=a[z],Q=a[z+1],ae=$.dist(Q),ve=Q.angleTo($);for(;F+l<P+ae;){F+=l;const le=(F-P)/ae,ge=Ln($.x,Q.x,le),xe=Ln($.y,Q.y,le);if(ge>=0&&ge<D&&xe>=0&&xe<D&&F-T>=0&&F+T<=R){const be=new aa(ge,xe,0,ve,z);be._round(),u&&!m1(a,be,g,u,p)||B.push(be)}}P+=ae}return w||B.length||v||(B=_1(a,P/2,l,u,p,g,v,!0,D)),B}function HC(a,o,l,u,p){const g=[];for(let v=0;v<a.length;v++){const w=a[v];let D;for(let T=0;T<w.length-1;T++){let R=w[T],P=w[T+1];R.x<o&&P.x<o||(R.x<o?R=new ot(o,R.y+(o-R.x)/(P.x-R.x)*(P.y-R.y))._round():P.x<o&&(P=new ot(o,R.y+(o-R.x)/(P.x-R.x)*(P.y-R.y))._round()),R.y<l&&P.y<l||(R.y<l?R=new ot(R.x+(l-R.y)/(P.y-R.y)*(P.x-R.x),l)._round():P.y<l&&(P=new ot(R.x+(l-R.y)/(P.y-R.y)*(P.x-R.x),l)._round()),R.x>=u&&P.x>=u||(R.x>=u?R=new ot(u,R.y+(u-R.x)/(P.x-R.x)*(P.y-R.y))._round():P.x>=u&&(P=new ot(u,R.y+(u-R.x)/(P.x-R.x)*(P.y-R.y))._round()),R.y>=p&&P.y>=p||(R.y>=p?R=new ot(R.x+(p-R.y)/(P.y-R.y)*(P.x-R.x),p)._round():P.y>=p&&(P=new ot(R.x+(p-R.y)/(P.y-R.y)*(P.x-R.x),p)._round()),D&&R.equals(D[D.length-1])||(D=[R],g.push(D)),D.push(P)))))}}return g}Et(aa,"Anchor");const U_=1e20;function Pf(a,o,l,u,p,g,v,w,D){for(let T=o;T<o+u;T++)g1(a,l*g+T,g,p,v,w,D);for(let T=l;T<l+p;T++)g1(a,T*g+o,1,u,v,w,D)}function g1(a,o,l,u,p,g,v){g[0]=0,v[0]=-U_,v[1]=U_,p[0]=a[o];for(let w=1,D=0,T=0;w<u;w++){p[w]=a[o+w*l];const R=w*w;do{const P=g[D];T=(p[w]-p[P]+R-P*P)/(w-P)/2}while(T<=v[D]&&--D>-1);D++,g[D]=w,v[D]=T,v[D+1]=U_}for(let w=0,D=0;w<u;w++){for(;v[D+1]<w;)D++;const T=g[D],R=w-T;a[o+w*l]=p[T]+R*R}}const ks=2,Of={none:0,ideographs:1,all:2};class La{constructor(o,l,u){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,l){const u=[];for(const p in o)for(const g of o[p])u.push({stack:p,id:g});vr(u,({stack:p,id:g},v)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=w.glyphs[g];if(void 0!==D)return void v(null,{stack:p,id:g,glyph:D});if(D=this._tinySDF(w,p,g),D)return w.glyphs[g]=D,void v(null,{stack:p,id:g,glyph:D});const T=Math.floor(g/256);if(256*T>65535)return void v(new Error("glyphs > 65535 not supported"));if(w.ranges[T])return void v(null,{stack:p,id:g,glyph:D});let R=w.requests[T];R||(R=w.requests[T]=[],La.loadGlyphRange(p,T,this.url,this.requestManager,(P,F)=>{if(F){w.ascender=F.ascender,w.descender=F.descender;for(const B in F.glyphs)this._doesCharSupportLocalGlyph(+B)||(w.glyphs[+B]=F.glyphs[+B]);w.ranges[T]=!0}for(const B of R)B(P,F);delete w.requests[T]})),R.push((P,F)=>{P?v(P):F&&v(null,{stack:p,id:g,glyph:F.glyphs[g]||null})})},(p,g)=>{if(p)l(p);else if(g){const v={};for(const{stack:w,id:D,glyph:T}of g)void 0===v[w]&&(v[w]={}),void 0===v[w].glyphs&&(v[w].glyphs={}),v[w].glyphs[D]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},v[w].ascender=this.entries[w].ascender,v[w].descender=this.entries[w].descender;l(null,v)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==Of.none&&(this.localGlyphMode===Of.all?!!this.localFontFamily:!!this.localFontFamily&&(xt["CJK Unified Ideographs"](o)||xt["Hangul Syllables"](o)||xt.Hiragana(o)||xt.Katakana(o)||xt["CJK Symbols and Punctuation"](o)))}_tinySDF(o,l,u){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(u))return;let g=o.tinySDF;if(!g){let $="400";/bold/i.test(l)?$="900":/medium/i.test(l)?$="500":/light/i.test(l)&&($="200"),g=o.tinySDF=new La.TinySDF({fontFamily:p,fontWeight:$,fontSize:24*ks,buffer:3*ks,radius:8*ks}),g.fontWeight=$}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const v=String.fromCharCode(u),{data:w,width:D,height:T,glyphWidth:R,glyphHeight:P,glyphLeft:F,glyphTop:B,glyphAdvance:z}=g.draw(v);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new Nl({width:D,height:T},w),metrics:{width:R/ks,height:P/ks,left:F/ks,top:B/ks-27,advance:z/ks,localGlyph:!0}}}}La.loadGlyphRange=function(a,o,l,u,p){const g=256*o,v=g+255,w=u.transformRequest(u.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${g}-${v}`),qs.Glyphs);Zc(w,(D,T)=>{if(D)p(D);else if(T){const R={},P=new If(T).readFields(bM,{});for(const F of P.glyphs)R[F.id]=F;p(null,{glyphs:R,ascender:P.ascender,descender:P.descender})}})},La.TinySDF=class{constructor({fontSize:a=24,buffer:o=3,radius:l=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:v="normal"}={}){this.buffer=o,this.cutoff=u,this.radius=l;const w=this.size=a+4*o,D=this._createCanvas(w),T=this.ctx=D.getContext("2d",{willReadFrequently:!0});T.font=`${v} ${g} ${a}px ${p}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(a){const o=document.createElement("canvas");return o.width=o.height=a,o}draw(a){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(a),v=Math.ceil(l),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-p))),D=Math.min(this.size-this.buffer,v+Math.ceil(u)),T=w+2*this.buffer,R=D+2*this.buffer,P=Math.max(T*R,0),F=new Uint8ClampedArray(P),B={data:F,width:T,height:R,glyphWidth:w,glyphHeight:D,glyphTop:v,glyphLeft:0,glyphAdvance:o};if(0===w||0===D)return B;const{ctx:z,buffer:$,gridInner:Q,gridOuter:ae}=this;z.clearRect($,$,w,D),z.fillText(a,$,$+v);const ve=z.getImageData($,$,w,D);ae.fill(U_,0,P),Q.fill(0,0,P);for(let le=0;le<D;le++)for(let ge=0;ge<w;ge++){const xe=ve.data[4*(le*w+ge)+3]/255;if(0===xe)continue;const be=(le+$)*T+ge+$;if(1===xe)ae[be]=0,Q[be]=U_;else{const ze=.5-xe;ae[be]=ze>0?ze*ze:0,Q[be]=ze<0?ze*ze:0}}Pf(ae,0,0,T,R,T,this.f,this.v,this.z),Pf(Q,$,$,w,D,T,this.f,this.v,this.z);for(let le=0;le<P;le++){const ge=Math.sqrt(ae[le])-Math.sqrt(Q[le]);F[le]=Math.round(255-255*(ge/this.radius+this.cutoff))}return B}};const gd=To;function $_(a,o,l,u){const p=[],g=a.image,v=g.pixelRatio,w=g.paddedRect.w-2*gd,D=g.paddedRect.h-2*gd,T=a.right-a.left,R=a.bottom-a.top,P=g.stretchX||[[0,w]],F=g.stretchY||[[0,D]],B=($e,Qe)=>$e+Qe[1]-Qe[0],z=P.reduce(B,0),$=F.reduce(B,0),Q=w-z,ae=D-$;let ve=0,le=z,ge=0,xe=$,be=0,ze=Q,Le=0,Ze=ae;if(g.content&&u){const $e=g.content;ve=yd(P,0,$e[0]),ge=yd(F,0,$e[1]),le=yd(P,$e[0],$e[2]),xe=yd(F,$e[1],$e[3]),be=$e[0]-ve,Le=$e[1]-ge,ze=$e[2]-$e[0]-le,Ze=$e[3]-$e[1]-xe}const lt=($e,Qe,Je,it)=>{const st=vd($e.stretch-ve,le,T,a.left),qe=Nf($e.fixed-be,ze,$e.stretch,z),vt=vd(Qe.stretch-ge,xe,R,a.top),St=Nf(Qe.fixed-Le,Ze,Qe.stretch,$),bt=vd(Je.stretch-ve,le,T,a.left),rn=Nf(Je.fixed-be,ze,Je.stretch,z),ut=vd(it.stretch-ge,xe,R,a.top),Nt=Nf(it.fixed-Le,Ze,it.stretch,$),Zt=new ot(st,vt),Pn=new ot(bt,vt),cn=new ot(bt,ut),Gt=new ot(st,ut),ci=new ot(qe/v,St/v),sn=new ot(rn/v,Nt/v),dn=o*Math.PI/180;if(dn){const oi=Math.sin(dn),Un=Math.cos(dn),Ai=[Un,-oi,oi,Un];Zt._matMult(Ai),Pn._matMult(Ai),Gt._matMult(Ai),cn._matMult(Ai)}const ii=$e.stretch+$e.fixed,ri=Qe.stretch+Qe.fixed;return{tl:Zt,tr:Pn,bl:Gt,br:cn,tex:{x:g.paddedRect.x+gd+ii,y:g.paddedRect.y+gd+ri,w:Je.stretch+Je.fixed-ii,h:it.stretch+it.fixed-ri},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ci,pixelOffsetBR:sn,minFontScaleX:ze/v/T,minFontScaleY:Ze/v/R,isSDF:l}};if(u&&(g.stretchX||g.stretchY)){const $e=Ff(P,Q,z),Qe=Ff(F,ae,$);for(let Je=0;Je<$e.length-1;Je++){const it=$e[Je],st=$e[Je+1];for(let qe=0;qe<Qe.length-1;qe++)p.push(lt(it,Qe[qe],st,Qe[qe+1]))}}else p.push(lt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:D+1}));return p}function yd(a,o,l){let u=0;for(const p of a)u+=Math.max(o,Math.min(l,p[1]))-Math.max(o,Math.min(l,p[0]));return u}function Ff(a,o,l){const u=[{fixed:-gd,stretch:0}];for(const[p,g]of a){const v=u[u.length-1];u.push({fixed:p-v.stretch,stretch:v.stretch}),u.push({fixed:p-v.stretch,stretch:v.stretch+(g-p)})}return u.push({fixed:o+gd,stretch:l}),u}function vd(a,o,l,u){return a/o*l+u}function Nf(a,o,l,u){return a-o*l/u}function vv(a,o,l,u){const p=o+a.positionedLines[u].lineOffset;return 0===u?l+p/2:l+(p+(o+a.positionedLines[u-1].lineOffset))/2}class H_{constructor(o=[],l=xM){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:u}=this,p=l[o];for(;o>0;){const g=o-1>>1,v=l[g];if(u(p,v)>=0)break;l[o]=v,o=g}l[o]=p}_down(o){const{data:l,compare:u}=this,p=this.length>>1,g=l[o];for(;o<p;){let v=1+(o<<1),w=l[v];const D=v+1;if(D<this.length&&u(l[D],w)<0&&(v=D,w=l[D]),u(w,g)>=0)break;l[o]=w,o=v}l[o]=g}}function xM(a,o){return a<o?-1:a>o?1:0}function bv(a,o=1,l=!1){let u=1/0,p=1/0,g=-1/0,v=-1/0;const w=a[0];for(let B=0;B<w.length;B++){const z=w[B];(!B||z.x<u)&&(u=z.x),(!B||z.y<p)&&(p=z.y),(!B||z.x>g)&&(g=z.x),(!B||z.y>v)&&(v=z.y)}const D=Math.min(g-u,v-p);let T=D/2;const R=new H_([],Lf);if(0===D)return new ot(u,p);for(let B=u;B<g;B+=D)for(let z=p;z<v;z+=D)R.push(new Yh(B+T,z+T,T,a));let P=function(B){let z=0,$=0,Q=0;const ae=B[0];for(let ve=0,le=ae.length,ge=le-1;ve<le;ge=ve++){const xe=ae[ve],be=ae[ge],ze=xe.x*be.y-be.x*xe.y;$+=(xe.x+be.x)*ze,Q+=(xe.y+be.y)*ze,z+=3*ze}return new Yh($/z,Q/z,0,B)}(a),F=R.length;for(;R.length;){const B=R.pop();(B.d>P.d||!P.d)&&(P=B,l&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,F)),B.max-P.d<=o||(T=B.h/2,R.push(new Yh(B.p.x-T,B.p.y-T,T,a)),R.push(new Yh(B.p.x+T,B.p.y-T,T,a)),R.push(new Yh(B.p.x-T,B.p.y+T,T,a)),R.push(new Yh(B.p.x+T,B.p.y+T,T,a)),F+=4)}return l&&(console.log(`num probes: ${F}`),console.log(`best distance: ${P.d}`)),P.p}function Lf(a,o){return o.max-a.max}class Yh{constructor(o,l,u,p){this.p=new ot(o,l),this.h=u,this.d=function(g,v){let w=!1,D=1/0;for(let T=0;T<v.length;T++){const R=v[T];for(let P=0,F=R.length,B=F-1;P<F;B=P++){const z=R[P],$=R[B];z.y>g.y!=$.y>g.y&&g.x<($.x-z.x)*(g.y-z.y)/($.y-z.y)+z.x&&(w=!w),D=Math.min(D,Ib(g,z,$))}}return(w?1:-1)*Math.sqrt(D)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const wu=7,xv=Number.POSITIVE_INFINITY,GC=Math.sqrt(2);function G_(a,[o,l]){let u=0,p=0;if(l===xv){o<0&&(o=0);const g=o/GC;switch(a){case"top-right":case"top-left":p=g-wu;break;case"bottom-right":case"bottom-left":p=-g+wu;break;case"bottom":p=-o+wu;break;case"top":p=o-wu}switch(a){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=o;break;case"right":u=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),a){case"top-right":case"top-left":case"top":p=l-wu;break;case"bottom-right":case"bottom-left":case"bottom":p=-l+wu}switch(a){case"top-right":case"bottom-right":case"right":u=-o;break;case"top-left":case"bottom-left":case"left":u=o}}return[u,p]}function y1(a,o,l,u,p,g,v,w,D,T){a.createArrays(),a.tilePixelRatio=Bt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const R=a.layers[0].layout,P=a.layers[0]._unevaluatedLayout._values,F={};if("composite"===a.textSizeData.kind){const{minZoom:$,maxZoom:Q}=a.textSizeData;F.compositeTextSizes=[P["text-size"].possiblyEvaluate(new k($),w),P["text-size"].possiblyEvaluate(new k(Q),w)]}if("composite"===a.iconSizeData.kind){const{minZoom:$,maxZoom:Q}=a.iconSizeData;F.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new k($),w),P["icon-size"].possiblyEvaluate(new k(Q),w)]}F.layoutTextSize=P["text-size"].possiblyEvaluate(new k(D+1),w),F.layoutIconSize=P["icon-size"].possiblyEvaluate(new k(D+1),w),F.textMaxSize=P["text-size"].possiblyEvaluate(new k(18),w);const B="map"===R.get("text-rotation-alignment")&&"point"!==R.get("symbol-placement"),z=R.get("text-size");for(const $ of a.features){const Q=R.get("text-font").evaluate($,{},w).join(","),ae=z.evaluate($,{},w),ve=F.layoutTextSize.evaluate($,{},w),le=(F.layoutIconSize.evaluate($,{},w),{horizontal:{},vertical:void 0}),ge=$.text;let xe,be=[0,0];if(ge){const Ze=ge.toString(),lt=R.get("text-letter-spacing").evaluate($,{},w)*Xr,$e=R.get("text-line-height").evaluate($,{},w)*Xr,Qe=Ay(Ze)?lt:0,Je=R.get("text-anchor").evaluate($,{},w),it=R.get("text-variable-anchor");if(!it){const bt=R.get("text-radial-offset").evaluate($,{},w);be=bt?G_(Je,[bt*Xr,xv]):R.get("text-offset").evaluate($,{},w).map(rn=>rn*Xr)}let st=B?"center":R.get("text-justify").evaluate($,{},w);const qe="point"===R.get("symbol-placement"),vt=qe?R.get("text-max-width").evaluate($,{},w)*Xr:1/0,St=bt=>{a.allowVerticalPlacement&&tu(Ze)&&(le.vertical=Zh(ge,o,l,p,Q,vt,$e,Je,bt,Qe,be,Uo.vertical,!0,ve,ae))};if(!B&&it){const bt="auto"===st?it.map(ut=>wv(ut)):[st];let rn=!1;for(let ut=0;ut<bt.length;ut++){const Nt=bt[ut];if(!le.horizontal[Nt])if(rn)le.horizontal[Nt]=le.horizontal[0];else{const Zt=Zh(ge,o,l,p,Q,vt,$e,"center",Nt,Qe,be,Uo.horizontal,!1,ve,ae);Zt&&(le.horizontal[Nt]=Zt,rn=1===Zt.positionedLines.length)}}St("left")}else{if("auto"===st&&(st=wv(Je)),qe||R.get("text-writing-mode").indexOf("horizontal")>=0||!tu(Ze)){const bt=Zh(ge,o,l,p,Q,vt,$e,Je,st,Qe,be,Uo.horizontal,!1,ve,ae);bt&&(le.horizontal[st]=bt)}St(qe?"left":st)}}let ze=!1;if($.icon&&$.icon.name){const Ze=u[$.icon.name];Ze&&(xe=UC(p[$.icon.name],R.get("icon-offset").evaluate($,{},w),R.get("icon-anchor").evaluate($,{},w)),ze=Ze.sdf,void 0===a.sdfIcons?a.sdfIcons=Ze.sdf:a.sdfIcons!==Ze.sdf&&Ei("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ze.pixelRatio!==a.pixelRatio||0!==R.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const Le=W_(le.horizontal)||le.vertical;a.iconsInText||(a.iconsInText=!!Le&&Le.iconsInText),(Le||xe)&&qC(a,$,le,xe,u,F,ve,0,be,ze,v,w,T)}g&&a.generateCollisionDebugBuffers(D,a.collisionBoxArray)}function wv(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qC(a,o,l,u,p,g,v,w,D,T,R,P,F){let B=g.textMaxSize.evaluate(o,{},P);void 0===B&&(B=v);const z=a.layers[0].layout,$=z.get("icon-offset").evaluate(o,{},P),Q=W_(l.horizontal)||l.vertical,ae="globe"===F.name,ve=Xr,le=v/ve,ge=a.tilePixelRatio*B/ve,xe=(Je=a.overscaling,a.zoom>18&&Je>2&&(Je>>=1),Math.max(Bt/(512*Je),1)*z.get("symbol-spacing")),be=z.get("text-padding")*a.tilePixelRatio,ze=z.get("icon-padding")*a.tilePixelRatio,Le=mn(z.get("text-max-angle")),Ze="map"===z.get("text-rotation-alignment")&&"point"!==z.get("symbol-placement"),lt="map"===z.get("icon-rotation-alignment")&&"point"!==z.get("symbol-placement"),$e=z.get("symbol-placement"),Qe=xe/2;var Je;const it=z.get("icon-text-fit");let st;u&&"none"!==it&&(a.allowVerticalPlacement&&l.vertical&&(st=j_(u,l.vertical,it,z.get("icon-text-fit-padding"),$,le)),Q&&(u=j_(u,Q,it,z.get("icon-text-fit-padding"),$,le)));const qe=(vt,St,bt)=>{if(St.x<0||St.x>=Bt||St.y<0||St.y>=Bt)return;let rn=null;if(ae){const{x:ut,y:Nt,z:Zt}=F.projectTilePoint(St.x,St.y,bt);rn={anchor:new aa(ut,Nt,Zt,0,void 0),up:F.upVector(bt,St.x,St.y)}}!function(ut,Nt,Zt,Pn,cn,Gt,ci,sn,dn,ii,ri,oi,Un,Ai,Pi,Vi,si,ir,Ii,Oi,jn,Qi,di,Mo,Ji){const Or=ut.addToLineVertexArray(Nt,Pn);let Dr,mo,Yt,ja,Mc,Xf,Kf,q1=0,W1=0,Z1=0,Y1=0,Eu=-1,ag=-1;const Ua={};let X1=ky("");const tp=Zt?Zt.anchor:Nt;let lg=0,cg=0;if(void 0===dn._unevaluatedLayout.getValue("text-radial-offset")?[lg,cg]=dn.layout.get("text-offset").evaluate(jn,{},Ji).map(ds=>ds*Xr):(lg=dn.layout.get("text-radial-offset").evaluate(jn,{},Ji)*Xr,cg=xv),ut.allowVerticalPlacement&&cn.vertical){const ds=cn.vertical;if(Pi)Xf=Y_(ds),sn&&(Kf=Y_(sn));else{const Ao=dn.layout.get("text-rotate").evaluate(jn,{},Ji)+90;Yt=Z_(ii,tp,Nt,ri,oi,Un,ds,Ai,Ao,Vi),sn&&(ja=Z_(ii,tp,Nt,ri,oi,Un,sn,ir,Ao))}}if(Gt){const ds=dn.layout.get("icon-rotate").evaluate(jn,{},Ji),Ao="none"!==dn.layout.get("icon-text-fit"),Qf=$_(Gt,ds,di,Ao),ca=sn?$_(sn,ds,di,Ao):void 0;mo=Z_(ii,tp,Nt,ri,oi,Un,Gt,ir,ds),q1=4*Qf.length;const ip=ut.iconSizeData;let rr=null;"source"===ip.kind?(rr=[sa*dn.layout.get("icon-size").evaluate(jn,{},Ji)],rr[0]>bd&&Ei(`${ut.layerIds[0]}: Value for "icon-size" is >= ${q_}. Reduce your "icon-size".`)):"composite"===ip.kind&&(rr=[sa*Qi.compositeIconSizes[0].evaluate(jn,{},Ji),sa*Qi.compositeIconSizes[1].evaluate(jn,{},Ji)],(rr[0]>bd||rr[1]>bd)&&Ei(`${ut.layerIds[0]}: Value for "icon-size" is >= ${q_}. Reduce your "icon-size".`)),ut.addSymbols(ut.icon,Qf,rr,Oi,Ii,jn,!1,Zt,Nt,Or.lineStartIndex,Or.lineLength,-1,Mo,Ji),Eu=ut.icon.placedSymbolArray.length-1,ca&&(W1=4*ca.length,ut.addSymbols(ut.icon,ca,rr,Oi,Ii,jn,Uo.vertical,Zt,Nt,Or.lineStartIndex,Or.lineLength,-1,Mo,Ji),ag=ut.icon.placedSymbolArray.length-1)}for(const ds in cn.horizontal){const Ao=cn.horizontal[ds];Dr||(X1=ky(Ao.text),Pi?Mc=Y_(Ao):Dr=Z_(ii,tp,Nt,ri,oi,Un,Ao,Ai,dn.layout.get("text-rotate").evaluate(jn,{},Ji),Vi));const Qf=1===Ao.positionedLines.length;if(Z1+=Bf(ut,Zt,Nt,Ao,ci,dn,Pi,jn,Vi,Or,cn.vertical?Uo.horizontal:Uo.horizontalOnly,Qf?Object.keys(cn.horizontal):[ds],Ua,Eu,Qi,Mo,Ji),Qf)break}cn.vertical&&(Y1+=Bf(ut,Zt,Nt,cn.vertical,ci,dn,Pi,jn,Vi,Or,Uo.vertical,["vertical"],Ua,ag,Qi,Mo,Ji));let Tu=-1;const np=(ds,Ao)=>ds?Math.max(ds,Ao):Ao;Tu=np(Mc,Tu),Tu=np(Xf,Tu),Tu=np(Kf,Tu);const rD=Tu>-1?1:0;ut.glyphOffsetArray.length>=Dc.MAX_GLYPHS&&Ei("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==jn.sortKey&&ut.addToSortKeyRanges(ut.symbolInstances.length,jn.sortKey),ut.symbolInstances.emplaceBack(tp.x,tp.y,tp.z,Nt.x,Nt.y,Ua.right>=0?Ua.right:-1,Ua.center>=0?Ua.center:-1,Ua.left>=0?Ua.left:-1,Ua.vertical>=0?Ua.vertical:-1,Eu,ag,X1,void 0!==Dr?Dr:ut.collisionBoxArray.length,void 0!==Dr?Dr+1:ut.collisionBoxArray.length,void 0!==Yt?Yt:ut.collisionBoxArray.length,void 0!==Yt?Yt+1:ut.collisionBoxArray.length,void 0!==mo?mo:ut.collisionBoxArray.length,void 0!==mo?mo+1:ut.collisionBoxArray.length,ja||ut.collisionBoxArray.length,ja?ja+1:ut.collisionBoxArray.length,ri,Z1,Y1,q1,W1,rD,0,lg,cg,Tu)}(a,St,rn,vt,l,u,p,st,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,be,Ze,D,0,ze,lt,$,o,g,T,R,P)};if("line"===$e)for(const vt of HC(o.geometry,0,0,Bt,Bt)){const St=yv(vt,xe,Le,l.vertical||Q,u,ve,ge,a.overscaling,Bt);for(const bt of St)Q&&Cv(a,Q.text,Qe,bt)||qe(vt,bt,P)}else if("line-center"===$e){for(const vt of o.geometry)if(vt.length>1){const St=xu(vt,Le,l.vertical||Q,u,ve,ge);St&&qe(vt,St,P)}}else if("Polygon"===o.type)for(const vt of jb(o.geometry,0)){const St=bv(vt,16);qe(vt[0],new aa(St.x,St.y,0,0,void 0),P)}else if("LineString"===o.type)for(const vt of o.geometry)qe(vt,new aa(vt[0].x,vt[0].y,0,0,void 0),P);else if("Point"===o.type)for(const vt of o.geometry)for(const St of vt)qe([St],new aa(St.x,St.y,0,0,void 0),P)}const q_=255,bd=q_*sa;function Bf(a,o,l,u,p,g,v,w,D,T,R,P,F,B,z,$,Q){const ae=function(ge,xe,be,ze,Le,Ze,lt,$e){const Qe=[];if(0===xe.positionedLines.length)return Qe;const Je=ze.layout.get("text-rotate").evaluate(Ze,{})*Math.PI/180,it=function(bt){const rn=bt[0],ut=bt[1],Nt=rn*ut;return Nt>0?[rn,-ut]:Nt<0?[-rn,ut]:0===rn?[ut,rn]:[ut,-rn]}(be);let st=Math.abs(xe.top-xe.bottom);for(const bt of xe.positionedLines)st-=bt.lineOffset;const qe=xe.positionedLines.length,vt=st/qe;let St=xe.top-be[1];for(let bt=0;bt<qe;++bt){const rn=xe.positionedLines[bt];St=vv(xe,vt,St,bt);for(const ut of rn.positionedGlyphs){if(!ut.rect)continue;const Nt=ut.rect||{};let Zt=L_+1,Pn=!0,cn=1,Gt=0;if(ut.imageName){const di=lt[ut.imageName];if(!di)continue;if(di.sdf){Ei("SDF images are not supported in formatted text and will be ignored.");continue}Pn=!1,cn=di.pixelRatio,Zt=To/cn}const ci=(Le||$e)&&ut.vertical,sn=ut.metrics.advance*ut.scale/2,dn=ut.metrics,ii=ut.rect;if(null===ii)continue;$e&&xe.verticalizable&&(Gt=ut.imageName?sn-ut.metrics.width*ut.scale/2:0);const ri=Le?[ut.x+sn,ut.y]:[0,0];let oi=[0,0],Un=[0,0],Ai=!1;Le||(ci?(Un=[ut.x+sn+it[0],ut.y+it[1]-Gt],Ai=!0):oi=[ut.x+sn+be[0],ut.y+be[1]-Gt]);const Pi=ii.w*ut.scale/(cn*(ut.localGlyph?ks:1)),Vi=ii.h*ut.scale/(cn*(ut.localGlyph?ks:1));let si,ir,Ii,Oi;if(ci){const di=ut.y-St,Mo=new ot(-sn,sn-di),Ji=-Math.PI/2,Or=new ot(...Un);si=new ot(-sn+oi[0],oi[1]),si._rotateAround(Ji,Mo)._add(Or),si.x+=-di+sn,si.y-=(dn.left-Zt)*ut.scale;const Dr=ut.imageName?dn.advance*ut.scale:Xr*ut.scale,mo=String.fromCharCode(ut.glyph);r1(mo)?si.x+=(1-Zt)*ut.scale:dv(mo)?si.x+=Dr-dn.height*ut.scale+(-Zt-1)*ut.scale:si.x+=ut.imageName||dn.width+2*Zt===ii.w&&dn.height+2*Zt===ii.h?(Dr-Vi)/2:(Dr-(dn.height+2*Zt)*ut.scale)/2,ir=new ot(si.x,si.y-Pi),Ii=new ot(si.x+Vi,si.y),Oi=new ot(si.x+Vi,si.y-Pi)}else{const di=(dn.left-Zt)*ut.scale-sn+oi[0],Mo=(-dn.top-Zt)*ut.scale+oi[1],Ji=di+Pi,Or=Mo+Vi;si=new ot(di,Mo),ir=new ot(Ji,Mo),Ii=new ot(di,Or),Oi=new ot(Ji,Or)}if(Je){let di;di=Le?new ot(0,0):Ai?new ot(it[0],it[1]):new ot(be[0],be[1]),si._rotateAround(Je,di),ir._rotateAround(Je,di),Ii._rotateAround(Je,di),Oi._rotateAround(Je,di)}const jn=new ot(0,0),Qi=new ot(0,0);Qe.push({tl:si,tr:ir,bl:Ii,br:Oi,tex:Nt,writingMode:xe.writingMode,glyphOffset:ri,sectionIndex:ut.sectionIndex,isSDF:Pn,pixelOffsetTL:jn,pixelOffsetBR:Qi,minFontScaleX:0,minFontScaleY:0})}}return Qe}(0,u,D,g,v,w,p,a.allowVerticalPlacement),ve=a.textSizeData;let le=null;"source"===ve.kind?(le=[sa*g.layout.get("text-size").evaluate(w,{},Q)],le[0]>bd&&Ei(`${a.layerIds[0]}: Value for "text-size" is >= ${q_}. Reduce your "text-size".`)):"composite"===ve.kind&&(le=[sa*z.compositeTextSizes[0].evaluate(w,{},Q),sa*z.compositeTextSizes[1].evaluate(w,{},Q)],(le[0]>bd||le[1]>bd)&&Ei(`${a.layerIds[0]}: Value for "text-size" is >= ${q_}. Reduce your "text-size".`)),a.addSymbols(a.text,ae,le,D,v,w,R,o,l,T.lineStartIndex,T.lineLength,B,$,Q);for(const ge of P)F[ge]=a.text.placedSymbolArray.length-1;return 4*ae.length}function W_(a){for(const o in a)return a[o];return null}function Z_(a,o,l,u,p,g,v,w,D,T){let R=v.top,P=v.bottom,F=v.left,B=v.right;const z=v.collisionPadding;if(z&&(F-=z[0],R-=z[1],B+=z[2],P+=z[3]),D){const $=new ot(F,R),Q=new ot(B,R),ae=new ot(F,P),ve=new ot(B,P),le=mn(D);let ge=new ot(0,0);T&&(ge=new ot(T[0],T[1])),$._rotateAround(le,ge),Q._rotateAround(le,ge),ae._rotateAround(le,ge),ve._rotateAround(le,ge),F=Math.min($.x,Q.x,ae.x,ve.x),B=Math.max($.x,Q.x,ae.x,ve.x),R=Math.min($.y,Q.y,ae.y,ve.y),P=Math.max($.y,Q.y,ae.y,ve.y)}return a.emplaceBack(o.x,o.y,o.z,l.x,l.y,F,R,B,P,w,u,p,g),a.length-1}function Y_(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const o=a.bottom-a.top;return o>0?Math.max(10,o):null}function Cv(a,o,l,u){const p=a.compareText;if(o in p){const g=p[o];for(let v=g.length-1;v>=0;v--)if(u.dist(g[v])<l)return!0}else p[o]=[];return p[o].push(u),!1}function zf(a,o){const l=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*o:0,p=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),g=Math.sin(l)*p/Math.sin(Math.max(Math.PI/2-a._pitch-l,.01)),v=Math.sin(a._pitch)*g+p;return Math.min(1.01*v,p*(1/a._horizonShift))}function Cu(a,o){if(!o.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:o};const l=Math.pow(2,-a.z),u=a.x*l,p=(a.x+1)*l,g=a.y*l,v=(a.y+1)*l,w=ss(u),D=ss(p),T=ho(g),R=ho(v),P=o.project(w,T),F=o.project(D,T),B=o.project(D,R),z=o.project(w,R);let $=Math.min(P.x,F.x,B.x,z.x),Q=Math.min(P.y,F.y,B.y,z.y),ae=Math.max(P.x,F.x,B.x,z.x),ve=Math.max(P.y,F.y,B.y,z.y);const le=l/16;function ge(be,ze,Le,Ze,lt,$e){const Qe=(Le+lt)/2,Je=(Ze+$e)/2,it=o.project(ss(Qe),ho(Je)),st=Math.max(0,$-it.x,Q-it.y,it.x-ae,it.y-ve);$=Math.min($,it.x),ae=Math.max(ae,it.x),Q=Math.min(Q,it.y),ve=Math.max(ve,it.y),st>le&&(ge(be,it,Le,Ze,Qe,Je),ge(it,ze,Qe,Je,lt,$e))}ge(P,F,u,g,p,g),ge(F,B,p,g,p,v),ge(B,z,p,v,u,v),ge(z,P,u,v,u,g),$-=le,Q-=le,ae+=le,ve+=le;const xe=1/Math.max(ae-$,ve-Q);return{scale:xe,x:$*xe,y:Q*xe,x2:ae*xe,y2:ve*xe,projection:o}}const v1=ra(new Float32Array(16));class xd{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new Zn(0,0)}projectTilePoint(o,l,u){return{x:o,y:l,z:0}}locationPoint(o,l,u=!0){return o._coordinatePoint(o.locationCoordinate(l),u)}pixelsPerMeter(o,l){return Pl(1,o)*l}pixelSpaceConversion(o,l,u){return 1}farthestPixelDistance(o){return zf(o,o.pixelsPerMeter)}pointCoordinate(o,l,u,p){const g=o.horizonLineFromTop(!1),v=new ot(l,Math.max(g,u));return o.rayIntersectionCoordinate(o.pointRayIntersection(v,p))}pointCoordinate3D(o,l,u){const p=new ot(l,u);if(o.elevation)return o.elevation.pointCoordinate(p);{const g=this.pointCoordinate(o,p.x,p.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(o,l){if(o.elevation)return!this.pointCoordinate3D(o,l.x,l.y);const u=o.horizonLineFromTop();return l.y<u}createInversionMatrix(o,l){return v1}createTileMatrix(o,l,u){let p,g,v;const w=u.canonical,D=ra(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=Cu(w,this);p=1,g=T.x+u.wrap*T.scale,v=T.y,au(D,D,[p/T.scale,p/T.scale,o.pixelsPerMeter/l])}else p=l/o.zoomScale(w.z),g=(w.x+Math.pow(2,w.z)*u.wrap)*p,v=w.y*p;return Ch(D,D,[g,v,0]),au(D,D,[p/Bt,p/Bt,1]),D}upVector(o,l,u){return[0,0,1]}upVectorScale(o,l,u){return{metersToTile:1}}}class b1 extends xd{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,u]=this.parallels=o.parallels||[29.5,45.5],p=Math.sin(mn(l));this.n=(p+Math.sin(mn(u)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:u,c:p,r0:g}=this,v=mn(o-this.center[0]),w=mn(l),D=Math.sqrt(p-2*u*Math.sin(w))/u;return{x:D*Math.sin(v*u),y:D*Math.cos(v*u)-g,z:0}}unproject(o,l){const{n:u,c:p,r0:g}=this,v=g+l;let w=Math.atan2(o,Math.abs(v))*Math.sign(v);v*u<0&&(w-=Math.PI*Math.sign(o)*Math.sign(v));const D=mn(this.center[0])*u;w=lr(w,-Math.PI-D,Math.PI-D);const T=hn(yr(w/u)+this.center[0],-180,180),R=Math.asin(hn((p-(o*o+v*v)*u*u)/(2*u),-1,1)),P=hn(yr(R),-Yr,Yr);return new Zn(T,P)}}const X_=1.340264,Vf=-.081106,Bl=893e-6,jf=.003796,Cc=Math.sqrt(3)/2;class Tn extends xd{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const u=Math.asin(Cc*Math.sin(l)),p=u*u,g=p*p*p;return{x:.5*(o*Math.cos(u)/(Cc*(X_+3*Vf*p+g*(7*Bl+9*jf*p)))/Math.PI+.5),y:1-.5*(u*(X_+Vf*p+g*(Bl+jf*p))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,p=u*u,g=p*p*p;for(let R,P,F,B=0;B<12&&(P=u*(X_+Vf*p+g*(Bl+jf*p))-l,F=X_+3*Vf*p+g*(7*Bl+9*jf*p),R=P/F,u=hn(u-R,-Math.PI/3,Math.PI/3),p=u*u,g=p*p*p,!(Math.abs(R)<1e-12));++B);const v=Cc*o*(X_+3*Vf*p+g*(7*Bl+9*jf*p))/Math.cos(u),w=Math.asin(Math.sin(u)/Cc),D=hn(180*v/Math.PI,-180,180),T=hn(180*w/Math.PI,-Yr,Yr);return new Zn(D,T)}}class WC extends xd{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const u=360*(o-.5),p=hn(360*(.5-l),-Yr,Yr);return new Zn(u,p)}}const Ba=Math.PI/2;function po(a){return Math.tan((Ba+a)/2)}class ZC extends xd{constructor(o){super(o),this.center=o.center||[0,30];const[l,u]=this.parallels=o.parallels||[30,30];let p=mn(l),g=mn(u);this.southernCenter=p+g<0,this.southernCenter&&(p=-p,g=-g);const v=Math.cos(p),w=po(p);this.n=p===g?Math.sin(p):Math.log(v/Math.cos(g))/Math.log(po(g)/w),this.f=v*Math.pow(po(p),this.n)/this.n}project(o,l){l=mn(l),this.southernCenter&&(l=-l),o=mn(o-this.center[0]);const u=1e-6,{n:p,f:g}=this;g>0?l<-Ba+u&&(l=-Ba+u):l>Ba-u&&(l=Ba-u);const v=g/Math.pow(po(l),p);let w=v*Math.sin(p*o),D=g-v*Math.cos(p*o);return w=.5*(w/Math.PI+.5),D=.5*(D/Math.PI+.5),{x:w,y:this.southernCenter?D:1-D,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:u,f:p}=this,g=p-l,v=Math.sign(g),w=Math.sign(u)*Math.sqrt(o*o+g*g);let D=Math.atan2(o,Math.abs(g))*v;g*u<0&&(D-=Math.PI*Math.sign(o)*v);const T=hn(yr(D/u)+this.center[0],-180,180),R=hn(yr(2*Math.atan(Math.pow(p/w,1/u))-Ba),-Yr,Yr);return new Zn(T,this.southernCenter?-R:R)}}class x1 extends xd{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:kl(o),y:Fa(l),z:0}}unproject(o,l){const u=ss(o),p=ho(l);return new Zn(u,p)}}const wd=mn(Yr);class YC extends xd{project(o,l){const u=(l=mn(l))*l,p=u*u;return{x:.5*((o=mn(o))*(.8707-.131979*u+p*(p*(.003971*u-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+u*(.015085+p*(.028874*u-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,p=25,g=0,v=u*u;do{v=u*u;const T=v*v;g=(u*(1.007226+v*(.015085+T*(.028874*v-.044475-.005916*T)))-l)/(1.007226+v*(.045255+T*(.259866*v-.311325-.005916*11*T))),u=hn(u-g,-wd,wd)}while(Math.abs(g)>1e-6&&--p>0);v=u*u;const w=hn(yr(o/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),D=yr(u);return new Zn(w,D)}}const K_=mn(Yr);class wM extends xd{project(o,l){l=mn(l),o=mn(o);const u=Math.cos(l),p=2/Math.PI,g=Math.acos(u*Math.cos(o/2)),v=Math.sin(g)/g,w=.5*(o*p+2*u*Math.sin(o/2)/v)||0,D=.5*(l+Math.sin(l)/v)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(D/Math.PI+1),z:0}}unproject(o,l){let u=o=(2*o-.5)*Math.PI,p=l=(2*(1-l)-1)*Math.PI,g=25;const v=1e-6;let w=0,D=0;do{const T=Math.cos(p),R=Math.sin(p),P=2*R*T,F=R*R,B=T*T,z=Math.cos(u/2),$=Math.sin(u/2),Q=2*z*$,ae=$*$,ve=1-B*z*z,le=ve?1/ve:0,ge=ve?Math.acos(T*z)*Math.sqrt(1/ve):0,xe=.5*(2*ge*T*$+2*u/Math.PI)-o,be=.5*(ge*R+p)-l,ze=.5*le*(B*ae+ge*T*z*F)+1/Math.PI,Le=le*(Q*P/4-ge*R*$),Ze=.125*le*(P*$-ge*R*B*Q),lt=.5*le*(F*z+ge*ae*T)+.5,$e=Le*Ze-lt*ze;w=(be*Le-xe*lt)/$e,D=(xe*Ze-be*ze)/$e,u=hn(u-w,-Math.PI,Math.PI),p=hn(p-D,-K_,K_)}while((Math.abs(w)>v||Math.abs(D)>v)&&--g>0);return new Zn(yr(u),yr(p))}}class Q_ extends xd{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(mn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:u,cosPhi:p}=this;return{x:mn(o)*p*u+.5,y:-Math.sin(mn(l))/p*u+.5,z:0}}unproject(o,l){const{scale:u,cosPhi:p}=this,g=-(l-.5)/u,v=hn(yr((o-.5)/u)/p,-180,180),w=Math.asin(hn(g*p,-1,1)),D=hn(yr(w),-Yr,Yr);return new Zn(v,D)}}class w1 extends x1{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,u){const p=hu(o,l,u);return yi(p,p,uf(Ml(u))),{x:p[0],y:p[1],z:p[2]}}locationPoint(o,l){const u=uu(l.lat,l.lng),p=hr([],u),g=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude;Dl(u,u,p,Pl(1,0)*Bt*g);const v=ra(new Float64Array(16));return dd(v,o.pixelMatrix,o.globeMatrix),yi(u,u,v),new ot(u[0],u[1])}pixelsPerMeter(o,l){return Pl(1,0)*l}pixelSpaceConversion(o,l,u){const p=Pl(1,o)*l,g=Ln(Pl(1,45)*l,p,u);return this.pixelsPerMeter(o,l)/g}createTileMatrix(o,l,u){const p=By(Ml(u.canonical));return dd(new Float64Array(16),o.globeMatrix,p)}createInversionMatrix(o,l){const{center:u}=o,p=uf(Ml(l));return Cl(p,p,mn(u.lng)),Dh(p,p,mn(u.lat)),au(p,p,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(o,l,u,p){return bb(o,l,u,!0)||new pf(0,0)}pointCoordinate3D(o,l,u){const p=this.pointCoordinate(o,l,u,0);return[p.x,p.y,p.z]}isPointAboveHorizon(o,l){return!bb(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(p,g){const v=p.cameraToCenterDistance,w=p._centerAltitude*g,D=p._camera,T=p._camera.forward(),R=mi([],Zr([],T,-v),[0,0,w]),P=p.worldSize/(2*Math.PI),F=[0,0,-P],B=p.width/p.height,z=Math.tan(p.fovAboveCenter),$=Zr([],D.up(),z),Q=Zr([],D.right(),z*B),ae=hr([],mi([],mi([],T,$),Q)),ve=[];let le;if(new d_(R,ae).closestPointOnSphere(F,P,ve)){const ge=mi([],ve,F),xe=El([],ge,R);le=Math.cos(p.fovAboveCenter)*Pr(xe)}else{const ge=El([],R,F),xe=El([],F,R);hr(xe,xe);const be=Pr(ge)-P;le=Math.sqrt(be*(be+2*P));const ze=Math.acos(le/(P+be))-Math.acos(Ms(T,xe));le*=Math.cos(ze)}return 1.01*le}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),u=Rl(o.zoom);if(u>0){const p=zf(o,Pl(1,o.center.lat)*o.worldSize),g=o.worldSize/(2*Math.PI),v=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Ln(l,p+g*(1-Math.cos(v)),Math.pow(u,10))}return l}upVector(o,l,u){return hu(l,u,o,1)}upVectorScale(o){return{metersToTile:u_(pu(Ml(o)))}}}function C1(a){const o=a.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(a.name){case"mercator":return new x1(a);case"equirectangular":return new WC(a);case"naturalEarth":return new YC(a);case"equalEarth":return new Tn(a);case"winkelTripel":return new wM(a);case"albers":return l?new Q_(a):new b1(a);case"lambertConformalConic":return l?new Q_(a):new ZC(a);case"globe":return new w1(a)}throw new Error(`Invalid projection name: ${a.name}`)}const XC=Vh.types,D1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function J_(a,o,l,u,p,g,v,w,D,T,R,P,F){const B=w?Math.min(bd,Math.round(w[0])):0,z=w?Math.min(bd,Math.round(w[1])):0;a.emplaceBack(o,l,Math.round(32*u),Math.round(32*p),g,v,(B<<1)+(D?1:0),z,16*T,16*R,256*P,256*F)}function Uf(a,o,l,u,p,g,v){a.emplaceBack(o,l,u,p,g,v)}function eg(a,o,l,u,p){a.emplaceBack(o,l,u,p),a.emplaceBack(o,l,u,p),a.emplaceBack(o,l,u,p),a.emplaceBack(o,l,u,p)}function KC(a){for(const o of a.sections)if(_h(o.text))return!0;return!1}class E1{constructor(o){this.layoutVertexArray=new tt,this.indexArray=new Ot,this.programConfigurations=o,this.segments=new Xi,this.dynamicLayoutVertexArray=new et,this.opacityVertexArray=new Tt,this.placedSymbolArray=new zi,this.globeExtVertexArray=new dt}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,l,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,t1.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,mM.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,D1,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,fM.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Et(E1,"SymbolBuffers");class tg{constructor(o,l,u){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new u,this.segments=new Xi,this.collisionVertexArray=new Jt,this.collisionVertexArrayExt=new wn}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,_M.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,lv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Et(tg,"CollisionBuffers");class Dc{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(v=>v.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ra([]),this.placementViewportMatrix=ra([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=cv(this.zoom,l["text-size"]),this.iconSizeData=cv(this.zoom,l["icon-size"]);const u=this.layers[0].layout,p=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==p.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(v=>Uo[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new E1(new Pa(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new E1(new Pa(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new Co,this.lineVertexArray=new yh,this.symbolInstances=new ai}calculateGlyphDependencies(o,l,u,p,g){for(let v=0;v<o.length;v++)if(l[o.charCodeAt(v)]=!0,p&&g){const w=md[o.charAt(v)];w&&(l[w.charCodeAt(0)]=!0)}}populate(o,l,u,p){const g=this.layers[0],v=g.layout,w="globe"===this.projection.name,D=v.get("text-font"),T=v.get("text-field"),R=v.get("icon-image"),P=("constant"!==T.value.kind||T.value.value instanceof bo&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&("constant"!==D.value.kind||D.value.value.length>0),F="constant"!==R.value.kind||!!R.value.value||Object.keys(R.parameters).length>0,B=v.get("symbol-sort-key");if(this.features=[],!P&&!F)return;const z=l.iconDependencies,$=l.glyphDependencies,Q=l.availableImages,ae=new k(this.zoom);for(const{feature:ve,id:le,index:ge,sourceLayerIndex:xe}of o){const be=g._featureFilter.needGeometry,ze=Ol(ve,be);if(!g._featureFilter.filter(ae,ze,u))continue;if(be||(ze.geometry=yc(ve,u,p)),w&&1!==ve.type&&u.z<=5){const $e=ze.geometry,Qe=.98078528056,Je=(it,st)=>Ms(hu(it.x,it.y,u,1),hu(st.x,st.y,u,1))<Qe;for(let it=0;it<$e.length;it++)$e[it]=hM($e[it],Je)}let Le,Ze;if(P){const $e=g.getValueAndResolveTokens("text-field",ze,u,Q),Qe=bo.factory($e);KC(Qe)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===C()||this.hasRTLText&&M.isParsed())&&(Le=n1(Qe,g,ze))}if(F){const $e=g.getValueAndResolveTokens("icon-image",ze,u,Q);Ze=$e instanceof xo?$e:xo.fromString($e)}if(!Le&&!Ze)continue;const lt=this.sortFeaturesByKey?B.evaluate(ze,{},u):void 0;if(this.features.push({id:le,text:Le,icon:Ze,index:ge,sourceLayerIndex:xe,geometry:ze.geometry,properties:ve.properties,type:XC[ve.type],sortKey:lt}),Ze&&(z[Ze.name]=!0),Le){const $e=D.evaluate(ze,{},u).join(","),Qe="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Uo.vertical)>=0;for(const Je of Le.sections)if(Je.image)z[Je.image.name]=!0;else{const it=tu(Le.toString()),st=Je.fontStack||$e,qe=$[st]=$[st]||{};this.calculateGlyphDependencies(Je.text,qe,Qe,this.allowVerticalPlacement,it)}}}"line"===v.get("symbol-placement")&&(this.features=function(ve){const le={},ge={},xe=[];let be=0;function ze($e){xe.push(ve[$e]),be++}function Le($e,Qe,Je){const it=ge[$e];return delete ge[$e],ge[Qe]=it,xe[it].geometry[0].pop(),xe[it].geometry[0]=xe[it].geometry[0].concat(Je[0]),it}function Ze($e,Qe,Je){const it=le[Qe];return delete le[Qe],le[$e]=it,xe[it].geometry[0].shift(),xe[it].geometry[0]=Je[0].concat(xe[it].geometry[0]),it}function lt($e,Qe,Je){const it=Je?Qe[0][Qe[0].length-1]:Qe[0][0];return`${$e}:${it.x}:${it.y}`}for(let $e=0;$e<ve.length;$e++){const Qe=ve[$e],Je=Qe.geometry,it=Qe.text?Qe.text.toString():null;if(!it){ze($e);continue}const st=lt(it,Je),qe=lt(it,Je,!0);if(st in ge&&qe in le&&ge[st]!==le[qe]){const vt=Ze(st,qe,Je),St=Le(st,qe,xe[vt].geometry);delete le[st],delete ge[qe],ge[lt(it,xe[St].geometry,!0)]=St,xe[vt].geometry=null}else st in ge?Le(st,qe,Je):qe in le?Ze(st,qe,Je):(ze($e),le[st]=be-1,ge[qe]=be-1)}return xe.filter($e=>$e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ve,le)=>ve.sortKey-le.sortKey)}update(o,l,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,l,this.layers,u,p),this.icon.programConfigurations.updatePaintArrays(o,l,this.layers,u,p))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=C1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const u=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:p,y:g}of l)this.lineVertexArray.emplaceBack(p,g);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(o,l,u,p,g,v,w,D,T,R,P,F,B,z){const $=o.indexArray,Q=o.layoutVertexArray,ae=o.globeExtVertexArray,ve=o.segments.prepareSegment(4*l.length,Q,$,this.canOverlap?v.sortKey:void 0),le=this.glyphOffsetArray.length,ge=ve.vertexLength,xe=this.allowVerticalPlacement&&w===Uo.vertical?Math.PI/2:0,be=v.text&&v.text.sections;for(let Le=0;Le<l.length;Le++){const{tl:Ze,tr:lt,bl:$e,br:Qe,tex:Je,pixelOffsetTL:it,pixelOffsetBR:st,minFontScaleX:qe,minFontScaleY:vt,glyphOffset:St,isSDF:bt,sectionIndex:rn}=l[Le],ut=ve.vertexLength,Nt=St[1];if(J_(Q,T.x,T.y,Ze.x,Nt+Ze.y,Je.x,Je.y,u,bt,it.x,it.y,qe,vt),J_(Q,T.x,T.y,lt.x,Nt+lt.y,Je.x+Je.w,Je.y,u,bt,st.x,it.y,qe,vt),J_(Q,T.x,T.y,$e.x,Nt+$e.y,Je.x,Je.y+Je.h,u,bt,it.x,st.y,qe,vt),J_(Q,T.x,T.y,Qe.x,Nt+Qe.y,Je.x+Je.w,Je.y+Je.h,u,bt,st.x,st.y,qe,vt),D){const{x:Zt,y:Pn,z:cn}=D.anchor,[Gt,ci,sn]=D.up;Uf(ae,Zt,Pn,cn,Gt,ci,sn),Uf(ae,Zt,Pn,cn,Gt,ci,sn),Uf(ae,Zt,Pn,cn,Gt,ci,sn),Uf(ae,Zt,Pn,cn,Gt,ci,sn),eg(o.dynamicLayoutVertexArray,Zt,Pn,cn,xe)}else eg(o.dynamicLayoutVertexArray,T.x,T.y,T.z,xe);$.emplaceBack(ut,ut+1,ut+2),$.emplaceBack(ut+1,ut+2,ut+3),ve.vertexLength+=4,ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),Le!==l.length-1&&rn===l[Le+1].sectionIndex||o.programConfigurations.populatePaintArrays(Q.length,v,v.index,{},B,z,be&&be[rn])}const ze=D?D.anchor:T;o.placedSymbolArray.emplaceBack(ze.x,ze.y,ze.z,T.x,T.y,le,this.glyphOffsetArray.length-le,ge,R,P,T.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],w,0,!1,0,F,0)}_commitLayoutVertex(o,l,u,p,g,v,w){o.emplaceBack(l,u,p,g,v,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(o,l,u,p,g,v,w){const D=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),T=D.vertexLength,R=w.tileAnchorX,P=w.tileAnchorY;for(let B=0;B<4;B++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(l,-o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(l,o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(l,o.padding,o.padding),u.collisionVertexArrayExt.emplaceBack(l,-o.padding,o.padding),this._commitLayoutVertex(u.layoutVertexArray,p,g,v,R,P,new ot(o.x1,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,g,v,R,P,new ot(o.x2,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,g,v,R,P,new ot(o.x2,o.y2)),this._commitLayoutVertex(u.layoutVertexArray,p,g,v,R,P,new ot(o.x1,o.y2)),D.vertexLength+=4;const F=u.indexArray;F.emplaceBack(T,T+1),F.emplaceBack(T+1,T+2),F.emplaceBack(T+2,T+3),F.emplaceBack(T+3,T),D.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,u,p,g,v){for(let w=p;w<g;w++){const D=u.get(w),T=this.getSymbolInstanceTextSize(o,v,l,w);this._addCollisionDebugVertices(D,T,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(o,l,u,p,g,v){for(let w=p;w<g;w++){const D=u.get(w),T=this.getSymbolInstanceIconSize(o,l,v.placedIconSymbolIndex);this._addCollisionDebugVertices(D,T,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,v)}}generateCollisionDebugBuffers(o,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new tg(Mt,F_.members,nr),this.iconCollisionBox=new tg(Mt,F_.members,nr);const u=$h(this.iconSizeData,o),p=$h(this.textSizeData,o);for(let g=0;g<this.symbolInstances.length;g++){const v=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(p,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(p,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(o,l,u,p){const g=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:p),v=N_(this.textSizeData,o,g)/Xr;return this.tilePixelRatio*v}getSymbolInstanceIconSize(o,l,u){const p=this.icon.placedSymbolArray.get(u),g=N_(this.iconSizeData,o,p);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(o,l,u){o.emplaceBack(l,-u,-u),o.emplaceBack(l,u,-u),o.emplaceBack(l,u,u),o.emplaceBack(l,-u,u)}_updateTextDebugCollisionBoxes(o,l,u,p,g,v){for(let w=p;w<g;w++){const D=u.get(w),T=this.getSymbolInstanceTextSize(o,v,l,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,D.padding)}}_updateIconDebugCollisionBoxes(o,l,u,p,g,v){for(let w=p;w<g;w++){const D=u.get(w),T=this.getSymbolInstanceIconSize(o,l,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,D.padding)}}updateCollisionDebugBuffers(o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=$h(this.iconSizeData,o),p=$h(this.textSizeData,o);for(let g=0;g<this.symbolInstances.length;g++){const v=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(p,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(p,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(u,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,u,p,g,v,w,D,T){const R={};if(l<u){const{x1:P,y1:F,x2:B,y2:z,padding:$,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:ve,tileAnchorX:le,tileAnchorY:ge,featureIndex:xe}=o.get(l);R.textBox={x1:P,y1:F,x2:B,y2:z,padding:$,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:ve,tileAnchorX:le,tileAnchorY:ge},R.textFeatureIndex=xe}if(p<g){const{x1:P,y1:F,x2:B,y2:z,padding:$,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:ve,tileAnchorX:le,tileAnchorY:ge,featureIndex:xe}=o.get(p);R.verticalTextBox={x1:P,y1:F,x2:B,y2:z,padding:$,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:ve,tileAnchorX:le,tileAnchorY:ge},R.verticalTextFeatureIndex=xe}if(v<w){const{x1:P,y1:F,x2:B,y2:z,padding:$,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:ve,tileAnchorX:le,tileAnchorY:ge,featureIndex:xe}=o.get(v);R.iconBox={x1:P,y1:F,x2:B,y2:z,padding:$,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:ve,tileAnchorX:le,tileAnchorY:ge},R.iconFeatureIndex=xe}if(D<T){const{x1:P,y1:F,x2:B,y2:z,padding:$,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:ve,tileAnchorX:le,tileAnchorY:ge,featureIndex:xe}=o.get(D);R.verticalIconBox={x1:P,y1:F,x2:B,y2:z,padding:$,projectedAnchorX:Q,projectedAnchorY:ae,projectedAnchorZ:ve,tileAnchorX:le,tileAnchorY:ge},R.verticalIconFeatureIndex=xe}return R}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,l){const u=o.placedSymbolArray.get(l),p=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<p;g+=4)o.indexArray.emplaceBack(g,g+1,g+2),o.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(o),u=Math.cos(o),p=[],g=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const D=this.symbolInstances.get(w);p.push(0|Math.round(l*D.tileAnchorX+u*D.tileAnchorY)),g.push(D.featureIndex)}return v.sort((w,D)=>p[w]-p[D]||g[D]-g[w]),v}addToSortKeyRanges(o,l){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===l?u.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const u=this.symbolInstances.get(l);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:T}=u;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&v!==g&&v!==p&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Et(Dc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Dc.MAX_GLYPHS=65535,Dc.addDynamicAttributes=eg;const pr=new he({"symbol-placement":new U(We.layout_symbol["symbol-placement"]),"symbol-spacing":new U(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new U(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new J(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new U(We.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new U(We.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new U(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new U(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new U(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new J(We.layout_symbol["icon-size"]),"icon-text-fit":new U(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new U(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new J(We.layout_symbol["icon-image"]),"icon-rotate":new J(We.layout_symbol["icon-rotate"]),"icon-padding":new U(We.layout_symbol["icon-padding"]),"icon-keep-upright":new U(We.layout_symbol["icon-keep-upright"]),"icon-offset":new J(We.layout_symbol["icon-offset"]),"icon-anchor":new J(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new U(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new U(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new U(We.layout_symbol["text-rotation-alignment"]),"text-field":new J(We.layout_symbol["text-field"]),"text-font":new J(We.layout_symbol["text-font"]),"text-size":new J(We.layout_symbol["text-size"]),"text-max-width":new J(We.layout_symbol["text-max-width"]),"text-line-height":new J(We.layout_symbol["text-line-height"]),"text-letter-spacing":new J(We.layout_symbol["text-letter-spacing"]),"text-justify":new J(We.layout_symbol["text-justify"]),"text-radial-offset":new J(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new U(We.layout_symbol["text-variable-anchor"]),"text-anchor":new J(We.layout_symbol["text-anchor"]),"text-max-angle":new U(We.layout_symbol["text-max-angle"]),"text-writing-mode":new U(We.layout_symbol["text-writing-mode"]),"text-rotate":new J(We.layout_symbol["text-rotate"]),"text-padding":new U(We.layout_symbol["text-padding"]),"text-keep-upright":new U(We.layout_symbol["text-keep-upright"]),"text-transform":new J(We.layout_symbol["text-transform"]),"text-offset":new J(We.layout_symbol["text-offset"]),"text-allow-overlap":new U(We.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new U(We.layout_symbol["text-ignore-placement"]),"text-optional":new U(We.layout_symbol["text-optional"])});var $f={paint:new he({"icon-opacity":new J(We.paint_symbol["icon-opacity"]),"icon-color":new J(We.paint_symbol["icon-color"]),"icon-halo-color":new J(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new J(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new J(We.paint_symbol["icon-halo-blur"]),"icon-translate":new U(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new U(We.paint_symbol["icon-translate-anchor"]),"text-opacity":new J(We.paint_symbol["text-opacity"]),"text-color":new J(We.paint_symbol["text-color"],{runtimeType:Ur,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new J(We.paint_symbol["text-halo-color"]),"text-halo-width":new J(We.paint_symbol["text-halo-width"]),"text-halo-blur":new J(We.paint_symbol["text-halo-blur"]),"text-translate":new U(We.paint_symbol["text-translate"]),"text-translate-anchor":new U(We.paint_symbol["text-translate-anchor"])}),layout:pr};class T1{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Nd,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Et(T1,"FormatSectionOverride",{omit:["defaultValue"]});class Dv extends ia{constructor(o){super(o,$f)}recalculate(o,l){super.recalculate(o,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const p=[];for(const g of u)p.indexOf(g)<0&&p.push(g);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,l,u,p){const g=this.layout.get(o).evaluate(l,{},u,p),v=this._unevaluatedLayout._values[o];return v.isDataDriven()||sd(v.value)||!g?g:(w=l.properties,g.replace(/{([^{}]+)}/g,(T,R)=>R in w?String(w[R]):""));var w}createBucket(o){return new Dc(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of $f.paint.overridableProperties){if(!Dv.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),u=new T1(l),p=new od(u,l.property.specification);let g=null;g="constant"===l.value.kind||"source"===l.value.kind?new Km("source",p):new Wd("composite",p,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new ie(l.property,g,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,u){return!(!this.layout||l.isDataDriven()||u.isDataDriven())&&Dv.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const u=o.get("text-field"),p=$f.paint.properties[l];let g=!1;const v=w=>{for(const D of w)if(p.overrides&&p.overrides.hasOverride(D))return void(g=!0)};if("constant"===u.value.kind&&u.value.value instanceof bo)v(u.value.value.sections);else if("source"===u.value.kind){const w=T=>{g||(T instanceof bs&&Bi(T.value)===sl?v(T.value.sections):T instanceof al?v(T.sections):T.eachChild(w))},D=u.value;D._styleExpression&&w(D._styleExpression.expression)}return g}getProgramConfiguration(o){return new bl(this,o)}}var S1={paint:new he({"background-color":new U(We.paint_background["background-color"]),"background-pattern":new U(We.paint_background["background-pattern"]),"background-opacity":new U(We.paint_background["background-opacity"])})},QC={paint:new he({"raster-opacity":new U(We.paint_raster["raster-opacity"]),"raster-hue-rotate":new U(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new U(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new U(We.paint_raster["raster-brightness-max"]),"raster-saturation":new U(We.paint_raster["raster-saturation"]),"raster-contrast":new U(We.paint_raster["raster-contrast"]),"raster-resampling":new U(We.paint_raster["raster-resampling"]),"raster-fade-duration":new U(We.paint_raster["raster-fade-duration"])})};class M1 extends ia{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var Xh={paint:new he({"sky-type":new U(We.paint_sky["sky-type"]),"sky-atmosphere-sun":new U(We.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new U(We.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new U(We.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new U(We.paint_sky["sky-gradient-radius"]),"sky-gradient":new de(We.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new U(We.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new U(We.paint_sky["sky-atmosphere-color"]),"sky-opacity":new U(We.paint_sky["sky-opacity"])})};function za(a,o,l){const u=[0,0,1],p=mb([]);return Cr(p,p,l?-mn(a)+Math.PI:mn(a)),_b(p,p,-mn(o)),pC(u,u,p),hr(u,u)}const Kh={circle:class extends ia{constructor(a){super(a,wC)}createBucket(a){return new __(a)}queryRadius(a){const o=a;return kh("circle-radius",this,o)+kh("circle-stroke-width",this,o)+y_(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,l,u,p,g,v,w){const D=Hy(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return jo(a,u,g,v,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),D,T)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new bl(this,a)}},heatmap:class extends ia{createBucket(a){return new Ph(a)}constructor(a){super(a,Pb),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ky({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return kh("heatmap-radius",this,a)}queryIntersectsFeature(a,o,l,u,p,g,v,w){const D=this.paint.get("heatmap-radius").evaluate(o,l);return jo(a,u,g,v,w,!0,!0,new ot(0,0),D)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new bl(this,a)}},hillshade:class extends ia{constructor(a){super(a,Ob)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ia{constructor(a){super(a,tv)}getProgramIds(){const a=this.paint.get("fill-pattern"),o=a&&a.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new bl(this,a)}recalculate(a,o){super.recalculate(a,o);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new xf(a)}queryRadius(){return y_(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,l,u,p,g){return!a.queryGeometry.isAboveHorizon&&jy(kb(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends ia{constructor(a){super(a,PC)}createBucket(a){return new Ef(a)}queryRadius(){return y_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new bl(this,a)}queryIntersectsFeature(a,o,l,u,p,g,v,w,D){const T=Hy(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(o,l),P=this.paint.get("fill-extrusion-base").evaluate(o,l),F=[0,0],B=w&&g.elevation,z=g.elevation?g.elevation.exaggeration():1,$=a.tile.getBucket(this);if(B&&$ instanceof Ef){const ge=$.centroidVertexArray,xe=D+1;xe<ge.length&&(F[0]=ge.geta_centroid_pos0(xe),F[1]=ge.geta_centroid_pos1(xe))}if(0===F[0]&&1===F[1])return!1;"globe"===g.projection.name&&(u=Xb([u],[new ot(0,0),new ot(Bt,Bt)],a.tileID.canonical).map(ge=>ge.polygon).flat());const Q=B?w:null,[ae,ve]=(xe=u,be=P,ze=R,Le=T,Ze=v,lt=Q,$e=F,Qe=z,Je=g.center.lat,"globe"===(ge=g).projection.name?function(st,qe,vt,St,bt,rn,ut,Nt,Zt,Pn,cn){const Gt=[],ci=[],sn=st.projection.upVectorScale(cn,st.center.lat,st.worldSize).metersToTile,dn=[0,0,0,1],ii=[0,0,0,1],ri=(Un,Ai,Pi,Vi)=>{Un[0]=Ai,Un[1]=Pi,Un[2]=Vi,Un[3]=1},oi=fd();vt>0&&(vt+=oi),St+=oi;for(const Un of qe){const Ai=[],Pi=[];for(const Vi of Un){const si=Vi.x+bt.x,ir=Vi.y+bt.y,Ii=st.projection.projectTilePoint(si,ir,cn),Oi=st.projection.upVector(cn,Vi.x,Vi.y);let jn=vt,Qi=St;if(ut){const di=Jb(si,ir,vt,St,ut,Nt,Zt,Pn);jn+=di.base,Qi+=di.top}0!==vt?ri(dn,Ii.x+Oi[0]*sn*jn,Ii.y+Oi[1]*sn*jn,Ii.z+Oi[2]*sn*jn):ri(dn,Ii.x,Ii.y,Ii.z),ri(ii,Ii.x+Oi[0]*sn*Qi,Ii.y+Oi[1]*sn*Qi,Ii.z+Oi[2]*sn*Qi),yi(dn,dn,rn),yi(ii,ii,rn),Ai.push(new jh(dn[0],dn[1],dn[2])),Pi.push(new jh(ii[0],ii[1],ii[2]))}Gt.push(Ai),ci.push(Pi)}return[Gt,ci]}(ge,xe,be,ze,Le,Ze,lt,$e,Qe,Je,a.tileID.canonical):lt?function(st,qe,vt,St,bt,rn,ut,Nt,Zt){const Pn=[],cn=[],Gt=[0,0,0,1];for(const ci of st){const sn=[],dn=[];for(const ii of ci){const ri=ii.x+St.x,oi=ii.y+St.y,Un=Jb(ri,oi,qe,vt,rn,ut,Nt,Zt);Gt[0]=ri,Gt[1]=oi,Gt[2]=Un.base,Gt[3]=1,Sh(Gt,Gt,bt),Gt[3]=Math.max(Gt[3],1e-5);const Ai=new jh(Gt[0]/Gt[3],Gt[1]/Gt[3],Gt[2]/Gt[3]);Gt[0]=ri,Gt[1]=oi,Gt[2]=Un.top,Gt[3]=1,Sh(Gt,Gt,bt),Gt[3]=Math.max(Gt[3],1e-5);const Pi=new jh(Gt[0]/Gt[3],Gt[1]/Gt[3],Gt[2]/Gt[3]);sn.push(Ai),dn.push(Pi)}Pn.push(sn),cn.push(dn)}return[Pn,cn]}(xe,be,ze,Le,Ze,lt,$e,Qe,Je):function(st,qe,vt,St,bt){const rn=[],ut=[],Nt=bt[8]*qe,Zt=bt[9]*qe,Pn=bt[10]*qe,cn=bt[11]*qe,Gt=bt[8]*vt,ci=bt[9]*vt,sn=bt[10]*vt,dn=bt[11]*vt;for(const ii of st){const ri=[],oi=[];for(const Un of ii){const Ai=Un.x+St.x,Pi=Un.y+St.y,Vi=bt[0]*Ai+bt[4]*Pi+bt[12],si=bt[1]*Ai+bt[5]*Pi+bt[13],ir=bt[2]*Ai+bt[6]*Pi+bt[14],Ii=bt[3]*Ai+bt[7]*Pi+bt[15],Oi=Vi+Nt,jn=si+Zt,Qi=ir+Pn,di=Math.max(Ii+cn,1e-5),Mo=Vi+Gt,Ji=si+ci,Or=ir+sn,Dr=Math.max(Ii+dn,1e-5);ri.push(new jh(Oi/di,jn/di,Qi/di)),oi.push(new jh(Mo/Dr,Ji/Dr,Or/Dr))}rn.push(ri),ut.push(oi)}return[rn,ut]}(xe,be,ze,Le,Ze)),le=a.queryGeometry;var ge,xe,be,ze,Le,Ze,lt,$e,Qe,Je;return function(ge,xe,be){let ze=1/0;jy(be,xe)&&(ze=Qb(be,xe[0]));for(let Le=0;Le<xe.length;Le++){const Ze=xe[Le],lt=ge[Le];for(let $e=0;$e<Ze.length-1;$e++){const Qe=Ze[$e],Je=[Qe,Ze[$e+1],lt[$e+1],lt[$e],Qe];Vy(be,Je)&&(ze=Math.min(ze,Qb(be,Je)))}}return ze!==1/0&&ze}(ae,ve,le.isPointQuery()?le.screenBounds:le.screenGeometry)}},line:class extends ia{constructor(a){super(a,Uh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof zo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=sv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new vu(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new bl(this,a)}queryRadius(a){const o=a,l=av(kh("line-width",this,o),kh("line-gap-width",this,o)),u=kh("line-offset",this,o);return l/2+Math.abs(u)+y_(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,l,u,p,g){if(a.queryGeometry.isAboveHorizon)return!1;const v=kb(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),w=a.pixelToTileUnitsFactor/2*av(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),D=this.paint.get("line-offset").evaluate(o,l);return D&&(u=function(T,R){const P=[],F=new ot(0,0);for(let B=0;B<T.length;B++){const z=T[B],$=[];for(let Q=0;Q<z.length;Q++){const ae=z[Q],ve=z[Q+1],le=0===Q?F:ae.sub(z[Q-1])._unit()._perp(),ge=Q===z.length-1?F:ve.sub(ae)._unit()._perp(),xe=le._add(ge)._unit();xe._mult(1/(xe.x*ge.x+xe.y*ge.y)),$.push(xe._mult(R)._add(ae))}P.push($)}return P}(u,D*a.pixelToTileUnitsFactor)),function(T,R,P){for(let F=0;F<R.length;F++){const B=R[F];if(T.length>=3)for(let z=0;z<B.length;z++)if(_u(T,B[z]))return!0;if(Ab(T,B,P))return!0}return!1}(v,u,w)}isTileClipped(){return!0}},symbol:Dv,background:class extends ia{constructor(a){super(a,S1)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ia{constructor(a){super(a,QC)}getProgramIds(){return["raster"]}},sky:class extends ia{constructor(a){super(a,Xh),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ky({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(a,o){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),p=!u,g=a.style.light,v=g.properties.get("position");return p&&"viewport"===g.properties.get("anchor")&&Ei("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?za(v.azimuthal,90-v.polar,o):za(u[0],90-u[1],o)}const l=this.paint.get("sky-gradient-center");return za(l[0],90-l[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class Hf{constructor(o,l,u,p){this.context=o,this.format=u,this.texture=o.gl.createTexture(),this.update(l,p)}update(o,l,u){const{width:p,height:g}=o,{context:v}=this,{gl:w}=v,{HTMLImageElement:D,HTMLCanvasElement:T,HTMLVideoElement:R,ImageData:P,ImageBitmap:F}=at;if(w.bindTexture(w.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!l||!1!==l.premultiply)),u||this.size&&this.size[0]===p&&this.size[1]===g){const{x:B,y:z}=u||{x:0,y:0};o instanceof D||o instanceof T||o instanceof R||o instanceof P||F&&o instanceof F?w.texSubImage2D(w.TEXTURE_2D,0,B,z,w.RGBA,w.UNSIGNED_BYTE,o):w.texSubImage2D(w.TEXTURE_2D,0,B,z,p,g,w.RGBA,w.UNSIGNED_BYTE,o.data)}else this.size=[p,g],o instanceof D||o instanceof T||o instanceof R||o instanceof P||F&&o instanceof F?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,o):w.texImage2D(w.TEXTURE_2D,0,this.format,p,g,0,this.format,w.UNSIGNED_BYTE,o.data);this.useMipmap=!!(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(o,l){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),o!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?o===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:o),this.filter=o),l!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class JC{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class A1{constructor(){this.tasks={},this.taskQueue=[],tl(["process"],this),this.invoker=new JC(this.process),this.nextId=0}add(o,l){const u=this.nextId++,p=function({type:g,isSymbolTile:v,zoom:w}){return w=w||0,"message"===g?0:"maybePrepare"!==g||v?"parseTile"!==g||v?"parseTile"===g&&v?300-w:"maybePrepare"===g&&v?400-w:500:200-w:100-w}(l);if(0===p){Ca();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:o,metadata:l,priority:p,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){Ca();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let p=0;p<this.taskQueue.length;p++){const g=this.tasks[this.taskQueue[p]];g.priority<l&&(l=g.priority,o=p)}if(null===o)return null;const u=this.taskQueue[o];return this.taskQueue.splice(o,1),u}remove(){this.invoker.remove()}}class ng{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const u=o[l];this._stringToNumber[u]=l,this._numberToString[l]=u}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const Gf=["tile","layer","source","sourceLayer","state"];class Ev{constructor(o,l,u,p,g){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=u,this._y=p,this.properties=o.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const l of Gf)void 0!==this[l]&&(o[l]=this[l]);return o}}const fo=new Uint16Array(8184);for(let a=0;a<2046;a++){let o=a+2,l=0,u=0,p=0,g=0,v=0,w=0;for(1&o?p=g=v=32:l=u=w=32;(o>>=1)>1;){const T=l+p>>1,R=u+g>>1;1&o?(p=l,g=u,l=v,u=w):(l=p,u=g,p=v,g=w),v=T,w=R}const D=4*a;fo[D+0]=l,fo[D+1]=u,fo[D+2]=p,fo[D+3]=g}const Ps=new Uint16Array(2178),Ec=new Uint8Array(1089),qf=new Uint16Array(1089);function I1(a){return 0===a?-.03125:32===a?.03125:0}var R1=De([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const k1={type:2,extent:Bt,loadGeometry:()=>[[new ot(0,0),new ot(Bt+1,0),new ot(Bt+1,Bt+1),new ot(0,Bt+1),new ot(0,0)]]};class Tv{constructor(o,l,u,p,g){this.tileID=o,this.uid=Oo(),this.uses=0,this.tileSize=l,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(o){const l=o+this.timeAdded;l<il.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Cu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,l,u){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(p,g){const v={};if(!g)return v;for(const w of p){const D=w.layerIds.map(T=>g.getLayer(T)).filter(Boolean);if(0!==D.length){w.layers=D,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(T=>D.filter(R=>R.id===T)[0]));for(const T of D)v[T.id]=w}}return v}(o.buckets,l.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof Dc){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof Dc&&g.hasRTLText){this.hasRTLText=!0,M.isLoading()||M.isLoaded()||"deferred"!==C()||S();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(p).queryRadius(g))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new Qn}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(o)}const l=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Hf(o,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Hf(o,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Hf(o,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,l,u,p,g,v,w,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:w,transform:v,params:g,tileTransform:this.tileTransform},o,l,u):{}}querySourceFeatures(o,l){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),g=l?l.sourceLayer:"",v=p._geojsonTileLayer||p[g];if(!v)return;const w=Up(l&&l.filter),{z:D,x:T,y:R}=this.tileID.canonical,P={z:D,x:T,y:R};for(let F=0;F<v.length;F++){const B=v.feature(F);if(w.needGeometry){const Q=Ol(B,!0);if(!w.filter(new k(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!w.filter(new k(this.tileID.overscaledZ),B))continue;const z=u.getId(B,g),$=new Ev(B,D,T,R,z);$.tile=P,o.push($)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const l=this.expirationTime;if(o.cacheControl){const u=ei(o.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(l)if(this.expirationTime<l)p=!0;else{const g=this.expirationTime-l;g?this.expirationTime=u+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!l)return;const u=this.latestFeatureIndex.loadVTLayers(),p=l.style.listImages();for(const g in this.buckets){if(!l.style.hasLayer(g))continue;const v=this.buckets[g],w=v.layers[0].sourceLayer||"_geojsonTileLayer",D=u[w],T=o[w];if(!D||!T||0===Object.keys(T).length)continue;if(v.update(T,D,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof vu||v instanceof xf){const P=l.style._getSourceCache(v.layers[0].source);l._terrain&&l._terrain.enabled&&P&&v.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(P.id,this.tileID)}const R=l&&l.style&&l.style.getLayer(g);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<il.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=il.now()+o}setTexture(o,l){const u=l.context,p=u.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new Hf(u,o,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(o,l){const u={};for(const p of l)u[p]=!0;this.dependencies[o]=u}hasDependency(o,l){for(const u of o){const p=this.dependencies[u];if(p)for(const g of l)if(p[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const u=yc(k1,this.tileID.canonical,this.tileTransform)[0],p=new Ie,g=new os;for(let v=0;v<u.length;v++){const{x:w,y:D}=u[v];p.emplaceBack(w,D),g.emplaceBack(v)}g.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(g),this._tileDebugBuffer=o.createVertexBuffer(p,Tl.members),this._tileDebugSegments=Xi.simpleSegment(0,0,p.length,g.length)}_makeTileBoundsBuffers(o,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const u=yc(k1,this.tileID.canonical,this.tileTransform)[0];let p,g;if(this.isRaster){const v=function(w,D){const T=Cu(w,D),R=Math.pow(2,w.z);for(let Q=0;Q<33;Q++)for(let ae=0;ae<33;ae++){const ve=ss((w.x+(ae+I1(ae))/32)/R),le=ho((w.y+(Q+I1(Q))/32)/R),ge=D.project(ve,le),xe=33*Q+ae;Ps[2*xe+0]=Math.round((ge.x*T.scale-T.x)*Bt),Ps[2*xe+1]=Math.round((ge.y*T.scale-T.y)*Bt)}Ec.fill(0),qf.fill(0);for(let Q=2045;Q>=0;Q--){const ae=4*Q,ve=fo[ae+0],le=fo[ae+1],ge=fo[ae+2],xe=fo[ae+3],be=ve+ge>>1,ze=le+xe>>1,Le=be+ze-le,Ze=ze+ve-be,lt=33*le+ve,$e=33*xe+ge,Qe=33*ze+be,Je=Math.hypot((Ps[2*lt+0]+Ps[2*$e+0])/2-Ps[2*Qe+0],(Ps[2*lt+1]+Ps[2*$e+1])/2-Ps[2*Qe+1])>=16;Ec[Qe]=Ec[Qe]||(Je?1:0),Q<1022&&(Ec[Qe]=Ec[Qe]||Ec[33*(le+Ze>>1)+(ve+Le>>1)]||Ec[33*(xe+Ze>>1)+(ge+Le>>1)])}const P=new Ke,F=new Ot;let B=0;function z(Q,ae){const ve=33*ae+Q;return 0===qf[ve]&&(P.emplaceBack(Ps[2*ve+0],Ps[2*ve+1],Q*Bt/32,ae*Bt/32),qf[ve]=++B),qf[ve]-1}function $(Q,ae,ve,le,ge,xe){const be=Q+ve>>1,ze=ae+le>>1;if(Math.abs(Q-ge)+Math.abs(ae-xe)>1&&Ec[33*ze+be])$(ge,xe,Q,ae,be,ze),$(ve,le,ge,xe,be,ze);else{const Le=z(Q,ae),Ze=z(ve,le),lt=z(ge,xe);F.emplaceBack(Le,Ze,lt)}}return $(0,0,32,32,32,0),$(32,32,0,0,0,32),{vertices:P,indices:F}}(this.tileID.canonical,l);p=v.vertices,g=v.indices}else{p=new Ke,g=new Ot;for(const{x:w,y:D}of u)p.emplaceBack(w,D,0,0);const v=E_(p.int16,void 0,4);for(let w=0;w<v.length;w+=3)g.emplaceBack(v[w],v[w+1],v[w+2])}this._tileBoundsBuffer=o.createVertexBuffer(p,R1.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(g),this._tileBoundsSegments=Xi.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugBuffers(o,l){const u=l.projection;if(!u||"globe"!==u.name||l.freezeTileCoverage)return;const p=this.tileID.canonical,g=uf(df(p,l)),v=Rl(l.zoom);let w;v>0&&(w=c_(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,p,l,g,w,v),this._makeGlobeTileDebugTextBuffer(o,p,l,g,w,v)}_globePoint(o,l,u,p,g,v,w){let D=hu(o,l,u);if(v){const T=1<<u.z,R=kl(p.center.lng),P=Fa(p.center.lat),F=(u.x+.5)/T-R;let B=0;F>.5?B=-1:F<-.5&&(B=1);let z=(o/Bt+u.x)/T+B,$=(l/Bt+u.y)/T;z=(z-R)*p._pixelsPerMercatorPixel+R,$=($-P)*p._pixelsPerMercatorPixel+P;const Q=[z*p.worldSize,$*p.worldSize,0];yi(Q,Q,v),D=gc(D,Q,w)}return yi(D,D,g)}_makeGlobeTileDebugBorderBuffer(o,l,u,p,g,v){const w=new Ie,D=new os,T=new Pe,R=(F,B,z,$,Q)=>{const ae=(z-F)/(Q-1),ve=($-B)/(Q-1),le=w.length;for(let ge=0;ge<Q;ge++){const xe=F+ge*ae,be=B+ge*ve;w.emplaceBack(xe,be);const ze=this._globePoint(xe,be,l,u,p,g,v);T.emplaceBack(ze[0],ze[1],ze[2]),D.emplaceBack(le+ge)}},P=Bt;R(0,0,P,0,16),R(P,0,P,P,16),R(P,P,0,P,16),R(0,P,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(D),this._tileDebugBuffer=o.createVertexBuffer(w,Tl.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(T,As.members),this._tileDebugSegments=Xi.simpleSegment(0,0,w.length,D.length)}_makeGlobeTileDebugTextBuffer(o,l,u,p,g,v){const w=Bt/4,D=new Ie,T=new Ot,R=new Pe,P=25;T.reserve(32),D.reserve(P),R.reserve(P);const F=(B,z)=>P*B+z;for(let B=0;B<P;B++){const z=B*w;for(let $=0;$<P;$++){const Q=$*w;D.emplaceBack(Q,z);const ae=this._globePoint(Q,z,l,u,p,g,v);R.emplaceBack(ae[0],ae[1],ae[2])}}for(let B=0;B<4;B++)for(let z=0;z<4;z++){const $=F(B,z),Q=F(B,z+1),ae=F(B+1,z),ve=F(B+1,z+1);T.emplaceBack($,Q,ae),T.emplaceBack(ae,Q,ve)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(T),this._tileDebugTextBuffer=o.createVertexBuffer(D,Tl.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(R,As.members),this._tileDebugTextSegments=Xi.simpleSegment(0,0,P,32)}}class P1{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,l,u){const p=String(l);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][p]=this.stateChanges[o][p]||{},Hi(this.stateChanges[o][p],u),null===this.deletedStates[o]){this.deletedStates[o]={};for(const g in this.state[o])g!==p&&(this.deletedStates[o][g]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][p]){this.deletedStates[o][p]={};for(const g in this.state[o][p])u[g]||(this.deletedStates[o][p][g]=null)}else for(const g in u)this.deletedStates[o]&&this.deletedStates[o][p]&&null===this.deletedStates[o][p][g]&&delete this.deletedStates[o][p][g]}removeFeatureState(o,l,u){if(null===this.deletedStates[o])return;const p=String(l);if(this.deletedStates[o]=this.deletedStates[o]||{},u&&void 0!==l)null!==this.deletedStates[o][p]&&(this.deletedStates[o][p]=this.deletedStates[o][p]||{},this.deletedStates[o][p][u]=null);else if(void 0!==l)if(this.stateChanges[o]&&this.stateChanges[o][p])for(u in this.deletedStates[o][p]={},this.stateChanges[o][p])this.deletedStates[o][p][u]=null;else this.deletedStates[o][p]=null;else this.deletedStates[o]=null}getState(o,l){const u=String(l),p=Hi({},(this.state[o]||{})[u],(this.stateChanges[o]||{})[u]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const g=this.deletedStates[o][l];if(null===g)return{};for(const v in g)delete p[v]}return p}initializeTileState(o,l){o.setFeatureState(this.state,l)}coalesceChanges(o,l){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const v in this.stateChanges[p])this.state[p][v]||(this.state[p][v]={}),Hi(this.state[p][v],this.stateChanges[p][v]),g[v]=this.state[p][v];u[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(null===this.deletedStates[p])for(const v in this.state[p])g[v]={},this.state[p][v]={};else for(const v in this.deletedStates[p]){if(null===this.deletedStates[p][v])this.state[p][v]={};else if(this.state[p][v])for(const w of Object.keys(this.deletedStates[p][v]))delete this.state[p][v][w];g[v]=this.state[p][v]}u[p]=u[p]||{},Hi(u[p],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const p in o)o[p].setFeatureState(u,l)}}class eD{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const u=this.toIdx(o,l);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function O1(a,o,l,u){let p=0,g=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(u[v])<1e-15){if(l[v]<a[v]||l[v]>o[v])return null}else{const w=1/u[v];let D=(a[v]-l[v])*w,T=(o[v]-l[v])*w;if(D>T){const R=D;D=T,T=R}if(D>p&&(p=D),T<g&&(g=T),p>g)return null}return p}function tD(a,o,l,u,p,g,v,w,D,T,R){const P=u-a,F=p-o,B=g-l,z=v-a,$=w-o,Q=D-l,ae=R[1]*Q-R[2]*$,ve=R[2]*z-R[0]*Q,le=R[0]*$-R[1]*z,ge=P*ae+F*ve+B*le;if(Math.abs(ge)<1e-15)return null;const xe=1/ge,be=T[0]-a,ze=T[1]-o,Le=T[2]-l,Ze=(be*ae+ze*ve+Le*le)*xe;if(Ze<0||Ze>1)return null;const lt=ze*B-Le*F,$e=Le*P-be*B,Qe=be*F-ze*P,Je=(R[0]*lt+R[1]*$e+R[2]*Qe)*xe;return Je<0||Ze+Je>1?null:(z*lt+$*$e+Q*Qe)*xe}function nD(a,o,l){return(a-o)/(l-o)}function Sv(a,o,l,u,p,g,v,w,D){const T=1<<l,R=g-u,P=v-p,F=(a+1)/T*R+u,B=(o+0)/T*P+p,z=(o+1)/T*P+p;w[0]=(a+0)/T*R+u,w[1]=B,D[0]=F,D[1]=z}class Mv{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(g){const v=Math.ceil(Math.log2(g.dim/8)),w=[];let D=Math.ceil(Math.pow(2,v));const T=1/D,R=(B,z,$,Q,ae)=>{const ve=Q?1:0,le=(B+1)*$-ve,ge=z*$,xe=(z+1)*$-ve;ae[0]=B*$,ae[1]=ge,ae[2]=le,ae[3]=xe};let P=new eD(D);const F=[];for(let B=0;B<D*D;B++){R(B%D,Math.floor(B/D),T,!1,F);const z=Tc(F[0],F[1],g),$=Tc(F[2],F[1],g),Q=Tc(F[2],F[3],g),ae=Tc(F[0],F[3],g);P.minimums.push(Math.min(z,$,Q,ae)),P.maximums.push(Math.max(z,$,Q,ae)),P.leaves.push(1)}for(w.push(P),D/=2;D>=1;D/=2){const B=w[w.length-1];P=new eD(D);for(let z=0;z<D*D;z++){R(z%D,Math.floor(z/D),2,!0,F);const $=B.getElevation(F[0],F[1]),Q=B.getElevation(F[2],F[1]),ae=B.getElevation(F[2],F[3]),ve=B.getElevation(F[0],F[3]),le=B.isLeaf(F[0],F[1]),ge=B.isLeaf(F[2],F[1]),xe=B.isLeaf(F[2],F[3]),be=B.isLeaf(F[0],F[3]),ze=Math.min($.min,Q.min,ae.min,ve.min),Le=Math.max($.max,Q.max,ae.max,ve.max),Ze=le&&ge&&xe&&be;P.maximums.push(Le),P.minimums.push(ze),P.leaves.push(Le-ze<=5&&Ze?1:0)}w.push(P)}return w}(this.dem),u=l.length-1,p=l[u];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(l,0,0,u,0)}raycastRoot(o,l,u,p,g,v,w=1){return O1([o,l,-100],[u,p,this.maximums[0]*w],g,v)}raycast(o,l,u,p,g,v,w=1){if(!this.nodeCount)return null;const D=this.raycastRoot(o,l,u,p,g,v,w);if(null==D)return null;const T=[],R=[],P=[],F=[],B=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:z,t:$,nodex:Q,nodey:ae,depth:ve}=B.pop();if(this.leaves[z]){Sv(Q,ae,ve,o,l,u,p,P,F);const ge=1<<ve,xe=(Q+0)/ge,be=(Q+1)/ge,ze=(ae+0)/ge,Le=(ae+1)/ge,Ze=Tc(xe,ze,this.dem)*w,lt=Tc(be,ze,this.dem)*w,$e=Tc(be,Le,this.dem)*w,Qe=Tc(xe,Le,this.dem)*w,Je=tD(P[0],P[1],Ze,F[0],P[1],lt,F[0],F[1],$e,g,v),it=tD(F[0],F[1],$e,P[0],F[1],Qe,P[0],P[1],Ze,g,v),st=Math.min(null!==Je?Je:Number.MAX_VALUE,null!==it?it:Number.MAX_VALUE);if(st!==Number.MAX_VALUE)return st;{const qe=Dl([],g,v,$);if(iD(Ze,lt,Qe,$e,nD(qe[0],P[0],F[0]),nD(qe[1],P[1],F[1]))>=qe[2])return $}continue}let le=0;for(let ge=0;ge<this._siblingOffset.length;ge++){Sv((Q<<1)+this._siblingOffset[ge][0],(ae<<1)+this._siblingOffset[ge][1],ve+1,o,l,u,p,P,F),P[2]=-100,F[2]=this.maximums[this.childOffsets[z]+ge]*w;const xe=O1(P,F,g,v);if(null!=xe){const be=xe;T[ge]=be;let ze=!1;for(let Le=0;Le<le&&!ze;Le++)be>=T[R[Le]]&&(R.splice(Le,0,ge),ze=!0);ze||(R[le]=ge),le++}}for(let ge=0;ge<le;ge++){const xe=R[ge];B.push({idx:this.childOffsets[z]+xe,t:T[xe],nodex:(Q<<1)+this._siblingOffset[xe][0],nodey:(ae<<1)+this._siblingOffset[xe][1],depth:ve+1})}}return null}_addNode(o,l,u){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,u,p,g){if(1===o[p].isLeaf(l,u))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const v=p-1,w=o[v];let D=0,T=0;for(let R=0;R<this._siblingOffset.length;R++){const P=2*l+this._siblingOffset[R][0],F=2*u+this._siblingOffset[R][1],B=w.getElevation(P,F),z=w.isLeaf(P,F),$=this._addNode(B.min,B.max,z);z&&(D|=1<<R),T||(T=$)}for(let R=0;R<this._siblingOffset.length;R++)D&1<<R||this._construct(o,2*l+this._siblingOffset[R][0],2*u+this._siblingOffset[R][1],v,T+R)}}function iD(a,o,l,u,p,g){return Ln(Ln(a,l,g),Ln(o,u,g),p)}function Tc(a,o,l){const u=l.dim,p=hn(a*u-.5,0,u-1),g=hn(o*u-.5,0,u-1),v=Math.floor(p),w=Math.floor(g),D=Math.min(v+1,u-1),T=Math.min(w+1,u-1);return iD(l.get(v,w),l.get(D,w),l.get(v,T),l.get(D,T),p-v,g-w)}const Wf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function F1(a,o,l){return(256*a*256+256*o+l)/10-1e4}function N1(a,o,l){return 256*a+o+l/256-32768}class Zf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,u,p=!1,g=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return Ei(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const v=this.dim=l.height-2,w=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=u||"mapbox",this.borderReady=p,!p){for(let D=0;D<v;D++)w[this._idx(-1,D)]=w[this._idx(0,D)],w[this._idx(v,D)]=w[this._idx(v-1,D)],w[this._idx(D,-1)]=w[this._idx(D,0)],w[this._idx(D,v)]=w[this._idx(D,v-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(v,-1)]=w[this._idx(v-1,0)],w[this._idx(-1,v)]=w[this._idx(0,v-1)],w[this._idx(v,v)]=w[this._idx(v-1,v-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Mv(this)}get(o,l,u=!1){u&&(o=hn(o,-1,this.dim),l=hn(l,-1,this.dim));const p=4*this._idx(o,l);return("terrarium"===this.encoding?N1:F1)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(o){return Wf[o]}get unpackVector(){return Wf[this.encoding]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){const u=[0,0,0,0],p=Zf.getUnpackVector(l);let g=Math.floor((o+p[3])/p[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new as({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,u){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,g=l*this.dim+this.dim,v=u*this.dim,w=u*this.dim+this.dim;switch(l){case-1:p=g-1;break;case 1:g=p+1}switch(u){case-1:v=w-1;break;case 1:w=v+1}const D=-l*this.dim,T=-u*this.dim;for(let R=v;R<w;R++)for(let P=p;P<g;P++){const F=4*this._idx(P,R),B=4*this._idx(P+D,R+T);this.pixels[F+0]=o.pixels[B+0],this.pixels[F+1]=o.pixels[B+1],this.pixels[F+2]=o.pixels[B+2],this.pixels[F+3]=o.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Et(Zf,"DEMData"),Et(Mv,"DemMinMaxQuadTree",{omit:["dem"]});class En{constructor(o,l){this.max=o,this.onRemove=l,this.reset()}reset(){for(const o in this.data)for(const l of this.data[o])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(o,l,u){const p=o.wrapped().key;void 0===this.data[p]&&(this.data[p]=[]);const g={value:l,timeout:void 0};if(void 0!==u&&(g.timeout=setTimeout(()=>{this.remove(o,g)},u)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const l=this.data[o].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),l.value}getByKey(o){const l=this.data[o];return l?l[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,l){if(!this.has(o))return this;const u=o.wrapped().key,p=void 0===l?0:this.data[u].indexOf(l),g=this.data[u][p];return this.data[u].splice(p,1),g.timeout&&clearTimeout(g.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(o){const l=[];for(const u in this.data)for(const p of this.data[u])o(p.value)||l.push(p);for(const u of l)this.remove(u.value.tileID,u)}}class G{constructor(o,l,u){this.func=o,this.mask=l,this.range=u}}G.ReadOnly=!1,G.ReadWrite=!0,G.disabled=new G(519,G.ReadOnly,[0,1]);class oe{constructor(o,l,u,p,g,v){this.test=o,this.ref=l,this.mask=u,this.fail=p,this.depthFail=g,this.pass=v}}oe.disabled=new oe({func:519,mask:0},0,0,7680,7680,7680);class Os{constructor(o,l,u){this.blendFunction=o,this.blendColor=l,this.mask=u}}Os.Replace=[1,0],Os.disabled=new Os(Os.Replace,ki.transparent,[!1,!1,!1,!1]),Os.unblended=new Os(Os.Replace,ki.transparent,[!0,!0,!0,!0]),Os.alphaBlended=new Os([1,771],ki.transparent,[!0,!0,!0,!0]);class So{constructor(o,l,u){this.enable=o,this.mode=l,this.frontFace=u}}So.disabled=new So(!1,1029,2305),So.backCCW=new So(!0,1029,2305),So.backCW=new So(!0,1029,2304),So.frontCW=new So(!0,1028,2304),So.frontCCW=new So(!0,1028,2305);class Sc extends Gu{constructor(o,l,u){super(),this.id=o,this._onlySymbols=u,l.on("data",p=>{"source"===p.dataType&&"metadata"===p.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===p.dataType&&"content"===p.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new En(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new P1,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const l=this._tiles[o];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,l){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,l)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const u=this._tiles[l];u.upload(o),u.prepare(this.map.style.imageManager)}}getIds(){return xa(this._tiles).map(o=>o.tileID).sort(Jh).map(o=>o.key)}getRenderableIds(o){const l=[];for(const u in this._tiles)this._isIdRenderable(+u,o)&&l.push(this._tiles[u]);return o?l.sort((u,p)=>{const g=u.tileID,v=p.tileID,w=new ot(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),D=new ot(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-v.overscaledZ||D.y-w.y||D.x-w.x}).map(u=>u.tileID.key):l.map(u=>u.tileID).sort(Jh).map(u=>u.key)}hasRenderableParent(o){const l=this.findLoadedParent(o,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(o,l){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(l||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,l){const u=this._tiles[o];u&&("loading"!==u.state&&(u.state=l),this._loadTile(u,this._tileLoaded.bind(this,u,o,l)))}_tileLoaded(o,l,u,p){if(p)if(o.state="errored",404!==p.status)this._source.fire(new rl(p,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=il.now(),"expired"===u&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(l,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new Yc("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const l=this.getRenderableIds();for(let p=0;p<l.length;p++){const g=l[p];if(o.neighboringTiles&&o.neighboringTiles[g]){const v=this.getTileByID(g);u(o,v),u(v,o)}}function u(p,g){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let v=g.tileID.canonical.x-p.tileID.canonical.x;const w=g.tileID.canonical.y-p.tileID.canonical.y,D=Math.pow(2,p.tileID.canonical.z),T=g.tileID.key;0===v&&0===w||Math.abs(w)>1||(Math.abs(v)>1&&(1===Math.abs(v+D)?v+=D:1===Math.abs(v-D)&&(v-=D)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,v,w),p.neighboringTiles&&p.neighboringTiles[T]&&(p.neighboringTiles[T].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,l,u,p){for(const g in this._tiles){let v=this._tiles[g];if(p[g]||!v.hasData()||v.tileID.overscaledZ<=l||v.tileID.overscaledZ>u)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>l+1;){const T=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[T.key],v&&v.hasData()&&(w=T)}let D=w;for(;D.overscaledZ>l;)if(D=D.scaledTo(D.overscaledZ-1),o[D.key]){p[w.key]=w;break}}}findLoadedParent(o,l){if(o.key in this._loadedParentTiles){const u=this._loadedParentTiles[o.key];return u&&u.tileID.overscaledZ>=l?u:null}for(let u=o.overscaledZ-1;u>=l;u--){const p=o.scaledTo(u),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(o){const l=this._tiles[o.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,l){l=l||this._source.tileSize;const u=Math.ceil(o.width/l)+1,p=Math.ceil(o.height/l)+1,g=Math.floor(u*p*5),v="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,g):g,w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(w)}handleWrapJump(o){const l=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,l){const u={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+l),u[g.tileID.key]=g}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(o,l,u){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let p;this.updateCacheSize(o,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new Li(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(p=o.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(w=>this._source.hasTile(w)))):p=[];const g=this._updateRetainedTiles(p);if(Iv(this._source.type)&&0!==p.length){const w={},D={},T=Object.keys(g);for(const P of T){const F=g[P],B=this._tiles[P];if(!B||B.fadeEndTime&&B.fadeEndTime<=il.now())continue;const z=this.findLoadedParent(F,Math.max(F.overscaledZ-Sc.maxOverzooming,this._source.minzoom));z&&(this._addTile(z.tileID),w[z.tileID.key]=z.tileID),D[P]=F}const R=p[p.length-1].overscaledZ;for(const P in this._tiles){const F=this._tiles[P];if(g[P]||!F.hasData())continue;let B=F.tileID;for(;B.overscaledZ>R;){B=B.scaledTo(B.overscaledZ-1);const z=this._tiles[B.key];if(z&&z.hasData()&&D[B.key]){g[P]=F.tileID;break}}}for(const P in w)g[P]||(this._coveredTiles[P]=!0,g[P]=w[P])}for(const w in g)this._tiles[w].clearFadeHold();const v=function(w,D){const T=[];for(const R in w)R in D||T.push(R);return T}(this._tiles,g);for(const w of v){const D=this._tiles[w];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const l={};if(0===o.length)return l;const u={},p=o.reduce((T,R)=>Math.min(T,R.overscaledZ),1/0),g=o[0].overscaledZ,v=Math.max(g-Sc.maxOverzooming,this._source.minzoom),w=Math.max(g+Sc.maxUnderzooming,this._source.minzoom),D={};for(const T of o){const R=this._addTile(T);l[T.key]=T,R.hasData()||p<this._source.maxzoom&&(D[T.key]=T)}this._retainLoadedChildren(D,p,w,l);for(const T of o){let R=this._tiles[T.key];if(R.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const F=T.children(this._source.maxzoom)[0],B=this.getTile(F);if(B&&B.hasData()){l[F.key]=F;continue}}else{const F=T.children(this._source.maxzoom);if(l[F[0].key]&&l[F[1].key]&&l[F[2].key]&&l[F[3].key])continue}let P=R.wasRequested();for(let F=T.overscaledZ-1;F>=v;--F){const B=T.scaledTo(F);if(u[B.key]||(u[B.key]=!0,R=this.getTile(B),!R&&P&&(R=this._addTile(B)),R&&(l[B.key]=B,P=R.wasRequested(),R.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const l=[];let u,p=this._tiles[o].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}l.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;p=g}for(const g of l)this._loadedParentTiles[g]=u}}_addTile(o){let l=this._tiles[o.key];if(l)return l;l=this._cache.getAndRemove(o),l&&(this._setTileReloadTimer(o.key,l),l.tileID=o,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,l)));const u=!!l;if(!u){const p=this.map?this.map.painter:null;l=new Tv(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,o.key,l.state))}return l?(l.uses++,this._tiles[o.key]=l,u||this._source.fire(new Yc("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(o,l){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const u=l.getExpiryTimeout();u&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},u))}_removeTile(o){const l=this._tiles[o];l&&(l.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,l,u){const p=[],g=this.transform;if(!g)return p;const v="globe"===g.projection.name,w=kl(g.center.lng);for(const D in this._tiles){const T=this._tiles[D];if(u&&T.clearQueryDebugViz(),T.holdingForFade())continue;let R;if(v){const P=T.tileID.canonical;if(0===P.z){const F=[Math.abs(hn(w,...Du(P,-1))-w),Math.abs(hn(w,...Du(P,1))-w)];R=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(hn(w,...Du(P,-1))-w),Math.abs(hn(w,...Du(P,0))-w),Math.abs(hn(w,...Du(P,1))-w)];R=[F.indexOf(Math.min(...F))-1]}}else R=[0];for(const P of R){const F=o.containsTile(T,g,l,P);F&&p.push(F)}}return p}getVisibleCoordinates(o){const l=this.getRenderableIds(o).map(u=>this._tiles[u].tileID);for(const u of l)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(Iv(this._source.type))for(const o in this._tiles){const l=this._tiles[o];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=il.now())return!0}return!1}setFeatureState(o,l,u){this._state.updateState(o=o||"_geojsonTileLayer",l,u)}removeFeatureState(o,l,u){this._state.removeFeatureState(o=o||"_geojsonTileLayer",l,u)}getFeatureState(o,l){return this._state.getState(o=o||"_geojsonTileLayer",l)}setDependencies(o,l,u){const p=this._tiles[o];p&&p.setDependencies(l,u)}reloadTilesForDependencies(o,l){for(const u in this._tiles)this._tiles[u].hasDependency(o,l)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(o,l))}_preloadTiles(o,l){if(!this._sourceLoaded){const w=()=>{this._sourceLoaded&&(this._source.off("data",w),this._preloadTiles(o,l))};return void this._source.on("data",w)}const u=new Map,p=Array.isArray(o)?o:[o],g=this.map.painter.terrain,v=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const w of p){const D=w.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const T of D)u.set(T.key,T);this.usedForTerrain&&w.updateElevation(!1)}vr(Array.from(u.values()),(w,D)=>{const T=new Tv(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(T,R=>{"raster-dem"===this._source.type&&T.dem&&this._backfillDEM(T),D(R,T)})},l)}}function Jh(a,o){const l=Math.abs(2*a.wrap)-+(a.wrap<0),u=Math.abs(2*o.wrap)-+(o.wrap<0);return a.overscaledZ-o.overscaledZ||u-l||o.canonical.y-a.canonical.y||o.canonical.x-a.canonical.x}function Iv(a){return"raster"===a||"image"===a||"video"===a||"custom"===a}function Du(a,o){const l=1<<a.z;return[a.x/l+o,(a.x+1)/l+o]}Sc.maxOverzooming=10,Sc.maxUnderzooming=3;class ep{constructor(o,l,u){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=u}static create(o,l,u){const p=u||o.findDEMTileFor(l);if(!p||!p.dem)return;const g=p.dem,v=p.tileID,w=1<<l.canonical.z-v.canonical.z;return new ep(p,p.tileSize/Bt/w,[(l.canonical.x/w-v.canonical.x)*g.dim,(l.canonical.y/w-v.canonical.y)*g.dim])}tileCoordToPixel(o,l){const u=l*this._scale+this._offset[1],p=Math.floor(o*this._scale+this._offset[0]),g=Math.floor(u);return new ot(p,g)}getElevationAt(o,l,u,p){const g=o*this._scale+this._offset[0],v=l*this._scale+this._offset[1],w=Math.floor(g),D=Math.floor(v),T=this._dem;return p=!!p,u?Ln(Ln(T.get(w,D,p),T.get(w,D+1,p),v-D),Ln(T.get(w+1,D,p),T.get(w+1,D+1,p),v-D),g-w):T.get(w,D,p)}getElevationAtPixel(o,l,u){return this._dem.get(o,l,!!u)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Pl(1,o)*this._dem.stride}}class rg{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new uc(Bt,16,0),this.featureIndexArray=new Ss,this.promoteId=l}insert(o,l,u,p,g,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,g,v);const D=this.grid;for(let T=0;T<l.length;T++){const R=l[T],P=[1/0,1/0,-1/0,-1/0];for(let F=0;F<R.length;F++){const B=R[F];P[0]=Math.min(P[0],B.x),P[1]=Math.min(P[1],B.y),P[2]=Math.max(P[2],B.x),P[3]=Math.max(P[3],B.y)}P[0]<Bt&&P[1]<Bt&&P[2]>=0&&P[3]>=0&&D.insert(w,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new zh(new If(this.rawTileData)).layers,this.sourceLayerCoder=new ng(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l,u,p){this.loadVTLayers();const g=o.params||{},v=Up(g.filter),w=o.tileResult,D=o.transform,T=w.bufferedTilespaceBounds,R=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(z,$,Q,ae)=>Uy(w.bufferedTilespaceGeometry,z,$,Q,ae));R.sort(kv);let P=null;D.elevation&&R.length>0&&(P=ep.create(D.elevation,this.tileID));const F={};let B;for(let z=0;z<R.length;z++){const $=R[z];if($===B)continue;B=$;const Q=this.featureIndexArray.get($);let ae=null;this.loadMatchingFeature(F,Q,v,g.layers,g.availableImages,l,u,p,(ve,le,ge,xe=0)=>(ae||(ae=yc(ve,this.tileID.canonical,o.tileTransform)),le.queryIntersectsFeature(w,ve,ge,ae,this.z,o.transform,o.pixelPosMatrix,P,xe)))}return F}loadMatchingFeature(o,l,u,p,g,v,w,D,T){const{featureIndex:R,bucketIndex:P,sourceLayerIndex:F,layoutVertexArrayOffset:B}=l,z=this.bucketLayerIDs[P];if(p&&!function(ve,le){for(let ge=0;ge<ve.length;ge++)if(le.indexOf(ve[ge])>=0)return!0;return!1}(p,z))return;const $=this.sourceLayerCoder.decode(F),Q=this.vtLayers[$].feature(R);if(u.needGeometry){const ve=Ol(Q,!0);if(!u.filter(new k(this.tileID.overscaledZ),ve,this.tileID.canonical))return}else if(!u.filter(new k(this.tileID.overscaledZ),Q))return;const ae=this.getId(Q,$);for(let ve=0;ve<z.length;ve++){const le=z[ve];if(p&&p.indexOf(le)<0)continue;const ge=v[le];if(!ge)continue;let xe={};void 0!==ae&&D&&(xe=D.getState(ge.sourceLayer||"_geojsonTileLayer",ae));const be=Hi({},w[le]);be.paint=Rv(be.paint,ge.paint,Q,xe,g),be.layout=Rv(be.layout,ge.layout,Q,xe,g);const ze=!T||T(Q,ge,xe,B);if(!ze)continue;const Le=new Ev(Q,this.z,this.x,this.y,ae);Le.layer=be;let Ze=o[le];void 0===Ze&&(Ze=o[le]=[]),Ze.push({featureIndex:R,feature:Le,intersectionZ:ze})}}lookupSymbolFeatures(o,l,u,p,g,v,w,D){const T={};this.loadVTLayers();const R=Up(g);for(const P of o)this.loadMatchingFeature(T,{bucketIndex:u,sourceLayerIndex:p,featureIndex:P,layoutVertexArrayOffset:0},R,v,w,D,l);return T}loadFeature(o){const{featureIndex:l,sourceLayerIndex:u}=o;this.loadVTLayers();const p=this.sourceLayerCoder.decode(u),g=this.vtFeatures[p];if(g[l])return g[l];const v=this.vtLayers[p].feature(l);return g[l]=v,v}hasLayer(o){for(const l of this.bucketLayerIDs)for(const u of l)if(o===u)return!0;return!1}getId(o,l){let u=o.id;if(this.promoteId){const p="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=p&&(u=o.properties[p]),"boolean"==typeof u&&(u=Number(u))}return u}}function Rv(a,o,l,u,p){return Dn(a,(g,v)=>{const w=o instanceof se?o.get(v):null;return w&&w.evaluate?w.evaluate(l,u,p):w})}function kv(a,o){return o-a}Et(rg,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class L1{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new Nl({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const u=this.getKey(o,l);return this.positions[u]}trim(){const o=this.width,l=this.height=wa(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,u){const p=[];let g=o.length%2==1?-o[o.length-1]*u:0,v=o[0]*u,w=!0;p.push({left:g,right:v,isDash:w,zeroLength:0===o[0]});let D=o[0];for(let T=1;T<o.length;T++){w=!w;const R=o[T];g=D*u,D+=R,v=D*u,p.push({left:g,right:v,isDash:w,zeroLength:0===R})}return p}addRoundDash(o,l,u){const p=l/2;for(let g=-u;g<=u;g++){const v=this.width*(this.nextRow+u+g);let w=0,D=o[w];for(let T=0;T<this.width;T++){T/D.right>1&&(D=o[++w]);const R=Math.abs(T-D.left),P=Math.abs(T-D.right),F=Math.min(R,P);let B;const z=g/u*(p+1);if(D.isDash){const $=p-Math.abs(z);B=Math.sqrt(F*F+$*$)}else B=p-Math.sqrt(F*F+z*z);this.image.data[v+T]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(o,l){for(let D=o.length-1;D>=0;--D){const T=o[D],R=o[D+1];T.zeroLength?o.splice(D,1):R&&R.isDash===T.isDash&&(R.left=T.left,o.splice(D,1))}const u=o[0],p=o[o.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);const g=this.width*this.nextRow;let v=0,w=o[v];for(let D=0;D<this.width;D++){D/w.right>1&&(w=o[++v]);const T=Math.abs(D-w.left),R=Math.abs(D-w.right),P=Math.min(T,R);this.image.data[g+D]=Math.max(0,Math.min(255,(w.isDash?P:-P)+l+128))}}addDash(o,l){const u=this.getKey(o,l);if(this.positions[u])return this.positions[u];const p="round"===l,g=p?7:0,v=2*g+1;if(this.nextRow+v>this.height)return Ei("LineAtlas out of space"),null;0===o.length&&o.push(1);let w=0;for(let R=0;R<o.length;R++)o[R]<0&&(Ei("Negative value is found in line dasharray, replacing values with 0"),o[R]=0),w+=o[R];if(0!==w){const R=this.width/w,P=this.getDashRanges(o,this.width,R);p?this.addRoundDash(P,R,g):this.addRegularDash(P,"square"===l?.5*R:0)}const D=this.nextRow+g;this.nextRow+=v;const T={tl:[D,g],br:[w,0]};return this.positions[u]=T,T}}Et(L1,"LineAtlas");const B1=1*ks;class z1{constructor(o){const l={},u=[];for(const w in o){const D=o[w],T=l[w]={};for(const R in D.glyphs){const P=D.glyphs[+R];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const F=P.metrics.localGlyph?B1:1,B={x:0,y:0,w:P.bitmap.width+2*F,h:P.bitmap.height+2*F};u.push(B),T[R]=B}}const{w:p,h:g}=B_(u),v=new Nl({width:p||1,height:g||1});for(const w in o){const D=o[w];for(const T in D.glyphs){const R=D.glyphs[+T];if(!R||0===R.bitmap.width||0===R.bitmap.height)continue;const P=l[w][T],F=R.metrics.localGlyph?B1:1;Nl.copy(R.bitmap,v,{x:0,y:0},{x:P.x+F,y:P.y+F},R.bitmap)}}this.image=v,this.positions=l}}Et(z1,"GlyphAtlas");class V1{constructor(o){this.tileID=new Li(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=Cu(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,l,u,p,g){this.status="parsing",this.data=o,this.collisionBoxArray=new Qn;const v=new ng(Object.keys(o.layers).sort()),w=new rg(this.tileID,this.promoteId);w.bucketLayerIDs=[];const D={},T=new L1(256,256),R={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:u},P=l.familiesBySource[this.source];for(const xe in P){const be=o.layers[xe];if(!be)continue;let ze=!1,Le=!1;for(const $e of P[xe])"symbol"===$e[0].type?ze=!0:Le=!0;if(!0===this.isSymbolTile&&!ze||!1===this.isSymbolTile&&!Le)continue;1===be.version&&Ei(`Vector tile source "${this.source}" layer "${xe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ze=v.encode(xe),lt=[];for(let $e=0;$e<be.length;$e++){const Qe=be.feature($e),Je=w.getId(Qe,xe);lt.push({feature:Qe,id:Je,index:$e,sourceLayerIndex:Ze})}for(const $e of P[xe]){const Qe=$e[0];void 0!==this.isSymbolTile&&"symbol"===Qe.type!==this.isSymbolTile||Qe.minzoom&&this.zoom<Math.floor(Qe.minzoom)||Qe.maxzoom&&this.zoom>=Qe.maxzoom||"none"!==Qe.visibility&&(Pv($e,this.zoom,u),(D[Qe.id]=Qe.createBucket({index:w.bucketLayerIDs.length,layers:$e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ze,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(lt,R,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push($e.map(Je=>Je.id)))}}let F,B,z,$;T.trim();const Q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ae=()=>{if(F)return g(F);if(B&&z&&$){const xe=new z1(B),be=new h1(z,$);for(const ze in D){const Le=D[ze];Le instanceof Dc?(Pv(Le.layers,this.zoom,u),y1(Le,B,xe.positions,z,be.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):Le.hasPattern&&(Le instanceof vu||Le instanceof xf||Le instanceof Ef)&&(Pv(Le.layers,this.zoom,u),Le.addFeatures(R,this.tileID.canonical,be.patternPositions,u,this.tileTransform))}this.status="done",g(null,{buckets:xa(D).filter(ze=>!ze.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xe.image,lineAtlas:T,imageAtlas:be,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?z:null,glyphPositions:this.returnDependencies?xe.positions:null})}},ve=Dn(R.glyphDependencies,xe=>Object.keys(xe).map(Number));Object.keys(ve).length?p.send("getGlyphs",{uid:this.uid,stacks:ve},(xe,be)=>{F||(F=xe,B=be,ae())},void 0,!1,Q):B={};const le=Object.keys(R.iconDependencies);le.length?p.send("getImages",{icons:le,source:this.source,tileID:this.tileID,type:"icons"},(xe,be)=>{F||(F=xe,z=be,ae())},void 0,!1,Q):z={};const ge=Object.keys(R.patternDependencies);ge.length?p.send("getImages",{icons:ge,source:this.source,tileID:this.tileID,type:"patterns"},(xe,be)=>{F||(F=xe,$=be,ae())},void 0,!1,Q):$={},ae()}}function Pv(a,o,l){const u=new k(o);for(const p of a)p.recalculate(u,l)}class j1{constructor(o){this.entries={},this.scheduler=o}request(o,l,u,p){const g=this.entries[o]=this.entries[o]||{callbacks:[]};if(g.result){const[v,w]=g.result;return this.scheduler?this.scheduler.add(()=>{p(v,w)},l):p(v,w),()=>{}}return g.callbacks.push(p),g.cancel||(g.cancel=u((v,w)=>{g.result=[v,w];for(const D of g.callbacks)this.scheduler?this.scheduler.add(()=>{D(v,w)},l):D(v,w);setTimeout(()=>delete this.entries[o],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(v=>v!==p),g.callbacks.length||(g.cancel(),delete this.entries[o]))}}}function U1(a,o,l){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},p=>{const g=Zc(a.request,(v,w,D,T)=>{v?p(v):w&&p(null,{vectorTile:l?void 0:new zh(new If(w)),rawData:w,cacheControl:D,expires:T})});return()=>{g.cancel(),p()}},o)}const $1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class og{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,u]=new Uint8Array(o,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const p=u>>4;if(1!==p)throw new Error(`Got v${p} data when expected v1.`);const g=$1[15&u];if(!g)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(o,2,1),[w]=new Uint32Array(o,4,1);return new og(w,v,g,o)}constructor(o,l=64,u=Float64Array,p){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=u,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const g=$1.indexOf(this.ArrayType),v=2*o*this.ArrayType.BYTES_PER_ELEMENT,w=o*this.IndexArrayType.BYTES_PER_ELEMENT,D=(8-w%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${u}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+w+D,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+D),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+w+D,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=o)}add(o,l){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=o,this.coords[this._pos++]=l,u}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return sg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,l,u,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:v,nodeSize:w}=this,D=[0,g.length-1,0],T=[];for(;D.length;){const R=D.pop()||0,P=D.pop()||0,F=D.pop()||0;if(P-F<=w){for(let Q=F;Q<=P;Q++){const ae=v[2*Q],ve=v[2*Q+1];ae>=o&&ae<=u&&ve>=l&&ve<=p&&T.push(g[Q])}continue}const B=F+P>>1,z=v[2*B],$=v[2*B+1];z>=o&&z<=u&&$>=l&&$<=p&&T.push(g[B]),(0===R?o<=z:l<=$)&&(D.push(F),D.push(B-1),D.push(1-R)),(0===R?u>=z:p>=$)&&(D.push(B+1),D.push(P),D.push(1-R))}return T}within(o,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:v}=this,w=[0,p.length-1,0],D=[],T=u*u;for(;w.length;){const R=w.pop()||0,P=w.pop()||0,F=w.pop()||0;if(P-F<=v){for(let Q=F;Q<=P;Q++)G1(g[2*Q],g[2*Q+1],o,l)<=T&&D.push(p[Q]);continue}const B=F+P>>1,z=g[2*B],$=g[2*B+1];G1(z,$,o,l)<=T&&D.push(p[B]),(0===R?o-u<=z:l-u<=$)&&(w.push(F),w.push(B-1),w.push(1-R)),(0===R?o+u>=z:l+u>=$)&&(w.push(B+1),w.push(P),w.push(1-R))}return D}}function sg(a,o,l,u,p,g){if(p-u<=l)return;const v=u+p>>1;H1(a,o,v,u,p,g),sg(a,o,l,u,v-1,1-g),sg(a,o,l,v+1,p,1-g)}function H1(a,o,l,u,p,g){for(;p>u;){if(p-u>600){const T=p-u+1,R=l-u+1,P=Math.log(T),F=.5*Math.exp(2*P/3),B=.5*Math.sqrt(P*F*(T-F)/T)*(R-T/2<0?-1:1);H1(a,o,l,Math.max(u,Math.floor(l-R*F/T+B)),Math.min(p,Math.floor(l+(T-R)*F/T+B)),g)}const v=o[2*l+g];let w=u,D=p;for(Yf(a,o,u,l),o[2*p+g]>v&&Yf(a,o,u,p);w<D;){for(Yf(a,o,w,D),w++,D--;o[2*w+g]<v;)w++;for(;o[2*D+g]>v;)D--}o[2*u+g]===v?Yf(a,o,u,D):(D++,Yf(a,o,D,p)),D<=l&&(u=D+1),l<=D&&(p=D-1)}}function Yf(a,o,l,u){$o(a,l,u),$o(o,2*l,2*u),$o(o,2*l+1,2*u+1)}function $o(a,o,l){const u=a[o];a[o]=a[l],a[l]=u}function G1(a,o,l,u){const p=a-l,g=o-u;return p*p+g*g}f.ARRAY_TYPE=uo,f.AUTH_ERR_MSG=we,f.Aabb=Do,f.Actor=class{constructor(a,o,l){this.target=a,this.parent=o,this.mapId=l,this.callbacks={},this.cancelCallbacks={},tl(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ca()?a:at,this.scheduler=new A1}send(a,o,l,u,p=!1,g){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=g,this.callbacks[v]=l);const w=Fd(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:a,hasCallback:!!l,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:hc(o,w)},w),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(a){const o=a.data,l=o.id;if(l&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(o.mustQueue||Ca()){const u=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,o),u&&u.metadata||{type:"message"})}else this.processTask(l,o)}processTask(a,o){if("<response>"===o.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(o.error?l(gl(o.error)):l(null,gl(o.data)))}else{const l=Fd(this.globalScope)?void 0:[],u=o.hasCallback?(g,v)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:g?hc(g):null,data:hc(v,l)},l)}:g=>{},p=gl(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,p,u);else if(this.parent.getWorkerSource){const g=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,g[0],p.source)[g[1]](p,u)}else u(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},f.CanonicalTileID=O_,f.Color=ki,f.ColorMode=Os,f.CullFaceMode=So,f.DEMData=Zf,f.DataConstantProperty=U,f.DedupedRequest=j1,f.DepthMode=G,f.EXTENT=Bt,f.Elevation=class{isDataAvailableAtPoint(a){const o=this._source();if(this.isUsingMockSource()||!o||a.y<0||a.y>1)return!1;const l=o.getSource().maxzoom,u=1<<l,p=Math.floor(a.x),g=Math.floor((a.x-p)*u),v=Math.floor(a.y*u),w=this.findDEMTileFor(new Li(l,p,l,g,v));return!(!w||!w.dem)}getAtPointOrZero(a,o=0){return this.getAtPoint(a,o)||0}getAtPoint(a,o,l=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const u=this._source();if(!u||a.y<0||a.y>1)return o;const p=u.getSource().maxzoom,g=1<<p,v=Math.floor(a.x),w=a.x-v,D=new Li(p,v,p,Math.floor(w*g),Math.floor(a.y*g)),T=this.findDEMTileFor(D);if(!T||!T.dem)return o;const R=T.dem,P=1<<T.tileID.canonical.z,F=(w*P-T.tileID.canonical.x)*R.dim,B=(a.y*P-T.tileID.canonical.y)*R.dim,z=Math.floor(F),$=Math.floor(B);return(l?this.exaggeration():1)*Ln(Ln(R.get(z,$),R.get(z,$+1),B-$),Ln(R.get(z+1,$),R.get(z+1,$+1),B-$),F-z)}getAtTileOffset(a,o,l){const u=1<<a.canonical.z;return this.getAtPointOrZero(new pf(a.wrap+(a.canonical.x+o/Bt)/u,(a.canonical.y+l/Bt)/u))}getAtTileOffsetFunc(a,o,l,u){return p=>{const g=this.getAtTileOffset(a,p.x,p.y),v=u.upVector(a.canonical,p.x,p.y);return Zr(v,v,g*u.upVectorScale(a.canonical,o,l).metersToTile),v}}getForTilePoints(a,o,l,u){if(this.isUsingMockSource())return!1;const p=ep.create(this,a,u);return!!p&&(o.forEach(g=>{g[2]=this.exaggeration()*p.getElevationAt(g[0],g[1],l)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(a);if(!o||!o.dem)return null;const l=o.dem.tree,u=o.tileID,p=1<<a.canonical.z-u.canonical.z;let g=a.canonical.x/p-u.canonical.x,v=a.canonical.y/p-u.canonical.y,w=0;for(let D=0;D<a.canonical.z-u.canonical.z&&!l.leaves[w];D++){g*=2,v*=2;const T=2*Math.floor(v)+Math.floor(g);w=l.childOffsets[w]+T,g%=1,v%=1}return{min:this.exaggeration()*l.minimums[w],max:this.exaggeration()*l.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},f.ErrorEvent=rl,f.EvaluationParameters=k,f.Event=Yc,f.Evented=Gu,f.FillExtrusionBucket=Ef,f.Frustum=du,f.FrustumCorners=Mh,f.GLOBE_RADIUS=mc,f.GLOBE_SCALE_MATCH_LATITUDE=45,f.GLOBE_ZOOM_THRESHOLD_MAX=vb,f.GLOBE_ZOOM_THRESHOLD_MIN=yb,f.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_fillGridMeshWithLods(a,o){const l=new Ie,u=new Ot,p=[],g=a+1+2,v=o[0]+1,w=o[0]+1+(1+o.length),D=(T,R,P)=>{let F=T===g-1?T-2:0===T?T:T-1;return F+=P?24575:0,[F,R]};for(let T=0;T<g;++T)l.emplaceBack(...D(T,0,!0));for(let T=0;T<v;++T)for(let R=0;R<g;++R)l.emplaceBack(...D(R,T,(0===R||R===g-1)&&!0));for(let T=0;T<o.length;++T){const R=o[T];for(let P=0;P<g;++P)l.emplaceBack(...D(P,R,!0))}for(let T=0;T<o.length;++T){const R=u.length,P=o[T]+1+2,F=new Ot;for(let $=0;$<P-1;$++){const Q=$===P-2,ae=Q?g*(w-o.length+T-$):g;for(let ve=0;ve<g-1;ve++){const le=$*g+ve;0===$||Q||0===ve||ve===g-2?(F.emplaceBack(le+1,le,le+ae),F.emplaceBack(le+ae,le+ae+1,le+1)):(u.emplaceBack(le+1,le,le+ae),u.emplaceBack(le+ae,le+ae+1,le+1))}}const B=Xi.simpleSegment(0,R,l.length,u.length-R);for(let $=0;$<F.uint16.length;$+=3)u.emplaceBack(F.uint16[$],F.uint16[$+1],F.uint16[$+2]);const z=Xi.simpleSegment(0,R,l.length,u.length-R);p.push({withoutSkirts:B,withSkirts:z})}return{vertices:l,indices:u,segments:p}}_createGrid(a){const o=this._fillGridMeshWithLods(64,Sl);this._gridSegments=o.segments,this._gridBuffer=a.createVertexBuffer(o.vertices,Tl.members),this._gridIndexBuffer=a.createIndexBuffer(o.indices,!0)}_createPoles(a){const o=new Ot;for(let p=0;p<=64;p++)o.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=a.createIndexBuffer(o,!0);const l=new Xn,u=new Xn;this._poleSegments=[];for(let p=0,g=0;p<yb;p++){const v=360/(1<<p);l.emplaceBack(0,-mc,0,.5,0),u.emplaceBack(0,-mc,0,.5,1);for(let w=0;w<=64;w++){const D=w/64,T=Ln(0,v,D),[R,P,F]=Ah(vC,uM,T,mc);l.emplaceBack(R,P,F,D,0),u.emplaceBack(R,P,F,D,1)}this._poleSegments.push(Xi.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,gb,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,gb,!1)}getGridBuffers(a,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,o){if(!this._wireframeSegments){const l=new nr,u=64,p=u+1+2,g=1;this._wireframeSegments=[];for(let v=0,w=0;v<Sl.length;v++){const D=Sl[v];for(let R=g;R<D+g;R++)for(let P=g;P<u+g;P++){const F=R*p+P;l.emplaceBack(F,F+1),l.emplaceBack(F,F+p),l.emplaceBack(F,F+p+1)}const T=D*u*3;this._wireframeSegments.push(Xi.simpleSegment(0,w,(D+1)*p,T)),w+=T}this._wireframeIndexBuffer=a.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},f.GlyphManager=La,f.ImagePosition=wc,f.KDBush=og,f.LivePerformanceUtils=ti,f.LngLat=Zn,f.LngLatBounds=wl,f.LocalGlyphMode=Of,f.MAX_MERCATOR_LATITUDE=Yr,f.MercatorCoordinate=pf,f.ONE_EM=Xr,f.OverscaledTileID=Li,f.PerformanceMarkers=nn,f.Point=ot,f.Properties=he,f.RGBAImage=as,f.Ray=d_,f.RequestManager=class{constructor(a,o,l){this._transformRequestFn=a,this._customAccessToken=o,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let o="";for(let l=0;l<10;l++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Wl,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}}normalizeStyleURL(a,o){if(!Me(a))return a;const l=_t(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeGlyphsURL(a,o){if(!Me(a))return a;const l=_t(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeSourceURL(a,o,l,u){if(!Me(a))return a;const p=_t(a);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),l&&p.params.push(`language=${l}`),u&&p.params.push(`worldview=${u}`),this._makeAPIURL(p,this._customAccessToken||o)}normalizeSpriteURL(a,o,l,u){const p=_t(a);return Me(a)?(p.path=`/styles/v1${p.path}/sprite${o}${l}`,this._makeAPIURL(p,this._customAccessToken||u)):(p.path+=`${o}${l}`,Xe(p))}normalizeTileURL(a,o,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Me(a))return a;const u=_t(a);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||l&&"raster"!==u.authority&&512===l?"@2x":""}${yn.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${gn.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${gn.TILE_URL_VERSION}${u.path}`);const p=this._customAccessToken||function(g){for(const v of g){const w=v.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(u.params)||gn.ACCESS_TOKEN;return gn.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,p)}canonicalizeTileURL(a,o){const l=_t(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let u="mapbox://";l.path.match(/^\/raster\/v1\//)?u+=`raster/${l.path.replace(`/${gn.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${l.path.replace(`/${gn.TILE_URL_VERSION}/`,"")}`;let p=l.params;return o&&(p=p.filter(g=>!g.match(/^access_token=/))),p.length&&(u+=`?${p.join("&")}`),u}canonicalizeTileset(a,o){const l=!!o&&Me(o),u=[];for(const p of a.tiles||[])Fe(p)?u.push(this.canonicalizeTileURL(p,l)):u.push(p);return u}_makeAPIURL(a,o){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=_t(gn.API_URL);if(a.protocol=u.protocol,a.authority=u.authority,"http"===a.protocol){const p=a.params.indexOf("secure");p>=0&&a.params.splice(p,1)}if("/"!==u.path&&(a.path=`${u.path}${a.path}`),!gn.REQUIRE_ACCESS_TOKEN)return Xe(a);if(o=o||gn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(p=>-1===p.indexOf("access_token")),a.params.push(`access_token=${o||""}`),Xe(a)}},f.ResourceType=qs,f.SegmentVector=Xi,f.SourceCache=Sc,f.StencilMode=oe,f.StructArrayLayout1ui2=os,f.StructArrayLayout2f1f2i16=Lt,f.StructArrayLayout2i4=Ie,f.StructArrayLayout2ui4=nr,f.StructArrayLayout3f12=wn,f.StructArrayLayout3ui6=Ot,f.StructArrayLayout4i8=Ke,f.StructArrayLayout5f20=Xn,f.Texture=Hf,f.Tile=Tv,f.Transitionable=V,f.Uniform1f=Jp,f.Uniform1i=class extends yl{constructor(a){super(a),this.current=0}set(a,o,l){this.fetchUniformLocation(a,o)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},f.Uniform2f=class extends yl{constructor(a){super(a),this.current=[0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},f.Uniform3f=class extends yl{constructor(a){super(a),this.current=[0,0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},f.Uniform4f=cb,f.UniformColor=ou,f.UniformMatrix2f=class extends yl{constructor(a){super(a),this.current=lM}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},f.UniformMatrix3f=class extends yl{constructor(a){super(a),this.current=cC}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let u=0;u<9;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},f.UniformMatrix4f=class extends yl{constructor(a){super(a),this.current=ef}set(a,o,l){if(this.fetchUniformLocation(a,o)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},f.UnwrappedTileID=ls,f.ValidationError=Dt,f.VectorTileFeature=Vh,f.VectorTileWorkerSource=class extends Gu{constructor(a,o,l,u,p){super(),this.actor=a,this.layerIndex=o,this.availableImages=l,this.loadVectorData=p||U1,this.loading={},this.loaded={},this.deduped=new j1(a.scheduler),this.isSpriteLoaded=u,this.scheduler=a.scheduler}loadTile(a,o){const l=a.uid,u=a&&a.request,p=u&&u.collectResourceTiming,g=this.loading[l]=new V1(a);g.abort=this.loadVectorData(a,(v,w)=>{const D=!this.loading[l];if(delete this.loading[l],D||v||!w)return g.status="done",D||(this.loaded[l]=g),o(v);const T=w.rawData,R={};w.expires&&(R.expires=w.expires),w.cacheControl&&(R.cacheControl=w.cacheControl),g.vectorTile=w.vectorTile||new zh(new If(T));const P=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(F,B)=>{if(F||!B)return o(F);const z={};if(p){const $=Sp(u);$.length>0&&(z.resourceTiming=JSON.parse(JSON.stringify($)))}o(null,Hi({rawTileData:T.slice(0)},B,R,z))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[l]=g})}reloadTile(a,o){const l=this.loaded,u=a.uid,p=this;if(l&&l[u]){const g=l[u];g.showCollisionBoxes=a.showCollisionBoxes,g.enableTerrain=!!a.enableTerrain,g.projection=a.projection,g.tileTransform=Cu(a.tileID.canonical,a.projection);const v=(w,D)=>{const T=g.reloadCallback;T&&(delete g.reloadCallback,g.parse(g.vectorTile,p.layerIndex,this.availableImages,p.actor,T)),o(w,D)};"parsing"===g.status?g.reloadCallback=v:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(a,o){const l=a.uid,u=this.loading[l];u&&(u.abort&&u.abort(),delete this.loading[l]),o()}removeTile(a,o){const l=this.loaded,u=a.uid;l&&l[u]&&delete l[u],o()}},f.WritingMode=Uo,f.ZoomDependentExpression=Wd,f.add=mi,f.addDynamicAttributes=eg,f.adjoint=function(a,o){var l=o[0],u=o[1],p=o[2],g=o[3],v=o[4],w=o[5],D=o[6],T=o[7],R=o[8];return a[0]=v*R-w*T,a[1]=p*T-u*R,a[2]=u*w-p*v,a[3]=w*D-g*R,a[4]=l*R-p*D,a[5]=p*g-l*w,a[6]=g*T-v*D,a[7]=u*D-l*T,a[8]=l*v-u*g,a},f.asyncAll=vr,f.bezier=qc,f.bindAll=tl,f.boundsAttributes=R1,f.bufferConvexPolygon=function(a,o){const l=[];for(let u=0;u<a.length;u++){const p=lr(u-1,-1,a.length-1),g=lr(u+1,-1,a.length-1),v=a[u],w=a[g],D=a[p].sub(v).unit(),T=w.sub(v).unit(),R=T.angleWithSep(D.x,D.y),P=D.add(T).unit().mult(-1*o/Math.sin(R/2));l.push(v.add(P))}return l},f.cacheEntryPossiblyAdded=function(a){Vt++,Vt>$u&&(a.getActor().send("enforceCacheSizeLimit",er),Vt=0)},f.calculateGlobeLabelMatrix=function(a,o){const{x:l,y:u}=a.point,p=fu(l,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return dd(p,p,By(Ml(o)))},f.calculateGlobeMatrix=function(a){const{x:o,y:l}=a.point,{lng:u,lat:p}=a._center;return fu(o,l,a.worldSize,u,p)},f.calculateGlobeMercatorMatrix=function(a){const o=a.pixelsPerMeter,l=o/Pl(1,a.center.lat),u=ra(new Float64Array(16));return Ch(u,u,[a.point.x,a.point.y,0]),au(u,u,[l,l,o]),Float32Array.from(u)},f.circumferenceAtLatitude=p_,f.clamp=hn,f.clearTileCache=function(a){if(!Gs())return;const o=at.caches.delete(_s);a&&o.catch(a).then(()=>a())},f.clipLine=HC,f.clone=function(a){var o=new uo(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},f.clone$1=Fo,f.collisionCircleLayout=gM,f.config=gn,f.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a},f.create=function(){var a=new uo(16);return uo!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},f.create$1=l_,f.createExpression=ad,f.createLayout=De,f.createStyleLayer=function(a){return"custom"===a.type?new M1(a):new Kh[a.type](a)},f.cross=af,f.degToRad=mn,f.distance=function(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2])},f.div=function(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a[2]=o[2]/l[2],a},f.dot=Ms,f.earthRadius=hf,f.ease=jr,f.easeCubicInOut=vn,f.ecefToLatLng=function([a,o,l]){const u=Math.hypot(a,o,l),p=Math.atan2(a,l),g=.5*Math.PI-Math.acos(-o/u);return new Zn(yr(p),yr(g))},f.emitValidationErrors=My,f.endsWith=Xl,f.enforceCacheSizeLimit=function(a){gs(),Qo&&Qo.then(o=>{o.keys().then(l=>{for(let u=0;u<l.length-a;u++)o.delete(l[u])})})},f.evaluateSizeForFeature=N_,f.evaluateSizeForZoom=$h,f.evaluateVariableOffset=G_,f.evented=x,f.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},f.exactEquals$1=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]},f.exported=il,f.exported$1=yn,f.extend=Hi,f.extend$1=ol,f.fillExtrusionHeightLift=fd,f.filterObject=Wc,f.fromMat4=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],a},f.fromQuat=function(a,o){var l=o[0],u=o[1],p=o[2],g=o[3],v=l+l,w=u+u,D=p+p,T=l*v,R=u*v,P=u*w,F=p*v,B=p*w,z=p*D,$=g*v,Q=g*w,ae=g*D;return a[0]=1-P-z,a[1]=R+ae,a[2]=F-Q,a[3]=0,a[4]=R-ae,a[5]=1-T-z,a[6]=B+$,a[7]=0,a[8]=F+Q,a[9]=B-$,a[10]=1-T-P,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},f.fromRotation=function(a,o){var l=Math.sin(o),u=Math.cos(o);return a[0]=u,a[1]=l,a[2]=0,a[3]=-l,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},f.fromScaling=ub,f.furthestTileCorner=function(a){const o=Math.round((a+45+360)%360/90)%4;return Vu[o]},f.getAABBPointSquareDist=function(a,o,l){let u=0;for(let p=0;p<2;++p){const g=l?l[p]:0;a[p]>g&&(u+=(a[p]-g)*(a[p]-g)),o[p]<g&&(u+=(g-o[p])*(g-o[p]))}return u},f.getAnchorAlignment=_v,f.getAnchorJustification=wv,f.getBounds=function(a){let o=1/0,l=1/0,u=-1/0,p=-1/0;for(const g of a)o=Math.min(o,g.x),l=Math.min(l,g.y),u=Math.max(u,g.x),p=Math.max(p,g.y);return{min:new ot(o,l),max:new ot(u,p)}},f.getColumn=Ql,f.getDefaultExportFromCjs=ms,f.getGridMatrix=function(a,o,l,u){const p=o.getNorth(),g=o.getSouth(),v=o.getWest(),w=o.getEast(),D=1<<a.z,T=w-v,R=p-g,P=T/64,F=-R/Sl[l],B=[0,P,0,F,0,0,p,v,0];if(a.z>0){const z=180/u;db(B,B,[z/T+1,0,0,0,z/R+1,0,-.5*z/P,.5*z/F,1])}return B[2]=D,B[5]=a.x,B[8]=a.y,B},f.getImage=fe,f.getJSON=function(a,o){return Ea(Hi(a,{type:"json"}),o)},f.getLatitudinalLod=function(a){const o=Yr-5;a=hn(a,-o,o)/o*90;const l=Math.pow(Math.abs(Math.sin(mn(a))),3);return Math.round(l*(Sl.length-1))},f.getMapSessionAPI=He,f.getPerformanceMeasurement=Sp,f.getProjection=C1,f.getRTLTextPluginStatus=C,f.getReferrer=ec,f.getTilePoint=function(a,{x:o,y:l},u=0){return new ot(((o-u)*a.scale-a.x)*Bt,(l*a.scale-a.y)*Bt)},f.getTileVec3=function(a,o,l=0){return Eh(((o.x-l)*a.scale-a.x)*Bt,(o.y*a.scale-a.y)*Bt,Eb(o.z,o.y))},f.getVideo=function(a,o){const l=at.document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let u=0;u<a.length;u++){const p=at.document.createElement("source");Hu(a[u])||(l.crossOrigin="Anonymous"),p.src=a[u],l.appendChild(p)}return{cancel:()=>{}}},f.globeCenterToScreenPoint=function(a){const o=[0,0,0],l=ra(new Float64Array(16));return dd(l,a.pixelMatrix,a.globeMatrix),yi(o,o,l),new ot(o[0],o[1])},f.globeDenormalizeECEF=By,f.globeECEFOrigin=function(a,o){const l=[0,0,0];return yi(l,l,uf(Ml(o.canonical))),yi(l,l,a),l},f.globeMetersToEcef=u_,f.globeNormalizeECEF=uf,f.globePixelsToTileUnits=function(a,o){return Bt/(512*Math.pow(2,a))*pu(Ml(o))},f.globePoleMatrixForTile=function(a,o,l){const u=ra(new Float64Array(16)),p=(o/(1<<a)-.5)*Math.PI*2;return Cl(u,l.globeMatrix,p),Float32Array.from(u)},f.globeTileBounds=Ml,f.globeTiltAtLngLat=wb,f.globeToMercatorTransition=Rl,f.globeUseCustomAntiAliasing=function(a,o,l){const u=Rl(l.zoom),p=a.style.map._antialias,g=!!o.extStandardDerivatives,v=o.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return 0===u&&!p&&!v&&g},f.identity=ra,f.identity$1=mb,f.invert=c_,f.isFullscreen=function(){return!!at.document.fullscreenElement||!!at.document.webkitFullscreenElement},f.isLngLatBehindGlobe=Cb,f.isMapAuthenticated=function(a){return xr.has(a)},f.isMapboxURL=Me,f.isSafariWithAntialiasingBug=function(a){const o=a.navigator?a.navigator.userAgent:null;return!!Fd(a)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},f.latFromMercatorY=ho,f.latLngToECEF=uu,f.len=dM,f.length=Pr,f.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},f.lngFromMercatorX=ss,f.loadVectorTile=U1,f.makeRequest=Ea,f.mapValue=function(a,o,l,u,p){return hn((a-o)/(l-o)*(p-u)+u,u,p)},f.mercatorScale=f_,f.mercatorXfromLng=kl,f.mercatorYfromLat=Fa,f.mercatorZfromAltitude=Pl,f.mul=hb,f.mul$1=cM,f.multiply=dd,f.multiply$1=db,f.multiply$2=fb,f.nextPowerOfTwo=wa,f.normalize=hr,f.normalize$1=_C,f.normalize$2=mC,f.number=Ln,f.ortho=function(a,o,l,u,p,g,v){var w=1/(o-l),D=1/(u-p),T=1/(g-v);return a[0]=-2*w,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*D,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*T,a[11]=0,a[12]=(o+l)*w,a[13]=(p+u)*D,a[14]=(v+g)*T,a[15]=1,a},f.pbf=o1,f.perspective=function(a,o,l,u,p){var g,v=1/Math.tan(o/2);return a[0]=v/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=v,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=p&&p!==1/0?(a[10]=(p+u)*(g=1/(u-p)),a[14]=2*p*u*g):(a[10]=-1,a[14]=-2*u),a},f.pick=function(a,o){const l={};for(let u=0;u<o.length;u++){const p=o[u];p in a&&(l[p]=a[p])}return l},f.plugin=M,f.pointGeometry=Zl,f.polesInViewport=function(a){const o=ra(new Float64Array(16));dd(o,a.pixelMatrix,a.globeMatrix);const l=[0,Oa,0],u=[0,Rs,0];return yi(l,l,o),yi(u,u,o),[l[0]>0&&l[0]<=a.width&&l[1]>0&&l[1]<=a.height&&!Cb(a,new Zn(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!Cb(a,new Zn(a.center.lat,-90))]},f.polygonContainsPoint=_u,f.polygonIntersectsBox=Uy,f.polygonIntersectsPolygon=Vy,f.polygonizeBounds=function(a,o,l=0,u=!0){const p=new ot(l,l),g=a.sub(p),v=o.add(p),w=[g,new ot(v.x,g.y),v,new ot(g.x,v.y)];return u&&w.push(g.clone()),w},f.posAttributes=Tl,f.postMapLoadEvent=Fi,f.postPerformanceEvent=cr,f.postTurnstileEvent=wt,f.potpack=B_,f.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},f.radToDeg=yr,f.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],f.registerForPluginStateChange=function(a){return a({pluginStatus:_,pluginURL:c}),x.on("pluginStateChange",a),a},f.removeAuthState=function(a){xr.delete(a)},f.renderColorRamp=Ky,f.resample=m_,f.rotateX=Dh,f.rotateX$1=_b,f.rotateY=Cl,f.rotateY$1=Cr,f.rotateZ=function(a,o,l){var u=Math.sin(l),p=Math.cos(l),g=o[0],v=o[1],w=o[2],D=o[3],T=o[4],R=o[5],P=o[6],F=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=g*p+T*u,a[1]=v*p+R*u,a[2]=w*p+P*u,a[3]=D*p+F*u,a[4]=T*p-g*u,a[5]=R*p-v*u,a[6]=P*p-w*u,a[7]=F*p-D*u,a},f.rotateZ$1=function(a,o,l){l*=.5;var u=o[0],p=o[1],g=o[2],v=o[3],w=Math.sin(l),D=Math.cos(l);return a[0]=u*D+p*w,a[1]=p*D-u*w,a[2]=g*D+v*w,a[3]=v*D-g*w,a},f.scale=au,f.scale$1=fC,f.scale$2=Zr,f.scaleAndAdd=Dl,f.set=function(a,o,l,u){return a[0]=o,a[1]=l,a[2]=u,a},f.setCacheLimits=function(a,o){er=a,$u=o},f.setColumn=function(a,o,l){a[4*o+0]=l[0],a[4*o+1]=l[1],a[4*o+2]=l[2],a[4*o+3]=l[3]},f.setRTLTextPlugin=function(a,o,l=!1){if(_===qr||_===Xp||_===gh)throw new Error("setRTLTextPlugin cannot be called multiple times.");c=il.resolveURL(a),_=qr,Es=o,y(),l||S()},f.smoothstep=Xt,f.spec=We,f.squaredLength=function(a){var o=a[0],l=a[1],u=a[2];return o*o+l*l+u*u},f.storeAuthState=function(a,o){o?xr.add(a):xr.delete(a)},f.sub=El,f.subtract=sf,f.symbolSize=zC,f.tileAABB=function(a,o,l,u,p,g,v,w,D){if("globe"===D.name)return function Al(a,o,l){const u=o/a.worldSize,p=a.globeMatrix;if(l.z<=1){const Le=Ml(l).getCorners();return xb(Le,p,u),Do.fromPoints(Le)}const g=h_(l),v=Il(g);xb(v,p,u);const w=Number.MAX_VALUE,D=[-w,-w,-w],T=[w,w,w];if(g.contains(a.center)){for(const lt of v)Th(T,T,lt),oa(D,D,lt);D[2]=0;const Le=a.point,Ze=[Le.x*u,Le.y*u,0];return Th(T,T,Ze),oa(D,D,Ze),new Do(T,D)}const R=[p[12]*u,p[13]*u,p[14]*u],P=g.getCenter(),F=hn(a.center.lat,-Yr,Yr),B=hn(P.lat,-Yr,Yr),z=kl(a.center.lng),$=Fa(F);let Q=z-kl(P.lng);const ae=$-Fa(B);Q>.5?Q-=1:Q<-.5&&(Q+=1);let ve=0;Math.abs(Q)>Math.abs(ae)?ve=Q>=0?1:3:(ve=ae>=0?0:2,Dl(R,R,[p[4]*u,p[5]*u,p[6]*u],-Math.sin(mn(ae>=0?g.getSouth():g.getNorth()))*mc));const le=v[ve],ge=v[(ve+1)%4],xe=new yC(le,ge,R),be=[Ny(xe,0)||le[0],Ny(xe,1)||le[1],Ny(xe,2)||le[2]],ze=Rl(a.zoom);if(ze>0){const Le=function({x:lt,y:$e,z:Qe},Je,it,st,qe){const vt=1/(1<<Qe);let St=lt*vt,bt=St+vt,rn=$e*vt,ut=rn+vt,Nt=0;const Zt=(St+bt)/2-st;return Zt>.5?Nt=-1:Zt<-.5&&(Nt=1),St=((St+Nt)*Je-(st*=Je))*it+st,bt=((bt+Nt)*Je-st)*it+st,rn=(rn*Je-(qe*=Je))*it+qe,ut=(ut*Je-qe)*it+qe,[[St,ut,0],[bt,ut,0],[bt,rn,0],[St,rn,0]]}(l,o,a._pixelsPerMercatorPixel,z,$);for(let lt=0;lt<v.length;lt++)gc(v[lt],Le[lt],ze);const Ze=mi([],Le[ve],Le[(ve+1)%4]);Zr(Ze,Ze,.5),gc(be,Ze,ze)}for(const Le of v)Th(T,T,Le),oa(D,D,Le);return T[2]=Math.min(le[2],ge[2]),Th(T,T,be),oa(D,D,be),new Do(T,D)}(a,o,new O_(l,u,p));const T=Cu({z:l,x:u,y:p},D);return new Do([(g+T.x/T.scale)*o,o*(T.y/T.scale),v],[(g+T.x2/T.scale)*o,o*(T.y2/T.scale),w])},f.tileCornersToBounds=h_,f.tileTransform=Cu,f.transformMat3=function(a,o,l){var u=o[0],p=o[1],g=o[2];return a[0]=u*l[0]+p*l[3]+g*l[6],a[1]=u*l[1]+p*l[4]+g*l[7],a[2]=u*l[2]+p*l[5]+g*l[8],a},f.transformMat4=yi,f.transformMat4$1=Sh,f.transformQuat=pC,f.transitionTileAABBinECEF=df,f.translate=Ch,f.transpose=function(a,o){if(a===o){var l=o[1],u=o[2],p=o[5];a[1]=o[3],a[2]=o[6],a[3]=l,a[5]=o[7],a[6]=u,a[7]=p}else a[0]=o[0],a[1]=o[3],a[2]=o[6],a[3]=o[1],a[4]=o[4],a[5]=o[7],a[6]=o[2],a[7]=o[5],a[8]=o[8];return a},f.triggerPluginCompletionEvent=h,f.uniqueId=Oo,f.updateGlobeVertexNormal=function(a,o,l,u,p){const g=5*o+2;a.float32[g+0]=l,a.float32[g+1]=u,a.float32[g+2]=p},f.validateCustomStyleLayer=function(a){const o=[],l=a.id;return void 0===l&&o.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&o.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},f.validateFilter=a=>Cs(Qd(a)),f.validateFog=a=>Cs(i_(a)),f.validateLayer=a=>Cs(eu(a)),f.validateLight=a=>Cs(ph(a)),f.validateSource=a=>Cs(Ey(a)),f.validateStyle=r_,f.validateTerrain=a=>Cs(ld(a)),f.values=xa,f.vectorTile=Bh,f.version=Vr,f.warnOnce=Ei,f.window=at,f.wrap=lr}),Tp(0,function(f){function at(ye){if("number"==typeof ye||"boolean"==typeof ye||"string"==typeof ye||null==ye)return JSON.stringify(ye);if(Array.isArray(ye)){let X="[";for(const fe of ye)X+=`${at(fe)},`;return`${X}]`}let W="{";for(const X of Object.keys(ye).sort())W+=`${X}:${at(ye[X])},`;return`${W}}`}function Vr(ye){let W="";for(const X of f.refProperties)W+=`/${at(ye[X])}`;return W}class Po{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,X){for(const we of W)this._layerConfigs[we.id]=we,(this._layers[we.id]=f.createStyleLayer(we)).compileFilter(),this.keyCache[we.id]&&delete this.keyCache[we.id];for(const we of X)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const fe=function(we,Me){const Fe={};for(let Ae=0;Ae<we.length;Ae++){const Ue=Me&&Me[we[Ae].id]||Vr(we[Ae]);Me&&(Me[we[Ae].id]=Ue);let ht=Fe[Ue];ht||(ht=Fe[Ue]=[]),ht.push(we[Ae])}const Ne=[];for(const Ae in Fe)Ne.push(Fe[Ae]);return Ne}(f.values(this._layerConfigs),this.keyCache);for(const we of fe){const Me=we.map(_t=>this._layers[_t.id]),Fe=Me[0];if("none"===Fe.visibility)continue;const Ne=Fe.source||"";let Ae=this.familiesBySource[Ne];Ae||(Ae=this.familiesBySource[Ne]={});const Ue=Fe.sourceLayer||"_geojsonTileLayer";let ht=Ae[Ue];ht||(ht=Ae[Ue]=[]),ht.push(Me)}}}class gn{loadTile(W,X){const{uid:fe,encoding:we,rawImageData:Me,padding:Fe,buildQuadTree:Ne}=W,Ae=f.window.ImageBitmap&&Me instanceof f.window.ImageBitmap?this.getImageData(Me,Fe):Me;X(null,new f.DEMData(fe,Ae,we,Fe<1,Ne))}getImageData(W,X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);const fe=this.offscreenCanvasContext.getImageData(-X,-X,W.width+2*X,W.height+2*X);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),fe}}function yn(ye,W){if(0!==ye.length){un(ye[0],W);for(var X=1;X<ye.length;X++)un(ye[X],!W)}}function un(ye,W){for(var X=0,fe=0,we=0,Me=ye.length,Fe=Me-1;we<Me;Fe=we++){var Ne=(ye[we][0]-ye[Fe][0])*(ye[Fe][1]+ye[we][1]),Ae=X+Ne;fe+=Math.abs(X)>=Math.abs(Ne)?X-Ae+Ne:Ne-Ae+X,X=Ae}X+fe>=0!=!!W&&ye.reverse()}var ro=f.getDefaultExportFromCjs(function ye(W,X){var fe,we=W&&W.type;if("FeatureCollection"===we)for(fe=0;fe<W.features.length;fe++)ye(W.features[fe],X);else if("GeometryCollection"===we)for(fe=0;fe<W.geometries.length;fe++)ye(W.geometries[fe],X);else if("Feature"===we)ye(W.geometry,X);else if("Polygon"===we)yn(W.coordinates,X);else if("MultiPolygon"===we)for(fe=0;fe<W.coordinates.length;fe++)yn(W.coordinates[fe],X);return W});const Yo=f.VectorTileFeature.prototype.toGeoJSON;var Ja={exports:{}},Gn=f.pointGeometry,Wl=f.vectorTile.VectorTileFeature,ms=Gc;function Gc(ye,W){this.options=W||{},this.features=ye,this.length=ye.length}function oo(ye,W){this.id="number"==typeof ye.id?ye.id:void 0,this.type=ye.type,this.rawGeometry=1===ye.type?[ye.geometry]:ye.geometry,this.properties=ye.tags,this.extent=W||4096}Gc.prototype.feature=function(ye){return new oo(this.features[ye],this.options.extent)},oo.prototype.loadGeometry=function(){var ye=this.rawGeometry;this.geometry=[];for(var W=0;W<ye.length;W++){for(var X=ye[W],fe=[],we=0;we<X.length;we++)fe.push(new Gn(X[we][0],X[we][1]));this.geometry.push(fe)}return this.geometry},oo.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ye=this.geometry,W=1/0,X=-1/0,fe=1/0,we=-1/0,Me=0;Me<ye.length;Me++)for(var Fe=ye[Me],Ne=0;Ne<Fe.length;Ne++){var Ae=Fe[Ne];W=Math.min(W,Ae.x),X=Math.max(X,Ae.x),fe=Math.min(fe,Ae.y),we=Math.max(we,Ae.y)}return[W,fe,X,we]},oo.prototype.toGeoJSON=Wl.prototype.toGeoJSON;var Us=f.pbf,Zl=ms;function Xo(ye){var W=new Us;return function(X,fe){for(var we in X.layers)fe.writeMessage(3,ot,X.layers[we])}(ye,W),W.finish()}function ot(ye,W){var X;W.writeVarintField(15,ye.version||1),W.writeStringField(1,ye.name||""),W.writeVarintField(5,ye.extent||4096);var fe={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<ye.length;X++)fe.feature=ye.feature(X),W.writeMessage(2,zu,fe);var we=fe.keys;for(X=0;X<we.length;X++)W.writeStringField(3,we[X]);var Me=fe.values;for(X=0;X<Me.length;X++)W.writeMessage(4,vn,Me[X])}function zu(ye,W){var X=ye.feature;void 0!==X.id&&W.writeVarintField(1,X.id),W.writeMessage(2,zm,ye),W.writeVarintField(3,X.type),W.writeMessage(4,Vu,X)}function zm(ye,W){var X=ye.feature,fe=ye.keys,we=ye.values,Me=ye.keycache,Fe=ye.valuecache;for(var Ne in X.properties){var Ae=X.properties[Ne],Ue=Me[Ne];if(null!==Ae){void 0===Ue&&(fe.push(Ne),Me[Ne]=Ue=fe.length-1),W.writeVarint(Ue);var ht=typeof Ae;"string"!==ht&&"boolean"!==ht&&"number"!==ht&&(Ae=JSON.stringify(Ae));var _t=ht+":"+Ae,Xe=Fe[_t];void 0===Xe&&(we.push(Ae),Fe[_t]=Xe=we.length-1),W.writeVarint(Xe)}}}function mn(ye,W){return(W<<3)+(7&ye)}function yr(ye){return ye<<1^ye>>31}function Vu(ye,W){for(var X=ye.loadGeometry(),fe=ye.type,we=0,Me=0,Fe=X.length,Ne=0;Ne<Fe;Ne++){var Ae=X[Ne],Ue=1;1===fe&&(Ue=Ae.length),W.writeVarint(mn(1,Ue));for(var ht=3===fe?Ae.length-1:Ae.length,_t=0;_t<ht;_t++){1===_t&&1!==fe&&W.writeVarint(mn(2,ht-1));var Xe=Ae[_t].x-we,Kt=Ae[_t].y-Me;W.writeVarint(yr(Xe)),W.writeVarint(yr(Kt)),we+=Xe,Me+=Kt}3===fe&&W.writeVarint(mn(7,1))}}function vn(ye,W){var X=typeof ye;"string"===X?W.writeStringField(1,ye):"boolean"===X?W.writeBooleanField(7,ye):"number"===X&&(ye%1!=0?W.writeDoubleField(3,ye):ye<0?W.writeSVarintField(6,ye):W.writeVarintField(5,ye))}Ja.exports=Xo,Ja.exports.fromVectorTileJs=Xo,Ja.exports.fromGeojsonVt=function(ye,W){W=W||{};var X={};for(var fe in ye)X[fe]=new Zl(ye[fe].features,W),X[fe].name=fe,X[fe].version=W.version,X[fe].extent=W.extent;return Xo({layers:X})},Ja.exports.GeoJSONWrapper=Zl;var qc=f.getDefaultExportFromCjs(Ja.exports);const jr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},hn=Math.fround||(Xt=new Float32Array(1),ye=>(Xt[0]=+ye,Xt[0]));var Xt;const lr=3,vr=5,xa=6;class Hi{constructor(W){this.options=Object.assign(Object.create(jr),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:X,minZoom:fe,maxZoom:we}=this.options;X&&console.time("total time");const Me=`prepare ${W.length} points`;X&&console.time(Me),this.points=W;const Fe=[];for(let Ae=0;Ae<W.length;Ae++){const Ue=W[Ae];if(!Ue.geometry)continue;const[ht,_t]=Ue.geometry.coordinates,Xe=hn(Yl(ht)),Kt=hn(wa(_t));Fe.push(Xe,Kt,1/0,Ae,-1,1),this.options.reduce&&Fe.push(0)}let Ne=this.trees[we+1]=this._createTree(Fe);X&&console.timeEnd(Me);for(let Ae=we;Ae>=fe;Ae--){const Ue=+Date.now();Ne=this.trees[Ae]=this._createTree(this._cluster(Ne,Ae)),X&&console.log("z%d: %d clusters in %dms",Ae,Ne.numItems,+Date.now()-Ue)}return X&&console.timeEnd("total time"),this}getClusters(W,X){let fe=((W[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,W[1]));let Me=180===W[2]?180:((W[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)fe=-180,Me=180;else if(fe>Me){const _t=this.getClusters([fe,we,180,Fe],X),Xe=this.getClusters([-180,we,Me,Fe],X);return _t.concat(Xe)}const Ne=this.trees[this._limitZoom(X)],Ae=Ne.range(Yl(fe),wa(Fe),Yl(Me),wa(we)),Ue=Ne.data,ht=[];for(const _t of Ae){const Xe=this.stride*_t;ht.push(Ue[Xe+vr]>1?el(Ue,Xe,this.clusterProps):this.points[Ue[Xe+lr]])}return ht}getChildren(W){const X=this._getOriginId(W),fe=this._getOriginZoom(W),we="No cluster with the specified id.",Me=this.trees[fe];if(!Me)throw new Error(we);const Fe=Me.data;if(X*this.stride>=Fe.length)throw new Error(we);const Ne=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),Ae=Me.within(Fe[X*this.stride],Fe[X*this.stride+1],Ne),Ue=[];for(const ht of Ae){const _t=ht*this.stride;Fe[_t+4]===W&&Ue.push(Fe[_t+vr]>1?el(Fe,_t,this.clusterProps):this.points[Fe[_t+lr]])}if(0===Ue.length)throw new Error(we);return Ue}getLeaves(W,X,fe){const we=[];return this._appendLeaves(we,W,X=X||10,fe=fe||0,0),we}getTile(W,X,fe){const we=this.trees[this._limitZoom(W)],Me=Math.pow(2,W),{extent:Fe,radius:Ne}=this.options,Ae=Ne/Fe,Ue=(fe-Ae)/Me,ht=(fe+1+Ae)/Me,_t={features:[]};return this._addTileFeatures(we.range((X-Ae)/Me,Ue,(X+1+Ae)/Me,ht),we.data,X,fe,Me,_t),0===X&&this._addTileFeatures(we.range(1-Ae/Me,Ue,1,ht),we.data,Me,fe,Me,_t),X===Me-1&&this._addTileFeatures(we.range(0,Ue,Ae/Me,ht),we.data,-1,fe,Me,_t),_t.features.length?_t:null}getClusterExpansionZoom(W){let X=this._getOriginZoom(W)-1;for(;X<=this.options.maxZoom;){const fe=this.getChildren(W);if(X++,1!==fe.length)break;W=fe[0].properties.cluster_id}return X}_appendLeaves(W,X,fe,we,Me){const Fe=this.getChildren(X);for(const Ne of Fe){const Ae=Ne.properties;if(Ae&&Ae.cluster?Me+Ae.point_count<=we?Me+=Ae.point_count:Me=this._appendLeaves(W,Ae.cluster_id,fe,we,Me):Me<we?Me++:W.push(Ne),W.length===fe)break}return Me}_createTree(W){const X=new f.KDBush(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<W.length;fe+=this.stride)X.add(W[fe],W[fe+1]);return X.finish(),X.data=W,X}_addTileFeatures(W,X,fe,we,Me,Fe){for(const Ne of W){const Ae=Ne*this.stride,Ue=X[Ae+vr]>1;let ht,_t,Xe;if(Ue)ht=Oo(X,Ae,this.clusterProps),_t=X[Ae],Xe=X[Ae+1];else{const tn=this.points[X[Ae+lr]];ht=tn.properties;const[bn,wt]=tn.geometry.coordinates;_t=Yl(bn),Xe=wa(wt)}const Kt={type:1,geometry:[[Math.round(this.options.extent*(_t*Me-fe)),Math.round(this.options.extent*(Xe*Me-we))]],tags:ht};let Ut;Ut=Ue||this.options.generateId?X[Ae+lr]:this.points[X[Ae+lr]].id,void 0!==Ut&&(Kt.id=Ut),Fe.features.push(Kt)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,X){const{radius:fe,extent:we,reduce:Me,minPoints:Fe}=this.options,Ne=fe/(we*Math.pow(2,X)),Ae=W.data,Ue=[],ht=this.stride;for(let _t=0;_t<Ae.length;_t+=ht){if(Ae[_t+2]<=X)continue;Ae[_t+2]=X;const Xe=Ae[_t],Kt=Ae[_t+1],Ut=W.within(Ae[_t],Ae[_t+1],Ne),tn=Ae[_t+vr];let bn=tn;for(const wt of Ut){const Pt=wt*ht;Ae[Pt+2]>X&&(bn+=Ae[Pt+vr])}if(bn>tn&&bn>=Fe){let wt,Pt=Xe*tn,Fi=Kt*tn,br=-1;const cr=((_t/ht|0)<<5)+(X+1)+this.points.length;for(const ys of Ut){const He=ys*ht;if(Ae[He+2]<=X)continue;Ae[He+2]=X;const xr=Ae[He+vr];Pt+=Ae[He]*xr,Fi+=Ae[He+1]*xr,Ae[He+4]=cr,Me&&(wt||(wt=this._map(Ae,_t,!0),br=this.clusterProps.length,this.clusterProps.push(wt)),Me(wt,this._map(Ae,He)))}Ae[_t+4]=cr,Ue.push(Pt/bn,Fi/bn,1/0,cr,-1,bn),Me&&Ue.push(br)}else{for(let wt=0;wt<ht;wt++)Ue.push(Ae[_t+wt]);if(bn>1)for(const wt of Ut){const Pt=wt*ht;if(!(Ae[Pt+2]<=X)){Ae[Pt+2]=X;for(let Fi=0;Fi<ht;Fi++)Ue.push(Ae[Pt+Fi])}}}}return Ue}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,X,fe){if(W[X+vr]>1){const Fe=this.clusterProps[W[X+xa]];return fe?Object.assign({},Fe):Fe}const we=this.points[W[X+lr]].properties,Me=this.options.map(we);return fe&&Me===we?Object.assign({},Me):Me}}function el(ye,W,X){return{type:"Feature",id:ye[W+lr],properties:Oo(ye,W,X),geometry:{type:"Point",coordinates:[(fe=ye[W],360*(fe-.5)),ju(ye[W+1])]}};var fe}function Oo(ye,W,X){const fe=ye[W+vr],we=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,Me=ye[W+xa],Fe=-1===Me?{}:Object.assign({},X[Me]);return Object.assign(Fe,{cluster:!0,cluster_id:ye[W+lr],point_count:fe,point_count_abbreviated:we})}function Yl(ye){return ye/360+.5}function wa(ye){const W=Math.sin(ye*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function ju(ye){const W=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function tl(ye,W,X,fe){for(var we,Me=fe,Fe=X-W>>1,Ne=X-W,Ae=ye[W],Ue=ye[W+1],ht=ye[X],_t=ye[X+1],Xe=W+3;Xe<X;Xe+=3){var Kt=Xl(ye[Xe],ye[Xe+1],Ae,Ue,ht,_t);if(Kt>Me)we=Xe,Me=Kt;else if(Kt===Me){var Ut=Math.abs(Xe-Fe);Ut<Ne&&(we=Xe,Ne=Ut)}}Me>fe&&(we-W>3&&tl(ye,W,we,fe),ye[we+2]=Me,X-we>3&&tl(ye,we,X,fe))}function Xl(ye,W,X,fe,we,Me){var Fe=we-X,Ne=Me-fe;if(0!==Fe||0!==Ne){var Ae=((ye-X)*Fe+(W-fe)*Ne)/(Fe*Fe+Ne*Ne);Ae>1?(X=we,fe=Me):Ae>0&&(X+=Fe*Ae,fe+=Ne*Ae)}return(Fe=ye-X)*Fe+(Ne=W-fe)*Ne}function Dn(ye,W,X,fe){var we={id:void 0===ye?null:ye,type:W,geometry:X,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Me){var Fe=Me.geometry,Ne=Me.type;if("Point"===Ne||"MultiPoint"===Ne||"LineString"===Ne)Wc(Me,Fe);else if("Polygon"===Ne||"MultiLineString"===Ne)for(var Ae=0;Ae<Fe.length;Ae++)Wc(Me,Fe[Ae]);else if("MultiPolygon"===Ne)for(Ae=0;Ae<Fe.length;Ae++)for(var Ue=0;Ue<Fe[Ae].length;Ue++)Wc(Me,Fe[Ae][Ue])}(we),we}function Wc(ye,W){for(var X=0;X<W.length;X+=3)ye.minX=Math.min(ye.minX,W[X]),ye.minY=Math.min(ye.minY,W[X+1]),ye.maxX=Math.max(ye.maxX,W[X]),ye.maxY=Math.max(ye.maxY,W[X+1])}function Fo(ye,W,X,fe){if(W.geometry){var we=W.geometry.coordinates,Me=W.geometry.type,Fe=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),Ne=[],Ae=W.id;if(X.promoteId?Ae=W.properties[X.promoteId]:X.generateId&&(Ae=fe||0),"Point"===Me)Kl(we,Ne);else if("MultiPoint"===Me)for(var Ue=0;Ue<we.length;Ue++)Kl(we[Ue],Ne);else if("LineString"===Me)Ei(we,Ne,Fe,!1);else if("MultiLineString"===Me){if(X.lineMetrics){for(Ue=0;Ue<we.length;Ue++)Ei(we[Ue],Ne=[],Fe,!1),ye.push(Dn(Ae,"LineString",Ne,W.properties));return}Ko(we,Ne,Fe,!1)}else if("Polygon"===Me)Ko(we,Ne,Fe,!0);else{if("MultiPolygon"!==Me){if("GeometryCollection"===Me){for(Ue=0;Ue<W.geometry.geometries.length;Ue++)Fo(ye,{id:Ae,geometry:W.geometry.geometries[Ue],properties:W.properties},X,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ue=0;Ue<we.length;Ue++){var ht=[];Ko(we[Ue],ht,Fe,!0),Ne.push(ht)}}ye.push(Dn(Ae,Me,Ne,W.properties))}}function Kl(ye,W){W.push(Uu(ye[0])),W.push(Ca(ye[1])),W.push(0)}function Ei(ye,W,X,fe){for(var we,Me,Fe=0,Ne=0;Ne<ye.length;Ne++){var Ae=Uu(ye[Ne][0]),Ue=Ca(ye[Ne][1]);W.push(Ae),W.push(Ue),W.push(0),Ne>0&&(Fe+=fe?(we*Ue-Ae*Me)/2:Math.sqrt(Math.pow(Ae-we,2)+Math.pow(Ue-Me,2))),we=Ae,Me=Ue}var ht=W.length-3;W[2]=1,tl(W,0,ht,X),W[ht+2]=1,W.size=Math.abs(Fe),W.start=0,W.end=W.size}function Ko(ye,W,X,fe){for(var we=0;we<ye.length;we++){var Me=[];Ei(ye[we],Me,X,fe),W.push(Me)}}function Uu(ye){return ye/360+.5}function Ca(ye){var W=Math.sin(ye*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function ei(ye,W,X,fe,we,Me,Fe,Ne){if(fe/=W,Me>=(X/=W)&&Fe<fe)return ye;if(Fe<X||Me>=fe)return null;for(var Ae=[],Ue=0;Ue<ye.length;Ue++){var ht=ye[Ue],_t=ht.geometry,Xe=ht.type,Kt=0===we?ht.minX:ht.minY,Ut=0===we?ht.maxX:ht.maxY;if(Kt>=X&&Ut<fe)Ae.push(ht);else if(!(Ut<X||Kt>=fe)){var tn=[];if("Point"===Xe||"MultiPoint"===Xe)$s(_t,tn,X,fe,we);else if("LineString"===Xe)Fd(_t,tn,X,fe,we,!1,Ne.lineMetrics);else if("MultiLineString"===Xe)Ql(_t,tn,X,fe,we,!1);else if("Polygon"===Xe)Ql(_t,tn,X,fe,we,!0);else if("MultiPolygon"===Xe)for(var bn=0;bn<_t.length;bn++){var wt=[];Ql(_t[bn],wt,X,fe,we,!0),wt.length&&tn.push(wt)}if(tn.length){if(Ne.lineMetrics&&"LineString"===Xe){for(bn=0;bn<tn.length;bn++)Ae.push(Dn(ht.id,Xe,tn[bn],ht.tags));continue}"LineString"!==Xe&&"MultiLineString"!==Xe||(1===tn.length?(Xe="LineString",tn=tn[0]):Xe="MultiLineString"),"Point"!==Xe&&"MultiPoint"!==Xe||(Xe=3===tn.length?"Point":"MultiPoint"),Ae.push(Dn(ht.id,Xe,tn,ht.tags))}}}return Ae.length?Ae:null}function $s(ye,W,X,fe,we){for(var Me=0;Me<ye.length;Me+=3){var Fe=ye[Me+we];Fe>=X&&Fe<=fe&&(W.push(ye[Me]),W.push(ye[Me+1]),W.push(ye[Me+2]))}}function Fd(ye,W,X,fe,we,Me,Fe){for(var Ne,Ae,Ue=Hs(ye),ht=0===we?er:$u,_t=ye.start,Xe=0;Xe<ye.length-3;Xe+=3){var Kt=ye[Xe],Ut=ye[Xe+1],tn=ye[Xe+2],bn=ye[Xe+3],wt=ye[Xe+4],Pt=0===we?Kt:Ut,Fi=0===we?bn:wt,br=!1;Fe&&(Ne=Math.sqrt(Math.pow(Kt-bn,2)+Math.pow(Ut-wt,2))),Pt<X?Fi>X&&(Ae=ht(Ue,Kt,Ut,bn,wt,X),Fe&&(Ue.start=_t+Ne*Ae)):Pt>fe?Fi<fe&&(Ae=ht(Ue,Kt,Ut,bn,wt,fe),Fe&&(Ue.start=_t+Ne*Ae)):_s(Ue,Kt,Ut,tn),Fi<X&&Pt>=X&&(Ae=ht(Ue,Kt,Ut,bn,wt,X),br=!0),Fi>fe&&Pt<=fe&&(Ae=ht(Ue,Kt,Ut,bn,wt,fe),br=!0),!Me&&br&&(Fe&&(Ue.end=_t+Ne*Ae),W.push(Ue),Ue=Hs(ye)),Fe&&(_t+=Ne)}var cr=ye.length-3;Kt=ye[cr],Ut=ye[cr+1],tn=ye[cr+2],(Pt=0===we?Kt:Ut)>=X&&Pt<=fe&&_s(Ue,Kt,Ut,tn),cr=Ue.length-3,Me&&cr>=3&&(Ue[cr]!==Ue[0]||Ue[cr+1]!==Ue[1])&&_s(Ue,Ue[0],Ue[1],Ue[2]),Ue.length&&W.push(Ue)}function Hs(ye){var W=[];return W.size=ye.size,W.start=ye.start,W.end=ye.end,W}function Ql(ye,W,X,fe,we,Me){for(var Fe=0;Fe<ye.length;Fe++)Fd(ye[Fe],W,X,fe,we,Me,!1)}function _s(ye,W,X,fe){ye.push(W),ye.push(X),ye.push(fe)}function er(ye,W,X,fe,we,Me){var Fe=(Me-W)/(fe-W);return ye.push(Me),ye.push(X+(we-X)*Fe),ye.push(1),Fe}function $u(ye,W,X,fe,we,Me){var Fe=(Me-X)/(we-X);return ye.push(W+(fe-W)*Fe),ye.push(Me),ye.push(1),Fe}function Qo(ye,W){for(var X=[],fe=0;fe<ye.length;fe++){var we,Me=ye[fe],Fe=Me.type;if("Point"===Fe||"MultiPoint"===Fe||"LineString"===Fe)we=Jl(Me.geometry,W);else if("MultiLineString"===Fe||"Polygon"===Fe){we=[];for(var Ne=0;Ne<Me.geometry.length;Ne++)we.push(Jl(Me.geometry[Ne],W))}else if("MultiPolygon"===Fe)for(we=[],Ne=0;Ne<Me.geometry.length;Ne++){for(var Ae=[],Ue=0;Ue<Me.geometry[Ne].length;Ue++)Ae.push(Jl(Me.geometry[Ne][Ue],W));we.push(Ae)}X.push(Dn(Me.id,Fe,we,Me.tags))}return X}function Jl(ye,W){var X=[];X.size=ye.size,void 0!==ye.start&&(X.start=ye.start,X.end=ye.end);for(var fe=0;fe<ye.length;fe+=3)X.push(ye[fe]+W,ye[fe+1],ye[fe+2]);return X}function Gs(ye,W){if(ye.transformed)return ye;var X,fe,we,Me=1<<ye.z,Fe=ye.x,Ne=ye.y;for(X=0;X<ye.features.length;X++){var Ae=ye.features[X],Ue=Ae.geometry,ht=Ae.type;if(Ae.geometry=[],1===ht)for(fe=0;fe<Ue.length;fe+=2)Ae.geometry.push(gs(Ue[fe],Ue[fe+1],W,Me,Fe,Ne));else for(fe=0;fe<Ue.length;fe++){var _t=[];for(we=0;we<Ue[fe].length;we+=2)_t.push(gs(Ue[fe][we],Ue[fe][we+1],W,Me,Fe,Ne));Ae.geometry.push(_t)}}return ye.transformed=!0,ye}function gs(ye,W,X,fe,we,Me){return[Math.round(X*(ye*fe-we)),Math.round(X*(W*fe-Me))]}function Da(ye,W,X,fe,we){for(var Me=W===we.maxZoom?0:we.tolerance/((1<<W)*we.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:fe,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ne=0;Ne<ye.length;Ne++){Fe.numFeatures++,Vt(Fe,ye[Ne],Me,we);var Ae=ye[Ne].minX,Ue=ye[Ne].minY,ht=ye[Ne].maxX,_t=ye[Ne].maxY;Ae<Fe.minX&&(Fe.minX=Ae),Ue<Fe.minY&&(Fe.minY=Ue),ht>Fe.maxX&&(Fe.maxX=ht),_t>Fe.maxY&&(Fe.maxY=_t)}return Fe}function Vt(ye,W,X,fe){var we=W.geometry,Me=W.type,Fe=[];if("Point"===Me||"MultiPoint"===Me)for(var Ne=0;Ne<we.length;Ne+=3)Fe.push(we[Ne]),Fe.push(we[Ne+1]),ye.numPoints++,ye.numSimplified++;else if("LineString"===Me)qs(Fe,we,ye,X,!1,!1);else if("MultiLineString"===Me||"Polygon"===Me)for(Ne=0;Ne<we.length;Ne++)qs(Fe,we[Ne],ye,X,"Polygon"===Me,0===Ne);else if("MultiPolygon"===Me)for(var Ae=0;Ae<we.length;Ae++){var Ue=we[Ae];for(Ne=0;Ne<Ue.length;Ne++)qs(Fe,Ue[Ne],ye,X,!0,0===Ne)}if(Fe.length){var ht=W.tags||null;if("LineString"===Me&&fe.lineMetrics){for(var _t in ht={},W.tags)ht[_t]=W.tags[_t];ht.mapbox_clip_start=we.start/we.size,ht.mapbox_clip_end=we.end/we.size}var Xe={geometry:Fe,type:"Polygon"===Me||"MultiPolygon"===Me?3:"LineString"===Me||"MultiLineString"===Me?2:1,tags:ht};null!==W.id&&(Xe.id=W.id),ye.features.push(Xe)}}function qs(ye,W,X,fe,we,Me){var Fe=fe*fe;if(fe>0&&W.size<(we?Fe:fe))X.numPoints+=W.length/3;else{for(var Ne=[],Ae=0;Ae<W.length;Ae+=3)(0===fe||W[Ae+2]>Fe)&&(X.numSimplified++,Ne.push(W[Ae]),Ne.push(W[Ae+1])),X.numPoints++;we&&function(Ue,ht){for(var _t=0,Xe=0,Kt=Ue.length,Ut=Kt-2;Xe<Kt;Ut=Xe,Xe+=2)_t+=(Ue[Xe]-Ue[Ut])*(Ue[Xe+1]+Ue[Ut+1]);if(_t>0===ht)for(Xe=0,Kt=Ue.length;Xe<Kt/2;Xe+=2){var tn=Ue[Xe],bn=Ue[Xe+1];Ue[Xe]=Ue[Kt-2-Xe],Ue[Xe+1]=Ue[Kt-1-Xe],Ue[Kt-2-Xe]=tn,Ue[Kt-1-Xe]=bn}}(Ne,Me),ye.push(Ne)}}function nl(ye,W){var X=(W=this.options=function(we,Me){for(var Fe in Me)we[Fe]=Me[Fe];return we}(Object.create(this.options),W)).debug;if(X&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");var we,Me,Fe,Ne,Ae,Ue,fe=function(we,Me){var Fe=[];if("FeatureCollection"===we.type)for(var Ne=0;Ne<we.features.length;Ne++)Fo(Fe,we.features[Ne],Me,Ne);else Fo(Fe,"Feature"===we.type?we:{geometry:we},Me);return Fe}(ye,W);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ne=we=fe,Ae=ei(we,1,-1-(Fe=(Me=W).buffer/Me.extent),Fe,0,-1,2,Me),Ue=ei(we,1,1-Fe,2+Fe,0,-1,2,Me),(Ae||Ue)&&(Ne=ei(we,1,-Fe,1+Fe,0,-1,2,Me)||[],Ae&&(Ne=Qo(Ae,1).concat(Ne)),Ue&&(Ne=Ne.concat(Qo(Ue,-1)))),(fe=Ne).length&&this.splitTile(fe,0,0,0),X&&(fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ec(ye,W,X){return 32*((1<<ye)*X+W)+ye}function Ea(ye,W){const X=ye.tileID.canonical;if(!this._geoJSONIndex)return W(null,null);const fe=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!fe)return W(null,null);const we=new class{constructor(Fe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.EXTENT,this.length=Fe.length,this._features=Fe}feature(Fe){return new class{constructor(Ne){this._feature=Ne,this.extent=f.EXTENT,this.type=Ne.type,this.properties=Ne.tags,"id"in Ne&&!isNaN(Ne.id)&&(this.id=parseInt(Ne.id,10))}loadGeometry(){if(1===this._feature.type){const Ne=[];for(const Ae of this._feature.geometry)Ne.push([new f.Point(Ae[0],Ae[1])]);return Ne}{const Ne=[];for(const Ae of this._feature.geometry){const Ue=[];for(const ht of Ae)Ue.push(new f.Point(ht[0],ht[1]));Ne.push(Ue)}return Ne}}toGeoJSON(Ne,Ae,Ue){return Yo.call(this,Ne,Ae,Ue)}}(this._features[Fe])}}(fe.features);let Me=qc(we);0===Me.byteOffset&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),W(null,{vectorTile:we,rawData:Me.buffer})}nl.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},nl.prototype.splitTile=function(ye,W,X,fe,we,Me,Fe){for(var Ne=[ye,W,X,fe],Ae=this.options,Ue=Ae.debug;Ne.length;){fe=Ne.pop(),X=Ne.pop(),W=Ne.pop(),ye=Ne.pop();var ht=1<<W,_t=ec(W,X,fe),Xe=this.tiles[_t];if(!Xe&&(Ue>1&&console.time("creation"),Xe=this.tiles[_t]=Da(ye,W,X,fe,Ae),this.tileCoords.push({z:W,x:X,y:fe}),Ue)){Ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,X,fe,Xe.numFeatures,Xe.numPoints,Xe.numSimplified),console.timeEnd("creation"));var Kt="z"+W;this.stats[Kt]=(this.stats[Kt]||0)+1,this.total++}if(Xe.source=ye,we){if(W===Ae.maxZoom||W===we)continue;var Ut=1<<we-W;if(X!==Math.floor(Me/Ut)||fe!==Math.floor(Fe/Ut))continue}else if(W===Ae.indexMaxZoom||Xe.numPoints<=Ae.indexMaxPoints)continue;if(Xe.source=null,0!==ye.length){Ue>1&&console.time("clipping");var tn,bn,wt,Pt,Fi,br,cr=.5*Ae.buffer/Ae.extent,ys=.5-cr,He=.5+cr,xr=1+cr;tn=bn=wt=Pt=null,Fi=ei(ye,ht,X-cr,X+He,0,Xe.minX,Xe.maxX,Ae),br=ei(ye,ht,X+ys,X+xr,0,Xe.minX,Xe.maxX,Ae),ye=null,Fi&&(tn=ei(Fi,ht,fe-cr,fe+He,1,Xe.minY,Xe.maxY,Ae),bn=ei(Fi,ht,fe+ys,fe+xr,1,Xe.minY,Xe.maxY,Ae),Fi=null),br&&(wt=ei(br,ht,fe-cr,fe+He,1,Xe.minY,Xe.maxY,Ae),Pt=ei(br,ht,fe+ys,fe+xr,1,Xe.minY,Xe.maxY,Ae),br=null),Ue>1&&console.timeEnd("clipping"),Ne.push(tn||[],W+1,2*X,2*fe),Ne.push(bn||[],W+1,2*X,2*fe+1),Ne.push(wt||[],W+1,2*X+1,2*fe),Ne.push(Pt||[],W+1,2*X+1,2*fe+1)}}},nl.prototype.getTile=function(ye,W,X){var fe=this.options,we=fe.extent,Me=fe.debug;if(ye<0||ye>24)return null;var Fe=1<<ye,Ne=ec(ye,W=(W%Fe+Fe)%Fe,X);if(this.tiles[Ne])return Gs(this.tiles[Ne],we);Me>1&&console.log("drilling down to z%d-%d-%d",ye,W,X);for(var Ae,Ue=ye,ht=W,_t=X;!Ae&&Ue>0;)Ue--,ht=Math.floor(ht/2),_t=Math.floor(_t/2),Ae=this.tiles[ec(Ue,ht,_t)];return Ae&&Ae.source?(Me>1&&console.log("found parent tile z%d-%d-%d",Ue,ht,_t),Me>1&&console.time("drilling down"),this.splitTile(Ae.source,Ue,ht,_t,ye,W,X),Me>1&&console.timeEnd("drilling down"),this.tiles[Ne]?Gs(this.tiles[Ne],we):null):null};class Zc extends f.VectorTileWorkerSource{constructor(W,X,fe,we,Me){super(W,X,fe,we,Ea),Me&&(this.loadGeoJSON=Me)}loadData(W,X){const fe=W&&W.request,we=fe&&fe.collectResourceTiming;this.loadGeoJSON(W,(Me,Fe)=>{if(Me||!Fe)return X(Me);if("object"!=typeof Fe)return X(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));{ro(Fe,!0);try{if(W.filter){const Ae=f.createExpression(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ae.result)throw new Error(Ae.value.map(ht=>`${ht.key}: ${ht.message}`).join(", "));Fe={type:"FeatureCollection",features:Fe.features.filter(ht=>Ae.value.evaluate({zoom:0},ht))}}this._geoJSONIndex=W.cluster?new Hi(function({superclusterOptions:Ae,clusterProperties:Ue}){if(!Ue||!Ae)return Ae;const ht={},_t={},Xe={accumulated:null,zoom:0},Kt={properties:null},Ut=Object.keys(Ue);for(const tn of Ut){const[bn,wt]=Ue[tn],Pt=f.createExpression(wt),Fi=f.createExpression("string"==typeof bn?[bn,["accumulated"],["get",tn]]:bn);ht[tn]=Pt.value,_t[tn]=Fi.value}return Ae.map=tn=>{Kt.properties=tn;const bn={};for(const wt of Ut)bn[wt]=ht[wt].evaluate(Xe,Kt);return bn},Ae.reduce=(tn,bn)=>{Kt.properties=bn;for(const wt of Ut)Xe.accumulated=tn[wt],tn[wt]=_t[wt].evaluate(Xe,Kt)},Ae}(W)).load(Fe.features):new nl(Ae=Fe,W.geojsonVtOptions)}catch(Ae){return X(Ae)}this.loaded={};const Ne={};if(we){const Ae=f.getPerformanceMeasurement(fe);Ae&&(Ne.resourceTiming={},Ne.resourceTiming[W.source]=JSON.parse(JSON.stringify(Ae)))}X(null,Ne)}var Ae})}reloadTile(W,X){const fe=this.loaded;return fe&&fe[W.uid]?super.reloadTile(W,X):this.loadTile(W,X)}loadGeoJSON(W,X){if(W.request)f.getJSON(W.request,X);else{if("string"!=typeof W.data)return X(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));try{return X(null,JSON.parse(W.data))}catch{return X(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(W,X){try{X(null,this._geoJSONIndex.getClusterExpansionZoom(W.clusterId))}catch(fe){X(fe)}}getClusterChildren(W,X){try{X(null,this._geoJSONIndex.getChildren(W.clusterId))}catch(fe){X(fe)}}getClusterLeaves(W,X){try{X(null,this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset))}catch(fe){X(fe)}}}class Hu{constructor(W){this.self=W,this.actor=new f.Actor(W,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=f.getProjection({name:"mercator"}),this.workerSourceTypes={vector:f.VectorTileWorkerSource,geojson:Zc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(X,fe)=>{if(this.workerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.workerSourceTypes[X]=fe},this.self.registerRTLTextPlugin=X=>{if(f.plugin.isParsed())throw new Error("RTL text plugin already registered.");f.plugin.applyArabicShaping=X.applyArabicShaping,f.plugin.processBidirectionalText=X.processBidirectionalText,f.plugin.processStyledBidirectionalText=X.processStyledBidirectionalText}}clearCaches(W,X,fe){delete this.layerIndexes[W],delete this.availableImages[W],delete this.workerSources[W],delete this.demWorkerSources[W],fe()}checkIfReady(W,X,fe){fe()}setReferrer(W,X){this.referrer=X}spriteLoaded(W,X){this.isSpriteLoaded[W]=X;for(const fe in this.workerSources[W]){const we=this.workerSources[W][fe];for(const Me in we)we[Me]instanceof f.VectorTileWorkerSource&&(we[Me].isSpriteLoaded=X,we[Me].fire(new f.Event("isSpriteLoaded")))}}setImages(W,X,fe){this.availableImages[W]=X;for(const we in this.workerSources[W]){const Me=this.workerSources[W][we];for(const Fe in Me)Me[Fe].availableImages=X}fe()}enableTerrain(W,X,fe){this.terrain=X,fe()}setProjection(W,X){this.projections[W]=f.getProjection(X)}setLayers(W,X,fe){this.getLayerIndex(W).replace(X),fe()}updateLayers(W,X,fe){this.getLayerIndex(W).update(X.layers,X.removedIds),fe()}loadTile(W,X,fe){const we=this.enableTerrain?f.extend({enableTerrain:this.terrain},X):X;we.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,X.type,X.source).loadTile(we,fe)}loadDEMTile(W,X,fe){const we=this.enableTerrain?f.extend({buildQuadTree:this.terrain},X):X;this.getDEMWorkerSource(W,X.source).loadTile(we,fe)}reloadTile(W,X,fe){const we=this.enableTerrain?f.extend({enableTerrain:this.terrain},X):X;we.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,X.type,X.source).reloadTile(we,fe)}abortTile(W,X,fe){this.getWorkerSource(W,X.type,X.source).abortTile(X,fe)}removeTile(W,X,fe){this.getWorkerSource(W,X.type,X.source).removeTile(X,fe)}removeSource(W,X,fe){if(!this.workerSources[W]||!this.workerSources[W][X.type]||!this.workerSources[W][X.type][X.source])return;const we=this.workerSources[W][X.type][X.source];delete this.workerSources[W][X.type][X.source],void 0!==we.removeSource?we.removeSource(X,fe):fe()}loadWorkerSource(W,X,fe){try{this.self.importScripts(X.url),fe()}catch(we){fe(we.toString())}}syncRTLPluginState(W,X,fe){try{f.plugin.setState(X);const we=f.plugin.getPluginURL();if(f.plugin.isLoaded()&&!f.plugin.isParsed()&&null!=we){this.self.importScripts(we);const Me=f.plugin.isParsed();fe(Me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${we}`),Me)}}catch(we){fe(we.toString())}}getAvailableImages(W){let X=this.availableImages[W];return X||(X=[]),X}getLayerIndex(W){let X=this.layerIndexes[W];return X||(X=this.layerIndexes[W]=new Po),X}getWorkerSource(W,X,fe){return this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][X]||(this.workerSources[W][X]={}),this.workerSources[W][X][fe]||(this.workerSources[W][X][fe]=new this.workerSourceTypes[X]({send:(Me,Fe,Ne,Ae,Ue,ht)=>{this.actor.send(Me,Fe,Ne,W,Ue,ht)},scheduler:this.actor.scheduler},this.getLayerIndex(W),this.getAvailableImages(W),this.isSpriteLoaded[W])),this.workerSources[W][X][fe]}getDEMWorkerSource(W,X){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][X]||(this.demWorkerSources[W][X]=new gn),this.demWorkerSources[W][X]}enforceCacheSizeLimit(W,X){f.enforceCacheSizeLimit(X)}getWorkerPerformanceMetrics(W,X,fe){fe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Hu(self)),Hu}),Tp(0,function(f){function at(_,c){if(Array.isArray(_)){if(!Array.isArray(c)||_.length!==c.length)return!1;for(let h=0;h<_.length;h++)if(!at(_[h],c[h]))return!1;return!0}if("object"==typeof _&&null!==_&&null!==c){if("object"!=typeof c||Object.keys(_).length!==Object.keys(c).length)return!1;for(const h in _)if(!at(_[h],c[h]))return!1;return!0}return _===c}var Vr=Po;function Po(_){return c=_,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,x,C=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(C);try{x=new Worker(S),y=!0}catch{y=!1}return x&&x.terminate(),URL.revokeObjectURL(S),y}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var y=document.createElement("canvas");y.width=y.height=1;var x=y.getContext("2d");if(!x)return!1;var C=x.getImageData(0,0,1,1);return C&&C.width===y.width}()||(void 0===gn[h=c&&c.failIfMajorPerformanceCaveat]&&(gn[h]=function(y){var x,S,M,k,C=(S=y,M=document.createElement("canvas"),(k=Object.create(Po.webGLContextAttributes)).failIfMajorPerformanceCaveat=S,M.getContext("webgl",k)||M.getContext("experimental-webgl",k));if(!C)return!1;try{x=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!x||C.isContextLost())&&(C.shaderSource(x,"void main() {}"),C.compileShader(x),!0===C.getShaderParameter(x,C.COMPILE_STATUS))}(h)),!gn[h]||document.documentMode));var c,h}var gn={};function yn(_,c,h){const y=f.window.document.createElement(_);return void 0!==c&&(y.className=c),h&&h.appendChild(y),y}function un(_,c,h){const y=f.window.document.createElementNS("http://www.w3.org/2000/svg",_);for(const x of Object.keys(c))y.setAttributeNS(null,x,c[x]);return h&&h.appendChild(y),y}Po.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ro=f.window.document&&f.window.document.documentElement.style,Yo=ro&&void 0!==ro.userSelect?"userSelect":"WebkitUserSelect";let Ja;function Gn(){ro&&Yo&&(Ja=ro[Yo],ro[Yo]="none")}function Wl(){ro&&Yo&&(ro[Yo]=Ja)}function ms(_){_.preventDefault(),_.stopPropagation(),f.window.removeEventListener("click",ms,!0)}function Gc(){f.window.addEventListener("click",ms,!0),f.window.setTimeout(()=>{f.window.removeEventListener("click",ms,!0)},0)}function oo(_,c){const h=_.getBoundingClientRect();return Xo(_,h,c)}function Us(_,c){const h=_.getBoundingClientRect(),y=[];for(let x=0;x<c.length;x++)y.push(Xo(_,h,c[x]));return y}function Zl(_){return void 0!==f.window.InstallTrigger&&2===_.button&&_.ctrlKey&&f.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button}function Xo(_,c,h){const y=_.offsetWidth===c.width?1:_.offsetWidth/c.width;return new f.Point((h.clientX-c.left)*y,(h.clientY-c.top)*y)}function ot(_,c){var h=c[0],y=c[1],x=c[2],C=c[3],S=h*C-x*y;return S?(_[0]=C*(S=1/S),_[1]=-y*S,_[2]=-x*S,_[3]=h*S,_):null}function zu(_){const{userImage:c}=_;return!!(c&&c.render&&c.render())&&(_.data.replace(new Uint8Array(c.data.buffer)),!0)}class zm extends f.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:h,callback:y}of this.requestors)this._notify(h,y);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,h){this._validate(c,h)&&(this.images[c]=h)}_validate(c,h){let y=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new f.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),y=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new f.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),y=!1),this._validateContent(h.content,h)||(this.fire(new f.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),y=!1),y}_validateStretch(c,h){if(!c)return!0;let y=0;for(const x of c){if(x[0]<y||x[1]<x[0]||h<x[1])return!1;y=x[1]}return!0}_validateContent(c,h){return!(c&&(4!==c.length||c[0]<0||h.data.width<c[0]||c[1]<0||h.data.height<c[1]||c[2]<0||h.data.width<c[2]||c[3]<0||h.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,h){h.version=this.images[c].version+1,this.images[c]=h,this.updatedImages[c]=!0}removeImage(c){const h=this.images[c];delete this.images[c],delete this.patterns[c],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,h){let y=!0;if(!this.isLoaded())for(const x of c)this.images[x]||(y=!1);this.isLoaded()||y?this._notify(c,h):this.requestors.push({ids:c,callback:h})}_notify(c,h){const y={};for(const x of c){this.images[x]||this.fire(new f.Event("styleimagemissing",{id:x}));const C=this.images[x];C?y[x]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!(!C.userImage||!C.userImage.render)}:f.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,y)}getPixelSize(){const{width:c,height:h}=this.atlasImage;return{width:c,height:h}}getPattern(c){const h=this.patterns[c],y=this.getImage(c);if(!y)return null;if(h&&h.position.version===y.version)return h.position;if(h)h.position.version=y.version;else{const x={w:y.data.width+2,h:y.data.height+2,x:0,y:0},C=new f.ImagePosition(x,y);this.patterns[c]={bin:x,position:C}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const h=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new f.Texture(c,this.atlasImage,h.RGBA),this.atlasTexture&&this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const C in this.patterns)c.push(this.patterns[C].bin);const{w:h,h:y}=f.potpack(c),x=this.atlasImage;x.resize({width:h||1,height:y||1});for(const C in this.patterns){const{bin:S}=this.patterns[C],M=S.x+1,k=S.y+1,L=this.images[C].data,N=L.width,V=L.height;f.RGBAImage.copy(L,x,{x:0,y:0},{x:M,y:k},{width:N,height:V}),f.RGBAImage.copy(L,x,{x:0,y:V-1},{x:M,y:k-1},{width:N,height:1}),f.RGBAImage.copy(L,x,{x:0,y:0},{x:M,y:k+V},{width:N,height:1}),f.RGBAImage.copy(L,x,{x:N-1,y:0},{x:M-1,y:k},{width:1,height:V}),f.RGBAImage.copy(L,x,{x:0,y:0},{x:M+N,y:k},{width:1,height:V})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const h of c){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const y=this.images[h];zu(y)&&this.updateImage(h,y)}}}const mn=new f.Properties({anchor:new f.DataConstantProperty(f.spec.light.anchor),position:new class{constructor(){this.specification=f.spec.light.position}possiblyEvaluate(_,c){return function([h,y,x]){const C=f.degToRad(y+90),S=f.degToRad(x);return{x:h*Math.cos(C)*Math.sin(S),y:h*Math.sin(C)*Math.sin(S),z:h*Math.cos(S),azimuthal:y,polar:x}}(_.expression.evaluate(c))}interpolate(_,c,h){return{x:f.number(_.x,c.x,h),y:f.number(_.y,c.y,h),z:f.number(_.z,c.z,h),azimuthal:f.number(_.azimuthal,c.azimuthal,h),polar:f.number(_.polar,c.polar,h)}}},color:new f.DataConstantProperty(f.spec.light.color),intensity:new f.DataConstantProperty(f.spec.light.intensity)});class yr extends f.Evented{constructor(c){super(),this._transitionable=new f.Transitionable(mn),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,h={}){if(!this._validate(f.validateLight,c,h))for(const y in c){const x=c[y];f.endsWith(y,"-transition")?this._transitionable.setTransition(y.slice(0,-11),x):this._transitionable.setValue(y,x)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,y){return(!y||!1!==y.validate)&&f.emitValidationErrors(this,c.call(f.validateStyle,f.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}const Vu=new f.Properties({source:new f.DataConstantProperty(f.spec.terrain.source),exaggeration:new f.DataConstantProperty(f.spec.terrain.exaggeration)});let vn=class extends f.Evented{constructor(_,c){super(),this._transitionable=new f.Transitionable(Vu),this.set(_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(_){for(const c in _){const h=_[c];f.endsWith(c,"-transition")?this._transitionable.setTransition(c.slice(0,-11),h):this._transitionable.setValue(c,h)}}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}};function qc(_,c,h,y){const x=f.smoothstep(45,65,h),[C,S]=jr(_,y),M=f.length(c);let k=1-Math.min(1,Math.exp((M-C)/(S-C)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*x*_.alpha}function jr(_,c){const h=.5/Math.tan(.5*c);return[_.range[0]+h,_.range[1]+h]}const hn=new f.Properties({range:new f.DataConstantProperty(f.spec.fog.range),color:new f.DataConstantProperty(f.spec.fog.color),"high-color":new f.DataConstantProperty(f.spec.fog["high-color"]),"space-color":new f.DataConstantProperty(f.spec.fog["space-color"]),"horizon-blend":new f.DataConstantProperty(f.spec.fog["horizon-blend"]),"star-intensity":new f.DataConstantProperty(f.spec.fog["star-intensity"])});class Xt extends f.Evented{constructor(c,h){super(),this._transitionable=new f.Transitionable(hn),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const c=this._transform,h="globe"===c.projection.name,y=f.globeToMercatorTransition(c.zoom),x=this.properties.get("range"),C=[.5,3];return{range:h?[f.number(C[0],x[0],y),f.number(C[1],x[1],y)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,h={}){if(!this._validate(f.validateFog,c,h)){for(const y of Object.keys(f.spec.fog))c&&void 0===c[y]&&(c[y]=f.spec.fog[y].default);for(const y in c){const x=c[y];f.endsWith(y,"-transition")?this._transitionable.setTransition(y.slice(0,-11),x):this._transitionable.setValue(y,x)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:f.smoothstep(45,65,c))*h.a}getOpacityAtLatLng(c,h){return this._transform.projection.supportsFog?function(y,x,C){const S=f.MercatorCoordinate.fromLngLat(x),M=C.elevation?C.elevation.getAtPointOrZero(S):0,k=[S.x,S.y,M];return f.transformMat4(k,k,C.mercatorFogMatrix),qc(y,k,C.pitch,C._fov)}(this.state,c,h):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?jr(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,y){return(!y||!1!==y.validate)&&f.emitValidationErrors(this,c.call(f.validateStyle,f.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}class lr{constructor(c,h){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=f.uniqueId();const y=this.workerPool.acquire(this.id);for(let x=0;x<y.length;x++){const C=new lr.Actor(y[x],h,this.id);C.name=`Worker ${x}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,h,y){f.asyncAll(this.actors,(x,C)=>{x.send(c,h,C)},y=y||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function vr(_,c,h){return c*(f.EXTENT/(_.tileSize*Math.pow(2,h-_.tileID.overscaledZ)))}lr.Actor=f.Actor;class xa{constructor(c,h,y,x){this.screenBounds=c,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(c,h){let y,x;if(c instanceof f.Point||"number"==typeof c[0]){const C=f.Point.convert(c);y=[C],x=h.isPointAboveHorizon(C)}else{const C=f.Point.convert(c[0]),S=f.Point.convert(c[1]);y=[C,S],x=f.polygonizeBounds(C,S).every(M=>h.isPointAboveHorizon(M))}return new xa(y,h.getCameraPoint(),x,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return f.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const h=this.screenBounds[0],y=1===this.screenBounds.length?this.screenBounds[0].add(new f.Point(1,1)):this.screenBounds[1],x=f.polygonizeBounds(h,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<y.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?x[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(x[3]=this.cameraPoint)),f.bufferConvexPolygon(x,c)}bufferedCameraGeometryGlobe(c){const h=this.screenBounds[0],y=1===this.screenBounds.length?this.screenBounds[0].add(new f.Point(1,1)):this.screenBounds[1],x=f.polygonizeBounds(h,y,c),C=this.cameraPoint.clone();switch(3*((C.y>h.y)+(C.y>y.y))+((C.x>h.x)+(C.x>y.x))){case 0:x[0]=C,x[4]=C.clone();break;case 1:x.splice(1,0,C);break;case 2:x[1]=C;break;case 3:x.splice(4,0,C);break;case 5:x.splice(2,0,C);break;case 6:x[3]=C;break;case 7:x.splice(3,0,C);break;case 8:x[2]=C}return x}containsTile(c,h,y,x=0){const C=c.queryPadding/h._pixelsPerMercatorPixel+1,S=y?this._bufferedCameraMercator(C,h):this._bufferedScreenMercator(C,h);let M=c.tileID.wrap+(S.unwrapped?x:0);const k=S.polygon.map(se=>f.getTilePoint(c.tileTransform,se,M));if(!f.polygonIntersectsBox(k,0,0,f.EXTENT,f.EXTENT))return;M=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const L=this.screenGeometryMercator.polygon.map(se=>f.getTileVec3(c.tileTransform,se,M)),N=L.map(se=>new f.Point(se[0],se[1])),V=h.getFreeCameraOptions().position||new f.MercatorCoordinate(0,0,0),K=f.getTileVec3(c.tileTransform,V,M),te=L.map(se=>{const U=f.sub(se,se,K);return f.normalize(U,U),new f.Ray(K,U)}),re=vr(c,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:N,tilespaceRays:te,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(ie=f.getBounds(k),ie.min.x=f.clamp(ie.min.x,0,f.EXTENT),ie.min.y=f.clamp(ie.min.y,0,f.EXTENT),ie.max.x=f.clamp(ie.max.x,0,f.EXTENT),ie.max.y=f.clamp(ie.max.y,0,f.EXTENT),ie),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:re};var ie}_bufferedScreenMercator(c,h){const y=Oo(c);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let x;return x="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),h):{polygon:this.bufferedScreenGeometry(c).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[y]=x,x}}_bufferedCameraMercator(c,h){const y=Oo(c);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let x;return x="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),h):{polygon:this.bufferedCameraGeometry(c).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[y]=x,x}}_projectAndResample(c,h){const y=function(C,S){const M=f.multiply([],S.pixelMatrix,S.globeMatrix),k=[0,-f.GLOBE_RADIUS,0,1],L=[0,f.GLOBE_RADIUS,0,1],N=[0,0,0,1];f.transformMat4$1(k,k,M),f.transformMat4$1(L,L,M),f.transformMat4$1(N,N,M);const V=new f.Point(k[0]/k[3],k[1]/k[3]),K=new f.Point(L[0]/L[3],L[1]/L[3]),te=f.polygonContainsPoint(C,V)&&k[3]<N[3],re=f.polygonContainsPoint(C,K)&&L[3]<N[3];if(!te&&!re)return null;const ie=function(Ee,ce,De){for(let _e=1;_e<Ee.length;_e++){const Ie=el(ce.pointCoordinate3D(Ee[_e-1]).x),Pe=el(ce.pointCoordinate3D(Ee[_e]).x);if(De<0){if(Ie<Pe)return{idx:_e,t:-Ie/(Pe-1-Ie)}}else if(Pe<Ie)return{idx:_e,t:(1-Ie)/(Pe+1-Ie)}}return null}(C,S,te?-1:1);if(!ie)return null;const{idx:se,t:U}=ie;let J=se>1?Hi(C.slice(0,se),S):[],de=se<C.length?Hi(C.slice(se),S):[];J=J.map(Ee=>new f.Point(el(Ee.x),Ee.y)),de=de.map(Ee=>new f.Point(el(Ee.x),Ee.y));const he=[...J];0===he.length&&he.push(de[de.length-1]);const Ce=f.number(he[he.length-1].y,(0===de.length?J[0]:de[0]).y,U);let Se;return Se=te?[new f.Point(0,Ce),new f.Point(0,0),new f.Point(1,0),new f.Point(1,Ce)]:[new f.Point(1,Ce),new f.Point(1,1),new f.Point(0,1),new f.Point(0,Ce)],he.push(...Se),0===de.length?he.push(J[0]):he.push(...de),{polygon:he.map(Ee=>new f.MercatorCoordinate(Ee.x,Ee.y)),unwrapped:!1}}(c,h);if(y)return y;const x=function(C,S){let M=!1,k=-1/0,L=0;for(let V=0;V<C.length-1;V++)C[V].x>k&&(k=C[V].x,L=V);for(let V=0;V<C.length-1;V++){const K=(L+V)%(C.length-1),te=C[K],re=C[K+1];Math.abs(te.x-re.x)>.5&&(te.x<re.x?(te.x+=1,0===K&&(C[C.length-1].x+=1)):(re.x+=1,K+1===C.length-1&&(C[0].x+=1)),M=!0)}const N=f.mercatorXfromLng(S.center.lng);return M&&N<Math.abs(N-1)&&C.forEach(V=>{V.x-=1}),{polygon:C,unwrapped:M}}(Hi(c,h).map(C=>new f.Point(el(C.x),C.y)),h);return{polygon:x.polygon.map(C=>new f.MercatorCoordinate(C.x,C.y)),unwrapped:x.unwrapped}}}function Hi(_,c){return f.resample(_,h=>{const y=c.pointCoordinate3D(h);h.x=y.x,h.y=y.y},1/256)}function el(_){return _<0?1+_%1:_%1}function Oo(_){return 100*_|0}function Yl(_,c,h,y,x){const C=function(S,M){if(S)return x(S);if(M){_.url&&M.tiles&&_.tiles&&delete _.tiles;const k=f.pick(f.extend(M,_),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(k.vectorLayers=M.vector_layers,k.vectorLayerIds=k.vectorLayers.map(L=>L.id)),k.tiles=c.canonicalizeTileset(k,_.url),x(null,k)}};return _.url?f.getJSON(c.transformRequest(c.normalizeSourceURL(_.url,null,h,y),f.ResourceType.Source),C):f.exported.frame(()=>C(null,_))}class wa{constructor(c,h,y){this.bounds=f.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=h||0,this.maxzoom=y||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const h=Math.pow(2,c.z),y=Math.floor(f.mercatorXfromLng(this.bounds.getWest())*h),x=Math.floor(f.mercatorYfromLat(this.bounds.getNorth())*h),C=Math.ceil(f.mercatorXfromLng(this.bounds.getEast())*h),S=Math.ceil(f.mercatorYfromLat(this.bounds.getSouth())*h);return c.x>=y&&c.x<C&&c.y>=x&&c.y<S}}class ju{constructor(c,h,y){this.context=c;const x=c.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const tl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xl{constructor(c,h,y,x){this.length=h.length,this.attributes=y,this.itemSize=h.bytesPerElement,this.dynamicDraw=x,this.context=c;const C=c.gl;this.buffer=C.createBuffer(),c.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,h){for(let y=0;y<this.attributes.length;y++){const x=h.attributes[this.attributes[y].name];void 0!==x&&c.enableVertexAttribArray(x)}}setVertexAttribPointers(c,h,y){for(let x=0;x<this.attributes.length;x++){const C=this.attributes[x],S=h.attributes[C.name];void 0!==S&&c.vertexAttribPointer(S,C.components,c[tl[C.type]],!1,this.itemSize,C.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Dn{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Wc extends Dn{getDefault(){return f.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Fo extends Dn{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Kl extends Dn{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class Ei extends Dn{getDefault(){return[!0,!0,!0,!0]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Ko extends Dn{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Uu extends Dn{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Ca extends Dn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const h=this.current;(c.func!==h.func||c.ref!==h.ref||c.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class ei extends Dn{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class $s extends Dn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=c,this.dirty=!1}}class Fd extends Dn{getDefault(){return[0,1]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class Hs extends Dn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=c,this.dirty=!1}}class Ql extends Dn{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class _s extends Dn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.BLEND):h.disable(h.BLEND),this.current=c,this.dirty=!1}}class er extends Dn{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class $u extends Dn{getDefault(){return f.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Qo extends Dn{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class Jl extends Dn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=c,this.dirty=!1}}class Gs extends Dn{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class gs extends Dn{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let Da,Vt=class extends Dn{getDefault(){return null}set(_){(_!==this.current||this.dirty)&&(this.gl.useProgram(_),this.current=_,this.dirty=!1)}};class qs extends Dn{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class nl extends Dn{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class ec extends Dn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class Ea extends Dn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Zc extends Dn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class Hu extends Dn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class ye extends Dn{getDefault(){return null}set(c){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class W extends Dn{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class X extends Dn{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class fe extends Dn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class we extends Dn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Me extends Dn{constructor(c,h){super(c),this.context=c,this.parent=h}getDefault(){return null}}class Fe extends Me{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Ne extends Me{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Ae extends Ne{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ue{constructor(c,h,y,x){this.context=c,this.width=h,this.height=y;const C=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Fe(c,C),x&&(this.depthAttachment=new Ne(c,C))}destroy(){const c=this.context.gl,h=this.colorAttachment.get();if(h&&c.deleteTexture(h),this.depthAttachment){const y=this.depthAttachment.get();y&&c.deleteRenderbuffer(y)}c.deleteFramebuffer(this.framebuffer)}}class ht{constructor(c,h=!1){if(this.gl=c,this.isWebGL2=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),h){const y=c;this.extVertexArrayObject={createVertexArrayOES:y.createVertexArray.bind(c),deleteVertexArrayOES:y.deleteVertexArray.bind(c),bindVertexArrayOES:y.bindVertexArray.bind(c)}}this.clearColor=new Wc(this),this.clearDepth=new Fo(this),this.clearStencil=new Kl(this),this.colorMask=new Ei(this),this.depthMask=new Ko(this),this.stencilMask=new Uu(this),this.stencilFunc=new Ca(this),this.stencilOp=new ei(this),this.stencilTest=new $s(this),this.depthRange=new Fd(this),this.depthTest=new Hs(this),this.depthFunc=new Ql(this),this.blend=new _s(this),this.blendFunc=new er(this),this.blendColor=new $u(this),this.blendEquation=new Qo(this),this.cullFace=new Jl(this),this.cullFaceSide=new Gs(this),this.frontFace=new gs(this),this.program=new Vt(this),this.activeTexture=new qs(this),this.viewport=new nl(this),this.bindFramebuffer=new ec(this),this.bindRenderbuffer=new Ea(this),this.bindTexture=new Zc(this),this.bindVertexBuffer=new Hu(this),this.bindElementBuffer=new ye(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new W(this),this.pixelStoreUnpack=new X(this),this.pixelStoreUnpackPremultiplyAlpha=new fe(this),this.pixelStoreUnpackFlipY=new we(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),h||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(h||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=h||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,h){return new ju(this,c,h)}createVertexBuffer(c,h,y){return new Xl(this,c,h,y)}createRenderbuffer(c,h,y){const x=this.gl,C=x.createRenderbuffer();return this.bindRenderbuffer.set(C),x.renderbufferStorage(x.RENDERBUFFER,c,h,y),this.bindRenderbuffer.set(null),C}createFramebuffer(c,h,y){return new Ue(this,c,h,y)}clear({color:c,depth:h,stencil:y}){const x=this.gl;let C=0;c&&(C|=x.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(C|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==y&&(C|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),x.clear(C)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){at(c.blendFunction,f.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class _t extends f.Evented{constructor(c,h,y,x){if(super(),this.id=c,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.extend(this,f.pick(h,["url","scheme","tileSize","promoteId"])),this._options=f.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new f.DedupedRequest}load(c){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map._worldview;this._tileJSONRequest=Yl(this._options,this.map._requestManager,h,y,(x,C)=>{this._tileJSONRequest=null,this._loaded=!0,x?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),y&&2!==y.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new f.ErrorEvent(x))):C&&(f.extend(this,C),C.bounds&&(this.tileBounds=new wa(C.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(C.tiles,this.map._requestManager._customAccessToken),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(x)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return f.extend({},this._options)}loadTile(c,h){const y=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(y,f.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=h:c.request=c.actor.send("reloadTile",x,C.bind(this));else if(c.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",x,C.bind(this),void 0,!0);else{const S=f.loadVectorTile.call({deduped:this._deduped},x,(M,k)=>{M||!k?C.call(this,M):(x.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},c.actor&&c.actor.send("loadTile",x,C.bind(this),void 0,!0))},!0);c.request={cancel:S}}function C(S,M){return delete c.request,c.aborted?h(null):S&&404!==S.status?h(S):(M&&M.resourceTiming&&(c.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&c.setExpiryData(M),c.loadVectorData(M,this.map.painter),f.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Xe extends f.Evented{constructor(c,h,y,x){super(),this.id=c,this.dispatcher=y,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.extend({type:"raster"},h),f.extend(this,f.pick(h,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Yl(this._options,this.map._requestManager,null,null,(h,y)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new f.ErrorEvent(h)):y&&(f.extend(this,y),y.bounds&&(this.tileBounds=new wa(y.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(y.tiles),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(h)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return f.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,h){const y=f.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);c.request=f.getImage(this.map._requestManager.transformRequest(x,f.ResourceType.Tile),(C,S,M,k)=>(delete c.request,c.aborted?(c.state="unloaded",h(null)):C?(c.state="errored",h(C)):S?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:M,expires:k}),c.setTexture(S,this.map.painter),c.state="loaded",f.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(c,h,y){c.setTexture(h,y)}static unloadTileData(c,h){c.texture&&h.saveTileTexture(c.texture)}abortTile(c,h){c.request&&(c.request.cancel(),delete c.request),h()}unloadTile(c,h){c.texture&&this.map.painter.saveTileTexture(c.texture),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Kt(_,c,h,y,x,C,S,M){const k=[_,h,x,c,y,C,1,1,1],L=[S,M,1],N=f.adjoint([],k),[V,K,te]=f.transformMat3(L,L,f.transpose(N,N));return f.multiply$1(k,[V,0,0,0,K,0,0,0,te],k)}class Ut extends f.Evented{constructor(c,h,y,x){super(),this.id=c,this.dispatcher=y,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=h,this._dirty=!1}load(c,h){this._loaded=h||!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=f.getImage(this.map._requestManager.transformRequest(this.url,f.ResourceType.Image),(y,x)=>{if(this._imageRequest=null,this._loaded=!0,y)this.fire(new f.ErrorEvent(y));else if(x){const{HTMLImageElement:C}=f.window;this.image=x instanceof C?f.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const h=c.map(f.MercatorCoordinate.fromLngLat);return this.tileID=function(y){let x=1/0,C=1/0,S=-1/0,M=-1/0;for(const V of y)x=Math.min(x,V.x),C=Math.min(C,V.y),S=Math.max(S,V.x),M=Math.max(M,V.y);const k=Math.max(S-x,M-C),L=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),N=Math.pow(2,L);return new f.CanonicalTileID(L,Math.floor((x+S)/2*N),Math.floor((C+M)/2*N))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const k in this.tiles){const L=this.tiles[k];"loaded"!==L.state&&(L.state="loaded",L.texture=this.texture)}if(this._boundsArray)return;const h=f.tileTransform(this.tileID,this.map.transform.projection),[y,x,C,S]=this.coordinates.map(k=>{const L=h.projection.project(k[0],k[1]);return f.getTilePoint(h,L)._round()});this.perspectiveTransform=function(k,L,N,V,K,te,re,ie,se,U){const J=Kt(0,0,k,0,0,L,k,L),de=Kt(N,V,K,te,re,ie,se,U);return f.multiply$1(de,f.adjoint(J,J),de),[de[6]/de[8]*k/f.EXTENT,de[7]/de[8]*L/f.EXTENT]}(this.width,this.height,y.x,y.y,x.x,x.y,S.x,S.y,C.x,C.y);const M=this._boundsArray=new f.StructArrayLayout4i8;M.emplaceBack(y.x,y.y,0,0),M.emplaceBack(x.x,x.y,f.EXTENT,0),M.emplaceBack(S.x,S.y,0,f.EXTENT),M.emplaceBack(C.x,C.y,f.EXTENT,f.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(M,f.boundsAttributes.members),this.boundsSegments=f.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const c=this.map.painter.context,h=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new f.Texture(c,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,h){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},h(null)):(c.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const tn={vector:_t,raster:Xe,"raster-dem":class extends Xe{constructor(_,c,h,y){super(_,c,h,y),this.type="raster-dem",this.maxzoom=22,this._options=f.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(_,c){const h=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(x,C){x&&(_.state="errored",c(x)),C&&(_.dem=C,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",c(null))}_.request=f.getImage(this.map._requestManager.transformRequest(h,f.ResourceType.Tile),function(x,C,S,M){if(delete _.request,_.aborted)_.state="unloaded",c(null);else if(x)_.state="errored",c(x);else if(C){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:S,expires:M});const k=f.window.ImageBitmap&&C instanceof f.window.ImageBitmap&&(null==Da&&(Da=f.window.OffscreenCanvas&&new f.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof f.window.createImageBitmap),Da),L=1-(C.width-f.prevPowerOfTwo(C.width))/2;L<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const N=k?C:f.exported.getImageData(C,L),V={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:N,encoding:this.encoding,padding:L};_.actor&&"expired"!==_.state||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",V,y.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(_){const c=_.canonical,h=Math.pow(2,c.z),y=(c.x-1+h)%h,x=0===c.x?_.wrap-1:_.wrap,C=(c.x+1+h)%h,S=c.x+1===h?_.wrap+1:_.wrap,M={};return M[new f.OverscaledTileID(_.overscaledZ,x,c.z,y,c.y).key]={backfilled:!1},M[new f.OverscaledTileID(_.overscaledZ,S,c.z,C,c.y).key]={backfilled:!1},c.y>0&&(M[new f.OverscaledTileID(_.overscaledZ,x,c.z,y,c.y-1).key]={backfilled:!1},M[new f.OverscaledTileID(_.overscaledZ,_.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},M[new f.OverscaledTileID(_.overscaledZ,S,c.z,C,c.y-1).key]={backfilled:!1}),c.y+1<h&&(M[new f.OverscaledTileID(_.overscaledZ,x,c.z,y,c.y+1).key]={backfilled:!1},M[new f.OverscaledTileID(_.overscaledZ,_.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},M[new f.OverscaledTileID(_.overscaledZ,S,c.z,C,c.y+1).key]={backfilled:!1}),M}unloadTile(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded"}},geojson:class extends f.Evented{constructor(_,c,h,y){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(y),this._data=c.data,this._options=f.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const x=f.EXTENT/this.tileSize;this.workerOptions=f.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*x,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*x,extent:f.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:f.EXTENT,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*x,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}getClusterExpansionZoom(_,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},c),this}getClusterChildren(_,c){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},c),this}getClusterLeaves(_,c,h,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:c,offset:h},y),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new f.Event("dataloading",{dataType:"source"})),this._loaded=!1;const _=f.extend({},this.workerOptions),c=this._data;"string"==typeof c?(_.request=this.map._requestManager.transformRequest(f.exported.resolveURL(c),f.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,_,(h,y)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new f.ErrorEvent(h));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(x.resourceTiming=y.resourceTiming[this.id]),this.fire(new f.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,c){const h=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send(h,{type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(y,x)=>(delete _.request,_.unloadVectorData(),_.aborted?c(null):y?c(y):(_.loadVectorData(x,this.map.painter,"reloadTile"===h),c(null))),void 0,"loadTile"===h)}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return f.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ut{constructor(_,c,h,y){super(_,c,h,y),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const c of _.urls)this.urls.push(this.map._requestManager.transformRequest(c,f.ResourceType.Source).url);f.getVideo(this.urls,(c,h)=>{this._loaded=!0,c?this.fire(new f.ErrorEvent(c)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const c=this.video.seekable;_<c.start(0)||_>c.end(0)?this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const _=this.map.painter.context,c=_.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new f.Texture(_,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(_)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ut,canvas:class extends Ut{constructor(_,c,h,y){super(_,c,h,y),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(C=>"number"!=typeof C))||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${_}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof f.window.HTMLCanvasElement||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${_}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof f.window.HTMLCanvasElement?this.options.canvas:f.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new f.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}},custom:class extends f.Evented{constructor(_,c,h,y){super(),this.id=_,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=c,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new f.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new f.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new wa(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),f.extend(this,f.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return f.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(_){this._map=_,this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(_),this.load()}onRemove(_){this._implementation.onRemove&&this._implementation.onRemove(_)}hasTile(_){if(this._implementation.hasTile){const{x:c,y:h,z:y}=_.canonical;return this._implementation.hasTile({x:c,y:h,z:y})}return!this.tileBounds||this.tileBounds.contains(_.canonical)}loadTile(_,c){const{x:h,y,z:x}=_.tileID.canonical,C=new f.window.AbortController;_.request=Promise.resolve(this._implementation.loadTile({x:h,y,z:x},{signal:C.signal})).then(function(S){return delete _.request,_.aborted?(_.state="unloaded",c(null)):void 0===S?(_.state="errored",c(null)):null===S?(this.loadTileData(_,{width:this.tileSize,height:this.tileSize,data:null}),_.state="loaded",c(null)):(M=S)instanceof f.window.ImageData||M instanceof f.window.HTMLCanvasElement||M instanceof f.window.ImageBitmap||M instanceof f.window.HTMLImageElement?(this.loadTileData(_,S),_.state="loaded",void c(null)):(_.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var M}.bind(this)).catch(S=>{20!==S.code&&(_.state="errored",c(S))}),_.request.cancel=()=>C.abort()}loadTileData(_,c){Xe.loadTileData(_,c,this._map.painter)}unloadTileData(_){Xe.unloadTileData(_,this._map.painter)}unloadTile(_,c){if(this.unloadTileData(_),this._implementation.unloadTile){const{x:h,y,z:x}=_.tileID.canonical;this._implementation.unloadTile({x:h,y,z:x})}c()}abortTile(_,c){_.request&&_.request.cancel&&(_.request.cancel(),delete _.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(_=>({x:_.canonical.x,y:_.canonical.y,z:_.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}}},bn=function(_,c,h,y){const x=new tn[c.type](_,c,h,y);if(x.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${x.id}`);return f.bindAll(["load","abort","unload","serialize","prepare"],x),x};function wt(_,c){const h=f.identity([]);return f.scale(h,h,[.5*_.width,.5*-_.height,1]),f.translate(h,h,[1,-1,0]),f.multiply(h,h,_.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(h)}function Pt(_,c,h,y,x,C,S,M=!1){const k=_.tilesIn(y,S,M);k.sort(br);const L=[];for(const V of k)L.push({wrappedTileID:V.tile.tileID.wrapped().key,queryResults:V.tile.queryRenderedFeatures(c,h,_._state,V,x,C,wt(_.transform,V.tile.tileID),M)});const N=function(V){const K={},te={};for(const re of V){const ie=re.queryResults,se=re.wrappedTileID,U=te[se]=te[se]||{};for(const J in ie){const de=ie[J],he=U[J]=U[J]||{},Ce=K[J]=K[J]||[];for(const Se of de)he[Se.featureIndex]||(he[Se.featureIndex]=!0,Ce.push(Se))}}return K}(L);for(const V in N)N[V].forEach(K=>{const te=K.feature,re=te.layer;re&&"background"!==re.type&&"sky"!==re.type&&(te.source=re.source,re["source-layer"]&&(te.sourceLayer=re["source-layer"]),te.state=void 0!==te.id?_.getFeatureState(re["source-layer"],te.id):{})});return N}function Fi(_,c){const h=_.getRenderableIds().map(C=>_.getTileByID(C)),y=[],x={};for(let C=0;C<h.length;C++){const S=h[C],M=S.tileID.canonical.key;x[M]||(x[M]=!0,S.querySourceFeatures(y,c))}return y}function br(_,c){const h=_.tileID,y=c.tileID;return h.overscaledZ-y.overscaledZ||h.canonical.y-y.canonical.y||h.wrap-y.wrap||h.canonical.x-y.canonical.x}function cr(){return null!=Es.workerClass?new Es.workerClass:new f.window.Worker(Es.workerUrl)}const ys="mapboxgl_preloaded_worker_pool";class He{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<He.workerCount;)this.workers.push(new cr);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ys]}numActive(){return Object.keys(this.active).length}}let xr;function nn(){return xr||(xr=new He),xr}function ti(_,c){const h={};for(const y in _)"ref"!==y&&(h[y]=_[y]);return f.refProperties.forEach(y=>{y in c&&(h[y]=c[y])}),h}function Vm(_){_=_.slice();const c=Object.create(null);for(let h=0;h<_.length;h++)c[_[h].id]=_[h];for(let h=0;h<_.length;h++)"ref"in _[h]&&(_[h]=ti(_[h],c[_[h].ref]));return _}He.workerCount=2;const qn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Sp(_,c,h){h.push({command:qn.addSource,args:[_,c[_]]})}function tc(_,c,h){c.push({command:qn.removeSource,args:[_]}),h[_]=!0}function so(_,c,h,y){tc(_,h,y),Sp(_,c,h)}function Mp(_,c,h){let y;for(y in _[h])if(_[h].hasOwnProperty(y)&&"data"!==y&&!at(_[h][y],c[h][y]))return!1;for(y in c[h])if(c[h].hasOwnProperty(y)&&"data"!==y&&!at(_[h][y],c[h][y]))return!1;return!0}function Ws(_,c,h,y,x,C){let S;for(S in c=c||{},_=_||{})_.hasOwnProperty(S)&&(at(_[S],c[S])||h.push({command:C,args:[y,S,c[S],x]}));for(S in c)c.hasOwnProperty(S)&&!_.hasOwnProperty(S)&&(at(_[S],c[S])||h.push({command:C,args:[y,S,c[S],x]}))}function il(_){return _.id}function Ta(_,c){return _[c.id]=c,_}class jm{constructor(c,h){this.reset(c,h)}reset(c,h){this.points=c||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=f.clamp(c,0,1);let h=1,y=this._distances[h];const x=c*this.paddedLength+this.padding;for(;y<x&&h<this._distances.length;)y=this._distances[++h];const C=h-1,S=this._distances[C],M=y-S,k=M>0?(x-S)/M:0;return this.points[C].mult(1-k).add(this.points[h].mult(k))}}class Yc{constructor(c,h,y){const x=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(c/y),this.yCellCount=Math.ceil(h/y);for(let S=0;S<this.xCellCount*this.yCellCount;S++)x.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=h,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,h,y,x,C){this._forEachCell(h,y,x,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(x),this.bboxes.push(C)}insertCircle(c,h,y,x){this._forEachCell(h-x,y-x,h+x,y+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(h),this.circles.push(y),this.circles.push(x)}_insertBoxCell(c,h,y,x,C,S){this.boxCells[C].push(S)}_insertCircleCell(c,h,y,x,C,S){this.circleCells[C].push(S)}_query(c,h,y,x,C,S){if(y<0||c>this.width||x<0||h>this.height)return!C&&[];const M=[];if(c<=0&&h<=0&&this.width<=y&&this.height<=x){if(C)return!0;for(let k=0;k<this.boxKeys.length;k++)M.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const L=this.circles[3*k],N=this.circles[3*k+1],V=this.circles[3*k+2];M.push({key:this.circleKeys[k],x1:L-V,y1:N-V,x2:L+V,y2:N+V})}return S?M.filter(S):M}return this._forEachCell(c,h,y,x,this._queryCell,M,{hitTest:C,seenUids:{box:{},circle:{}}},S),C?M.length>0:M}_queryCircle(c,h,y,x,C){const S=c-y,M=c+y,k=h-y,L=h+y;if(M<0||S>this.width||L<0||k>this.height)return!x&&[];const N=[];return this._forEachCell(S,k,M,L,this._queryCellCircle,N,{hitTest:x,circle:{x:c,y:h,radius:y},seenUids:{box:{},circle:{}}},C),x?N.length>0:N}query(c,h,y,x,C){return this._query(c,h,y,x,!1,C)}hitTest(c,h,y,x,C){return this._query(c,h,y,x,!0,C)}hitTestCircle(c,h,y,x){return this._queryCircle(c,h,y,!0,x)}_queryCell(c,h,y,x,C,S,M,k){const L=M.seenUids,N=this.boxCells[C];if(null!==N){const K=this.bboxes;for(const te of N)if(!L.box[te]){L.box[te]=!0;const re=4*te;if(c<=K[re+2]&&h<=K[re+3]&&y>=K[re+0]&&x>=K[re+1]&&(!k||k(this.boxKeys[te]))){if(M.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[te],x1:K[re],y1:K[re+1],x2:K[re+2],y2:K[re+3]})}}}const V=this.circleCells[C];if(null!==V){const K=this.circles;for(const te of V)if(!L.circle[te]){L.circle[te]=!0;const re=3*te;if(this._circleAndRectCollide(K[re],K[re+1],K[re+2],c,h,y,x)&&(!k||k(this.circleKeys[te]))){if(M.hitTest)return S.push(!0),!0;{const ie=K[re],se=K[re+1],U=K[re+2];S.push({key:this.circleKeys[te],x1:ie-U,y1:se-U,x2:ie+U,y2:se+U})}}}}}_queryCellCircle(c,h,y,x,C,S,M,k){const L=M.circle,N=M.seenUids,V=this.boxCells[C];if(null!==V){const te=this.bboxes;for(const re of V)if(!N.box[re]){N.box[re]=!0;const ie=4*re;if(this._circleAndRectCollide(L.x,L.y,L.radius,te[ie+0],te[ie+1],te[ie+2],te[ie+3])&&(!k||k(this.boxKeys[re])))return S.push(!0),!0}}const K=this.circleCells[C];if(null!==K){const te=this.circles;for(const re of K)if(!N.circle[re]){N.circle[re]=!0;const ie=3*re;if(this._circlesCollide(te[ie],te[ie+1],te[ie+2],L.x,L.y,L.radius)&&(!k||k(this.circleKeys[re])))return S.push(!0),!0}}}_forEachCell(c,h,y,x,C,S,M,k){const L=this._convertToXCellCoord(c),N=this._convertToYCellCoord(h),V=this._convertToXCellCoord(y),K=this._convertToYCellCoord(x);for(let te=L;te<=V;te++)for(let re=N;re<=K;re++)if(C.call(this,c,h,y,x,this.xCellCount*re+te,S,M,k))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,h,y,x,C,S){const M=x-c,k=C-h,L=y+S;return L*L>M*M+k*k}_circleAndRectCollide(c,h,y,x,C,S,M){const k=(S-x)/2,L=Math.abs(c-(x+k));if(L>k+y)return!1;const N=(M-C)/2,V=Math.abs(h-(C+N));if(V>N+y)return!1;if(L<=k||V<=N)return!0;const K=L-k,te=V-N;return K*K+te*te<=y*y}}const rl={unknown:0,flipRequired:1,flipNotRequired:2},Gu=Math.tan(85*Math.PI/180);function We(_,c,h,y,x,C,S){const M=f.create();if(h)if("globe"===C.name){const k=f.calculateGlobeLabelMatrix(x,c);f.multiply(M,M,k)}else{const k=ot([],S);M[0]=k[0],M[1]=k[1],M[4]=k[2],M[5]=k[3],y||f.rotateZ(M,M,x.angle)}else f.multiply(M,x.labelPlaneMatrix,_);return M}function ol(_,c,h,y,x,C,S){const M=We(_,c,h,y,x,C,S);return"globe"===C.name&&h||(M[2]=M[6]=M[10]=M[14]=0),M}function Gi(_,c,h,y,x,C,S){if(h){if("globe"===C.name){const M=We(_,c,h,y,x,C,S);return f.invert(M,M),f.multiply(M,_,M),M}{const M=f.clone(_),k=f.identity([]);return k[0]=S[0],k[1]=S[1],k[4]=S[2],k[5]=S[3],f.multiply(M,M,k),y||f.rotateZ(M,M,-x.angle),M}}return x.glCoordMatrix}function Sr(_,c,h,y){const x=[_,c,h,1];h?f.transformMat4$1(x,x,y):xn(x,x,y);const C=x[3];return x[0]/=C,x[1]/=C,x[2]/=C,x}function No(_,c){return Math.min(.5+_/c*.5,1.5)}function qt(_,c){const h=_[0]/_[3],y=_[1]/_[3];return h>=-c[0]&&h<=c[0]&&y>=-c[1]&&y<=c[1]}function Um(_,c,h,y,x,C,S,M,k,L){const N=h.transform,V=y?_.textSizeData:_.iconSizeData,K=f.evaluateSizeForZoom(V,h.transform.zoom),te="globe"===N.projection.name,re=[256/h.width*2+1,256/h.height*2+1],ie=y?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ie.clear();let se=null;te&&(se=y?_.text.globeExtVertexArray:_.icon.globeExtVertexArray);const U=_.lineVertexArray,J=y?_.text.placedSymbolArray:_.icon.placedSymbolArray,de=h.transform.width/h.transform.height;let he,Ce=!1;for(let Se=0;Se<J.length;Se++){const Ee=J.get(Se),{numGlyphs:ce,writingMode:De}=Ee;if(De!==f.WritingMode.vertical||Ce||he===f.WritingMode.horizontal||(Ce=!0),he=De,(Ee.hidden||De===f.WritingMode.vertical)&&!Ce){vs(ce,ie);continue}Ce=!1;const _e=new f.Point(Ee.tileAnchorX,Ee.tileAnchorY);let{x:Ie,y:Pe,z:Ke}=N.projection.projectTilePoint(_e.x,_e.y,L.canonical);if(k){const[Ht,Mt,Lt]=k(_e);Ie+=Ht,Pe+=Mt,Ke+=Lt}const Ve=[Ie,Pe,Ke,1];if(f.transformMat4$1(Ve,Ve,c),!qt(Ve,re)){vs(ce,ie);continue}const et=No(h.transform.cameraToCenterDistance,Ve[3]),Be=f.evaluateSizeForFeature(V,K,Ee),Ye=S?Be/et:Be*et,ct=Sr(Ie,Pe,Ke,x);if(ct[3]<=0){vs(ce,ie);continue}let tt={};const dt=S?null:k,Tt=Re(Ee,Ye,!1,M,c,x,C,_.glyphOffsetArray,U,ie,se,ct,_e,tt,de,dt,N.projection,L,S);Ce=Tt.useVertical,dt&&Tt.needsFlipping&&(tt={}),(Tt.notEnoughRoom||Ce||Tt.needsFlipping&&Re(Ee,Ye,!0,M,c,x,C,_.glyphOffsetArray,U,ie,se,ct,_e,tt,de,dt,N.projection,L,S).notEnoughRoom)&&vs(ce,ie)}y?(_.text.dynamicLayoutVertexBuffer.updateData(ie),se&&_.text.globeExtVertexBuffer.updateData(se)):(_.icon.dynamicLayoutVertexBuffer.updateData(ie),se&&_.icon.globeExtVertexBuffer.updateData(se))}function gy(_,c,h,y,x,C,S,M,k,L,N,V,K,te,re,ie){const{lineStartIndex:se,glyphStartIndex:U,segment:J}=M,de=U+M.numGlyphs,he=se+M.lineLength,Ce=c.getoffsetX(U),Se=c.getoffsetX(de-1),Ee=Ur(_*Ce,h,y,x,C,S,J,se,he,k,L,N,V,K,!0,te,re,ie);if(!Ee)return null;const ce=Ur(_*Se,h,y,x,C,S,J,se,he,k,L,N,V,K,!0,te,re,ie);return ce?{first:Ee,last:ce}:null}function Nd(_,c,h,y){return _===f.WritingMode.horizontal&&Math.abs(y)>Math.abs(h)?{useVertical:!0}:_===f.WritingMode.vertical?y>0?{needsFlipping:!0}:null:c!==rl.unknown&&(0===(x=h)||Math.abs(y/x)>Gu)?c===rl.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null;var x}function Re(_,c,h,y,x,C,S,M,k,L,N,V,K,te,re,ie,se,U,J){const de=c/24,he=_.lineOffsetX*de,Ce=_.lineOffsetY*de,{lineStartIndex:Se,glyphStartIndex:Ee,numGlyphs:ce,segment:De,writingMode:_e,flipState:Ie}=_,Pe=Se+_.lineLength,Ke=Ve=>{if(N){const[ct,tt,dt]=Ve.up,Tt=L.length;f.updateGlobeVertexNormal(N,Tt+0,ct,tt,dt),f.updateGlobeVertexNormal(N,Tt+1,ct,tt,dt),f.updateGlobeVertexNormal(N,Tt+2,ct,tt,dt),f.updateGlobeVertexNormal(N,Tt+3,ct,tt,dt)}const[et,Be,Ye]=Ve.point;f.addDynamicAttributes(L,et,Be,Ye,Ve.angle)};if(ce>1){const Ve=gy(de,M,he,Ce,h,V,K,_,k,C,te,ie,!1,se,U,J);if(!Ve)return{notEnoughRoom:!0};if(y&&!h){let[et,Be,Ye]=Ve.first.point,[ct,tt,dt]=Ve.last.point;[et,Be]=Sr(et,Be,Ye,S),[ct,tt]=Sr(ct,tt,dt,S);const Tt=Nd(_e,Ie,(ct-et)*re,tt-Be);if(_.flipState=Tt&&Tt.needsFlipping?rl.flipRequired:rl.flipNotRequired,Tt)return Tt}Ke(Ve.first);for(let et=Ee+1;et<Ee+ce-1;et++){const Be=Ur(de*M.getoffsetX(et),he,Ce,h,V,K,De,Se,Pe,k,C,te,ie,!1,!1,se,U,J);if(!Be)return L.length-=4*(et-Ee),{notEnoughRoom:!0};Ke(Be)}Ke(Ve.last)}else{if(y&&!h){const et=Sr(K.x,K.y,0,x),Be=Se+De+1,Ye=new f.Point(k.getx(Be),k.gety(Be)),ct=Sr(Ye.x,Ye.y,0,x),tt=ct[3]>0?ct:yt(K,Ye,et,1,x,void 0,se,U.canonical),dt=Nd(_e,Ie,(tt[0]-et[0])*re,tt[1]-et[1]);if(_.flipState=dt&&dt.needsFlipping?rl.flipRequired:rl.flipNotRequired,dt)return dt}const Ve=Ur(de*M.getoffsetX(Ee),he,Ce,h,V,K,De,Se,Pe,k,C,te,ie,!1,!1,se,U,J);if(!Ve)return{notEnoughRoom:!0};Ke(Ve)}return{}}function An(_,c,h,y,x){const{x:C,y:S,z:M}=y.projectTilePoint(_.x,_.y,c);if(!x)return Sr(C,S,M,h);const[k,L,N]=x(_);return Sr(C+k,S+L,M+N,h)}function yt(_,c,h,y,x,C,S,M){const k=An(_.sub(c)._unit()._add(_),M,x,S,C);return f.sub(k,h,k),f.normalize(k,k),f.scaleAndAdd(k,h,k,y)}function Ur(_,c,h,y,x,C,S,M,k,L,N,V,K,te,re,ie,se,U){const J=y?_-c:_+c;let de=J>0?1:-1,he=0;y&&(de*=-1,he=Math.PI),de<0&&(he+=Math.PI);let Ce=M+S+(de>0?0:1)|0,Se=x,Ee=x,ce=0,De=0;const _e=Math.abs(J),Ie=[],Pe=[];let Ke=C,Ve=Ke;const et=()=>yt(Ve,Ke,Ee,_e-ce+1,N,K,ie,se.canonical);for(;ce+De<=_e;){if(Ce+=de,Ce<M||Ce>=k)return null;if(Ee=Se,Ve=Ke,Ie.push(Ee),te&&Pe.push(Ve),Ke=new f.Point(L.getx(Ce),L.gety(Ce)),Se=V[Ce],!Se){const Lt=An(Ke,se.canonical,N,ie,K);Se=Lt[3]>0?V[Ce]=Lt:et()}ce+=De,De=f.distance(Ee,Se)}re&&K&&(V[Ce]&&(Se=et(),De=f.distance(Ee,Se)),V[Ce]=Se);const Be=(_e-ce)/De,Ye=Ke.sub(Ve)._mult(Be)._add(Ve),ct=f.sub([],Se,Ee),tt=f.scaleAndAdd([],Ee,ct,Be);let dt=[0,0,1],Tt=ct[0],Ht=ct[1];if(U&&(dt=ie.upVector(se.canonical,Ye.x,Ye.y),0!==dt[0]||0!==dt[1]||1!==dt[2])){const Lt=[dt[2],0,-dt[0]],Jt=f.cross([],dt,Lt);f.normalize(Lt,Lt),f.normalize(Jt,Jt),Tt=f.dot(ct,Lt),Ht=f.dot(ct,Jt)}if(h){const Lt=f.cross([],dt,ct);f.normalize(Lt,Lt),f.scaleAndAdd(tt,tt,Lt,h*de)}const Mt=he+Math.atan2(Ht,Tt);return Ie.push(tt),te&&Pe.push(Ye),{point:tt,angle:Mt,path:Ie,tilePath:Pe,up:dt}}function vs(_,c){const h=c.length,y=h+4*_;c.resize(y),c.float32.fill(-1/0,4*h,4*y)}function xn(_,c,h){const y=c[0],x=c[1];return _[0]=h[0]*y+h[4]*x+h[12],_[1]=h[1]*y+h[5]*x+h[13],_[3]=h[3]*y+h[7]*x+h[15],_}const Lo=100;class sl{constructor(c,h,y=new Yc(c.width+200,c.height+200,25),x=new Yc(c.width+200,c.height+200,25)){this.transform=c,this.grid=y,this.ignoredGrid=x,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+Lo,this.screenBottomBoundary=c.height+Lo,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=h}placeCollisionBox(c,h,y,x,C,S,M,k){let L=y.projectedAnchorX,N=y.projectedAnchorY,V=y.projectedAnchorZ;const K=y.elevation,te=y.tileID,re=c.getProjection();if(K&&te){const[Se,Ee,ce]=re.upVector(te.canonical,y.tileAnchorX,y.tileAnchorY),De=re.upVectorScale(te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=Se*K*De,N+=Ee*K*De,V+=ce*K*De}const ie=this.projectAndGetPerspectiveRatio(M,L,N,V,y.tileID,"globe"===re.name||!!K||this.transform.pitch>0,re),se=S*ie.perspectiveRatio,U=(y.x1*h+x.x-y.padding)*se+ie.point.x,J=(y.y1*h+x.y-y.padding)*se+ie.point.y,de=(y.x2*h+x.x+y.padding)*se+ie.point.x,he=(y.y2*h+x.y+y.padding)*se+ie.point.y,Ce=ie.perspectiveRatio<=.55||ie.occluded;return!this.isInsideGrid(U,J,de,he)||!C&&this.grid.hitTest(U,J,de,he,k)||Ce?{box:[],offscreen:!1,occluded:ie.occluded}:{box:[U,J,de,he],offscreen:this.isOffscreen(U,J,de,he),occluded:!1}}placeCollisionCircles(c,h,y,x,C,S,M,k,L,N,V,K,te,re,ie){const se=[],U=this.transform.elevation,J=c.getProjection(),de=U?U.getAtTileOffsetFunc(ie,this.transform.center.lat,this.transform.worldSize,J):null,he=new f.Point(y.tileAnchorX,y.tileAnchorY);let{x:Ce,y:Se,z:Ee}=J.projectTilePoint(he.x,he.y,ie.canonical);if(de){const[Ye,ct,tt]=de(he);Ce+=Ye,Se+=ct,Ee+=tt}const ce="globe"===J.name,De=this.projectAndGetPerspectiveRatio(M,Ce,Se,Ee,ie,ce||!!U||this.transform.pitch>0,J),{perspectiveRatio:_e}=De,Ie=(V?S/_e:S*_e)/f.ONE_EM,Pe=Sr(Ce,Se,Ee,k),Ke=De.signedDistanceFromCamera>0?gy(Ie,C,y.lineOffsetX*Ie,y.lineOffsetY*Ie,!1,Pe,he,y,x,k,{},U&&!V?de:null,V&&!!U,J,ie,V):null;let Ve=!1,et=!1,Be=!0;if(Ke&&!De.occluded){const Ye=.5*te*_e+re,ct=new f.Point(-100,-100),tt=new f.Point(this.screenRightBoundary,this.screenBottomBoundary),dt=new jm,{first:Tt,last:Ht}=Ke,Mt=Tt.path.length;let Lt=[];for(let Ot=Mt-1;Ot>=1;Ot--)Lt.push(Tt.path[Ot]);for(let Ot=1;Ot<Ht.path.length;Ot++)Lt.push(Ht.path[Ot]);const Jt=2.5*Ye;L&&(Lt=Lt.map(([Ot,Wn,ni],Yn)=>(de&&!ce&&(ni=de(Yn<Mt-1?Tt.tilePath[Mt-1-Yn]:Ht.tilePath[Yn-Mt+2])[2]),Sr(Ot,Wn,ni,L))),Lt.some(Ot=>Ot[3]<=0)&&(Lt=[]));let wn=[];if(Lt.length>0){let Ot=1/0,Wn=-1/0,ni=1/0,Yn=-1/0;for(const Xn of Lt)Ot=Math.min(Ot,Xn[0]),ni=Math.min(ni,Xn[1]),Wn=Math.max(Wn,Xn[0]),Yn=Math.max(Yn,Xn[1]);Wn>=ct.x&&Ot<=tt.x&&Yn>=ct.y&&ni<=tt.y&&(wn=[Lt.map(Xn=>new f.Point(Xn[0],Xn[1]))],(Ot<ct.x||Wn>tt.x||ni<ct.y||Yn>tt.y)&&(wn=f.clipLine(wn,ct.x,ct.y,tt.x,tt.y)))}for(const Ot of wn){dt.reset(Ot,.25*Ye);let Wn=0;Wn=dt.length<=.5*Ye?1:Math.ceil(dt.paddedLength/Jt)+1;for(let ni=0;ni<Wn;ni++){const Yn=ni/Math.max(Wn-1,1),Xn=dt.lerp(Yn),kr=Xn.x+Lo,nr=Xn.y+Lo;se.push(kr,nr,Ye,0);const os=kr-Ye,Ts=nr-Ye,fi=kr+Ye,Qn=nr+Ye;if(Be=Be&&this.isOffscreen(os,Ts,fi,Qn),et=et||this.isInsideGrid(os,Ts,fi,Qn),!h&&this.grid.hitTestCircle(kr,nr,Ye,K)&&(Ve=!0,!N))return{circles:[],offscreen:!1,collisionDetected:Ve,occluded:!1}}}}return{circles:!N&&Ve||!et?[]:se,offscreen:Be,collisionDetected:Ve,occluded:De.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let y=1/0,x=1/0,C=-1/0,S=-1/0;for(const N of c){const V=new f.Point(N.x+Lo,N.y+Lo);y=Math.min(y,V.x),x=Math.min(x,V.y),C=Math.max(C,V.x),S=Math.max(S,V.y),h.push(V)}const M=this.grid.query(y,x,C,S).concat(this.ignoredGrid.query(y,x,C,S)),k={},L={};for(const N of M){const V=N.key;if(void 0===k[V.bucketInstanceId]&&(k[V.bucketInstanceId]={}),k[V.bucketInstanceId][V.featureIndex])continue;const K=[new f.Point(N.x1,N.y1),new f.Point(N.x2,N.y1),new f.Point(N.x2,N.y2),new f.Point(N.x1,N.y2)];f.polygonIntersectsPolygon(h,K)&&(k[V.bucketInstanceId][V.featureIndex]=!0,void 0===L[V.bucketInstanceId]&&(L[V.bucketInstanceId]=[]),L[V.bucketInstanceId].push(V.featureIndex))}return L}insertCollisionBox(c,h,y,x,C){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:x,collisionGroupID:C},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,h,y,x,C){const S=h?this.ignoredGrid:this.grid,M={bucketInstanceId:y,featureIndex:x,collisionGroupID:C};for(let k=0;k<c.length;k+=4)S.insertCircle(M,c[k],c[k+1],c[k+2])}projectAndGetPerspectiveRatio(c,h,y,x,C,S,M){const k=[h,y,x,1];let L=!1;x||this.transform.pitch>0?(f.transformMat4$1(k,k,c),this.fogState&&C&&"globe"!==M.name&&(L=function(K,te,re,ie,se,U){const J=U.calculateFogTileMatrix(se),de=[te,re,ie];return f.transformMat4(de,de,J),qc(K,de,U.pitch,U._fov)}(this.fogState,h,y,x,C.toUnwrapped(),this.transform)>.9)):xn(k,k,c);const N=k[3];return{point:new f.Point((k[0]/N+1)/2*this.transform.width+Lo,(-k[1]/N+1)/2*this.transform.height+Lo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/N*.5,1.5),signedDistanceFromCamera:N,occluded:S&&k[2]>N||L}}isOffscreen(c,h,y,x){return y<Lo||c>=this.screenRightBoundary||x<Lo||h>this.screenBottomBoundary}isInsideGrid(c,h,y,x){return y>=0&&c<this.gridRightBoundary&&x>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const c=f.identity([]);return f.translate(c,c,[-100,-100,0]),c}}function Zs(_,c,h){const y=c.createTileMatrix(_,_.worldSize,h.toUnwrapped());return f.multiply(new Float32Array(16),_.projMatrix,y)}function vo(_,c,h){if(c.projection.name===h.projection.name)return _.projMatrix;const y=h.clone();return y.setProjection(c.projection),Zs(y,c.getProjection(),_)}function _i(_,c,h){return c.name===h.projection.name?_.projMatrix:Zs(h,c,_)}class $m{constructor(c,h,y,x){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?h:-h))):x&&y?1:0,this.placed=y}isHidden(){return 0===this.opacity&&!this.placed}}class pn{constructor(c,h,y,x,C,S=!1){this.text=new $m(c?c.text:null,h,y,C),this.icon=new $m(c?c.icon:null,h,x,C),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class nc{constructor(c,h,y,x=!1){this.text=c,this.icon=h,this.skipFade=y,this.clipped=x}}class Xc{constructor(){this.invProjMatrix=f.create(),this.viewportMatrix=f.create(),this.circles=[]}}class $r{constructor(c,h,y,x,C){this.bucketInstanceId=c,this.featureIndex=h,this.sourceLayerIndex=y,this.bucketIndex=x,this.tileID=C}}class Ap{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const h=++this.maxGroupID;this.collisionGroups[c]={ID:h,predicate:y=>y.collisionGroupID===h}}return this.collisionGroups[c]}}function qu(_,c,h,y,x){const{horizontalAlign:C,verticalAlign:S}=f.getAnchorAlignment(_),M=-(C-.5)*c,k=-(S-.5)*h,L=f.evaluateVariableOffset(_,y);return new f.Point(M+L[0]*x,k+L[1]*x)}function Kn(_,c,h,y,x){const C=new f.Point(_,c);return h&&C._rotate(y?x:-x),C}class Ip{constructor(c,h,y,x,C){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new sl(this.transform,C),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Ap(y),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,h,y,x){const C=y.getBucket(h),S=y.latestFeatureIndex;if(!C||!S||h.id!==C.layerIds[0])return;const M=C.layers[0].layout,k=y.collisionBoxArray,L=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),N=y.tileSize/f.EXTENT,V=y.tileID.toUnwrapped();this.transform.setProjection(C.projection);const K=(te=y.tileID,re=C.getProjection(),ie=this.transform,re.name===this.projection?ie.calculateProjMatrix(te.toUnwrapped()):Zs(ie,re,te));var te,re,ie;const se="map"===M.get("text-pitch-alignment"),U="map"===M.get("text-rotation-alignment");h.compileFilter();const J=h.dynamicFilter(),de=h.dynamicFilterNeedsFeature(),he=this.transform.calculatePixelsToTileUnitsMatrix(y),Ce=ol(K,y.tileID.canonical,se,U,this.transform,C.getProjection(),he);let Se=null;if(se){const De=Gi(K,y.tileID.canonical,se,U,this.transform,C.getProjection(),he);Se=f.multiply([],this.transform.labelPlaneMatrix,De)}let Ee=null;J&&y.latestFeatureIndex&&(Ee={unwrappedTileID:V,dynamicFilter:J,dynamicFilterNeedsFeature:de,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new $r(C.bucketInstanceId,S,C.sourceLayerIndex,C.index,y.tileID);const ce={bucket:C,layout:M,posMatrix:K,textLabelPlaneMatrix:Ce,labelToScreenMatrix:Se,clippingData:Ee,scale:L,textPixelRatio:N,holdingForFade:y.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:f.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:f.evaluateSizeForZoom(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(x)for(const De of C.sortKeyRanges){const{sortKey:_e,symbolInstanceStart:Ie,symbolInstanceEnd:Pe}=De;c.push({sortKey:_e,symbolInstanceStart:Ie,symbolInstanceEnd:Pe,parameters:ce})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:ce})}attemptAnchorPlacement(c,h,y,x,C,S,M,k,L,N,V,K,te,re,ie,se,U,J){const{textOffset0:de,textOffset1:he,crossTileID:Ce}=K,Se=[de,he],Ee=qu(c,y,x,Se,C),ce=this.collisionIndex.placeCollisionBox(re,C,h,Kn(Ee.x,Ee.y,S,M,this.transform.angle),V,k,L,N.predicate);if(se){const De=re.getSymbolInstanceIconSize(J,this.transform.zoom,K.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(re,De,se,Kn(Ee.x,Ee.y,S,M,this.transform.angle),V,k,L,N.predicate).box.length)return}if(ce.box.length>0){let De;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ce]&&this.prevPlacement.placements[Ce]&&this.prevPlacement.placements[Ce].text&&(De=this.prevPlacement.variableOffsets[Ce].anchor),this.variableOffsets[Ce]={textOffset:Se,width:y,height:x,anchor:c,textScale:C,prevAnchor:De},this.markUsedJustification(re,c,K,ie),re.allowVerticalPlacement&&(this.markUsedOrientation(re,ie,K),this.placedOrientations[Ce]=ie),{shift:Ee,placedGlyphBoxes:ce}}}placeLayerBucketPart(c,h,y,x){const{bucket:C,layout:S,posMatrix:M,textLabelPlaneMatrix:k,labelToScreenMatrix:L,clippingData:N,textPixelRatio:V,holdingForFade:K,collisionBoxArray:te,partiallyEvaluatedTextSize:re,partiallyEvaluatedIconSize:ie,collisionGroup:se}=c.parameters,U=S.get("text-optional"),J=S.get("icon-optional"),de=S.get("text-allow-overlap"),he=S.get("icon-allow-overlap"),Ce="map"===S.get("text-rotation-alignment"),Se="map"===S.get("text-pitch-alignment"),Ee="none"!==S.get("icon-text-fit"),ce="viewport-y"===S.get("symbol-z-order");this.transform.setProjection(C.projection);let De=de&&(he||!C.hasIconData()||J),_e=he&&(de||!C.hasTextData()||U);!C.collisionArrays&&te&&C.deserializeCollisionBoxes(te),y&&x&&C.updateCollisionDebugBuffers(this.transform.zoom,te);const Ie=(Pe,Ke,Ve)=>{const{crossTileID:et,numVerticalGlyphVertices:Be}=Pe;if(N){const fi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Qn=null;if(N.dynamicFilterNeedsFeature){const Vn=this.retainedQueryData[C.bucketInstanceId];Qn=N.featureIndex.loadFeature({featureIndex:Pe.featureIndex,bucketIndex:Vn.bucketIndex,sourceLayerIndex:Vn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,N.dynamicFilter)(fi,Qn,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new f.Point(Pe.tileAnchorX,Pe.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[et]=new nc(!1,!1,!1,!0),void h.add(et)}if(h.has(et))return;if(K)return void(this.placements[et]=new nc(!1,!1,!1));let Ye=!1,ct=!1,tt=!0,dt=!1,Tt=!1,Ht=null,Mt={box:null,offscreen:null,occluded:null},Lt={box:null,offscreen:null,occluded:null},Jt=null,wn=null,Ot=null,Wn=0,ni=0,Yn=0;Ve.textFeatureIndex?Wn=Ve.textFeatureIndex:Pe.useRuntimeCollisionCircles&&(Wn=Pe.featureIndex),Ve.verticalTextFeatureIndex&&(ni=Ve.verticalTextFeatureIndex);const Xn=fi=>{fi.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;const Qn=this.transform.elevation;(Qn||fi.elevation)&&(fi.elevation=Qn?Qn.getAtTileOffset(fi.tileID,fi.tileAnchorX,fi.tileAnchorY):0)},kr=Ve.textBox;if(kr){Xn(kr);const fi=Vn=>{let zi=f.WritingMode.horizontal;if(C.allowVerticalPlacement&&!Vn&&this.prevPlacement){const Wr=this.prevPlacement.placedOrientations[et];Wr&&(this.placedOrientations[et]=Wr,zi=Wr,this.markUsedOrientation(C,zi,Pe))}return zi},Qn=(Vn,zi)=>{if(C.allowVerticalPlacement&&Be>0&&Ve.verticalTextBox){for(const Wr of C.writingModes)if(Wr===f.WritingMode.vertical?(Mt=zi(),Lt=Mt):Mt=Vn(),Mt&&Mt.box&&Mt.box.length)break}else Mt=Vn()};if(S.get("text-variable-anchor")){let Vn=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[et]){const ai=this.prevPlacement.variableOffsets[et];Vn.indexOf(ai.anchor)>0&&(Vn=Vn.filter(Co=>Co!==ai.anchor),Vn.unshift(ai.anchor))}const zi=(ai,Co,yh)=>{const Yi=C.getSymbolInstanceTextSize(re,Pe,this.transform.zoom,Ke),Ss=(ai.x2-ai.x1)*Yi+2*ai.padding,Jn=(ai.y2-ai.y1)*Yi+2*ai.padding,ka=Ee&&!he?Co:null;ka&&Xn(ka);let pc={box:[],offscreen:!1,occluded:!1};const nu=de?2*Vn.length:Vn.length;for(let iu=0;iu<nu;++iu){const vh=this.attemptAnchorPlacement(Vn[iu%Vn.length],ai,Ss,Jn,Yi,Ce,Se,V,M,se,iu>=Vn.length,Pe,Ke,C,yh,ka,re,ie);if(vh&&(pc=vh.placedGlyphBoxes,pc&&pc.box&&pc.box.length)){Ye=!0,Ht=vh.shift;break}}return pc};Qn(()=>zi(kr,Ve.iconBox,f.WritingMode.horizontal),()=>{const ai=Ve.verticalTextBox;return ai&&Xn(ai),C.allowVerticalPlacement&&!(Mt&&Mt.box&&Mt.box.length)&&Be>0&&ai?zi(ai,Ve.verticalIconBox,f.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Mt&&(Ye=Mt.box,tt=Mt.offscreen,dt=Mt.occluded);const Wr=fi(!(!Mt||!Mt.box));if(!Ye&&this.prevPlacement){const ai=this.prevPlacement.variableOffsets[et];ai&&(this.variableOffsets[et]=ai,this.markUsedJustification(C,ai.anchor,Pe,Wr))}}else{const Vn=(zi,Wr)=>{const ai=C.getSymbolInstanceTextSize(re,Pe,this.transform.zoom,Ke),Co=this.collisionIndex.placeCollisionBox(C,ai,zi,new f.Point(0,0),de,V,M,se.predicate);return Co&&Co.box&&Co.box.length&&(this.markUsedOrientation(C,Wr,Pe),this.placedOrientations[et]=Wr),Co};Qn(()=>Vn(kr,f.WritingMode.horizontal),()=>{const zi=Ve.verticalTextBox;return C.allowVerticalPlacement&&Be>0&&zi?(Xn(zi),Vn(zi,f.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),fi(!!(Mt&&Mt.box&&Mt.box.length))}}if(Jt=Mt,Ye=Jt&&Jt.box&&Jt.box.length>0,tt=Jt&&Jt.offscreen,dt=Jt&&Jt.occluded,Pe.useRuntimeCollisionCircles){const fi=C.text.placedSymbolArray.get(Pe.centerJustifiedTextSymbolIndex>=0?Pe.centerJustifiedTextSymbolIndex:Pe.verticalPlacedTextSymbolIndex),Qn=f.evaluateSizeForFeature(C.textSizeData,re,fi),Vn=S.get("text-padding");wn=this.collisionIndex.placeCollisionCircles(C,de,fi,C.lineVertexArray,C.glyphOffsetArray,Qn,M,k,L,y,Se,se.predicate,Pe.collisionCircleDiameter*Qn/f.ONE_EM,Vn,this.retainedQueryData[C.bucketInstanceId].tileID),Ye=de||wn.circles.length>0&&!wn.collisionDetected,tt=tt&&wn.offscreen,dt=wn.occluded}if(Ve.iconFeatureIndex&&(Yn=Ve.iconFeatureIndex),Ve.iconBox){const fi=Qn=>{Xn(Qn);const Vn=Ee&&Ht?Kn(Ht.x,Ht.y,Ce,Se,this.transform.angle):new f.Point(0,0),zi=C.getSymbolInstanceIconSize(ie,this.transform.zoom,Pe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,zi,Qn,Vn,he,V,M,se.predicate)};Lt&&Lt.box&&Lt.box.length&&Ve.verticalIconBox?(Ot=fi(Ve.verticalIconBox),ct=Ot.box.length>0):(Ot=fi(Ve.iconBox),ct=Ot.box.length>0),tt=tt&&Ot.offscreen,Tt=Ot.occluded}const nr=U||0===Pe.numHorizontalGlyphVertices&&0===Be,os=J||0===Pe.numIconVertices;if(nr||os?os?nr||(ct=ct&&Ye):Ye=ct&&Ye:ct=Ye=ct&&Ye,Ye&&Jt&&Jt.box&&this.collisionIndex.insertCollisionBox(Jt.box,S.get("text-ignore-placement"),C.bucketInstanceId,Lt&&Lt.box&&ni?ni:Wn,se.ID),ct&&Ot&&this.collisionIndex.insertCollisionBox(Ot.box,S.get("icon-ignore-placement"),C.bucketInstanceId,Yn,se.ID),wn&&(Ye&&this.collisionIndex.insertCollisionCircles(wn.circles,S.get("text-ignore-placement"),C.bucketInstanceId,Wn,se.ID),y)){const fi=C.bucketInstanceId;let Qn=this.collisionCircleArrays[fi];void 0===Qn&&(Qn=this.collisionCircleArrays[fi]=new Xc);for(let Vn=0;Vn<wn.circles.length;Vn+=4)Qn.circles.push(wn.circles[Vn+0]),Qn.circles.push(wn.circles[Vn+1]),Qn.circles.push(wn.circles[Vn+2]),Qn.circles.push(wn.collisionDetected?1:0)}const Ts="globe"!==C.projection.name;De=De&&(Ts||!dt),_e=_e&&(Ts||!Tt),this.placements[et]=new nc(Ye||De,ct||_e,tt||C.justReloaded),h.add(et)};if(ce){const Pe=C.getSortedSymbolIndexes(this.transform.angle);for(let Ke=Pe.length-1;Ke>=0;--Ke){const Ve=Pe[Ke];Ie(C.symbolInstances.get(Ve),Ve,C.collisionArrays[Ve])}}else for(let Pe=c.symbolInstanceStart;Pe<c.symbolInstanceEnd;Pe++)Ie(C.symbolInstances.get(Pe),Pe,C.collisionArrays[Pe]);if(y&&C.bucketInstanceId in this.collisionCircleArrays){const Pe=this.collisionCircleArrays[C.bucketInstanceId];f.invert(Pe.invProjMatrix,M),Pe.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(c,h,y,x){const{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:k,crossTileID:L}=y,N=f.getAnchorJustification(h),V=x===f.WritingMode.vertical?k:"left"===N?C:"center"===N?S:"right"===N?M:-1;C>=0&&(c.text.placedSymbolArray.get(C).crossTileID=V>=0&&C!==V?0:L),S>=0&&(c.text.placedSymbolArray.get(S).crossTileID=V>=0&&S!==V?0:L),M>=0&&(c.text.placedSymbolArray.get(M).crossTileID=V>=0&&M!==V?0:L),k>=0&&(c.text.placedSymbolArray.get(k).crossTileID=V>=0&&k!==V?0:L)}markUsedOrientation(c,h,y){const x=h===f.WritingMode.horizontal||h===f.WritingMode.horizontalOnly?h:0,C=h===f.WritingMode.vertical?h:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:L}=y,N=c.text.placedSymbolArray;S>=0&&(N.get(S).placedOrientation=x),M>=0&&(N.get(M).placedOrientation=x),k>=0&&(N.get(k).placedOrientation=x),L>=0&&(N.get(L).placedOrientation=C)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let y=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const x=h?h.symbolFadeChange(c):1,C=h?h.opacities:{},S=h?h.variableOffsets:{},M=h?h.placedOrientations:{};for(const k in this.placements){const L=this.placements[k],N=C[k];N?(this.opacities[k]=new pn(N,x,L.text,L.icon,null,L.clipped),y=y||L.text!==N.text.placed||L.icon!==N.icon.placed):(this.opacities[k]=new pn(null,x,L.text,L.icon,L.skipFade,L.clipped),y=y||L.text||L.icon)}for(const k in C){const L=C[k];if(!this.opacities[k]){const N=new pn(L,x,!1,!1);N.isHidden()||(this.opacities[k]=N,y=y||L.text.placed||L.icon.placed)}}for(const k in S)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=S[k]);for(const k in M)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=M[k]);y?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:c)}updateLayerOpacities(c,h){const y=new Set;for(const x of h){const C=x.getBucket(c);C&&x.latestFeatureIndex&&c.id===C.layerIds[0]&&this.updateBucketOpacities(C,y,x.collisionBoxArray)}}updateBucketOpacities(c,h,y){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const x=c.layers[0].layout,C=!!c.layers[0].dynamicFilter(),S=new pn(null,0,!1,!1,!0),M=x.get("text-allow-overlap"),k=x.get("icon-allow-overlap"),L=x.get("text-variable-anchor"),N="map"===x.get("text-rotation-alignment"),V="map"===x.get("text-pitch-alignment"),K="none"!==x.get("icon-text-fit"),te=new pn(null,0,M&&(k||!c.hasIconData()||x.get("icon-optional")),k&&(M||!c.hasTextData()||x.get("text-optional")),!0);!c.collisionArrays&&y&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(y);const re=(se,U,J)=>{for(let de=0;de<U/4;de++)se.opacityVertexArray.emplaceBack(J)};let ie=0;for(let se=0;se<c.symbolInstances.length;se++){const U=c.symbolInstances.get(se),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:de,crossTileID:he,numIconVertices:Ce}=U,Se=h.has(he);let Ee=this.opacities[he];Se?Ee=S:Ee||(Ee=te,this.opacities[he]=Ee),h.add(he);const ce=J>0||de>0,De=Ce>0,_e=this.placedOrientations[he],Ie=_e===f.WritingMode.vertical,Pe=_e===f.WritingMode.horizontal||_e===f.WritingMode.horizontalOnly;if(!ce&&!De||Ee.isHidden()||ie++,ce){const Ke=Zu(Ee.text);re(c.text,J,Ie?Bi:Ke),re(c.text,de,Pe?Bi:Ke);const Ve=Ee.text.isHidden(),{leftJustifiedTextSymbolIndex:et,centerJustifiedTextSymbolIndex:Be,rightJustifiedTextSymbolIndex:Ye,verticalPlacedTextSymbolIndex:ct}=U,tt=c.text.placedSymbolArray,dt=Ve||Ie?1:0;et>=0&&(tt.get(et).hidden=dt),Be>=0&&(tt.get(Be).hidden=dt),Ye>=0&&(tt.get(Ye).hidden=dt),ct>=0&&(tt.get(ct).hidden=Ve||Pe?1:0);const Tt=this.variableOffsets[he];Tt&&this.markUsedJustification(c,Tt.anchor,U,_e);const Ht=this.placedOrientations[he];Ht&&(this.markUsedJustification(c,"left",U,Ht),this.markUsedOrientation(c,Ht,U))}if(De){const Ke=Zu(Ee.icon),{placedIconSymbolIndex:Ve,verticalPlacedIconSymbolIndex:et}=U,Be=c.icon.placedSymbolArray,Ye=Ee.icon.isHidden()?1:0;Ve>=0&&(re(c.icon,Ce,Ie?Bi:Ke),Be.get(Ve).hidden=Ye),et>=0&&(re(c.icon,U.numVerticalIconVertices,Pe?Bi:Ke),Be.get(et).hidden=Ye)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const Ke=c.collisionArrays[se];if(Ke){let Ve=new f.Point(0,0),et=!0;if(Ke.textBox||Ke.verticalTextBox){if(L){const Ye=this.variableOffsets[he];Ye?(Ve=qu(Ye.anchor,Ye.width,Ye.height,Ye.textOffset,Ye.textScale),N&&Ve._rotate(V?this.transform.angle:-this.transform.angle)):et=!1}C&&(et=!Ee.clipped),Ke.textBox&&Ld(c.textCollisionBox.collisionVertexArray,Ee.text.placed,!et||Ie,Ve.x,Ve.y),Ke.verticalTextBox&&Ld(c.textCollisionBox.collisionVertexArray,Ee.text.placed,!et||Pe,Ve.x,Ve.y)}const Be=et&&!(Pe||!Ke.verticalIconBox);Ke.iconBox&&Ld(c.iconCollisionBox.collisionVertexArray,Ee.icon.placed,Be,K?Ve.x:0,K?Ve.y:0),Ke.verticalIconBox&&Ld(c.iconCollisionBox.collisionVertexArray,Ee.icon.placed,!Be,K?Ve.x:0,K?Ve.y:0)}}}if(c.fullyClipped=0===ie,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=se.invProjMatrix,c.placementViewportMatrix=se.viewportMatrix,c.collisionCircleArray=se.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,h){const y=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*y>c}setStale(){this.stale=!0}}function Ld(_,c,h,y,x){_.emplaceBack(c?1:0,h?1:0,y||0,x||0),_.emplaceBack(c?1:0,h?1:0,y||0,x||0),_.emplaceBack(c?1:0,h?1:0,y||0,x||0),_.emplaceBack(c?1:0,h?1:0,y||0,x||0)}const Hr=Math.pow(2,25),ki=Math.pow(2,24),Wu=Math.pow(2,17),Bd=Math.pow(2,16),bo=Math.pow(2,9),xo=Math.pow(2,8),yy=Math.pow(2,1);function Zu(_){if(0===_.opacity&&!_.placed)return 0;if(1===_.opacity&&_.placed)return 4294967295;const c=_.placed?1:0,h=Math.floor(127*_.opacity);return h*Hr+c*ki+h*Wu+c*Bd+h*bo+c*xo+h*yy+c}const Bi=0;class Yu{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,h,y,x,C){const S=this._bucketParts;for(;this._currentTileIndex<c.length;)if(h.getBucketParts(S,x,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((M,k)=>M.sortKey-k.sortKey));this._currentPartIndex<S.length;){const M=S[this._currentPartIndex];if(h.placeLayerBucketPart(M,this._seenCrossTileIDs,y,0===M.symbolInstanceStart),this._currentPartIndex++,C())return!0}return!1}}class Hm{constructor(c,h,y,x,C,S,M,k){this.placement=new Ip(c,C,S,M,k),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(c,h,y){const x=f.exported.now(),C=()=>{const S=f.exported.now()-x;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=h[c[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if("symbol"===S.type&&(!S.minzoom||S.minzoom<=M)&&(!S.maxzoom||S.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Yu(S)),this._inProgressLayer.continuePlacement(y[S.source],this.placement,this._showCollisionBoxes,S,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const bs=512/f.EXTENT/2;class dr{constructor(c,h,y){this.tileID=c,this.bucketInstanceId=y,this.index=new f.KDBush(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=c.canonical.x*f.EXTENT,C=c.canonical.y*f.EXTENT;for(let S=0;S<h.length;S++){const{key:M,crossTileID:k,tileAnchorX:L,tileAnchorY:N}=h.get(S),V=Math.floor((x+L)*bs),K=Math.floor((C+N)*bs);this.index.add(V,K),this.keys.push(M),this.crossTileIDs.push(k)}this.index.finish()}findMatches(c,h,y){const x=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),C=bs/Math.pow(2,h.canonical.z-this.tileID.canonical.z),S=h.canonical.x*f.EXTENT,M=h.canonical.y*f.EXTENT;for(let k=0;k<c.length;k++){const L=c.get(k);if(L.crossTileID)continue;const{key:N,tileAnchorX:V,tileAnchorY:K}=L,te=Math.floor((S+V)*C),re=Math.floor((M+K)*C),ie=this.index.range(te-x,re-x,te+x,re+x);for(const se of ie){const U=this.crossTileIDs[se];if(this.keys[se]===N&&!y.has(U)){y.add(U),L.crossTileID=U;break}}}}}class Kc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Rp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const h=Math.round((c-this.lng)/360);if(0!==h)for(const y in this.indexes){const x=this.indexes[y],C={};for(const S in x){const M=x[S];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),C[M.tileID.key]=M}this.indexes[y]=C}this.lng=c}addBucket(c,h,y){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let C=0;C<h.symbolInstances.length;C++)h.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const x=this.usedCrossTileIDs[c.overscaledZ];for(const C in this.indexes){const S=this.indexes[C];if(Number(C)>c.overscaledZ)for(const M in S){const k=S[M];k.tileID.isChildOf(c)&&k.findMatches(h.symbolInstances,c,x)}else{const M=S[c.scaledTo(Number(C)).key];M&&M.findMatches(h.symbolInstances,c,x)}}for(let C=0;C<h.symbolInstances.length;C++){const S=h.symbolInstances.get(C);S.crossTileID||(S.crossTileID=y.generate(),x.add(S.crossTileID))}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new dr(c,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(c,h){for(const y of h.crossTileIDs)this.usedCrossTileIDs[c].delete(y)}removeStaleBuckets(c){let h=!1;for(const y in this.indexes){const x=this.indexes[y];for(const C in x)c[x[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,x[C]),delete x[C],h=!0)}return h}}class Sa{constructor(){this.layerIndexes={},this.crossTileIDs=new Kc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,h,y,x){let C=this.layerIndexes[c.id];void 0===C&&(C=this.layerIndexes[c.id]=new Rp);let S=!1;const M={};"globe"!==x.name&&C.handleWrapJump(y);for(const k of h){const L=k.getBucket(c);L&&c.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(k.tileID,L,this.crossTileIDs)&&(S=!0),M[L.bucketInstanceId]=!0)}return C.removeStaleBuckets(M)&&(S=!0),S}pruneUnusedLayers(c){const h={};c.forEach(y=>{h[y]=!0});for(const y in this.layerIndexes)h[y]||delete this.layerIndexes[y]}}const al=(_,c)=>f.emitValidationErrors(_,c&&c.filter(h=>"source.canvas"!==h.identifier)),zd=f.pick(qn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Qc=f.pick(qn,["setCenter","setZoom","setBearing","setPitch"]),kp={version:8,layers:[],sources:{}},Bo={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ys extends f.Evented{constructor(c,h={}){super(),this.map=c,this.dispatcher=new lr(nn(),this),this.imageManager=new zm,this.imageManager.setEventedParent(this),this.glyphManager=new f.GlyphManager(c._requestManager,h.localFontFamily?f.LocalGlyphMode.all:h.localIdeographFontFamily?f.LocalGlyphMode.ideographs:f.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new Sa,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",f.getReferrer());const y=this;this._rtlTextPluginCallback=Ys.registerForPluginStateChange(x=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(C,S)=>{if(f.triggerPluginCompletionEvent(C),S&&S.every(M=>M))for(const M in y._sourceCaches){const k=y._sourceCaches[M],L=k.getSource().type;"vector"!==L&&"geojson"!==L||k.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const C=this.getSource(x.sourceId);if(C&&C.vectorLayerIds)for(const S in this._layers){const M=this._layers[S];M.source===C.id&&this._validateLayer(M)}})}loadURL(c,h={}){this.fire(new f.Event("dataloading",{dataType:"style"}));const y="boolean"==typeof h.validate?h.validate:!f.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,h.accessToken);const x=this.map._requestManager.transformRequest(c,f.ResourceType.Style);this._request=f.getJSON(x,(C,S)=>{this._request=null,C?this.fire(new f.ErrorEvent(C)):S&&this._load(S,y)})}loadJSON(c,h={}){this.fire(new f.Event("dataloading",{dataType:"style"})),this._request=f.exported.frame(()=>{this._request=null,this._load(c,!1!==h.validate)})}loadEmpty(){this.fire(new f.Event("dataloading",{dataType:"style"})),this._load(kp,!1)}_updateLayerCount(c,h){const y=h?1:-1;c.is3D()&&(this._num3DLayers+=y),"circle"===c.type&&(this._numCircleLayers+=y),"symbol"===c.type&&(this._numSymbolLayers+=y)}_load(c,h){if(h&&al(this,f.validateStyle(c)))return;this._loaded=!0,this.stylesheet=f.clone$1(c),this._updateMapProjection();for(const x in c.sources)this.addSource(x,c.sources[x],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const y=Vm(this.stylesheet.layers);this._order=y.map(x=>x.id),this._layers={},this._serializedLayers={};for(const x of y){const C=f.createStyleLayer(x);C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C,this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new yr(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new f.Event("data",{dataType:"style"})),this.fire(new f.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(h,y,x){let C,S,M;const k=f.exported.devicePixelRatio>1?"@2x":"";let L=f.getJSON(y.transformRequest(y.normalizeSpriteURL(h,k,".json"),f.ResourceType.SpriteJSON),(K,te)=>{L=null,M||(M=K,C=te,V())}),N=f.getImage(y.transformRequest(y.normalizeSpriteURL(h,k,".png"),f.ResourceType.SpriteImage),(K,te)=>{N=null,M||(M=K,S=te,V())});function V(){if(M)x(M);else if(C&&S){const K=f.exported.getImageData(S),te={};for(const re in C){const{width:ie,height:se,x:U,y:J,sdf:de,pixelRatio:he,stretchX:Ce,stretchY:Se,content:Ee}=C[re],ce=new f.RGBAImage({width:ie,height:se});f.RGBAImage.copy(K,ce,{x:U,y:J},{x:0,y:0},{width:ie,height:se}),te[re]={data:ce,pixelRatio:he,sdf:de,stretchX:Ce,stretchY:Se,content:Ee}}x(null,te)}}return{cancel(){L&&(L.cancel(),L=null),N&&(N.cancel(),N=null)}}}(c,this.map._requestManager,(h,y)=>{if(this._spriteRequest=null,h)this.fire(new f.ErrorEvent(h));else if(y)for(const x in y)this.imageManager.addImage(x,y[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new f.Event("data",{dataType:"style"}))})}_validateLayer(c){const h=this.getSource(c.source);if(!h)return;const y=c.sourceLayer;y&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(y))&&this.fire(new f.ErrorEvent(new Error(`Source layer "${y}" does not exist on source "${h.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const h=[];for(const y of c){const x=this._layers[y];"custom"!==x.type&&h.push(x.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&("function"==typeof c.isLayerDraped?c.isLayerDraped():Bo[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const h=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(x.length||C.length)&&this._updateWorkerLayers(x,C);for(const S in this._updatedSources){const M=this._updatedSources[S];"reload"===M?this._reloadSource(S):"clear"===M&&this._clearSource(S)}this._updateTilesForChangedImages();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const y={};for(const x in this._sourceCaches){const C=this._sourceCaches[x];y[x]=C.used,C.used=!1}for(const x of this._order){const C=this._layers[x];if(C.recalculate(c,this._availableImages),!C.isHidden(c.zoom)){const M=this._getLayerSourceCache(C);M&&(M.used=!0)}const S=this.map.painter;if(S){const M=C.getProgramIds();if(!M)continue;const k=C.getProgramConfiguration(c.zoom);for(const L of M)S.useProgram(L,k)}}for(const x in y){const C=this._sourceCaches[x];y[x]!==C.used&&C.getSource().fire(new f.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new f.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),al(this,f.validateStyle(c)))return!1;(c=f.clone$1(c)).layers=Vm(c.layers);const h=function(x,C){if(!x)return[{command:qn.setStyle,args:[C]}];let S=[];try{if(!at(x.version,C.version))return[{command:qn.setStyle,args:[C]}];at(x.center,C.center)||S.push({command:qn.setCenter,args:[C.center]}),at(x.zoom,C.zoom)||S.push({command:qn.setZoom,args:[C.zoom]}),at(x.bearing,C.bearing)||S.push({command:qn.setBearing,args:[C.bearing]}),at(x.pitch,C.pitch)||S.push({command:qn.setPitch,args:[C.pitch]}),at(x.sprite,C.sprite)||S.push({command:qn.setSprite,args:[C.sprite]}),at(x.glyphs,C.glyphs)||S.push({command:qn.setGlyphs,args:[C.glyphs]}),at(x.transition,C.transition)||S.push({command:qn.setTransition,args:[C.transition]}),at(x.light,C.light)||S.push({command:qn.setLight,args:[C.light]}),at(x.fog,C.fog)||S.push({command:qn.setFog,args:[C.fog]}),at(x.projection,C.projection)||S.push({command:qn.setProjection,args:[C.projection]});const M={},k=[];!function(V,K,te,re){let ie;for(ie in K=K||{},V=V||{})V.hasOwnProperty(ie)&&(K.hasOwnProperty(ie)||tc(ie,te,re));for(ie in K){if(!K.hasOwnProperty(ie))continue;const se=K[ie];V.hasOwnProperty(ie)?at(V[ie],se)||("geojson"===V[ie].type&&"geojson"===se.type&&Mp(V,K,ie)?te.push({command:qn.setGeoJSONSourceData,args:[ie,se.data]}):so(ie,K,te,re)):Sp(ie,K,te)}}(x.sources,C.sources,k,M);const L=[];x.layers&&x.layers.forEach(V=>{V.source&&M[V.source]?S.push({command:qn.removeLayer,args:[V.id]}):L.push(V)});let N=x.terrain;N&&M[N.source]&&(S.push({command:qn.setTerrain,args:[void 0]}),N=void 0),S=S.concat(k),at(N,C.terrain)||S.push({command:qn.setTerrain,args:[C.terrain]}),function(V,K,te){K=K||[];const re=(V=V||[]).map(il),ie=K.map(il),se=V.reduce(Ta,{}),U=K.reduce(Ta,{}),J=re.slice(),de=Object.create(null);let he,Ce,Se,Ee,ce,De,_e;for(he=0,Ce=0;he<re.length;he++)Se=re[he],U.hasOwnProperty(Se)?Ce++:(te.push({command:qn.removeLayer,args:[Se]}),J.splice(J.indexOf(Se,Ce),1));for(he=0,Ce=0;he<ie.length;he++)Se=ie[ie.length-1-he],J[J.length-1-he]!==Se&&(se.hasOwnProperty(Se)?(te.push({command:qn.removeLayer,args:[Se]}),J.splice(J.lastIndexOf(Se,J.length-Ce),1)):Ce++,De=J[J.length-he],te.push({command:qn.addLayer,args:[U[Se],De]}),J.splice(J.length-he,0,Se),de[Se]=!0);for(he=0;he<ie.length;he++)if(Se=ie[he],Ee=se[Se],ce=U[Se],!de[Se]&&!at(Ee,ce))if(at(Ee.source,ce.source)&&at(Ee["source-layer"],ce["source-layer"])&&at(Ee.type,ce.type)){for(_e in Ws(Ee.layout,ce.layout,te,Se,null,qn.setLayoutProperty),Ws(Ee.paint,ce.paint,te,Se,null,qn.setPaintProperty),at(Ee.filter,ce.filter)||te.push({command:qn.setFilter,args:[Se,ce.filter]}),at(Ee.minzoom,ce.minzoom)&&at(Ee.maxzoom,ce.maxzoom)||te.push({command:qn.setLayerZoomRange,args:[Se,ce.minzoom,ce.maxzoom]}),Ee)Ee.hasOwnProperty(_e)&&"layout"!==_e&&"paint"!==_e&&"filter"!==_e&&"metadata"!==_e&&"minzoom"!==_e&&"maxzoom"!==_e&&(0===_e.indexOf("paint.")?Ws(Ee[_e],ce[_e],te,Se,_e.slice(6),qn.setPaintProperty):at(Ee[_e],ce[_e])||te.push({command:qn.setLayerProperty,args:[Se,_e,ce[_e]]}));for(_e in ce)ce.hasOwnProperty(_e)&&!Ee.hasOwnProperty(_e)&&"layout"!==_e&&"paint"!==_e&&"filter"!==_e&&"metadata"!==_e&&"minzoom"!==_e&&"maxzoom"!==_e&&(0===_e.indexOf("paint.")?Ws(Ee[_e],ce[_e],te,Se,_e.slice(6),qn.setPaintProperty):at(Ee[_e],ce[_e])||te.push({command:qn.setLayerProperty,args:[Se,_e,ce[_e]]}))}else te.push({command:qn.removeLayer,args:[Se]}),De=J[J.lastIndexOf(Se)+1],te.push({command:qn.addLayer,args:[ce,De]})}(L,C.layers,S)}catch(M){console.warn("Unable to compute style diff:",M),S=[{command:qn.setStyle,args:[C]}]}return S}(this.serialize(),c).filter(x=>!(x.command in Qc));if(0===h.length)return!1;const y=h.filter(x=>!(x.command in zd));if(y.length>0)throw new Error(`Unimplemented: ${y.map(x=>x.command).join(", ")}.`);return h.forEach(x=>{"setTransition"!==x.command&&"setProjection"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,h){return this.getImage(c)?this.fire(new f.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,h),this._afterImageUpdated(c),this)}updateImage(c,h){this.imageManager.updateImage(c,h)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new f.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new f.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,h,y={}){if(this._checkLoaded(),void 0!==this.getSource(c))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(f.validateSource,`sources.${c}`,h,null,y))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const x=bn(c,h,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:x.serialize(),sourceId:c}));const C=S=>{const M=(S?"symbol:":"other:")+c,k=this._sourceCaches[M]=new f.SourceCache(M,x,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[c]=k,k.style=this,k.onAdd(this.map)};C(!1),"vector"!==h.type&&"geojson"!==h.type||C(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const h=this.getSource(c);if(!h)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===c)return this.fire(new f.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new f.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const y=this._getSourceCaches(c);for(const x of y)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new f.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,h){this._checkLoaded(),this.getSource(c).setData(h),this._changed=!0}getSource(c){const h=this._getSourceCache(c);return h&&h.getSource()}_getSources(){const c=[];for(const h in this._otherSourceCaches){const y=this._getSourceCache(h);y&&c.push(y.getSource())}return c}addLayer(c,h,y={}){this._checkLoaded();const x=c.id;if(this.getLayer(x))return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let C;if("custom"===c.type){if(al(this,f.validateCustomStyleLayer(c)))return;C=f.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(x,c.source),c=f.clone$1(c),c=f.extend(c,{source:x})),this._validate(f.validateLayer,`layers.${x}`,c,{arrayIndex:-1},y))return;C=f.createStyleLayer(c),this._validateLayer(C),C.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}const S=h?this._order.indexOf(h):this._order.length;if(h&&-1===S)return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(S,0,x),this._layerOrderChanged=!0,this._layers[x]=C;const M=this._getLayerSourceCache(C);if(this._removedLayers[x]&&C.source&&M&&"custom"!==C.type){const k=this._removedLayers[x];delete this._removedLayers[x],k.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",M.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,h){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new f.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===h)return;const y=this._order.indexOf(c);this._order.splice(y,1);const x=h?this._order.indexOf(h):this._order.length;h&&-1===x?this.fire(new f.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(x,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const h=this._layers[c];if(!h)return void this.fire(new f.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const y=this._order.indexOf(c);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=h,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const h in this._layers)if(this._layers[h].type===c)return!0;return!1}setLayerZoomRange(c,h,y){this._checkLoaded();const x=this.getLayer(c);x?x.minzoom===h&&x.maxzoom===y||(null!=h&&(x.minzoom=h),null!=y&&(x.maxzoom=y),this._updateLayer(x)):this.fire(new f.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,h,y={}){this._checkLoaded();const x=this.getLayer(c);if(x){if(!at(x.filter,h))return null==h?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(f.validateFilter,`layers.${x.id}.filter`,h,{layerType:x.type},y)||(x.filter=f.clone$1(h),this._updateLayer(x)))}else this.fire(new f.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const h=this.getLayer(c);return h&&f.clone$1(h.filter)}setLayoutProperty(c,h,y,x={}){this._checkLoaded();const C=this.getLayer(c);C?at(C.getLayoutProperty(h),y)||(C.setLayoutProperty(h,y,x),this._updateLayer(C)):this.fire(new f.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,h){const y=this.getLayer(c);if(y)return y.getLayoutProperty(h);this.fire(new f.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,h,y,x={}){this._checkLoaded();const C=this.getLayer(c);C?at(C.getPaintProperty(h),y)||(C.setPaintProperty(h,y,x)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new f.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,h){const y=this.getLayer(c);return y&&y.getPaintProperty(h)}setFeatureState(c,h){this._checkLoaded();const y=c.source,x=c.sourceLayer,C=this.getSource(y);if(!C)return void this.fire(new f.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const S=C.type;if("geojson"===S&&x)return void this.fire(new f.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===S&&!x)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided.")));const M=this._getSourceCaches(y);for(const k of M)k.setFeatureState(x,c.id,h)}removeFeatureState(c,h){this._checkLoaded();const y=c.source,x=this.getSource(y);if(!x)return void this.fire(new f.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const C=x.type,S="vector"===C?c.sourceLayer:void 0;if("vector"===C&&!S)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new f.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const M=this._getSourceCaches(y);for(const k of M)k.removeFeatureState(S,c.id,h)}getFeatureState(c){this._checkLoaded();const h=c.source,y=c.sourceLayer,x=this.getSource(h);if(x){if("vector"!==x.type||y)return void 0===c.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(y,c.id);this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new f.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return f.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const h in this._sourceCaches){const y=this._sourceCaches[h].getSource();c[y.id]||(c[y.id]=y.serialize())}return f.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(c){this._updatedLayers[c.id]=!0;const h=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[c.source]="reload",h.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const h=S=>"fill-extrusion"===this._layers[S].type,y={},x=[];for(let S=this._order.length-1;S>=0;S--){const M=this._order[S];if(h(M)){y[M]=S;for(const k of c){const L=k[M];if(L)for(const N of L)x.push(N)}}}x.sort((S,M)=>M.intersectionZ-S.intersectionZ);const C=[];for(let S=this._order.length-1;S>=0;S--){const M=this._order[S];if(h(M))for(let k=x.length-1;k>=0;k--){const L=x[k].feature;if(y[L.layer.id]<S)break;C.push(L),x.pop()}else for(const k of c){const L=k[M];if(L)for(const N of L)C.push(N.feature)}}return C}queryRenderedFeatures(c,h,y){h&&h.filter&&this._validate(f.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const x={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new f.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const k of h.layers){const L=this._layers[k];if(!L)return this.fire(new f.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];x[L.source]=!0}}const C=[];h.availableImages=this._availableImages;const S=h&&h.layers?h.layers.some(k=>{const L=this.getLayer(k);return L&&L.is3D()}):this.has3DLayers(),M=xa.createFromScreenPoints(c,y);for(const k in this._sourceCaches){const L=this._sourceCaches[k].getSource().id;h.layers&&!x[L]||C.push(Pt(this._sourceCaches[k],this._layers,this._serializedLayers,M,h,y,S,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(k,L,N,V,K,te,re){const ie={},se=te.queryRenderedSymbols(V),U=[];for(const J of Object.keys(se).map(Number))U.push(re[J]);U.sort(br);for(const J of U){const de=J.featureIndex.lookupSymbolFeatures(se[J.bucketInstanceId],L,J.bucketIndex,J.sourceLayerIndex,K.filter,K.layers,K.availableImages,k);for(const he in de){const Ce=ie[he]=ie[he]||[],Se=de[he];Se.sort((Ee,ce)=>{const De=J.featureSortOrder;if(De){const _e=De.indexOf(Ee.featureIndex);return De.indexOf(ce.featureIndex)-_e}return ce.featureIndex-Ee.featureIndex});for(const Ee of Se)Ce.push(Ee)}}for(const J in ie)ie[J].forEach(de=>{const he=de.feature,Ce=N(k[J]);if(!Ce)return;const Se=Ce.getFeatureState(he.layer["source-layer"],he.id);he.source=he.layer.source,he.layer["source-layer"]&&(he.sourceLayer=he.layer["source-layer"]),he.state=Se});return ie}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(c,h){h&&h.filter&&this._validate(f.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const y=this._getSourceCaches(c);let x=[];for(const C of y)x=x.concat(Fi(C,h));return x}addSourceType(c,h,y){return Ys.getSourceType(c)?y(new Error(`A source type called "${c}" already exists.`)):(Ys.setSourceType(c,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:h.workerSourceURL},y):y(null,null))}getLight(){return this.light.getLight()}setLight(c,h={}){this._checkLoaded();const y=this.light.getLight();let x=!1;for(const S in c)if(!at(c[S],y[S])){x=!0;break}if(!x)return;const C=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,h),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,h=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let y=c;if(1===h){if("object"==typeof y.source){const x="terrain-dem-src";this.addSource(x,y.source),y=f.clone$1(y),y=f.extend(y,{source:x})}if(this._validate(f.validateTerrain,"terrain",y))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,h)}else{const x=this.terrain,C=x.get();for(const S of Object.keys(f.spec.terrain))!y.hasOwnProperty(S)&&f.spec.terrain[S].default&&(y[S]=f.spec.terrain[S].default);for(const S in y)if(!at(y[S],C[S])){x.set(y),this.stylesheet.terrain=y;const M=this._setTransitionParameters({duration:0});x.updateTransitions(M);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const h=this.fog=new Xt(c,this.map.transform);this.stylesheet.fog=c;const y=this._setTransitionParameters({duration:0});h.updateTransitions(y)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,y=h.get();0===Object.keys(c).length&&h.set(c);for(const x in c)if(!at(c[x],y[x])){h.set(c),this.stylesheet.fog=c;const C=this._setTransitionParameters({duration:0});h.updateTransitions(C);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:f.exported.now(),transition:f.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(y=>this.isLayerDraped(this._layers[y])),h=this._order.filter(y=>!this.isLayerDraped(this._layers[y]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...h)}_createTerrain(c,h){const y=this.terrain=new vn(c,h);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});y.updateTransitions(x)}_force3DLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"symbol"===h.type&&this._updateLayer(h)}}_validate(c,h,y,x,C={}){return(!C||!1!==C.validate)&&al(this,c.call(f.validateStyle,f.extend({key:h,style:this.serialize(),value:y,styleSpec:f.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),f.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const h=this._getSourceCaches(c);for(const y of h)y.clearTiles()}_reloadSource(c){const h=this._getSourceCaches(c);for(const y of h)y.resume(),y.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const h in this._sourceCaches)this._sourceCaches[h].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const h=this._sourceCaches[c];h.resume(),h.reload()}}_updatePlacement(c,h,y,x,C=!1){let S=!1,M=!1;const k={};for(const L of this._order){const N=this._layers[L];if("symbol"!==N.type)continue;if(!k[N.source]){const K=this._getLayerSourceCache(N);if(!K)continue;k[N.source]=K.getRenderableIds(!0).map(te=>K.getTileByID(te)).sort((te,re)=>re.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(re.tileID)?-1:1))}const V=this.crossTileSymbolIndex.addLayer(N,k[N.source],c.center.lng,c.projection);S=S||V}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),C=C||this._layerOrderChanged||0===y,this._layerOrderChanged&&this.fire(new f.Event("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(f.exported.now(),c.zoom))&&(this.pauseablePlacement=new Hm(c,this._order,C,h,y,x,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(f.exported.now()),M=!0),S&&this.pauseablePlacement.placement.setStale()),M||S)for(const L of this._order){const N=this._layers[L];"symbol"===N.type&&this.placement.updateLayerOpacities(N,k[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(f.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,h,y){this.imageManager.getImages(h.icons,y),this._updateTilesForChangedImages();const x=C=>{C&&C.setDependencies(h.tileID.key,h.type,h.icons)};x(this._otherSourceCaches[h.source]),x(this._symbolSourceCaches[h.source])}getGlyphs(c,h,y){this.glyphManager.getGlyphs(h.stacks,y)}getResource(c,h,y){return f.makeRequest(h,y)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const h=[];return this._otherSourceCaches[c]&&h.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&h.push(this._symbolSourceCaches[c]),h}_isSourceCacheLoaded(c){const h=this._getSourceCaches(c);return 0===h.length?(this.fire(new f.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):h.every(y=>y.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ys.getSourceType=function(_){return tn[_]},Ys.setSourceType=function(_,c){tn[_]=c},Ys.registerForPluginStateChange=f.registerForPluginStateChange;var je="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",ll="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ft="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",cl="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",xs="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let dl={},Jc={};const Vd=[];ao(je,Vd),ao(ft,Vd),ao(cl,Vd),ao(xs,Vd),dl=jt("",ft),Jc=jt(xs,cl);const Gm=jt("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Jo=je,ed="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var wo={background:jt("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:jt("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:jt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:jt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:jt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:jt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:jt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:jt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:jt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:jt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:jt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:jt("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:jt("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:jt("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:jt("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:jt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:jt("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:jt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:jt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:jt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:jt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:jt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:jt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:jt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:jt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ll),skyboxGradient:jt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ll),skyboxCapture:jt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:jt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:jt("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ao(_,c){const h=_.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let y of h)if(y=y.trim(),"#"===y[0]&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=y.split(" ");for(const C of x)c.includes(C)||c.push(C)}}function jt(_,c){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},C=[...Vd];return ao(_,C),ao(c,C),{fragmentSource:_=_.replace(h,(S,M,k,L,N)=>(x[N]=!0,"define"===M?`\n#ifndef HAS_UNIFORM_u_${N}\nvarying ${k} ${L} ${N};\n#else\nuniform ${k} ${L} u_${N};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${N}\n    ${k} ${L} ${N} = u_${N};\n#endif\n`)),vertexSource:c=c.replace(h,(S,M,k,L,N)=>{const V="float"===L?"vec2":"vec4",K=N.match(/color/)?"color":V;return x[N]?"define"===M?`\n#ifndef HAS_UNIFORM_u_${N}\nuniform lowp float u_${N}_t;\nattribute ${k} ${V} a_${N};\nvarying ${k} ${L} ${N};\n#else\nuniform ${k} ${L} u_${N};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${N}\n    ${N} = a_${N};\n#else\n    ${k} ${L} ${N} = u_${N};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${N}\n    ${N} = unpack_mix_${K}(a_${N}, u_${N}_t);\n#else\n    ${k} ${L} ${N} = u_${N};\n#endif\n`:"define"===M?`\n#ifndef HAS_UNIFORM_u_${N}\nuniform lowp float u_${N}_t;\nattribute ${k} ${V} a_${N};\n#else\nuniform ${k} ${L} u_${N};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${N}\n    ${k} ${L} ${N} = a_${N};\n#else\n    ${k} ${L} ${N} = u_${N};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${N}\n    ${k} ${L} ${N} = unpack_mix_${K}(a_${N}, u_${N}_t);\n#else\n    ${k} ${L} ${N} = u_${N};\n#endif\n`}),staticAttributes:y,usedDefines:C}}class Xu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,h,y,x,C,S,M){this.context=c;let k=this.boundPaintVertexBuffers.length!==x.length;for(let N=0;!k&&N<x.length;N++)this.boundPaintVertexBuffers[N]!==x[N]&&(k=!0);let L=this.boundDynamicVertexBuffers.length!==M.length;for(let N=0;!L&&N<M.length;N++)this.boundDynamicVertexBuffers[N]!==M[N]&&(L=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==y||k||L||this.boundIndexBuffer!==C||this.boundVertexOffset!==S)this.freshBind(h,y,x,C,S,M);else{c.bindVertexArrayOES.set(this.vao);for(const N of M)N&&N.bind();C&&C.dynamicDraw&&C.bind()}}freshBind(c,h,y,x,C,S){let M;const k=c.numAttributes,L=this.context,N=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=c,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=x,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=S;else{M=L.currentNumAttributes||0;for(let V=k;V<M;V++)N.disableVertexAttribArray(V)}h.enableAttributes(N,c),h.bind(),h.setVertexAttribPointers(N,c,C);for(const V of y)V.enableAttributes(N,c),V.bind(),V.setVertexAttribPointers(N,c,C);for(const V of S)V&&(V.enableAttributes(N,c),V.bind(),V.setVertexAttribPointers(N,c,C));x&&x.bind(),L.currentNumAttributes=k}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function jd(_,c){const h=Math.pow(2,c.canonical.z),y=c.canonical.y;return[new f.MercatorCoordinate(0,y/h).toLngLat().lat,new f.MercatorCoordinate(0,(y+1)/h).toLngLat().lat]}function Ku(_,c,h,y,x,C,S){const M=_.context,k=M.gl,L=h.fbo;if(!L)return;_.prepareDrawTile();const N=_.useProgram("hillshade");M.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,L.colorAttachment.get());const V=((ie,se,U,J)=>{const de=U.paint.get("hillshade-shadow-color"),he=U.paint.get("hillshade-highlight-color"),Ce=U.paint.get("hillshade-accent-color");let Se=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===U.paint.get("hillshade-illumination-anchor")&&(Se-=ie.transform.angle);const Ee=!ie.options.moving;return{u_matrix:J||ie.transform.calculateProjMatrix(se.tileID.toUnwrapped(),Ee),u_image:0,u_latrange:jd(0,se.tileID),u_light:[U.paint.get("hillshade-exaggeration"),Se],u_shadow:de,u_highlight:he,u_accent:Ce}})(_,h,y,_.terrain?c.projMatrix:null);_.prepareDrawProgram(M,N,c.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:te,tileBoundsSegments:re}=_.getTileBoundsBuffers(h);N.draw(M,k.TRIANGLES,x,C,S,f.CullFaceMode.disabled,V,y.id,K,te,re)}function Qu(_,c,h){if(!c.needsDEMTextureUpload)return;const y=_.context,x=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||_.getTileTexture(h.stride);const C=h.getPixels();c.demTexture?c.demTexture.update(C,{premultiply:!1}):c.demTexture=new f.Texture(y,C,x.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function Xs(_,c,h,y,x,C){const S=_.context,M=S.gl;if(!c.dem)return;const k=c.dem;if(S.activeTexture.set(M.TEXTURE1),Qu(_,c,k),!c.demTexture)return;c.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);const L=k.dim;S.activeTexture.set(M.TEXTURE0);let N=c.fbo;if(!N){const re=new f.Texture(S,{width:L,height:L,data:null},M.RGBA);re.bind(M.LINEAR,M.CLAMP_TO_EDGE),N=c.fbo=S.createFramebuffer(L,L,!0),N.colorAttachment.set(re.texture)}S.bindFramebuffer.set(N.framebuffer),S.viewport.set([0,0,L,L]);const{tileBoundsBuffer:V,tileBoundsIndexBuffer:K,tileBoundsSegments:te}=_.getMercatorTileBoundsBuffers();_.useProgram("hillshadePrepare").draw(S,M.TRIANGLES,y,x,C,f.CullFaceMode.disabled,((re,ie)=>{const se=ie.stride,U=f.create();return f.ortho(U,0,f.EXTENT,-f.EXTENT,0,0,1),f.translate(U,U,[0,-f.EXTENT,0]),{u_matrix:U,u_image:1,u_dimension:[se,se],u_zoom:re.overscaledZ,u_unpack:ie.unpackVector}})(c.tileID,k),h.id,V,K,te),c.needsHillshadePrepare=!1}const ic=_=>({u_matrix:new f.UniformMatrix4f(_),u_image0:new f.Uniform1i(_),u_skirt_height:new f.Uniform1f(_)}),rc=(_,c)=>({u_matrix:_,u_image0:0,u_skirt_height:c}),Ud=(_,c,h,y,x,C,S,M,k,L,N,V,K,te,re)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:h,u_zoom_transition:x,u_merc_center:C,u_image0:0,u_frustum_tl:S,u_frustum_tr:M,u_frustum_br:k,u_frustum_bl:L,u_globe_pos:N,u_globe_radius:V,u_viewport:K,u_grid_matrix:re?Float32Array.from(re):new Float32Array(9),u_skirt_height:te});function ul(_,c){return null!=_&&null!=c&&!(!_.hasData()||!c.hasData())&&null!=_.demTexture&&null!=c.demTexture&&_.tileID.key!==c.tileID.key}const Ks=new class{constructor(){this.operations={}}newMorphing(_,c,h,y,x){if(_ in this.operations){const C=this.operations[_];C.to.tileID.key!==h.tileID.key&&(C.queued=h)}else this.operations[_]={startTime:y,phase:0,duration:x,from:c,to:h,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const c=this.operations[_];return{from:c.from,to:c.to,phase:c.phase}}update(_){for(const c in this.operations){const h=this.operations[c];for(h.phase=(_-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,_)){delete this.operations[c];break}}}_nextOp(_,c){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=c,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},hl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function pl(_){return 6*Math.pow(1.5,22-_)}function Pp(_,c){const h=1<<_.z;return!c&&(0===_.x||_.x===h-1)||0===_.y||_.y===h-1}const td=_=>({u_matrix:_});function Op(_,c,h,y,x){if(x>0){const C=f.exported.now(),S=(C-_.timeAdded)/x,M=c?(C-c.timeAdded)/x:-1,k=h.getSource(),L=y.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),N=!c||Math.abs(c.tileID.overscaledZ-L)>Math.abs(_.tileID.overscaledZ-L),V=N&&_.refreshedUponExpiration?1:f.clamp(N?S:1-M,0,1);return _.refreshedUponExpiration&&S>=1&&(_.refreshedUponExpiration=!1),c?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}class Ju extends f.SourceCache{constructor(c){const h={type:"raster-dem",maxzoom:c.transform.maxZoom},y=new lr(nn(),null),x=bn("mock-dem",h,y,c.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,h){c.state="loaded",h(null)}}class eh extends f.SourceCache{constructor(c){const h=bn("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new lr(nn(),null),c.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,h,y){if(c.freezeTileCoverage)return;this.transform=c;const x=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,S)=>{if(C[S.key]="",!this._tiles[S.key]){const M=new f.Tile(S,this._source.tileSize*S.overscaleFactor(),c.tileZoom);M.state="loaded",this._tiles[S.key]=M}return C},{});for(const C in this._tiles)C in x||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(c){const h=this.proxyCachedFBO[c];if(void 0!==h){const y=Object.values(h);this.renderCachePool.push(...y),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class th extends f.OverscaledTileID{constructor(c,h,y){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=h,this.projMatrix=y}}class zo extends f.Elevation{constructor(c,h){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,x,C]=function(k){const L=new f.StructArrayLayout2i4,N=new f.StructArrayLayout3ui6,V=131;L.reserve(17161),N.reserve(33800);const K=f.EXTENT/128,te=f.EXTENT+K/2,re=te+K;for(let se=-K;se<re;se+=K)for(let U=-K;U<re;U+=K){const J=U<0||U>te||se<0||se>te?24575:0,de=f.clamp(Math.round(U),0,f.EXTENT),he=f.clamp(Math.round(se),0,f.EXTENT);L.emplaceBack(de+J,he)}const ie=(se,U)=>{const J=U*V+se;N.emplaceBack(J+1,J,J+V),N.emplaceBack(J+V,J+V+1,J+1)};for(let se=1;se<129;se++)for(let U=1;U<129;U++)ie(U,se);return[0,129].forEach(se=>{for(let U=0;U<130;U++)ie(U,se),ie(se,U)}),[L,N,32768]}(),S=c.context;this.gridBuffer=S.createVertexBuffer(y,f.posAttributes.members),this.gridIndexBuffer=S.createIndexBuffer(x),this.gridSegments=f.SegmentVector.simpleSegment(0,0,y.length,x.length),this.gridNoSkirtSegments=f.SegmentVector.simpleSegment(0,0,y.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new eh(h.map),this.orthoMatrix=f.create(),f.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,f.EXTENT,0,f.EXTENT,0,1);const M=S.gl;this._overlapStencilMode=new f.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ju(h.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,h,y){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const x=c.terrain.properties;this.sourceCache=0===c.terrain.drapeRenderMode?this._mockSourceCache:c._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const C=()=>{this.sourceCache.used&&f.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const S=this.getScaledDemTileSize();this.sourceCache.update(h,S,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),h.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==c.efficiency&&f.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=0===y._centerAltitude&&-1===this.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(y.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=h.getIds().map(k=>{const L=h.getTileByID(k).tileID;return L.projMatrix=y.calculateProjMatrix(L.toUnwrapped()),L});(function(k,L){const N=L.transform.pointCoordinate(L.transform.getCameraPoint()),V=new f.Point(N.x,N.y);k.sort((K,te)=>{if(te.overscaledZ-K.overscaledZ)return te.overscaledZ-K.overscaledZ;const re=new f.Point(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ie=new f.Point(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),se=V.mult(1<<K.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(re)-se.distSqr(ie)})})(x,this.painter),this._previousZoom=y.zoom;const C=this.proxyToSource||{};this.proxyToSource={},x.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const S=this._style._sourceCaches;for(const k in S){const L=S[k];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,c[k],C),L.usedForTerrain))continue;const N=c[k];L.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[h.id]=x.map(k=>new th(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1,this._updateTimestamp=f.exported.now();const M={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const L=this.terrainTileForTile[k.key];if(!L)continue;const N=L.tileID.key;N in M||(this._visibleDemTiles.push(L),M[N]=N)}}_assignTerrainTiles(c){this._initializing||c.forEach(h=>{if(this.terrainTileForTile[h.key])return;const y=this._findTileCoveringTileID(h,this.sourceCache);y&&(this.terrainTileForTile[h.key]=y)})}_prepareDEMTextures(){const c=this.painter.context,h=c.gl;for(const y in this.terrainTileForTile){const x=this.terrainTileForTile[y],C=x.dem;!C||x.demTexture&&!x.needsDEMTextureUpload||(c.activeTexture.set(h.TEXTURE1),Qu(this.painter,x,C))}}_prepareDemTileUniforms(c,h,y,x){if(!h||null==h.demTexture)return!1;const C=c.tileID.canonical,S=Math.pow(2,h.tileID.canonical.z-C.z),M=x||"";return y[`u_dem_tl${M}`]=[C.x*S%1,C.y*S%1],y[`u_dem_scale${M}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,h=c.gl;if(!this._emptyDepthBufferTexture){const y=new f.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new f.Texture(c,y,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const h=this._visibleDemTiles.reduce((y,x)=>{if(!x.dem)return y;const C=x.dem.tree.minimums[0];return C>0&&c++,y+C},0);return c?h/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,h=c.gl;c.activeTexture.set(h.TEXTURE2);const y=this._getLoadedAreaMinimum(),x=new f.RGBAImage({width:1,height:1},new Uint8Array(f.DEMData.pack(y,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(x,{premultiply:!1}):C=this._emptyDEMTexture=new f.Texture(c,x,h.RGBA,{premultiply:!1}),C}setupElevationDraw(c,h,y){const x=this.painter.context,C=x.gl,S=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:f.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var M;S.u_dem_size=this.sourceCache.getSource().tileSize,S.u_exaggeration=this.exaggeration();let k=null,L=null,N=1;if(y&&y.morphing&&this._useVertexMorphing){const V=y.morphing.srcDemTile,K=y.morphing.dstDemTile;N=y.morphing.phase,V&&K&&(this._prepareDemTileUniforms(c,V,S,"_prev")&&(L=V),this._prepareDemTileUniforms(c,K,S)&&(k=K))}if(L&&k?(x.activeTexture.set(C.TEXTURE2),k.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),x.activeTexture.set(C.TEXTURE4),L.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),S.u_dem_lerp=N):(k=this.terrainTileForTile[c.tileID.key],x.activeTexture.set(C.TEXTURE2),(this._prepareDemTileUniforms(c,k,S)?k.demTexture:this.emptyDEMTexture).bind(C.NEAREST,C.CLAMP_TO_EDGE)),x.activeTexture.set(C.TEXTURE3),y&&y.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),y&&y.useMeterToDem&&k){const V=(1<<k.tileID.canonical.z)*f.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=V}if(y&&y.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),h.setTerrainUniformValues(x,S),"globe"===this.painter.transform.projection.name){const V=this.globeUniformValues(this.painter.transform,c.tileID.canonical,y&&y.useDenormalizedUpVectorScale);h.setGlobeUniformValues(x,V)}}globeUniformValues(c,h,y){const x=c.projection;return{u_tile_tl_up:x.upVector(h,0,0),u_tile_tr_up:x.upVector(h,f.EXTENT,0),u_tile_br_up:x.upVector(h,f.EXTENT,f.EXTENT),u_tile_bl_up:x.upVector(h,0,f.EXTENT),u_tile_up_scale:y?f.globeMetersToEcef(1):x.upVectorScale(h,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const h=this.painter,y=this.painter.context;0!==c.length&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,C,S,M,k){if("globe"===x.transform.projection.name)!function(L,N,V,K,te){const re=L.context,ie=re.gl;let se,U;const J=L.options.showTerrainWireframe?2:0,de=L.transform,he=f.globeUseCustomAntiAliasing(L,re,de),Ce=(et,Be)=>{if(U===et)return;const Ye=[hl[et],"PROJECTION_GLOBE_VIEW"];he&&Ye.push("CUSTOM_ANTIALIASING"),Be&&Ye.push(hl[J]),se=L.useProgram("globeRaster",null,Ye),U=et},Se=L.colorModeForRenderPass(),Ee=new f.DepthMode(ie.LEQUAL,f.DepthMode.ReadWrite,L.depthRangeFor3D);Ks.update(te);const ce=f.calculateGlobeMercatorMatrix(de),De=[f.mercatorXfromLng(de.center.lng),f.mercatorYfromLat(de.center.lat)],_e=J?[!1,!0]:[!1],Ie=L.globeSharedBuffers,Pe=[de.width*f.exported.devicePixelRatio,de.height*f.exported.devicePixelRatio],Ke=Float32Array.from(de.globeMatrix),Ve={useDenormalizedUpVectorScale:!0};if(_e.forEach(et=>{const Be=L.transform,Ye=pl(Be.zoom)*N.exaggeration();U=-1;const ct=et?ie.LINES:ie.TRIANGLES;for(const tt of K){const dt=V.getTile(tt),Tt=f.StencilMode.disabled,Ht=N.prevTerrainTileForTile[tt.key],Mt=N.terrainTileForTile[tt.key];ul(Ht,Mt)&&Ks.newMorphing(tt.key,Ht,Mt,te,250),re.activeTexture.set(ie.TEXTURE0),dt.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const Lt=Ks.getMorphValuesForProxy(tt.key),Jt=Lt?1:0;Lt&&f.extend$1(Ve,{morphing:{srcDemTile:Lt.from,dstDemTile:Lt.to,phase:f.easeCubicInOut(Lt.phase)}});const wn=f.tileCornersToBounds(tt.canonical),Ot=f.getLatitudinalLod(wn.getCenter().lat),Wn=f.getGridMatrix(tt.canonical,wn,Ot,Be.worldSize/Be._pixelsPerMercatorPixel),ni=f.globeNormalizeECEF(f.globeTileBounds(tt.canonical)),Yn=Ud(Be.projMatrix,Ke,ce,ni,f.globeToMercatorTransition(Be.zoom),De,Be.frustumCorners.TL,Be.frustumCorners.TR,Be.frustumCorners.BR,Be.frustumCorners.BL,Be.globeCenterInViewSpace,Be.globeRadius,Pe,Ye,Wn);if(Ce(Jt,et),N.setupElevationDraw(dt,se,Ve),L.prepareDrawProgram(re,se,tt.toUnwrapped()),Ie){const[Xn,kr,nr]=et?Ie.getWirefameBuffers(L.context,Ot):Ie.getGridBuffers(Ot,0!==Ye);se.draw(re,ct,Ee,Tt,Se,f.CullFaceMode.backCCW,Yn,"globe_raster",Xn,kr,nr)}}}),Ie){const et=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];he&&et.push("CUSTOM_ANTIALIASING"),se=L.useProgram("globeRaster",null,et);for(const Be of K){const{x:Ye,y:ct,z:tt}=Be.canonical,dt=0===ct,Tt=ct===(1<<tt)-1,[Ht,Mt,Lt,Jt]=Ie.getPoleBuffers(tt);if(Jt&&(dt||Tt)){const wn=V.getTile(Be);re.activeTexture.set(ie.TEXTURE0),wn.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);let Ot=f.globePoleMatrixForTile(tt,Ye,de);const Wn=f.globeNormalizeECEF(f.globeTileBounds(Be.canonical)),ni=(Yn,Xn)=>Yn.draw(re,ie.TRIANGLES,Ee,f.StencilMode.disabled,Se,f.CullFaceMode.disabled,Ud(de.projMatrix,Ot,Ot,Wn,0,De,de.frustumCorners.TL,de.frustumCorners.TR,de.frustumCorners.BR,de.frustumCorners.BL,de.globeCenterInViewSpace,de.globeRadius,Pe,0),"globe_pole_raster",Xn,Lt,Jt);N.setupElevationDraw(wn,se,Ve),L.prepareDrawProgram(re,se,Be.toUnwrapped()),dt&&ni(se,Ht),Tt&&(Ot=f.scale(f.create(),Ot,[1,-1,1]),ni(se,Mt))}}}}(x,C,S,M,k);else{const L=x.context,N=L.gl;let V,K;const te=x.options.showTerrainWireframe?2:0,re=(de,he)=>{if(K===de)return;const Ce=[hl[de]];he&&Ce.push(hl[te]),V=x.useProgram("terrainRaster",null,Ce),K=de},ie=x.colorModeForRenderPass(),se=new f.DepthMode(N.LEQUAL,f.DepthMode.ReadWrite,x.depthRangeFor3D);Ks.update(k);const U=x.transform,J=pl(U.zoom)*C.exaggeration();(te?[!1,!0]:[!1]).forEach(de=>{K=-1;const he=de?N.LINES:N.TRIANGLES,[Ce,Se]=de?C.getWirefameBuffer():[C.gridIndexBuffer,C.gridSegments];for(const Ee of M){const ce=S.getTile(Ee),De=f.StencilMode.disabled,_e=C.prevTerrainTileForTile[Ee.key],Ie=C.terrainTileForTile[Ee.key];ul(_e,Ie)&&Ks.newMorphing(Ee.key,_e,Ie,k,250),L.activeTexture.set(N.TEXTURE0),ce.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST);const Pe=Ks.getMorphValuesForProxy(Ee.key),Ke=Pe?1:0;let Ve;Pe&&(Ve={morphing:{srcDemTile:Pe.from,dstDemTile:Pe.to,phase:f.easeCubicInOut(Pe.phase)}});const et=rc(Ee.projMatrix,Pp(Ee.canonical,U.renderWorldCopies)?J/10:J);re(Ke,de),C.setupElevationDraw(ce,V,Ve),x.prepareDrawProgram(L,V,Ee.toUnwrapped()),V.draw(L,he,se,De,ie,f.CullFaceMode.backCCW,et,"terrain_raster",C.gridBuffer,Ce,Se)}})}}(h,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const h=this.painter,y=this.painter.context,x=this.proxySourceCache,C=this.proxiedCoords[x.id],S=this._drapedRenderBatches.shift(),M=[],k=h.style.order;let L=0;for(const N of C){const V=x.getTileByID(N.proxyTileKey),K=x.proxyCachedFBO[N.key]?x.proxyCachedFBO[N.key][c]:void 0,te=void 0!==K?x.renderCache[K]:this.pool[L++],re=void 0!==K;if(V.texture=te.tex,re&&!te.dirty){M.push(V.tileID);continue}let ie;y.bindFramebuffer.set(te.fb.framebuffer),this.renderedToTile=!1,te.dirty&&(y.clear({color:f.Color.transparent,stencil:0}),te.dirty=!1);for(let se=S.start;se<=S.end;++se){const U=h.style._layers[k[se]];if(U.isHidden(h.transform.zoom))continue;const J=h.style._getLayerSourceCache(U),de=J?this.proxyToSource[N.key][J.id]:[N];if(!de)continue;const he=de;y.viewport.set([0,0,te.fb.width,te.fb.height]),ie!==(J?J.id:null)&&(this._setupStencil(te,de,U,J),ie=J?J.id:null),h.renderLayer(h,J,U,he)}this.renderedToTile?(te.dirty=!0,M.push(V.tileID)):re||--L,5===L&&(L=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),S.end+1}postRender(){}renderCacheEfficiency(c){const h=c.order.length;if(0===h)return{efficiency:100};let y,x=0,C=0,S=!1;for(let M=0;M<h;++M){const k=c._layers[c.order[M]];this._style.isLayerDraped(k)?(S&&++x,++C):S||(S=!0,y=k.id)}return 0===C?{efficiency:100}:{efficiency:100*(1-x/C),firstUndrapedLayer:y}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{c=Math.min(c,h.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,h,y){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const S=C.tileID,M=1<<S.overscaledZ,{x:k,y:L}=S.canonical,N=k/M,V=(k+1)/M,K=L/M,te=(L+1)/M;return{minx:N,miny:K,maxx:V,maxy:te,t:C.dem.tree.raycastRoot(N,K,V,te,c,h,y),tile:C}});x.sort((C,S)=>(null!==C.t?C.t:Number.MAX_VALUE)-(null!==S.t?S.t:Number.MAX_VALUE));for(const C of x){if(null==C.t)return null;const S=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,c,h,y);if(null!=S)return S}return null}_createFBO(){const c=this.painter.context,h=c.gl,y=this.drapeBufferSize;c.activeTexture.set(h.TEXTURE0);const x=new f.Texture(c,{width:y[0],height:y[1],data:null},h.RGBA);x.bind(h.LINEAR,h.CLAMP_TO_EDGE);const C=c.createFramebuffer(y[0],y[1],!1);return C.colorAttachment.set(x.texture),C.depthAttachment=new Ae(c,C.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:C,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const h=this._style._layers[c],y=h.isHidden(this.painter.transform.zoom);return"custom"===h.type?!y&&h.shouldRedrape():!y&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const y of this._style._getSources())if(y instanceof _t){c=!0;break}if(!c)return;const h={};for(let y=0;y<this._style.order.length;++y){const x=this._style._layers[this._style.order[y]],C=this._style._getLayerSourceCache(x);if(C&&!h[C.id]&&!x.isHidden(this.painter.transform.zoom)&&"line"===x.type&&x.widthExpression()instanceof f.ZoomDependentExpression){h[C.id]=!0;for(const S of this.proxyCoords){const M=this.proxyToSource[S.key][C.id];if(M)for(const k of M)this._clearRenderCacheForTile(C.id,k)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const y in this._style._sourceCaches)if(this._style._sourceCaches[y]._source instanceof Xe){c=!0;break}if(!c)return;const h={};for(let y=0;y<this._style.order.length;++y){const x=this._style._layers[this._style.order[y]],C=this._style._getLayerSourceCache(x);if(!C||h[C.id]||x.isHidden(this.painter.transform.zoom)||"raster"!==x.type)continue;const S=x.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const k=this.proxyToSource[M.key][C.id];if(k)for(const L of k){const N=Op(C.getTile(L),C.findLoadedParent(L,0),C,this.painter.transform,S);(1!==N.opacity||0!==N.mix)&&this._clearRenderCacheForTile(C.id,L)}}}}_setupDrapedRenderBatches(){const c=this._style.order,h=c.length;if(0===h)return;const y=[];let x,C=0,S=this._style._layers[c[C]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++C<h;)S=this._style._layers[c[C]];for(;C<h;++C){const M=this._style._layers[c[C]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?void 0===x&&(x=C):void 0!==x&&(y.push({start:x,end:C-1}),x=void 0))}void 0!==x&&y.push({start:x,end:C-1}),this._drapedRenderBatches=y}_setupRenderCache(c){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const S=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let M=0;M<S.length;++M){const k=Object.values(S[M]);h.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,x=this._tilesDirty;for(let S=y.length-1;S>=0;S--){const M=y[S];if(h.getTileByID(M.key),void 0!==h.proxyCachedFBO[M.key]){const k=c[M.key],L=this.proxyToSource[M.key];let N=0;for(const V in L){const K=L[V],te=k[V];if(!te||te.length!==K.length||K.some((re,ie)=>re!==te[ie]||x[V]&&x[V].hasOwnProperty(re.key))){N=-1;break}++N}for(const V in h.proxyCachedFBO[M.key])h.renderCache[h.proxyCachedFBO[M.key][V]].dirty=N<0||N!==Object.values(k).length}}const C=[...this._drapedRenderBatches];C.sort((S,M)=>M.end-M.start-(S.end-S.start));for(const S of C)for(const M of y){if(h.proxyCachedFBO[M.key])continue;let k=h.renderCachePool.pop();void 0===k&&h.renderCache.length<50&&(k=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==k&&(h.proxyCachedFBO[M.key]={},h.proxyCachedFBO[M.key][S.start]=k,h.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(c,h,y,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,S=C.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let M;if(y.isTileClipped())M=h.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):f.StencilMode.disabled}_renderTileClippingMasks(c,h){const y=this.painter,x=this.painter.context,C=x.gl;y._tileClippingMaskIDs={},x.setColorMode(f.ColorMode.disabled),x.setDepthMode(f.DepthMode.disabled);const S=y.useProgram("clippingMask");for(const M of c){const k=y._tileClippingMaskIDs[M.key]=--h;S.draw(x,C.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:C.ALWAYS,mask:0},k,255,C.KEEP,C.KEEP,C.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,td(M.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(c){const h=this.painter.transform;if(c.x<0||c.x>h.width||c.y<0||c.y>h.height)return null;const y=[c.x,c.y,1,1];f.transformMat4$1(y,y,h.pixelMatrixInverse),f.scale$1(y,y,1/y[3]),y[0]/=h.worldSize,y[1]/=h.worldSize;const x=h._camera.position,C=f.mercatorZfromAltitude(1,h.center.lat),S=[x[0],x[1],x[2]/C,0],M=f.subtract([],y.slice(0,3),S);f.normalize(M,M);const k=this.raycast(S,M,this._exaggeration);return null!==k&&k?(f.scaleAndAdd(S,S,M,k),S[3]=S[2],S[2]*=C,S):null}drawDepth(){const c=this.painter,h=c.context,y=this.proxySourceCache,x=Math.ceil(c.width),C=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===C||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const S=h.gl,M=h.createFramebuffer(x,C,!0);h.activeTexture.set(S.TEXTURE0);const k=new f.Texture(h,{width:x,height:C,data:null},S.RGBA);k.bind(S.NEAREST,S.CLAMP_TO_EDGE),M.colorAttachment.set(k.texture);const L=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,x,C);M.depthAttachment.set(L),this._depthFBO=M,this._depthTexture=k}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,x,C]),function(S,M,k,L){if("globe"===S.transform.projection.name)return;const N=S.context,V=N.gl;N.clear({depth:1});const K=S.useProgram("terrainDepth"),te=new f.DepthMode(V.LESS,f.DepthMode.ReadWrite,S.depthRangeFor3D);for(const re of L){const ie=k.getTile(re),se=rc(re.projMatrix,0);M.setupElevationDraw(ie,K),K.draw(N,V.TRIANGLES,te,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.backCCW,se,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(c,this,y,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,h,y){if(c.getSource()instanceof Ut)return this._setupProxiedCoordsForImageSource(c,h,y);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const x=this.proxiedCoords[c.id]=[],C=this.proxyCoords;for(let M=0;M<C.length;M++){const k=C[M],L=this._findTileCoveringTileID(k,c);if(L){const N=this._createProxiedId(k,L,y[k.key]&&y[k.key][c.id]);x.push(N),this.proxyToSource[k.key][c.id]=[N]}}let S=!1;for(let M=0;M<h.length;M++){const k=c.getTile(h[M]);if(!k||!k.hasData())continue;const L=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==k.tileID.canonical.z){const N=this.proxyToSource[L.tileID.key][c.id],V=this._createProxiedId(L.tileID,k,y[L.tileID.key]&&y[L.tileID.key][c.id]);N?N.splice(N.length-1,0,V):this.proxyToSource[L.tileID.key][c.id]=[V],x.push(V),S=!0}}this._sourceTilesOverlap[c.id]=S}_setupProxiedCoordsForImageSource(c,h,y){if(!c.getSource().loaded())return;const x=this.proxiedCoords[c.id]=[],C=this.proxyCoords,S=c.getSource(),M=new f.Point(S.tileID.x,S.tileID.y)._div(1<<S.tileID.z),k=S.coordinates.map(f.MercatorCoordinate.fromLngLat).reduce((N,V)=>(N.min.x=Math.min(N.min.x,V.x-M.x),N.min.y=Math.min(N.min.y,V.y-M.y),N.max.x=Math.max(N.max.x,V.x-M.x),N.max.y=Math.max(N.max.y,V.y-M.y),N),{min:new f.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new f.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(N,V)=>{const K=N.wrap+N.canonical.x/(1<<N.canonical.z),te=N.canonical.y/(1<<N.canonical.z),re=f.EXTENT/(1<<N.canonical.z),ie=V.wrap+V.canonical.x/(1<<V.canonical.z),se=V.canonical.y/(1<<V.canonical.z);return K+re<ie+k.min.x||K>ie+k.max.x||te+re<se+k.min.y||te>se+k.max.y};for(let N=0;N<C.length;N++){const V=C[N];for(let K=0;K<h.length;K++){const te=c.getTile(h[K]);if(!te||!te.hasData()||L(V,te.tileID))continue;const re=this._createProxiedId(V,te,y[V.key]&&y[V.key][c.id]),ie=this.proxyToSource[V.key][c.id];ie?ie.push(re):this.proxyToSource[V.key][c.id]=[re],x.push(re)}}}_createProxiedId(c,h,y){let x=this.orthoMatrix;if(y){const C=y.find(S=>S.key===h.tileID.key);if(C)return C}if(h.tileID.key!==c.key){const C=c.canonical.z-h.tileID.canonical.z;let S,M,k;x=f.create();const L=h.tileID.wrap-c.wrap<<c.overscaledZ;C>0?(S=f.EXTENT>>C,M=S*((h.tileID.canonical.x<<C)-c.canonical.x+L),k=S*((h.tileID.canonical.y<<C)-c.canonical.y)):(S=f.EXTENT<<-C,M=f.EXTENT*(h.tileID.canonical.x-(c.canonical.x+L<<-C)),k=f.EXTENT*(h.tileID.canonical.y-(c.canonical.y<<-C))),f.ortho(x,0,S,0,S,0,1),f.translate(x,x,[M,k,0])}return new th(h.tileID,c.key,x)}_findTileCoveringTileID(c,h){let y=h.getTile(c);if(y&&y.hasData())return y;const x=this._findCoveringTileCache[h.id],C=x[c.key];if(y=C?h.getTileByID(C):null,y&&y.hasData()||null===C)return y;let S=y?y.tileID:c,M=S.overscaledZ;const k=h.getSource().minzoom,L=[];if(!C){const V=h.getSource().maxzoom;if(c.canonical.z>=V){const K=c.canonical.z-V;h.getSource().reparseOverscaled?(M=Math.max(c.canonical.z+2,h.transform.tileZoom),S=new f.OverscaledTileID(M,c.wrap,V,c.canonical.x>>K,c.canonical.y>>K)):0!==K&&(M=V,S=new f.OverscaledTileID(M,c.wrap,V,c.canonical.x>>K,c.canonical.y>>K))}S.key!==c.key&&(L.push(S.key),y=h.getTile(S))}const N=V=>{L.forEach(K=>{x[K]=V}),L.length=0};for(M-=1;M>=k&&(!y||!y.hasData());M--){y&&N(y.tileID.key);const V=S.calculateScaledKey(M);if(y=h.getTileByID(V),y&&y.hasData())break;const K=x[V];if(null===K)break;void 0===K?L.push(V):y=h.getTileByID(K)}return N(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,h){let y=this._tilesDirty[c];y||(y=this._tilesDirty[c]={}),y[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(h){let y=0;const x=new f.StructArrayLayout2ui4,C=131;for(let S=1;S<129;S++){for(let M=1;M<129;M++)y=S*C+M,x.emplaceBack(y,y+1),x.emplaceBack(y,y+C),x.emplaceBack(y+1,y+C),128===S&&x.emplaceBack(y+C,y+C+1);x.emplaceBack(y+1,y+1+C)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=f.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ln{static cacheKey(c,h,y,x){let C=`${h}${x?x.cacheKey:""}`;for(const S of y)c.usedDefines.includes(S)&&(C+=`/${S}`);return C}constructor(c,h,y,x,C,S){const M=c.gl;this.program=M.createProgram();const k=function(U){const J=[];for(let de=0;de<U.length;de++){if(null===U[de])continue;const he=U[de].split(" ");J.push(he.pop())}return J}(y.staticAttributes),L=x?x.getBinderAttributes():[],N=k.concat(L);let V=x?x.defines():[];V=V.concat(S.map(U=>`#define ${U}`));const K=c.isWebGL2?"#version 300 es\n":"",te=K+V.concat(c.extStandardDerivatives&&0===K.length?"#extension GL_OES_standard_derivatives : enable\n".concat(ed):ed,ed,Jo,Gm.fragmentSource,Jc.fragmentSource,y.fragmentSource).join("\n"),re=K+V.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Jo,Gm.vertexSource,Jc.vertexSource,dl.vertexSource,y.vertexSource).join("\n"),ie=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(ie,te),M.compileShader(ie),M.attachShader(this.program,ie);const se=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(se,re),M.compileShader(se),M.attachShader(this.program,se),this.attributes={},this.numAttributes=N.length;for(let U=0;U<this.numAttributes;U++)N[U]&&(M.bindAttribLocation(this.program,U,N[U]),this.attributes[N[U]]=U);M.linkProgram(this.program),M.deleteShader(se),M.deleteShader(ie),this.fixedUniforms=C(c),this.binderUniforms=x?x.getUniforms(c):[],S.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new f.Uniform1i(U=c),u_dem_prev:new f.Uniform1i(U),u_dem_unpack:new f.Uniform4f(U),u_dem_tl:new f.Uniform2f(U),u_dem_scale:new f.Uniform1f(U),u_dem_tl_prev:new f.Uniform2f(U),u_dem_scale_prev:new f.Uniform1f(U),u_dem_size:new f.Uniform1f(U),u_dem_lerp:new f.Uniform1f(U),u_exaggeration:new f.Uniform1f(U),u_depth:new f.Uniform1i(U),u_depth_size_inv:new f.Uniform2f(U),u_meter_to_dem:new f.Uniform1f(U),u_label_plane_matrix_inv:new f.UniformMatrix4f(U)}),S.includes("GLOBE")&&(this.globeUniforms=(U=>({u_tile_tl_up:new f.Uniform3f(U),u_tile_tr_up:new f.Uniform3f(U),u_tile_br_up:new f.Uniform3f(U),u_tile_bl_up:new f.Uniform3f(U),u_tile_up_scale:new f.Uniform1f(U)}))(c)),S.includes("FOG")&&(this.fogUniforms=(U=>({u_fog_matrix:new f.UniformMatrix4f(U),u_fog_range:new f.Uniform2f(U),u_fog_color:new f.Uniform4f(U),u_fog_horizon_blend:new f.Uniform1f(U),u_fog_temporal_offset:new f.Uniform1f(U),u_frustum_tl:new f.Uniform3f(U),u_frustum_tr:new f.Uniform3f(U),u_frustum_br:new f.Uniform3f(U),u_frustum_bl:new f.Uniform3f(U),u_globe_pos:new f.Uniform3f(U),u_globe_radius:new f.Uniform1f(U),u_globe_transition:new f.Uniform1f(U),u_is_globe:new f.Uniform1i(U),u_viewport:new f.Uniform2f(U)}))(c))}var U}setTerrainUniformValues(c,h){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in h)y[x]&&y[x].set(this.program,x,h[x])}}setGlobeUniformValues(c,h){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in h)y[x]&&y[x].set(this.program,x,h[x])}}setFogUniformValues(c,h){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in h)y[x].set(this.program,x,h[x])}}draw(c,h,y,x,C,S,M,k,L,N,V,K,te,re,ie){const se=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(y),c.setStencilMode(x),c.setColorMode(C),c.setCullFace(S);for(const J of Object.keys(this.fixedUniforms))this.fixedUniforms[J].set(this.program,J,M[J]);re&&re.setUniforms(this.program,c,this.binderUniforms,K,{zoom:te});const U={[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[h];for(const J of V.get()){const de=J.vaos||(J.vaos={});(de[k]||(de[k]=new Xu)).bind(c,this,L,re?re.getPaintVertexBuffers():[],N,J.vertexOffset,ie||[]),se.drawElements(h,J.primitiveLength*U,se.UNSIGNED_SHORT,J.primitiveOffset*U*2)}}}function nd(_,c){const h=Math.pow(2,c.tileID.overscaledZ),y=c.tileSize*Math.pow(2,_.transform.tileZoom)/h,x=y*(c.tileID.canonical.x+c.tileID.wrap*h),C=y*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/vr(c,1,_.transform.tileZoom),u_pixel_coord_upper:[x>>16,C>>16],u_pixel_coord_lower:[65535&x,65535&C]}}const qm=f.create(),Fp=(_,c,h,y,x,C,S,M,k,L,N)=>{const V=c.style.light,K=V.properties.get("position"),te=[K.x,K.y,K.z],re=f.create$1();"viewport"===V.properties.get("anchor")&&(f.fromRotation(re,-c.transform.angle),f.transformMat3(te,te,re));const ie=V.properties.get("color"),se=c.transform,U={u_matrix:_,u_lightpos:te,u_lightintensity:V.properties.get("intensity"),u_lightcolor:[ie.r,ie.g,ie.b],u_vertical_gradient:+h,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:qm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:C};return"globe"===se.projection.name&&(U.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],U.u_zoom_transition=k,U.u_inv_rot_matrix=N,U.u_merc_center=L,U.u_up_dir=se.projection.upVector(new f.CanonicalTileID(0,0,0),L[0]*f.EXTENT,L[1]*f.EXTENT),U.u_height_lift=M),U},Wm=(_,c,h,y,x,C,S,M,k,L,N,V)=>{const K=Fp(_,c,h,y,x,C,S,k,L,N,V),te={u_height_factor:-Math.pow(2,S.overscaledZ)/M.tileSize/8};return f.extend(K,nd(c,M),te)},oc=_=>({u_matrix:_}),nh=(_,c,h)=>f.extend(oc(_),nd(c,h)),vy=(_,c)=>({u_matrix:_,u_world:c}),by=(_,c,h,y)=>f.extend(nh(_,c,h),{u_world:y}),xy=f.create(),In=(_,c,h,y,x,C)=>{const S=_.transform,M="globe"===S.projection.name;let k;if("map"===C.paint.get("circle-pitch-alignment"))if(M){const N=f.globePixelsToTileUnits(S.zoom,c.canonical)*S._pixelsPerMercatorPixel;k=Float32Array.from([N,0,0,N])}else k=S.calculatePixelsToTileUnitsMatrix(h);else k=new Float32Array([S.pixelsToGLUnits[0],0,0,S.pixelsToGLUnits[1]]);const L={u_camera_to_center_distance:S.cameraToCenterDistance,u_matrix:_.translatePosMatrix(c.projMatrix,h,C.paint.get("circle-translate"),C.paint.get("circle-translate-anchor")),u_device_pixel_ratio:f.exported.devicePixelRatio,u_extrude_scale:k,u_inv_rot_matrix:xy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){L.u_inv_rot_matrix=y,L.u_merc_center=x,L.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],L.u_zoom_transition=f.globeToMercatorTransition(S.zoom);const N=x[0]*f.EXTENT,V=x[1]*f.EXTENT;L.u_up_dir=S.projection.upVector(new f.CanonicalTileID(0,0,0),N,V)}return L},Np=_=>{const c=[];return"map"===_.paint.get("circle-pitch-alignment")&&c.push("PITCH_WITH_MAP"),"map"===_.paint.get("circle-pitch-scale")&&c.push("SCALE_WITH_MAP"),c},Lp=(_,c,h,y)=>{const x=f.EXTENT/h.tileSize;return{u_matrix:_,u_camera_to_center_distance:c.getCameraToCenterDistance(y),u_extrude_scale:[c.pixelsToGLUnits[0]/x,c.pixelsToGLUnits[1]/x]}},ih=(_,c,h=1)=>({u_matrix:_,u_color:c,u_overlay:0,u_overlay_scale:h}),Qt=f.create(),Zm=(_,c,h,y,x,C,S)=>{const M=_.transform,k="globe"===M.projection.name,L=k?f.globePixelsToTileUnits(M.zoom,c.canonical)*M._pixelsPerMercatorPixel:vr(h,1,C),N={u_matrix:c.projMatrix,u_extrude_scale:L,u_intensity:S,u_inv_rot_matrix:Qt,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){N.u_inv_rot_matrix=y,N.u_merc_center=x,N.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],N.u_zoom_transition=f.globeToMercatorTransition(M.zoom);const V=x[0]*f.EXTENT,K=x[1]*f.EXTENT;N.u_up_dir=M.projection.upVector(new f.CanonicalTileID(0,0,0),V,K)}return N},Ym=(_,c,h,y,x,C,S)=>{const M=_.transform,k=M.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:zn(_,c,h,y),u_pixels_to_tile_units:k,u_device_pixel_ratio:C,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:qi(h)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:tr(c,_.transform),u_alpha_discard_threshold:0,u_trim_offset:S}},gt=(_,c,h,y,x)=>{const C=_.transform;return{u_matrix:zn(_,c,h,y),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:tr(c,C),u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function tr(_,c){return 1/vr(_,1,c.tileZoom)}function zn(_,c,h,y){return _.translatePosMatrix(y||c.tileID.projMatrix,c,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function qi(_){const c=_.paint.get("line-dasharray").value;return c.value||"constant"!==c.kind}const Mr=(_,c,h,y,x,C)=>{return{u_matrix:_,u_tl_parent:c,u_scale_parent:h,u_fade_t:y.mix,u_opacity:y.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(M=x.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(S=x.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:lo(x.paint.get("raster-hue-rotate")),u_perspective_transform:C};var S,M};function lo(_){_*=Math.PI/180;const c=Math.sin(_),h=Math.cos(_);return[(2*h+1)/3,(-Math.sqrt(3)*c-h+1)/3,(Math.sqrt(3)*c-h+1)/3]}const Gr=f.create(),rh=(_,c,h,y,x,C,S,M,k,L,N,V,K,te,re,ie)=>{const se=x.transform,U={u_is_size_zoom_constant:+("constant"===_||"source"===_),u_is_size_feature_constant:+("constant"===_||"camera"===_),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:se.width/se.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:S,u_coord_matrix:M,u_is_text:+k,u_pitch_with_map:+y,u_texsize:L,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gr,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Gr,u_up_vector:[0,-1,0]};return"globe"===ie.name&&(U.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],U.u_zoom_transition=V,U.u_inv_rot_matrix=te,U.u_merc_center=K,U.u_camera_forward=se._camera.forward(),U.u_ecef_origin=f.globeECEFOrigin(se.globeMatrix,N.toUnwrapped()),U.u_tile_matrix=Float32Array.from(se.globeMatrix),U.u_up_vector=re),U},$d=(_,c,h,y,x,C,S,M,k,L,N,V,K,te,re,ie,se)=>f.extend(rh(_,c,h,y,x,C,S,M,k,L,V,K,te,re,ie,se),{u_gamma_scale:y?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:f.exported.devicePixelRatio,u_is_halo:+N}),Hd=(_,c,h,y,x,C,S,M,k,L,N,V,K,te,re,ie)=>f.extend($d(_,c,h,y,x,C,S,M,!0,k,!0,N,V,K,te,re,ie),{u_texsize_icon:L,u_texture_icon:1}),Bp=(_,c,h)=>({u_matrix:_,u_opacity:c,u_color:h}),wy=(_,c,h,y,x)=>f.extend(function(C,S,M){const k=S.imageManager.getPattern(C.toString()),{width:L,height:N}=S.imageManager.getPixelSize(),V=Math.pow(2,M.tileID.overscaledZ),K=M.tileSize*Math.pow(2,S.transform.tileZoom)/V,te=K*(M.tileID.canonical.x+M.tileID.wrap*V),re=K*M.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[L,N],u_pattern_size:k.displaySize,u_tile_units_to_pixels:1/vr(M,1,S.transform.tileZoom),u_pixel_coord_upper:[te>>16,re>>16],u_pixel_coord_lower:[65535&te,65535&re]}}(y,h,x),{u_matrix:_,u_opacity:c}),Ni={fillExtrusion:_=>({u_matrix:new f.UniformMatrix4f(_),u_lightpos:new f.Uniform3f(_),u_lightintensity:new f.Uniform1f(_),u_lightcolor:new f.Uniform3f(_),u_vertical_gradient:new f.Uniform1f(_),u_opacity:new f.Uniform1f(_),u_edge_radius:new f.Uniform1f(_),u_ao:new f.Uniform2f(_),u_tile_id:new f.Uniform3f(_),u_zoom_transition:new f.Uniform1f(_),u_inv_rot_matrix:new f.UniformMatrix4f(_),u_merc_center:new f.Uniform2f(_),u_up_dir:new f.Uniform3f(_),u_height_lift:new f.Uniform1f(_)}),fillExtrusionPattern:_=>({u_matrix:new f.UniformMatrix4f(_),u_lightpos:new f.Uniform3f(_),u_lightintensity:new f.Uniform1f(_),u_lightcolor:new f.Uniform3f(_),u_vertical_gradient:new f.Uniform1f(_),u_height_factor:new f.Uniform1f(_),u_edge_radius:new f.Uniform1f(_),u_ao:new f.Uniform2f(_),u_tile_id:new f.Uniform3f(_),u_zoom_transition:new f.Uniform1f(_),u_inv_rot_matrix:new f.UniformMatrix4f(_),u_merc_center:new f.Uniform2f(_),u_up_dir:new f.Uniform3f(_),u_height_lift:new f.Uniform1f(_),u_image:new f.Uniform1i(_),u_texsize:new f.Uniform2f(_),u_pixel_coord_upper:new f.Uniform2f(_),u_pixel_coord_lower:new f.Uniform2f(_),u_tile_units_to_pixels:new f.Uniform1f(_),u_opacity:new f.Uniform1f(_)}),fill:_=>({u_matrix:new f.UniformMatrix4f(_)}),fillPattern:_=>({u_matrix:new f.UniformMatrix4f(_),u_image:new f.Uniform1i(_),u_texsize:new f.Uniform2f(_),u_pixel_coord_upper:new f.Uniform2f(_),u_pixel_coord_lower:new f.Uniform2f(_),u_tile_units_to_pixels:new f.Uniform1f(_)}),fillOutline:_=>({u_matrix:new f.UniformMatrix4f(_),u_world:new f.Uniform2f(_)}),fillOutlinePattern:_=>({u_matrix:new f.UniformMatrix4f(_),u_world:new f.Uniform2f(_),u_image:new f.Uniform1i(_),u_texsize:new f.Uniform2f(_),u_pixel_coord_upper:new f.Uniform2f(_),u_pixel_coord_lower:new f.Uniform2f(_),u_tile_units_to_pixels:new f.Uniform1f(_)}),circle:_=>({u_camera_to_center_distance:new f.Uniform1f(_),u_extrude_scale:new f.UniformMatrix2f(_),u_device_pixel_ratio:new f.Uniform1f(_),u_matrix:new f.UniformMatrix4f(_),u_inv_rot_matrix:new f.UniformMatrix4f(_),u_merc_center:new f.Uniform2f(_),u_tile_id:new f.Uniform3f(_),u_zoom_transition:new f.Uniform1f(_),u_up_dir:new f.Uniform3f(_)}),collisionBox:_=>({u_matrix:new f.UniformMatrix4f(_),u_camera_to_center_distance:new f.Uniform1f(_),u_extrude_scale:new f.Uniform2f(_)}),collisionCircle:_=>({u_matrix:new f.UniformMatrix4f(_),u_inv_matrix:new f.UniformMatrix4f(_),u_camera_to_center_distance:new f.Uniform1f(_),u_viewport_size:new f.Uniform2f(_)}),debug:_=>({u_color:new f.UniformColor(_),u_matrix:new f.UniformMatrix4f(_),u_overlay:new f.Uniform1i(_),u_overlay_scale:new f.Uniform1f(_)}),clippingMask:_=>({u_matrix:new f.UniformMatrix4f(_)}),heatmap:_=>({u_extrude_scale:new f.Uniform1f(_),u_intensity:new f.Uniform1f(_),u_matrix:new f.UniformMatrix4f(_),u_inv_rot_matrix:new f.UniformMatrix4f(_),u_merc_center:new f.Uniform2f(_),u_tile_id:new f.Uniform3f(_),u_zoom_transition:new f.Uniform1f(_),u_up_dir:new f.Uniform3f(_)}),heatmapTexture:_=>({u_image:new f.Uniform1i(_),u_color_ramp:new f.Uniform1i(_),u_opacity:new f.Uniform1f(_)}),hillshade:_=>({u_matrix:new f.UniformMatrix4f(_),u_image:new f.Uniform1i(_),u_latrange:new f.Uniform2f(_),u_light:new f.Uniform2f(_),u_shadow:new f.UniformColor(_),u_highlight:new f.UniformColor(_),u_accent:new f.UniformColor(_)}),hillshadePrepare:_=>({u_matrix:new f.UniformMatrix4f(_),u_image:new f.Uniform1i(_),u_dimension:new f.Uniform2f(_),u_zoom:new f.Uniform1f(_),u_unpack:new f.Uniform4f(_)}),line:_=>({u_matrix:new f.UniformMatrix4f(_),u_pixels_to_tile_units:new f.UniformMatrix2f(_),u_device_pixel_ratio:new f.Uniform1f(_),u_units_to_pixels:new f.Uniform2f(_),u_dash_image:new f.Uniform1i(_),u_gradient_image:new f.Uniform1i(_),u_image_height:new f.Uniform1f(_),u_texsize:new f.Uniform2f(_),u_tile_units_to_pixels:new f.Uniform1f(_),u_alpha_discard_threshold:new f.Uniform1f(_),u_trim_offset:new f.Uniform2f(_)}),linePattern:_=>({u_matrix:new f.UniformMatrix4f(_),u_texsize:new f.Uniform2f(_),u_pixels_to_tile_units:new f.UniformMatrix2f(_),u_device_pixel_ratio:new f.Uniform1f(_),u_image:new f.Uniform1i(_),u_units_to_pixels:new f.Uniform2f(_),u_tile_units_to_pixels:new f.Uniform1f(_),u_alpha_discard_threshold:new f.Uniform1f(_)}),raster:_=>({u_matrix:new f.UniformMatrix4f(_),u_tl_parent:new f.Uniform2f(_),u_scale_parent:new f.Uniform1f(_),u_fade_t:new f.Uniform1f(_),u_opacity:new f.Uniform1f(_),u_image0:new f.Uniform1i(_),u_image1:new f.Uniform1i(_),u_brightness_low:new f.Uniform1f(_),u_brightness_high:new f.Uniform1f(_),u_saturation_factor:new f.Uniform1f(_),u_contrast_factor:new f.Uniform1f(_),u_spin_weights:new f.Uniform3f(_),u_perspective_transform:new f.Uniform2f(_)}),symbolIcon:_=>({u_is_size_zoom_constant:new f.Uniform1i(_),u_is_size_feature_constant:new f.Uniform1i(_),u_size_t:new f.Uniform1f(_),u_size:new f.Uniform1f(_),u_camera_to_center_distance:new f.Uniform1f(_),u_rotate_symbol:new f.Uniform1i(_),u_aspect_ratio:new f.Uniform1f(_),u_fade_change:new f.Uniform1f(_),u_matrix:new f.UniformMatrix4f(_),u_label_plane_matrix:new f.UniformMatrix4f(_),u_coord_matrix:new f.UniformMatrix4f(_),u_is_text:new f.Uniform1i(_),u_pitch_with_map:new f.Uniform1i(_),u_texsize:new f.Uniform2f(_),u_tile_id:new f.Uniform3f(_),u_zoom_transition:new f.Uniform1f(_),u_inv_rot_matrix:new f.UniformMatrix4f(_),u_merc_center:new f.Uniform2f(_),u_camera_forward:new f.Uniform3f(_),u_tile_matrix:new f.UniformMatrix4f(_),u_up_vector:new f.Uniform3f(_),u_ecef_origin:new f.Uniform3f(_),u_texture:new f.Uniform1i(_)}),symbolSDF:_=>({u_is_size_zoom_constant:new f.Uniform1i(_),u_is_size_feature_constant:new f.Uniform1i(_),u_size_t:new f.Uniform1f(_),u_size:new f.Uniform1f(_),u_camera_to_center_distance:new f.Uniform1f(_),u_rotate_symbol:new f.Uniform1i(_),u_aspect_ratio:new f.Uniform1f(_),u_fade_change:new f.Uniform1f(_),u_matrix:new f.UniformMatrix4f(_),u_label_plane_matrix:new f.UniformMatrix4f(_),u_coord_matrix:new f.UniformMatrix4f(_),u_is_text:new f.Uniform1i(_),u_pitch_with_map:new f.Uniform1i(_),u_texsize:new f.Uniform2f(_),u_texture:new f.Uniform1i(_),u_gamma_scale:new f.Uniform1f(_),u_device_pixel_ratio:new f.Uniform1f(_),u_tile_id:new f.Uniform3f(_),u_zoom_transition:new f.Uniform1f(_),u_inv_rot_matrix:new f.UniformMatrix4f(_),u_merc_center:new f.Uniform2f(_),u_camera_forward:new f.Uniform3f(_),u_tile_matrix:new f.UniformMatrix4f(_),u_up_vector:new f.Uniform3f(_),u_ecef_origin:new f.Uniform3f(_),u_is_halo:new f.Uniform1i(_)}),symbolTextAndIcon:_=>({u_is_size_zoom_constant:new f.Uniform1i(_),u_is_size_feature_constant:new f.Uniform1i(_),u_size_t:new f.Uniform1f(_),u_size:new f.Uniform1f(_),u_camera_to_center_distance:new f.Uniform1f(_),u_rotate_symbol:new f.Uniform1i(_),u_aspect_ratio:new f.Uniform1f(_),u_fade_change:new f.Uniform1f(_),u_matrix:new f.UniformMatrix4f(_),u_label_plane_matrix:new f.UniformMatrix4f(_),u_coord_matrix:new f.UniformMatrix4f(_),u_is_text:new f.Uniform1i(_),u_pitch_with_map:new f.Uniform1i(_),u_texsize:new f.Uniform2f(_),u_texsize_icon:new f.Uniform2f(_),u_texture:new f.Uniform1i(_),u_texture_icon:new f.Uniform1i(_),u_gamma_scale:new f.Uniform1f(_),u_device_pixel_ratio:new f.Uniform1f(_),u_is_halo:new f.Uniform1i(_)}),background:_=>({u_matrix:new f.UniformMatrix4f(_),u_opacity:new f.Uniform1f(_),u_color:new f.UniformColor(_)}),backgroundPattern:_=>({u_matrix:new f.UniformMatrix4f(_),u_opacity:new f.Uniform1f(_),u_image:new f.Uniform1i(_),u_pattern_tl:new f.Uniform2f(_),u_pattern_br:new f.Uniform2f(_),u_texsize:new f.Uniform2f(_),u_pattern_size:new f.Uniform2f(_),u_pixel_coord_upper:new f.Uniform2f(_),u_pixel_coord_lower:new f.Uniform2f(_),u_tile_units_to_pixels:new f.Uniform1f(_)}),terrainRaster:ic,terrainDepth:ic,skybox:_=>({u_matrix:new f.UniformMatrix4f(_),u_sun_direction:new f.Uniform3f(_),u_cubemap:new f.Uniform1i(_),u_opacity:new f.Uniform1f(_),u_temporal_offset:new f.Uniform1f(_)}),skyboxGradient:_=>({u_matrix:new f.UniformMatrix4f(_),u_color_ramp:new f.Uniform1i(_),u_center_direction:new f.Uniform3f(_),u_radius:new f.Uniform1f(_),u_opacity:new f.Uniform1f(_),u_temporal_offset:new f.Uniform1f(_)}),skyboxCapture:_=>({u_matrix_3f:new f.UniformMatrix3f(_),u_sun_direction:new f.Uniform3f(_),u_sun_intensity:new f.Uniform1f(_),u_color_tint_r:new f.Uniform4f(_),u_color_tint_m:new f.Uniform4f(_),u_luminance:new f.Uniform1f(_)}),globeRaster:_=>({u_proj_matrix:new f.UniformMatrix4f(_),u_globe_matrix:new f.UniformMatrix4f(_),u_normalize_matrix:new f.UniformMatrix4f(_),u_merc_matrix:new f.UniformMatrix4f(_),u_zoom_transition:new f.Uniform1f(_),u_merc_center:new f.Uniform2f(_),u_image0:new f.Uniform1i(_),u_grid_matrix:new f.UniformMatrix3f(_),u_skirt_height:new f.Uniform1f(_),u_frustum_tl:new f.Uniform3f(_),u_frustum_tr:new f.Uniform3f(_),u_frustum_br:new f.Uniform3f(_),u_frustum_bl:new f.Uniform3f(_),u_globe_pos:new f.Uniform3f(_),u_globe_radius:new f.Uniform1f(_),u_viewport:new f.Uniform2f(_)}),globeAtmosphere:_=>({u_frustum_tl:new f.Uniform3f(_),u_frustum_tr:new f.Uniform3f(_),u_frustum_br:new f.Uniform3f(_),u_frustum_bl:new f.Uniform3f(_),u_horizon:new f.Uniform1f(_),u_transition:new f.Uniform1f(_),u_fadeout_range:new f.Uniform1f(_),u_color:new f.Uniform4f(_),u_high_color:new f.Uniform4f(_),u_space_color:new f.Uniform4f(_),u_star_intensity:new f.Uniform1f(_),u_star_density:new f.Uniform1f(_),u_star_size:new f.Uniform1f(_),u_temporal_offset:new f.Uniform1f(_),u_horizon_angle:new f.Uniform1f(_),u_rotation_matrix:new f.UniformMatrix4f(_)})};let It;function an(_,c,h,y,x,C,S){const M=_.context,k=M.gl,L=_.transform,N=_.useProgram("collisionBox"),V=[];let K=0,te=0;for(let he=0;he<y.length;he++){const Ce=y[he],Se=c.getTile(Ce),Ee=Se.getBucket(h);if(!Ee)continue;const ce=vo(Ce,Ee,L);let De=ce;0===x[0]&&0===x[1]||(De=_.translatePosMatrix(ce,Se,x,C));const _e=S?Ee.textCollisionBox:Ee.iconCollisionBox,Ie=Ee.collisionCircleArray;if(Ie.length>0){const Pe=f.create(),Ke=De;f.mul(Pe,Ee.placementInvProjMatrix,L.glCoordMatrix),f.mul(Pe,Pe,Ee.placementViewportMatrix),V.push({circleArray:Ie,circleOffset:te,transform:Ke,invTransform:Pe,projection:Ee.getProjection()}),K+=Ie.length/4,te=K}_e&&(_.terrain&&_.terrain.setupElevationDraw(Se,N),N.draw(M,k.LINES,f.DepthMode.disabled,f.StencilMode.disabled,_.colorModeForRenderPass(),f.CullFaceMode.disabled,Lp(De,L,Se,Ee.getProjection()),h.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,null,L.zoom,null,[_e.collisionVertexBuffer,_e.collisionVertexBufferExt]))}if(!S||!V.length)return;const re=_.useProgram("collisionCircle"),ie=new f.StructArrayLayout2f1f2i16;ie.resize(4*K),ie._trim();let se=0;for(const he of V)for(let Ce=0;Ce<he.circleArray.length/4;Ce++){const Se=4*Ce,Ee=he.circleArray[Se+0],ce=he.circleArray[Se+1],De=he.circleArray[Se+2],_e=he.circleArray[Se+3];ie.emplace(se++,Ee,ce,De,_e,0),ie.emplace(se++,Ee,ce,De,_e,1),ie.emplace(se++,Ee,ce,De,_e,2),ie.emplace(se++,Ee,ce,De,_e,3)}(!It||It.length<2*K)&&(It=function(he){const Ce=2*he,Se=new f.StructArrayLayout3ui6;Se.resize(Ce),Se._trim();for(let Ee=0;Ee<Ce;Ee++){const ce=6*Ee;Se.uint16[ce+0]=4*Ee+0,Se.uint16[ce+1]=4*Ee+1,Se.uint16[ce+2]=4*Ee+2,Se.uint16[ce+3]=4*Ee+2,Se.uint16[ce+4]=4*Ee+3,Se.uint16[ce+5]=4*Ee+0}return Se}(K));const U=M.createIndexBuffer(It,!0),J=M.createVertexBuffer(ie,f.collisionCircleLayout.members,!0);for(const he of V){const Ce={u_matrix:he.transform,u_inv_matrix:he.invTransform,u_camera_to_center_distance:(de=L).getCameraToCenterDistance(he.projection),u_viewport_size:[de.width,de.height]};re.draw(M,k.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,_.colorModeForRenderPass(),f.CullFaceMode.disabled,Ce,h.id,J,U,f.SegmentVector.simpleSegment(0,2*he.circleOffset,he.circleArray.length,he.circleArray.length/2),null,L.zoom)}var de;J.destroy(),U.destroy()}const Ti=f.create();function Vo({width:_,height:c,anchor:h,textOffset:y,textScale:x},C){const{horizontalAlign:S,verticalAlign:M}=f.getAnchorAlignment(h),k=-(S-.5)*_,L=-(M-.5)*c,N=f.evaluateVariableOffset(h,y);return new f.Point((k/x+N[0])*C,(L/x+N[1])*C)}function Gd(_,c,h,y,x,C,S,M,k,L,N){const V=_.text.placedSymbolArray,K=_.text.dynamicLayoutVertexArray,te=_.icon.dynamicLayoutVertexArray,re={},ie=_.getProjection(),se=_i(M,ie,C),U=C.elevation,J=ie.upVectorScale(M.canonical,C.center.lat,C.worldSize).metersToTile;K.clear();for(let de=0;de<V.length;de++){const he=V.get(de),{tileAnchorX:Ce,tileAnchorY:Se,numGlyphs:Ee}=he,ce=he.hidden||!he.crossTileID||_.allowVerticalPlacement&&!he.placedOrientation?null:y[he.crossTileID];if(ce){let De=0,_e=0,Ie=0;if(U){const dt=U?U.getAtTileOffset(M,Ce,Se):0,[Tt,Ht,Mt]=ie.upVector(M.canonical,Ce,Se);De=dt*Tt*J,_e=dt*Ht*J,Ie=dt*Mt*J}let[Pe,Ke,Ve,et]=Sr(he.projectedAnchorX+De,he.projectedAnchorY+_e,he.projectedAnchorZ+Ie,h?se:S);const Be=No(C.getCameraToCenterDistance(ie),et);let Ye=x.evaluateSizeForFeature(_.textSizeData,L,he)*Be/f.ONE_EM;h&&(Ye*=_.tilePixelRatio/k);const ct=Vo(ce,Ye);h?(({x:Pe,y:Ke,z:Ve}=ie.projectTilePoint(Ce+ct.x,Se+ct.y,M.canonical)),[Pe,Ke,Ve]=Sr(Pe+De,Ke+_e,Ve+Ie,S)):(c&&ct._rotate(-C.angle),Pe+=ct.x,Ke+=ct.y,Ve=0);const tt=_.allowVerticalPlacement&&he.placedOrientation===f.WritingMode.vertical?Math.PI/2:0;for(let dt=0;dt<Ee;dt++)f.addDynamicAttributes(K,Pe,Ke,Ve,tt);N&&he.associatedIconIndex>=0&&(re[he.associatedIconIndex]={x:Pe,y:Ke,z:Ve,angle:tt})}else vs(Ee,K)}if(N){te.clear();const de=_.icon.placedSymbolArray;for(let he=0;he<de.length;he++){const Ce=de.get(he),{numGlyphs:Se}=Ce,Ee=re[he];if(Ce.hidden||!Ee)vs(Se,te);else{const{x:ce,y:De,z:_e,angle:Ie}=Ee;for(let Pe=0;Pe<Se;Pe++)f.addDynamicAttributes(te,ce,De,_e,Ie)}}_.icon.dynamicLayoutVertexBuffer.updateData(te)}_.text.dynamicLayoutVertexBuffer.updateData(K)}function wr(_,c,h){return h.iconsInText&&c?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function sc(_,c,h,y,x,C,S,M,k,L,N,V){const K=_.context,te=K.gl,re=_.transform,ie="map"===M,se="map"===k,U=ie&&"point"!==h.layout.get("symbol-placement"),J=ie&&!se&&!U,de=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let he=!1;const Ce=_.depthModeForSublayer(0,f.DepthMode.ReadOnly),Se=[f.mercatorXfromLng(re.center.lng),f.mercatorYfromLat(re.center.lat)],Ee=h.layout.get("text-variable-anchor"),ce="globe"===re.projection.name,De=[],_e=[0,-1,0];let Ie=_e;!ce&&!re.mercatorFromTransition||ie||(Ie=function(Pe){const Ke=Pe._camera.getWorldToCamera(Pe.worldSize,1),Ve=f.multiply([],Ke,Pe.globeMatrix);f.invert(Ve,Ve);const et=[0,0,0],Be=[0,1,0,0];return f.transformMat4$1(Be,Be,Ve),et[0]=Be[0],et[1]=Be[1],et[2]=Be[2],f.normalize(et,et),et}(re));for(const Pe of y){const Ke=c.getTile(Pe),Ve=Ke.getBucket(h);if(!Ve||"mercator"===Ve.projection.name&&ce)continue;const et=x?Ve.text:Ve.icon;if(!et||Ve.fullyClipped||!et.segments.get().length)continue;const Be=et.programConfigurations.get(h.id),Ye=x||Ve.sdfIcons,ct=x?Ve.textSizeData:Ve.iconSizeData,tt=se||0!==re.pitch,dt=f.evaluateSizeForZoom(ct,re.zoom);let Tt,Ht,Mt,Lt,Jt=[0,0],wn=null;if(x)Ht=Ke.glyphAtlasTexture,Mt=te.LINEAR,Tt=Ke.glyphAtlasTexture.size,Ve.iconsInText&&(Jt=Ke.imageAtlasTexture.size,wn=Ke.imageAtlasTexture,Lt=tt||_.options.rotating||_.options.zooming||"composite"===ct.kind||"camera"===ct.kind?te.LINEAR:te.NEAREST);else{const Jn=1!==h.layout.get("icon-size").constantOr(0)||Ve.iconsNeedLinear;Ht=Ke.imageAtlasTexture,Mt=Ye||_.options.rotating||_.options.zooming||Jn||tt?te.LINEAR:te.NEAREST,Tt=Ke.imageAtlasTexture.size}const Ot="globe"===Ve.projection.name,Wn=Ot?Ie:_e,ni=Ot?f.globeToMercatorTransition(re.zoom):0,Yn=_i(Pe,Ve.getProjection(),re),Xn=re.calculatePixelsToTileUnitsMatrix(Ke),kr=We(Yn,Ke.tileID.canonical,se,ie,re,Ve.getProjection(),Xn),nr=_.terrain&&se&&U?f.invert(f.create(),kr):Ti,os=Gi(Yn,Ke.tileID.canonical,se,ie,re,Ve.getProjection(),Xn),Ts=Ee&&Ve.hasTextData(),fi="none"!==h.layout.get("icon-text-fit")&&Ts&&Ve.hasIconData();if(U){const Jn=re.elevation,ka=Jn?Jn.getAtTileOffsetFunc(Pe,re.center.lat,re.worldSize,Ve.getProjection()):null,pc=ol(Yn,Ke.tileID.canonical,se,ie,re,Ve.getProjection(),Xn);Um(Ve,Yn,_,x,pc,os,se,L,ka,Pe)}const Qn=U||x&&Ee||fi,Vn=_.translatePosMatrix(Yn,Ke,C,S),zi=Qn?Ti:kr,Wr=_.translatePosMatrix(os,Ke,C,S,!0),ai=Ve.getProjection().createInversionMatrix(re,Pe.canonical),Co=[];_.terrainRenderModeElevated()&&se&&Co.push("PITCH_WITH_MAP_TERRAIN"),Ot&&Co.push("PROJECTION_GLOBE_VIEW"),Qn&&Co.push("PROJECTED_POS_ON_VIEWPORT");const yh=Ye&&0!==h.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let Yi;Yi=Ye?Ve.iconsInText?Hd(ct.kind,dt,J,se,_,Vn,zi,Wr,Tt,Jt,Pe,ni,Se,ai,Wn,Ve.getProjection()):$d(ct.kind,dt,J,se,_,Vn,zi,Wr,x,Tt,!0,Pe,ni,Se,ai,Wn,Ve.getProjection()):rh(ct.kind,dt,J,se,_,Vn,zi,Wr,x,Tt,Pe,ni,Se,ai,Wn,Ve.getProjection());const Ss={program:_.useProgram(wr(Ye,x,Ve),Be,Co),buffers:et,uniformValues:Yi,atlasTexture:Ht,atlasTextureIcon:wn,atlasInterpolation:Mt,atlasInterpolationIcon:Lt,isSDF:Ye,hasHalo:yh,tile:Ke,labelPlaneMatrixInv:nr};if(de&&Ve.canOverlap){he=!0;const Jn=et.segments.get();for(const ka of Jn)De.push({segments:new f.SegmentVector([ka]),sortKey:ka.sortKey,state:Ss})}else De.push({segments:et.segments,sortKey:0,state:Ss})}he&&De.sort((Pe,Ke)=>Pe.sortKey-Ke.sortKey);for(const Pe of De){const Ke=Pe.state;if(_.terrain&&_.terrain.setupElevationDraw(Ke.tile,Ke.program,{useDepthForOcclusion:!ce,labelPlaneMatrixInv:Ke.labelPlaneMatrixInv}),K.activeTexture.set(te.TEXTURE0),Ke.atlasTexture.bind(Ke.atlasInterpolation,te.CLAMP_TO_EDGE),Ke.atlasTextureIcon&&(K.activeTexture.set(te.TEXTURE1),Ke.atlasTextureIcon&&Ke.atlasTextureIcon.bind(Ke.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),Ke.isSDF){const Ve=Ke.uniformValues;Ke.hasHalo&&(Ve.u_is_halo=1,Si(Ke.buffers,Pe.segments,h,_,Ke.program,Ce,N,V,Ve)),Ve.u_is_halo=0}Si(Ke.buffers,Pe.segments,h,_,Ke.program,Ce,N,V,Ke.uniformValues)}}function Si(_,c,h,y,x,C,S,M,k){const L=y.context,N=[_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer,_.globeExtVertexBuffer];x.draw(L,L.gl.TRIANGLES,C,S,M,f.CullFaceMode.disabled,k,h.id,_.layoutVertexBuffer,_.indexBuffer,c,h.paint,y.transform.zoom,_.programConfigurations.get(h.id),N)}function Ma(_,c,h,y,x,C,S){const M=_.context.gl,k=h.paint.get("fill-pattern"),L=k&&k.constantOr(1);let N,V,K,te,re;S?(V=L&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=M.LINES):(V=L?"fillPattern":"fill",N=M.TRIANGLES);for(const ie of y){const se=c.getTile(ie);if(L&&!se.patternsLoaded())continue;const U=se.getBucket(h);if(!U)continue;_.prepareDrawTile();const J=U.programConfigurations.get(h.id),de=_.useProgram(V,J);L&&(_.context.activeTexture.set(M.TEXTURE0),se.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),J.updatePaintBuffers());const he=k.constantOr(null);if(he&&se.imageAtlas){const Se=se.imageAtlas.patternPositions[he.toString()];Se&&J.setConstantPatternPositions(Se)}const Ce=_.translatePosMatrix(ie.projMatrix,se,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(S){te=U.indexBuffer2,re=U.segments2;const Se=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];K="fillOutlinePattern"===V&&L?by(Ce,_,se,Se):vy(Ce,Se)}else te=U.indexBuffer,re=U.segments,K=L?nh(Ce,_,se):oc(Ce);_.prepareDrawProgram(_.context,de,ie.toUnwrapped()),de.draw(_.context,N,x,_.stencilModeForClipping(ie),C,f.CullFaceMode.disabled,K,h.id,U.layoutVertexBuffer,te,re,h.paint,_.transform.zoom,J)}}function Aa(_,c,h,y,x,C,S){const M=_.context,k=M.gl,L=_.transform,N=h.paint.get("fill-extrusion-pattern"),V=N.constantOr(1),K=h.paint.get("fill-extrusion-opacity"),te=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],re=h.layout.get("fill-extrusion-edge-radius"),ie=re>0&&!h.paint.get("fill-extrusion-rounded-roof"),se=ie?0:re,U="globe"===L.projection.name?f.fillExtrusionHeightLift():0,J="globe"===L.projection.name,de=J?f.globeToMercatorTransition(L.zoom):0,he=[f.mercatorXfromLng(L.center.lng),f.mercatorYfromLat(L.center.lat)],Ce=[];J&&Ce.push("PROJECTION_GLOBE_VIEW"),te[0]>0&&Ce.push("FAUX_AO"),ie&&Ce.push("ZERO_ROOF_RADIUS");for(const Se of y){const Ee=c.getTile(Se),ce=Ee.getBucket(h);if(!ce||ce.projection.name!==L.projection.name)continue;const De=ce.programConfigurations.get(h.id),_e=_.useProgram(V?"fillExtrusionPattern":"fillExtrusion",De,Ce);if(_.terrain){const Ye=_.terrain;if(_.style.terrainSetForDrapingOnly())Ye.setupElevationDraw(Ee,_e,{useMeterToDem:!0});else{if(!ce.enableTerrain)continue;if(Ye.setupElevationDraw(Ee,_e,{useMeterToDem:!0}),fn(M,c,Se,ce,h,Ye),!ce.centroidVertexBuffer){const ct=_e.attributes.a_centroid_pos;void 0!==ct&&k.vertexAttrib2f(ct,0,0)}}}V&&(_.context.activeTexture.set(k.TEXTURE0),Ee.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),De.updatePaintBuffers());const Ie=N.constantOr(null);if(Ie&&Ee.imageAtlas){const Ye=Ee.imageAtlas.patternPositions[Ie.toString()];Ye&&De.setConstantPatternPositions(Ye)}const Pe=_.translatePosMatrix(Se.projMatrix,Ee,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ke=L.projection.createInversionMatrix(L,Se.canonical),Ve=h.paint.get("fill-extrusion-vertical-gradient"),et=V?Wm(Pe,_,Ve,K,te,se,Se,Ee,U,de,he,Ke):Fp(Pe,_,Ve,K,te,se,Se,U,de,he,Ke);_.prepareDrawProgram(M,_e,Se.toUnwrapped());const Be=[];_.terrain&&Be.push(ce.centroidVertexBuffer),J&&Be.push(ce.layoutVertexExtBuffer),_e.draw(M,M.gl.TRIANGLES,x,C,S,f.CullFaceMode.backCCW,et,h.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,h.paint,_.transform.zoom,De,Be)}}function fn(_,c,h,y,x,C){const S=[U=>{let J=U.canonical.x-1,de=U.wrap;return J<0&&(J=(1<<U.canonical.z)-1,de--),new f.OverscaledTileID(U.overscaledZ,de,U.canonical.z,J,U.canonical.y)},U=>{let J=U.canonical.x+1,de=U.wrap;return J===1<<U.canonical.z&&(J=0,de++),new f.OverscaledTileID(U.overscaledZ,de,U.canonical.z,J,U.canonical.y)},U=>new f.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,(0===U.canonical.y?1<<U.canonical.z:U.canonical.y)-1),U=>new f.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y===(1<<U.canonical.z)-1?0:U.canonical.y+1)],M=U=>{const J=c.getSource().minzoom,de=Ce=>{const Se=c.getTileByID(Ce);if(Se&&Se.hasData())return Se.getBucket(x)},he=[0,-1,1];for(const Ce of he){if(U.overscaledZ+Ce<J)continue;const Se=de(U.calculateScaledKey(U.overscaledZ+Ce));if(Se)return Se}},k=[0,0,0],L=(U,J)=>(k[0]=Math.min(U.min.y,J.min.y),k[1]=Math.max(U.max.y,J.max.y),k[2]=f.EXTENT-J.min.x>U.max.x?J.min.x-f.EXTENT:U.max.x,k),N=(U,J)=>(k[0]=Math.min(U.min.x,J.min.x),k[1]=Math.max(U.max.x,J.max.x),k[2]=f.EXTENT-J.min.y>U.max.y?J.min.y-f.EXTENT:U.max.y,k),V=[(U,J)=>L(U,J),(U,J)=>L(J,U),(U,J)=>N(U,J),(U,J)=>N(J,U)],K=new f.Point(0,0);let te,re,ie;const se=(U,J,de,he,Ce)=>{const Se=[[he?de:U,he?U:de,0],[he?de:J,he?J:de,0]],Ee=Ce<0?f.EXTENT+Ce:Ce,ce=[he?Ee:(U+J)/2,he?(U+J)/2:Ee,0];return 0===de&&Ce<0||0!==de&&Ce>0?C.getForTilePoints(ie,[ce],!0,re):Se.push(ce),C.getForTilePoints(h,Se,!0,te),Math.max(Se[0][2],Se[1][2],ce[2])/C.exaggeration()};for(let U=0;U<4;U++){const J=(U<2?1:5)-U,de=y.borders[U];if(0===de.length)continue;const he=ie=S[U](h),Ce=M(he);if(!(Ce&&Ce instanceof f.FillExtrusionBucket&&Ce.enableTerrain)||y.borderDoneWithNeighborZ[U]===Ce.canonical.z&&Ce.borderDoneWithNeighborZ[J]===y.canonical.z||(re=C.findDEMTileFor(he),!re||!re.dem))continue;if(!te){const De=C.findDEMTileFor(h);if(!De||!De.dem)return;te=De}const Se=Ce.borders[J];let Ee=0;const ce=Ce.borderDoneWithNeighborZ[J]!==y.canonical.z;if(y.canonical.z===Ce.canonical.z){for(let De=0;De<de.length;De++){const _e=y.featuresOnBorder[de[De]],Ie=_e.borders[U];let Pe;for(;Ee<Se.length&&(Pe=Ce.featuresOnBorder[Se[Ee]],!(Pe.borders[J][1]>Ie[0]+3));)ce&&Ce.encodeCentroid(void 0,Pe,!1),Ee++;if(Pe&&Ee<Se.length){const Ke=Ee;let Ve=0;for(;!(Pe.borders[J][0]>Ie[1]-3)&&(Ve++,++Ee!==Se.length);)Pe=Ce.featuresOnBorder[Se[Ee]];if(Pe=Ce.featuresOnBorder[Se[Ke]],_e.intersectsCount()>1||Pe.intersectsCount()>1||1!==Ve){1!==Ve&&(Ee=Ke),y.encodeCentroid(void 0,_e,!1),ce&&Ce.encodeCentroid(void 0,Pe,!1);continue}const et=V[U](_e,Pe),Be=U%2?f.EXTENT-1:0;K.x=se(et[0],Math.min(f.EXTENT-1,et[1]),Be,U<2,et[2]),K.y=0,y.encodeCentroid(K,_e,!1),ce&&Ce.encodeCentroid(K,Pe,!1)}else y.encodeCentroid(void 0,_e,!1)}y.borderDoneWithNeighborZ[U]=Ce.canonical.z,y.needsCentroidUpdate=!0,ce&&(Ce.borderDoneWithNeighborZ[J]=y.canonical.z,Ce.needsCentroidUpdate=!0)}else{for(const De of de)y.encodeCentroid(void 0,y.featuresOnBorder[De],!1);if(ce){for(const De of Se)Ce.encodeCentroid(void 0,Ce.featuresOnBorder[De],!1);Ce.borderDoneWithNeighborZ[J]=y.canonical.z,Ce.needsCentroidUpdate=!0}y.borderDoneWithNeighborZ[U]=Ce.canonical.z,y.needsCentroidUpdate=!0}}(y.needsCentroidUpdate||!y.centroidVertexBuffer&&0!==y.centroidVertexArray.length)&&y.uploadCentroid(_)}const Qs=new f.Color(1,0,0,1),Xm=new f.Color(0,1,0,1),id=new f.Color(0,0,1,1),Wi=new f.Color(1,0,1,1),qd=new f.Color(0,1,1,1);function rd(_,c,h){const y=_.context,x=_.transform,C=y.gl,S="globe"===x.projection.name,M=S?["PROJECTION_GLOBE_VIEW"]:null;let k=h.projMatrix;if(S&&f.globeToMercatorTransition(x.zoom)>0){const _e=f.transitionTileAABBinECEF(h.canonical,x),Ie=f.globeDenormalizeECEF(_e);k=f.multiply(new Float32Array(16),x.globeMatrix,Ie),f.multiply(k,x.projMatrix,k)}const L=_.useProgram("debug",null,M),N=c.getTileByID(h.key);_.terrain&&_.terrain.setupElevationDraw(N,L);const V=f.DepthMode.disabled,K=f.StencilMode.disabled,te=_.colorModeForRenderPass();y.activeTexture.set(C.TEXTURE0),_.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),S?N._makeGlobeTileDebugBuffers(_.context,x):N._makeDebugTileBoundsBuffers(_.context,x.projection);const ie=N._tileDebugBuffer||_.debugBuffer,se=N._tileDebugIndexBuffer||_.debugIndexBuffer,U=N._tileDebugSegments||_.debugSegments;L.draw(y,C.LINE_STRIP,V,K,te,f.CullFaceMode.disabled,ih(k,f.Color.red),"$debug",ie,se,U,null,null,null,[N._globeTileDebugBorderBuffer]);const J=N.latestRawTileData,de=Math.floor((J&&J.byteLength||0)/1024),he=c.getTile(h).tileSize,Ce=512/Math.min(he,512)*(h.overscaledZ/x.zoom)*.5;let Se=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Se+=` => ${h.overscaledZ}`),Se+=` ${de}kb`,function(_e,Ie){_e.initDebugOverlayCanvas();const Pe=_e.debugOverlayCanvas,Ke=_e.context.gl,Ve=_e.debugOverlayCanvas.getContext("2d");Ve.clearRect(0,0,Pe.width,Pe.height),Ve.shadowColor="white",Ve.shadowBlur=2,Ve.lineWidth=1.5,Ve.strokeStyle="white",Ve.textBaseline="top",Ve.font="bold 36px Open Sans, sans-serif",Ve.fillText(Ie,5,5),Ve.strokeText(Ie,5,5),_e.debugOverlayTexture.update(Pe),_e.debugOverlayTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}(_,Se);const Ee=N._tileDebugTextBuffer||_.debugBuffer,ce=N._tileDebugTextIndexBuffer||_.quadTriangleIndexBuffer,De=N._tileDebugTextSegments||_.debugSegments;L.draw(y,C.TRIANGLES,V,K,f.ColorMode.alphaBlended,f.CullFaceMode.disabled,ih(k,f.Color.transparent,Ce),"$debug",Ee,ce,De,null,null,null,[N._globeTileDebugTextBuffer])}function ws(_,c,h,y){ac(_,0,c+h/2,_.transform.width,h,y)}function fl(_,c,h,y){ac(_,c-h/2,0,h,_.transform.height,y)}function ac(_,c,h,y,x,C){const S=_.context,M=S.gl;M.enable(M.SCISSOR_TEST),M.scissor(c*f.exported.devicePixelRatio,h*f.exported.devicePixelRatio,y*f.exported.devicePixelRatio,x*f.exported.devicePixelRatio),S.clear({color:C}),M.disable(M.SCISSOR_TEST)}const Ia=f.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Js}=Ia;function es(_,c,h,y){_.emplaceBack(c,h,y)}class lc{constructor(c){this.vertexArray=new f.StructArrayLayout3f12,this.indices=new f.StructArrayLayout3ui6,es(this.vertexArray,-1,-1,1),es(this.vertexArray,1,-1,1),es(this.vertexArray,-1,1,1),es(this.vertexArray,1,1,1),es(this.vertexArray,-1,-1,-1),es(this.vertexArray,1,-1,-1),es(this.vertexArray,-1,1,-1),es(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Js),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=f.SegmentVector.simpleSegment(0,0,36,12)}}function ln(_,c,h,y,x,C){const S=_.gl,M=c.paint.get("sky-atmosphere-color"),k=c.paint.get("sky-atmosphere-halo-color"),L=c.paint.get("sky-atmosphere-sun-intensity"),N={u_matrix_3f:f.fromMat4(f.create$1(),y),u_sun_direction:x,u_sun_intensity:L,u_color_tint_r:[(re=M).r,re.g,re.b,re.a],u_color_tint_m:[(ie=k).r,ie.g,ie.b,ie.a],u_luminance:5e-5};var re,ie;S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+C,c.skyboxTexture,0),h.draw(_,S.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.frontCW,N,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const oh=f.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class sh{constructor(c){const h=new f.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const y=new f.StructArrayLayout3ui6;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(h,oh.members),this.indexBuffer=c.createIndexBuffer(y),this.segments=f.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ml={symbol:function(_,c,h,y,x){if("translucent"!==_.renderPass)return;const C=f.StencilMode.disabled,S=_.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(M,k,L,N,V,K,te){const re=k.transform,ie="map"===V,se="map"===K;for(const U of M){const J=N.getTile(U),de=J.getBucket(L);if(!de||!de.text||!de.text.segments.get().length)continue;const he=f.evaluateSizeForZoom(de.textSizeData,re.zoom),Ce=_i(U,de.getProjection(),re),Se=re.calculatePixelsToTileUnitsMatrix(J),Ee=We(Ce,J.tileID.canonical,se,ie,re,de.getProjection(),Se),ce="none"!==L.layout.get("icon-text-fit")&&de.hasIconData();if(he){const De=Math.pow(2,re.zoom-J.tileID.overscaledZ);Gd(de,ie,se,te,f.symbolSize,re,Ee,U,De,he,ce)}}}(y,_,h,c,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),x),0!==h.paint.get("icon-opacity").constantOr(1)&&sc(_,c,h,y,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),C,S),0!==h.paint.get("text-opacity").constantOr(1)&&sc(_,c,h,y,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),C,S),c.map.showCollisionBoxes&&(an(_,c,h,y,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),an(_,c,h,y,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(_,c,h,y){if("translucent"!==_.renderPass)return;const x=h.paint.get("circle-opacity"),C=h.paint.get("circle-stroke-width"),S=h.paint.get("circle-stroke-opacity"),M=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===C.constantOr(1)||0===S.constantOr(1)))return;const k=_.context,L=k.gl,N=_.transform,V=_.depthModeForSublayer(0,f.DepthMode.ReadOnly),K=f.StencilMode.disabled,te=_.colorModeForRenderPass(),re="globe"===N.projection.name,ie=[f.mercatorXfromLng(N.center.lng),f.mercatorYfromLat(N.center.lat)],se=[];for(let J=0;J<y.length;J++){const de=y[J],he=c.getTile(de),Ce=he.getBucket(h);if(!Ce||Ce.projection.name!==N.projection.name)continue;const Se=Ce.programConfigurations.get(h.id),Ee=Np(h);re&&Ee.push("PROJECTION_GLOBE_VIEW");const ce=_.useProgram("circle",Se,Ee),De=Ce.layoutVertexBuffer,_e=Ce.globeExtVertexBuffer,Ie=Ce.indexBuffer,Pe=N.projection.createInversionMatrix(N,de.canonical),Ke={programConfiguration:Se,program:ce,layoutVertexBuffer:De,globeExtVertexBuffer:_e,indexBuffer:Ie,uniformValues:In(_,de,he,Pe,ie,h),tile:he};if(M){const Ve=Ce.segments.get();for(const et of Ve)se.push({segments:new f.SegmentVector([et]),sortKey:et.sortKey,state:Ke})}else se.push({segments:Ce.segments,sortKey:0,state:Ke})}M&&se.sort((J,de)=>J.sortKey-de.sortKey);const U={useDepthForOcclusion:!re};for(const J of se){const{programConfiguration:de,program:he,layoutVertexBuffer:Ce,globeExtVertexBuffer:Se,indexBuffer:Ee,uniformValues:ce,tile:De}=J.state,_e=J.segments;_.terrain&&_.terrain.setupElevationDraw(De,he,U),_.prepareDrawProgram(k,he,De.tileID.toUnwrapped()),he.draw(k,L.TRIANGLES,V,K,te,f.CullFaceMode.disabled,ce,h.id,Ce,Ee,_e,h.paint,N.zoom,de,[Se])}},heatmap:function(_,c,h,y){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===_.renderPass){const x=_.context,C=x.gl,S=f.StencilMode.disabled,M=new f.ColorMode([C.ONE,C.ONE],f.Color.transparent,[!0,!0,!0,!0]);(function(te,re,ie,se){const U=te.gl,J=re.width*se,de=re.height*se;te.activeTexture.set(U.TEXTURE1),te.viewport.set([0,0,J,de]);let he=ie.heatmapFbo;if(!he||he&&(he.width!==J||he.height!==de)){he&&he.destroy();const Ce=U.createTexture();U.bindTexture(U.TEXTURE_2D,Ce),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),he=ie.heatmapFbo=te.createFramebuffer(J,de,!1),function(Se,Ee,ce,De,_e,Ie){const Pe=Se.gl;Pe.texImage2D(Pe.TEXTURE_2D,0,Se.isWebGL2&&Se.extRenderToTextureHalfFloat?Pe.RGBA16F:Pe.RGBA,_e,Ie,0,Pe.RGBA,Se.extRenderToTextureHalfFloat?Se.isWebGL2?Pe.HALF_FLOAT:Se.extTextureHalfFloat.HALF_FLOAT_OES:Pe.UNSIGNED_BYTE,null),De.colorAttachment.set(ce)}(te,0,Ce,he,J,de)}else U.bindTexture(U.TEXTURE_2D,he.colorAttachment.get()),te.bindFramebuffer.set(he.framebuffer)})(x,_,h,"globe"===_.transform.projection.name?.5:.25),x.clear({color:f.Color.transparent});const k=_.transform,L="globe"===k.projection.name,N=L?["PROJECTION_GLOBE_VIEW"]:null,V=L?f.CullFaceMode.frontCCW:f.CullFaceMode.disabled,K=[f.mercatorXfromLng(k.center.lng),f.mercatorYfromLat(k.center.lat)];for(let te=0;te<y.length;te++){const re=y[te];if(c.hasRenderableParent(re))continue;const ie=c.getTile(re),se=ie.getBucket(h);if(!se||se.projection.name!==k.projection.name)continue;const U=se.programConfigurations.get(h.id),J=_.useProgram("heatmap",U,N),{zoom:de}=_.transform;_.terrain&&_.terrain.setupElevationDraw(ie,J),_.prepareDrawProgram(x,J,re.toUnwrapped());const he=k.projection.createInversionMatrix(k,re.canonical);J.draw(x,C.TRIANGLES,f.DepthMode.disabled,S,M,V,Zm(_,re,ie,he,K,de,h.paint.get("heatmap-intensity")),h.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,h.paint,_.transform.zoom,U,L?[se.globeExtVertexBuffer]:null)}x.viewport.set([0,0,_.width,_.height])}else"translucent"===_.renderPass&&(_.context.setColorMode(_.colorModeForRenderPass()),function(x,C){const S=x.context,M=S.gl,k=C.heatmapFbo;if(!k)return;S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,k.colorAttachment.get()),S.activeTexture.set(M.TEXTURE1);let L=C.colorRampTexture;L||(L=C.colorRampTexture=new f.Texture(S,C.colorRamp,M.RGBA)),L.bind(M.LINEAR,M.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(S,M.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,x.colorModeForRenderPass(),f.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")},C.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,C.paint,x.transform.zoom)}(_,h))},line:function(_,c,h,y){if("translucent"!==_.renderPass)return;const x=h.paint.get("line-opacity"),C=h.paint.get("line-width");if(0===x.constantOr(1)||0===C.constantOr(1))return;const S=_.depthModeForSublayer(0,f.DepthMode.ReadOnly),M=_.colorModeForRenderPass(),k=_.terrain&&_.terrain.renderingToTexture?1:f.exported.devicePixelRatio,L=h.paint.get("line-dasharray"),N=L.constantOr(1),V=h.layout.get("line-cap"),K=h.paint.get("line-pattern"),te=K.constantOr(1),re=h.paint.get("line-gradient"),ie=te?"linePattern":"line",se=_.context,U=se.gl,J=(he=>{const Ce=[];qi(he)&&Ce.push("RENDER_LINE_DASH"),he.paint.get("line-gradient")&&Ce.push("RENDER_LINE_GRADIENT");const Se=he.paint.get("line-trim-offset");0===Se[0]&&0===Se[1]||Ce.push("RENDER_LINE_TRIM_OFFSET");const Ee=he.paint.get("line-pattern").constantOr(1),ce=1!==he.paint.get("line-opacity").constantOr(1);return!Ee&&ce&&Ce.push("RENDER_LINE_ALPHA_DISCARD"),Ce})(h);let de=J.includes("RENDER_LINE_ALPHA_DISCARD");_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(de=!1);for(const he of y){const Ce=c.getTile(he);if(te&&!Ce.patternsLoaded())continue;const Se=Ce.getBucket(h);if(!Se)continue;_.prepareDrawTile();const Ee=Se.programConfigurations.get(h.id),ce=_.useProgram(ie,Ee,J),De=K.constantOr(null);if(De&&Ce.imageAtlas){const Ye=Ce.imageAtlas.patternPositions[De.toString()];Ye&&Ee.setConstantPatternPositions(Ye)}const _e=L.constantOr(null),Ie=V.constantOr(null);if(!te&&_e&&Ie&&Ce.lineAtlas){const Ye=Ce.lineAtlas.getDash(_e,Ie);Ye&&Ee.setConstantPatternPositions(Ye)}let[Pe,Ke]=h.paint.get("line-trim-offset");("round"===Ie||"square"===Ie)&&Pe!==Ke&&(0===Pe&&(Pe-=1),1===Ke&&(Ke+=1));const Ve=_.terrain?he.projMatrix:null,et=te?gt(_,Ce,h,Ve,k):Ym(_,Ce,h,Ve,Se.lineClipsArray.length,k,[Pe,Ke]);if(re){const Ye=Se.gradients[h.id];let ct=Ye.texture;if(h.gradientVersion!==Ye.version){let tt=256;if(h.stepInterpolant){const dt=c.getSource().maxzoom,Tt=he.canonical.z===dt?Math.ceil(1<<_.transform.maxZoom-he.canonical.z):1;tt=f.clamp(f.nextPowerOfTwo(Se.maxLineLength/f.EXTENT*1024*Tt),256,se.maxTextureSize)}Ye.gradient=f.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:tt,image:Ye.gradient||void 0,clips:Se.lineClipsArray}),Ye.texture?Ye.texture.update(Ye.gradient):Ye.texture=new f.Texture(se,Ye.gradient,U.RGBA),Ye.version=h.gradientVersion,ct=Ye.texture}se.activeTexture.set(U.TEXTURE1),ct.bind(h.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}N&&(se.activeTexture.set(U.TEXTURE0),Ce.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),Ee.updatePaintBuffers()),te&&(se.activeTexture.set(U.TEXTURE0),Ce.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Ee.updatePaintBuffers()),_.prepareDrawProgram(se,ce,he.toUnwrapped());const Be=Ye=>{ce.draw(se,U.TRIANGLES,S,Ye,M,f.CullFaceMode.disabled,et,h.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,h.paint,_.transform.zoom,Ee,[Se.layoutVertexBuffer2])};if(de){const Ye=_.stencilModeForClipping(he).ref;0===Ye&&_.terrain&&se.clear({stencil:0});const ct={func:U.EQUAL,mask:255};et.u_alpha_discard_threshold=.8,Be(new f.StencilMode(ct,Ye,255,U.KEEP,U.KEEP,U.INVERT)),et.u_alpha_discard_threshold=0,Be(new f.StencilMode(ct,Ye,255,U.KEEP,U.KEEP,U.KEEP))}else Be(_.stencilModeForClipping(he))}de&&(_.resetStencilClippingMasks(),_.terrain&&se.clear({stencil:0}))},fill:function(_,c,h,y){const x=h.paint.get("fill-color"),C=h.paint.get("fill-opacity");if(0===C.constantOr(1))return;const S=_.colorModeForRenderPass(),M=h.paint.get("fill-pattern"),k=_.opaquePassEnabledForLayer()&&!M.constantOr(1)&&1===x.constantOr(f.Color.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(_.renderPass===k){const L=_.depthModeForSublayer(1,"opaque"===_.renderPass?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly);Ma(_,c,h,y,L,S,!1)}if("translucent"===_.renderPass&&h.paint.get("fill-antialias")){const L=_.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,f.DepthMode.ReadOnly);Ma(_,c,h,y,L,S,!0)}},"fill-extrusion":function(_,c,h,y){const x=h.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===_.renderPass){const C=new f.DepthMode(_.context.gl.LEQUAL,f.DepthMode.ReadWrite,_.depthRangeFor3D);if(1!==x||h.paint.get("fill-extrusion-pattern").constantOr(1))Aa(_,c,h,y,C,f.StencilMode.disabled,f.ColorMode.disabled),Aa(_,c,h,y,C,_.stencilModeFor3D(),_.colorModeForRenderPass()),_.resetStencilClippingMasks();else{const S=_.colorModeForRenderPass();Aa(_,c,h,y,C,f.StencilMode.disabled,S)}}},hillshade:function(_,c,h,y){if("offscreen"!==_.renderPass&&"translucent"!==_.renderPass)return;const x=_.context,C=_.depthModeForSublayer(0,f.DepthMode.ReadOnly),S=_.colorModeForRenderPass(),M=_.terrain&&_.terrain.renderingToTexture,[k,L]="translucent"!==_.renderPass||M?[{},y]:_.stencilConfigForOverlap(y);for(const N of L){const V=c.getTile(N);if(V.needsHillshadePrepare&&"offscreen"===_.renderPass)Xs(_,V,h,C,f.StencilMode.disabled,S);else if("translucent"===_.renderPass){const K=M&&_.terrain?_.terrain.stencilModeForRTTOverlap(N):k[N.overscaledZ];Ku(_,N,V,h,C,K,S)}}x.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,c,h,y,x,C){if("translucent"!==_.renderPass||0===h.paint.get("raster-opacity")||!y.length)return;const S=_.context,M=S.gl,k=c.getSource(),L=_.useProgram("raster"),N=_.colorModeForRenderPass(),V=_.terrain&&_.terrain.renderingToTexture,[K,te]=k instanceof Ut||V?[{},y]:_.stencilConfigForOverlap(y),re=te[te.length-1].overscaledZ,ie=!_.options.moving;for(const se of te){const U=V?f.DepthMode.disabled:_.depthModeForSublayer(se.overscaledZ-re,1===h.paint.get("raster-opacity")?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly,M.LESS),J=se.toUnwrapped(),de=c.getTile(se);if(V&&(!de||!de.hasData()))continue;const he=V?se.projMatrix:_.transform.calculateProjMatrix(J,ie),Ce=_.terrain&&V?_.terrain.stencilModeForRTTOverlap(se):K[se.overscaledZ],Se=C?0:h.paint.get("raster-fade-duration");de.registerFadeDuration(Se);const Ee=c.findLoadedParent(se,0),ce=Op(de,Ee,c,_.transform,Se);let De,_e;_.terrain&&_.terrain.prepareDrawTile();const Ie="nearest"===h.paint.get("raster-resampling")?M.NEAREST:M.LINEAR;S.activeTexture.set(M.TEXTURE0),de.texture.bind(Ie,M.CLAMP_TO_EDGE),S.activeTexture.set(M.TEXTURE1),Ee?(Ee.texture.bind(Ie,M.CLAMP_TO_EDGE),De=Math.pow(2,Ee.tileID.overscaledZ-de.tileID.overscaledZ),_e=[de.tileID.canonical.x*De%1,de.tileID.canonical.y*De%1]):de.texture.bind(Ie,M.CLAMP_TO_EDGE),de.texture.useMipmap&&S.extTextureFilterAnisotropic&&_.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax);const Pe=Mr(he,_e||[0,0],De||1,ce,h,k instanceof Ut?k.perspectiveTransform:[0,0]);if(_.prepareDrawProgram(S,L,J),k instanceof Ut)k.boundsBuffer&&k.boundsSegments&&L.draw(S,M.TRIANGLES,U,f.StencilMode.disabled,N,f.CullFaceMode.disabled,Pe,h.id,k.boundsBuffer,_.quadTriangleIndexBuffer,k.boundsSegments);else{const{tileBoundsBuffer:Ke,tileBoundsIndexBuffer:Ve,tileBoundsSegments:et}=_.getTileBoundsBuffers(de);L.draw(S,M.TRIANGLES,U,Ce,N,f.CullFaceMode.disabled,Pe,h.id,Ke,Ve,et)}}_.resetStencilClippingMasks()},background:function(_,c,h,y){const x=h.paint.get("background-color"),C=h.paint.get("background-opacity");if(0===C)return;const S=_.context,M=S.gl,k=_.transform,L=k.tileSize,N=h.paint.get("background-pattern");if(_.isPatternMissing(N))return;const V=!N&&1===x.a&&1===C&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==V)return;const K=f.StencilMode.disabled,te=_.depthModeForSublayer(0,"opaque"===V?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly),re=_.colorModeForRenderPass(),ie=_.useProgram(N?"backgroundPattern":"background");let se,U=y;U||(se=_.getBackgroundTiles(),U=Object.values(se).map(J=>J.tileID)),N&&(S.activeTexture.set(M.TEXTURE0),_.imageManager.bind(_.context));for(const J of U){const de=J.toUnwrapped(),he=y?J.projMatrix:_.transform.calculateProjMatrix(de);_.prepareDrawTile();const Ce=c?c.getTile(J):se?se[J.key]:new f.Tile(J,L,k.zoom,_),Se=N?wy(he,C,_,N,{tileID:J,tileSize:L}):Bp(he,C,x);_.prepareDrawProgram(S,ie,de);const{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:ce,tileBoundsSegments:De}=_.getTileBoundsBuffers(Ce);ie.draw(S,M.TRIANGLES,te,K,re,f.CullFaceMode.disabled,Se,h.id,Ee,ce,De)}},sky:function(_,c,h){const y=_.transform,x="mercator"===y.projection.name||"globe"===y.projection.name?1:f.smoothstep(7,8,y.zoom),C=h.paint.get("sky-opacity")*x;if(0===C)return;const S=_.context,M=h.paint.get("sky-type"),k=new f.DepthMode(S.gl.LEQUAL,f.DepthMode.ReadOnly,[0,1]),L=_.frameCounter/1e3%1;"atmosphere"===M?"offscreen"===_.renderPass?h.needsSkyboxCapture(_)&&(function(N,V,K,te){const re=N.context,ie=re.gl;let se=V.skyboxFbo;if(!se){se=V.skyboxFbo=re.createFramebuffer(32,32,!1),V.skyboxGeometry=new lc(re),V.skyboxTexture=re.gl.createTexture(),ie.bindTexture(ie.TEXTURE_CUBE_MAP,V.skyboxTexture),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MAG_FILTER,ie.LINEAR);for(let he=0;he<6;++he)ie.texImage2D(ie.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,ie.RGBA,32,32,0,ie.RGBA,ie.UNSIGNED_BYTE,null)}re.bindFramebuffer.set(se.framebuffer),re.viewport.set([0,0,32,32]);const U=V.getCenter(N,!0),J=N.useProgram("skyboxCapture"),de=new Float64Array(16);f.identity(de),f.rotateY(de,de,.5*-Math.PI),ln(re,V,J,de,U,0),f.identity(de),f.rotateY(de,de,.5*Math.PI),ln(re,V,J,de,U,1),f.identity(de),f.rotateX(de,de,.5*-Math.PI),ln(re,V,J,de,U,2),f.identity(de),f.rotateX(de,de,.5*Math.PI),ln(re,V,J,de,U,3),f.identity(de),ln(re,V,J,de,U,4),f.identity(de),f.rotateY(de,de,Math.PI),ln(re,V,J,de,U,5),re.viewport.set([0,0,N.width,N.height])}(_,h),h.markSkyboxValid(_)):"sky"===_.renderPass&&function(N,V,K,te,re){const ie=N.context,se=ie.gl,U=N.transform,J=N.useProgram("skybox");ie.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,V.skyboxTexture);const de={u_matrix:U.skyboxMatrix,u_sun_direction:V.getCenter(N,!1),u_cubemap:0,u_opacity:te,u_temporal_offset:re};N.prepareDrawProgram(ie,J),J.draw(ie,se.TRIANGLES,K,f.StencilMode.disabled,N.colorModeForRenderPass(),f.CullFaceMode.backCW,de,"skybox",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(_,h,k,C,L):"gradient"===M&&"sky"===_.renderPass&&function(N,V,K,te,re){const ie=N.context,se=ie.gl,U=N.transform,J=N.useProgram("skyboxGradient");V.skyboxGeometry||(V.skyboxGeometry=new lc(ie)),ie.activeTexture.set(se.TEXTURE0);let de=V.colorRampTexture;de||(de=V.colorRampTexture=new f.Texture(ie,V.colorRamp,se.RGBA)),de.bind(se.LINEAR,se.CLAMP_TO_EDGE);const he=(Ce=U.skyboxMatrix,Se=V.getCenter(N,!1),Ee=V.paint.get("sky-gradient-radius"),ce=te,De=re,{u_matrix:Ce,u_color_ramp:0,u_center_direction:Se,u_radius:f.degToRad(Ee),u_opacity:ce,u_temporal_offset:De});var Ce,Se,Ee,ce,De;N.prepareDrawProgram(ie,J),J.draw(ie,se.TRIANGLES,K,f.StencilMode.disabled,N.colorModeForRenderPass(),f.CullFaceMode.backCW,he,"skyboxGradient",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(_,h,k,C,L)},debug:function(_,c,h){for(let y=0;y<h.length;y++)rd(_,c,h[y])},custom:function(_,c,h,y){const x=_.context,C=h.implementation;if(!_.transform.projection.unsupportedLayers||!_.transform.projection.unsupportedLayers.includes("custom")||_.terrain&&(_.terrain.renderingToTexture||"offscreen"===_.renderPass)&&h.isLayerDraped()){if("offscreen"===_.renderPass){const S=C.prerender;if(S){if(_.setCustomLayerDefaults(),x.setColorMode(_.colorModeForRenderPass()),"globe"===_.transform.projection.name){const M=_.transform.pointMerc;S.call(C,x.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),f.globeToMercatorTransition(_.transform.zoom),[M.x,M.y],_.transform.pixelsPerMeterRatio)}else S.call(C,x.gl,_.transform.customLayerMatrix());x.setDirty(),_.setBaseState()}}else if("translucent"===_.renderPass){if(_.terrain&&_.terrain.renderingToTexture){const M=C.renderToTile;if(M){const k=y[0].canonical,L=new f.MercatorCoordinate(k.x+y[0].wrap*(1<<k.z),k.y,k.z);x.setDepthMode(f.DepthMode.disabled),x.setStencilMode(f.StencilMode.disabled),x.setColorMode(_.colorModeForRenderPass()),_.setCustomLayerDefaults(),M.call(C,x.gl,L),x.setDirty(),_.setBaseState()}return}_.setCustomLayerDefaults(),x.setColorMode(_.colorModeForRenderPass()),x.setStencilMode(f.StencilMode.disabled);const S="3d"===C.renderingMode?new f.DepthMode(_.context.gl.LEQUAL,f.DepthMode.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,f.DepthMode.ReadOnly);if(x.setDepthMode(S),"globe"===_.transform.projection.name){const M=_.transform.pointMerc;C.render(x.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),f.globeToMercatorTransition(_.transform.zoom),[M.x,M.y],_.transform.pixelsPerMeterRatio)}else C.render(x.gl,_.transform.customLayerMatrix());x.setDirty(),_.setBaseState(),x.bindFramebuffer.set(null)}}else f.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class co{constructor(c,h,y=!1){this.context=new ht(c,y),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=f.SourceCache.maxUnderzooming+f.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,h){const y=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new zo(this,c));const x=this._terrain;this.transform.elevation=y?x:null,x.update(c,this.transform,h)}_updateFog(c){const h=c.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,x]=h.getFovAdjustedRange(this.transform._fov);if(y>x)return void(this.transform.fogCullDistSq=null);const C=y+.78*(x-y);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,h){if(this.width=c*f.exported.devicePixelRatio,this.height=h*f.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._layers[y].resize()}setup(){const c=this.context,h=new f.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(f.EXTENT,0),h.emplaceBack(0,f.EXTENT),h.emplaceBack(f.EXTENT,f.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(h,f.posAttributes.members),this.tileExtentSegments=f.SegmentVector.simpleSegment(0,0,4,2);const y=new f.StructArrayLayout2i4;y.emplaceBack(0,0),y.emplaceBack(f.EXTENT,0),y.emplaceBack(0,f.EXTENT),y.emplaceBack(f.EXTENT,f.EXTENT),this.debugBuffer=c.createVertexBuffer(y,f.posAttributes.members),this.debugSegments=f.SegmentVector.simpleSegment(0,0,4,5);const x=new f.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(x,f.posAttributes.members),this.viewportSegments=f.SegmentVector.simpleSegment(0,0,4,2);const C=new f.StructArrayLayout4i8;C.emplaceBack(0,0,0,0),C.emplaceBack(f.EXTENT,0,f.EXTENT,0),C.emplaceBack(0,f.EXTENT,0,f.EXTENT),C.emplaceBack(f.EXTENT,f.EXTENT,f.EXTENT,f.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(C,f.boundsAttributes.members),this.mercatorBoundsSegments=f.SegmentVector.simpleSegment(0,0,4,2);const S=new f.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(S);const M=new f.StructArrayLayout1ui2;for(const L of[0,1,3,2,0])M.emplaceBack(L);this.debugIndexBuffer=c.createIndexBuffer(M),this.emptyTexture=new f.Texture(c,new f.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=f.create();const k=this.context.gl;this.stencilClearMode=new f.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(f.window.performance.now()),this.atmosphereBuffer=new sh(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,h=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,h.TRIANGLES,f.DepthMode.disabled,this.stencilClearMode,f.ColorMode.disabled,f.CullFaceMode.disabled,td(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,h,y){if(!h||this.currentStencilSource===h.id||!c.isTileClipped()||!y||0===y.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const k of y)if(void 0===this._tileClippingMaskIDs[k.key]){M=!0;break}if(!M)return}this.currentStencilSource=h.id;const x=this.context,C=x.gl;this.nextStencilID+y.length>256&&this.clearStencil(),x.setColorMode(f.ColorMode.disabled),x.setDepthMode(f.DepthMode.disabled);const S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of y){const k=h.getTile(M),L=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:V,tileBoundsSegments:K}=this.getTileBoundsBuffers(k);S.draw(x,C.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:C.ALWAYS,mask:0},L,255,C.KEEP,C.KEEP,C.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,td(M.projMatrix),"$clipping",N,V,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,h=this.context.gl;return new f.StencilMode({func:h.NOTEQUAL,mask:255},c,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const h=this.context.gl;return new f.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(c){const h=this.context.gl,y=c.sort((S,M)=>M.overscaledZ-S.overscaledZ),x=y[y.length-1].overscaledZ,C=y[0].overscaledZ-x+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const S={};for(let M=0;M<C;M++)S[M+x]=new f.StencilMode({func:h.GEQUAL,mask:255},M+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=C,[S,y]}return[{[x]:f.StencilMode.disabled},y]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new f.ColorMode([c.CONSTANT_COLOR,c.ONE],new f.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?f.ColorMode.unblended:f.ColorMode.alphaBlended}depthModeForSublayer(c,h,y){if(!this.opaquePassEnabledForLayer())return f.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new f.DepthMode(y||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,h){this.style=c,this.options=h,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(f.exported.now()),this.imageManager.beginFrame();const y=this.style.order,x=this.style._sourceCaches;for(const L in x){const N=x[L];N.used&&N.prepare(this.context)}const C={},S={},M={};for(const L in x){const N=x[L];C[L]=N.getVisibleCoordinates(),S[L]=C[L].slice().reverse(),M[L]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<y.length;L++)if(this.style._layers[y[L]].is3D()){this.opaquePassCutoff=L;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new f.GlobeSharedBuffers(this.context)),!f.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const L of y){const N=this.style._layers[L],V=c._getLayerSourceCache(N);if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const K=V?S[V.id]:void 0;("custom"===N.type||N.isSky()||K&&K.length)&&this.renderLayer(this,V,N,K)}this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon];const k=this.terrain;if(k&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&k.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?f.Color.black:f.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[y[this.currentLayer]],N=c._getLayerSourceCache(L);if(L.isSky())continue;const V=N?S[N.id]:void 0;this._renderTileClippingMasks(L,N,V),this.renderLayer(this,N,L,V)}if(this.style.fog&&this.transform.projection.supportsFog&&function(L,N){const V=L.context,K=V.gl,te=L.transform,re=new f.DepthMode(K.LEQUAL,f.DepthMode.ReadOnly,[0,1]),ie=L.useProgram("globeAtmosphere",null,"globe"===te.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),se=f.globeToMercatorTransition(te.zoom),U=N.properties.get("color").toArray01(),J=N.properties.get("high-color").toArray01(),de=N.properties.get("space-color").toArray01PremultipliedAlpha(),he=f.identity$1([]);f.rotateY$1(he,he,-f.degToRad(te._center.lng)),f.rotateX$1(he,he,f.degToRad(te._center.lat)),f.rotateZ$1(he,he,te.angle),f.rotateX$1(he,he,-te._pitch);const Ce=f.fromQuat(new Float32Array(16),he),Se=f.mapValue(N.properties.get("star-intensity"),0,1,0,.25),ce=f.mapValue(N.properties.get("horizon-blend"),0,1,5e-4,.25),De=f.globeUseCustomAntiAliasing(L,V,te)&&5e-4===ce?te.worldSize/(2*Math.PI*1.025)-1:te.globeRadius,_e=L.frameCounter/1e3%1,Ie=f.length(te.globeCenterInViewSpace),Pe=Math.sqrt(Math.pow(Ie,2)-Math.pow(De,2)),Ke=Math.acos(Pe/Ie),Ve={u_frustum_tl:te.frustumCorners.TL,u_frustum_tr:te.frustumCorners.TR,u_frustum_br:te.frustumCorners.BR,u_frustum_bl:te.frustumCorners.BL,u_horizon:te.frustumCorners.horizon,u_transition:se,u_fadeout_range:ce,u_color:U,u_high_color:J,u_space_color:de,u_star_intensity:Se,u_star_size:5*f.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:_e,u_horizon_angle:Ke,u_rotation_matrix:Ce};L.prepareDrawProgram(V,ie);const et=L.atmosphereBuffer;et&&ie.draw(V,K.TRIANGLES,re,f.StencilMode.disabled,f.ColorMode.alphaBlended,f.CullFaceMode.backCW,Ve,"skybox",et.vertexBuffer,et.indexBuffer,et.segments)}(this,this.style.fog),this.renderPass="sky",(f.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const L=this.style._layers[y[this.currentLayer]],N=c._getLayerSourceCache(L);L.isSky()&&this.renderLayer(this,N,L,N?S[N.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;){const L=this.style._layers[y[this.currentLayer]],N=c._getLayerSourceCache(L);if(L.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(L)){if(L.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const V=N?("symbol"===L.type?M:S)[N.id]:void 0;this._renderTileClippingMasks(L,N,N?C[N.id]:void 0),this.renderLayer(this,N,L,V),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let L=null;f.values(this.style._layers).forEach(N=>{const V=c._getLayerSourceCache(N);V&&!N.isHidden(this.transform.zoom)&&(!L||L.getSource().maxzoom<V.getSource().maxzoom)&&(L=V)}),L&&this.options.showTileBoundaries&&ml.debug(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const N=L.transform.padding;ws(L,L.transform.height-(N.top||0),3,Qs),ws(L,N.bottom||0,3,Xm),fl(L,N.left||0,3,id),fl(L,L.transform.width-(N.right||0),3,Wi);const V=L.transform.centerPoint;var K,te,re,ie;ac(K=L,(te=V.x)-1,(re=L.transform.height-V.y)-10,2,20,ie=qd),ac(K,te-10,re-1,20,2,ie)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(f.window.performance.now()),this.saveCanvasCopy())}renderLayer(c,h,y,x){y.isHidden(this.transform.zoom)||("background"===y.type||"sky"===y.type||"custom"===y.type||x&&x.length)&&(this.id=y.id,this.gpuTimingStart(y),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(y.type)||c.terrain&&"custom"===y.type)&&ml[y.type](c,h,y,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let y=this.gpuTimers[c.id];y||(y=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),y.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,h=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),c.beginQueryEXT(c.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const h={};for(const y in c){const x=c[y],C=this.context.extTimerQuery,S=C.getQueryObjectEXT(x.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(x.query),h[y]=S}return h}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let y=0;for(const x of c)y+=h.getQueryObjectEXT(x,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(x);return y}translatePosMatrix(c,h,y,x,C){if(!y[0]&&!y[1])return c;const S=C?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(S){const L=Math.sin(S),N=Math.cos(S);y=[y[0]*N-y[1]*L,y[0]*L+y[1]*N]}const M=[C?y[0]:vr(h,y[0],this.transform.zoom),C?y[1]:vr(h,y[1],this.transform.zoom),0],k=new Float32Array(16);return f.translate(k,c,M),k}saveTileTexture(c){const h=this._tileTextures[c.size[0]];h?h.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const h=this._tileTextures[c];return h&&h.length>0?h.pop():null}isPatternMissing(c){return null===c||void 0!==c&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,h=this.terrain&&0===this.terrain.exaggeration(),y=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),"globe"===this.transform.projection.name&&x.push("GLOBE"),h&&x.push("ZERO_EXAGGERATION"),y&&!c&&0!==y.getOpacity(this.transform.pitch)&&x.push("FOG"),c&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(c,h,y){this.cache=this.cache||{};const x=y||[],C=this.currentGlobalDefines().concat(x),S=Ln.cacheKey(wo[c],c,C,h);return this.cache[S]||(this.cache[S]=new Ln(this.context,c,wo[c],h,Ni[c],C)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=f.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,h,y){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const C=x.getOpacity(this.transform.pitch),S=((M,k,L,N,V,K,te,re,ie,se,U)=>{const J=M.transform,de=k.properties.get("color").toArray01();de[3]=N;const he=M.frameCounter/1e3%1;return{u_fog_matrix:L?J.calculateFogTileMatrix(L):M.identityMat,u_fog_range:k.getFovAdjustedRange(J._fov),u_fog_color:de,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_temporal_offset:he,u_frustum_tl:V,u_frustum_tr:K,u_frustum_br:te,u_frustum_bl:re,u_globe_pos:ie,u_globe_radius:se,u_viewport:U,u_globe_transition:f.globeToMercatorTransition(J.zoom),u_is_globe:+("globe"===J.projection.name)}})(this,x,y,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*f.exported.devicePixelRatio,this.transform.height*f.exported.devicePixelRatio]);h.setFogUniformValues(c,S)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,h=c.createTexture();return c.bindTexture(c.TEXTURE_2D,h),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,h=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const x of y)h[x.key]=c[x.key]||new f.Tile(x,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class cc{constructor(c=0,h=0,y=0,x=0){if(isNaN(c)||c<0||isNaN(h)||h<0||isNaN(y)||y<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=h,this.left=y,this.right=x}interpolate(c,h,y){return null!=h.top&&null!=c.top&&(this.top=f.number(c.top,h.top,y)),null!=h.bottom&&null!=c.bottom&&(this.bottom=f.number(c.bottom,h.bottom,y)),null!=h.left&&null!=c.left&&(this.left=f.number(c.left,h.left,y)),null!=h.right&&null!=c.right&&(this.right=f.number(c.right,h.right,y)),this}getCenter(c,h){const y=f.clamp((this.left+c-this.right)/2,0,c),x=f.clamp((this.top+h-this.bottom)/2,0,h);return new f.Point(y,x)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new cc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ra(_,c){const h=f.getColumn(_,3);f.fromQuat(_,c),f.setColumn(_,3,h)}function Rn(_,c){const h=f.identity$1([]);return f.rotateZ$1(h,h,-c),f.rotateX$1(h,h,-_),h}function Zi(_,c){const h=[_[0],_[1],0],y=[c[0],c[1],0];if(f.length(h)>=1e-15){const S=f.normalize([],h);f.scale$2(y,S,f.dot(y,S)),c[0]=y[0],c[1]=y[1]}const x=f.cross([],c,_);if(f.len(x)<1e-15)return null;const C=Math.atan2(-x[1],x[0]);return Rn(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),C)}class Cy{constructor(c,h){this.position=c,this.orientation=h}get position(){return this._position}set position(c){if(c){const h=c instanceof f.MercatorCoordinate?c:new f.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(h.x=f.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(c,h){if(this.orientation=null,!this.position)return;const y=this.position,x=this._elevation?this._elevation.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(c)):0,C=f.MercatorCoordinate.fromLngLat(c,x),S=[C.x-y.x,C.y-y.y,C.z-y.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Zi(S,h)}setPitchBearing(c,h){this.orientation=Rn(f.degToRad(c),f.degToRad(-h))}}class Ar{constructor(c,h){this._transform=f.identity([]),this.orientation=h,this.position=c}get mercatorPosition(){const c=this.position;return new f.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=f.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var h;c&&f.setColumn(this._transform,3,[(h=c)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||f.identity$1([]),c&&Ra(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,h){this._orientation=Rn(c,h),Ra(this._transform,this._orientation)}forward(){const c=f.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=f.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=f.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,h){const y=new Float64Array(16);return f.invert(y,this.getWorldToCamera(c,h)),y}getWorldToCameraPosition(c,h,y){const x=this.position;f.scale$2(x,x,-c);const C=new Float64Array(16);return f.fromScaling(C,[y,y,y]),f.translate(C,C,x),C[10]*=h,C}getWorldToCamera(c,h){const y=new Float64Array(16),x=new Float64Array(4),C=this.position;return f.conjugate(x,this._orientation),f.scale$2(C,C,-c),f.fromQuat(y,x),f.translate(y,y,C),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=h,y[9]*=h,y[10]*=h,y[11]*=h,y}getCameraToClipPerspective(c,h,y,x){const C=new Float64Array(16);return f.perspective(C,c,h,y,x),C}getDistanceToElevation(c,h=!1){const y=0===c?0:f.mercatorZfromAltitude(c,h?f.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(y-this.position[2])/x[2]}clone(){return new Ar([...this.position],[...this.orientation])}}function ur(_,c){const h=ea(_.projection,_.zoom,_.width,_.height),y=function(C,S,M,k,L){const N=new f.LngLat(M.lng-180*ts,M.lat),V=new f.LngLat(M.lng+180*ts,M.lat),K=C.project(N.lng,N.lat),te=C.project(V.lng,V.lat),re=-Math.atan2(te.y-K.y,te.x-K.x),ie=f.MercatorCoordinate.fromLngLat(M);ie.y=f.clamp(ie.y,-1+ts,1-ts);const se=ie.toLngLat(),U=C.project(se.lng,se.lat),J=f.MercatorCoordinate.fromLngLat(se);J.x+=ts;const de=J.toLngLat(),he=C.project(de.lng,de.lat),Ce=od(he.x-U.x,he.y-U.y,re),Se=f.MercatorCoordinate.fromLngLat(se);Se.y+=ts;const Ee=Se.toLngLat(),ce=C.project(Ee.lng,Ee.lat),De=od(ce.x-U.x,ce.y-U.y,re),_e=Math.abs(Ce.x)/Math.abs(De.y),Ie=f.identity([]);f.rotateZ(Ie,Ie,-re*(1-(L?0:k)));const Pe=f.identity([]);return f.scale(Pe,Pe,[1,1-(1-_e)*k,1]),Pe[4]=-De.x/De.y*k,f.rotateZ(Pe,Pe,re),f.multiply(Pe,Ie,Pe),Pe}(_.projection,0,_.center,h,c),x=ah(_);return f.scale(y,y,[x,x,1]),y}function ah(_){const c=_.projection,h=ea(_.projection,_.zoom,_.width,_.height),y=ns(c,_.center),x=ns(c,f.LngLat.convert(c.center));return Math.pow(2,y*h+(1-h)*x)}function ea(_,c,h,y,x=1/0){const C=_.range;if(!C)return 0;const S=Math.min(x,Math.max(h,y)),M=Math.log(S/1024)/Math.LN2;return f.smoothstep(C[0]+M,C[1]+M,c)}const ts=1/4e4;function ns(_,c){const h=f.clamp(c.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),y=new f.LngLat(c.lng-180*ts,h),x=new f.LngLat(c.lng+180*ts,h),C=_.project(y.lng,h),S=_.project(x.lng,h),M=f.MercatorCoordinate.fromLngLat(y),k=f.MercatorCoordinate.fromLngLat(x),L=S.x-C.x,N=S.y-C.y,V=k.x-M.x,K=k.y-M.y,te=Math.sqrt((V*V+K*K)/(L*L+N*N));return Math.log(te)/Math.LN2}function od(_,c,h){const y=Math.cos(h),x=Math.sin(h);return{x:_*y-c*x,y:_*x+c*y}}class sd{constructor(c,h,y,x,C,S,M){this.tileSize=512,this._renderWorldCopies=void 0===C||C,this._minZoom=c||0,this._maxZoom=h||22,this._minPitch=y??0,this._maxPitch=x??60,this.setProjection(S),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new f.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new cc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Ar,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new sd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,h=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||y)&&this._updateCameraOnTerrain(),(c||y)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return f.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=f.getProjection(this.projectionOptions);const y=!at(h,this.getProjection());return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=f.getProjection({name:"mercator"});const h=c!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return f.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.Point(this.width,this.height)}get bearing(){return f.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const h=-c*Math.PI/180;var y,x,C,S,M,k,L,N,V,K;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(y=new f.ARRAY_TYPE(4),f.ARRAY_TYPE!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y),x=this.rotationMatrix,S=this.angle,M=(C=this.rotationMatrix)[0],k=C[1],L=C[2],N=C[3],V=Math.sin(S),K=Math.cos(S),x[0]=M*K+L*V,x[1]=k*K+N*V,x[2]=M*-V+L*K,x[3]=k*-V+N*K)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const h=f.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=f.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const h=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let x=0,C=0;for(let S=0;S<h.length;S++){const M=new f.Point(h[S][0]*this.width,y+h[S][1]*(this.height-y)),k=c.pointCoordinate(M);if(!k)continue;const L=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);x+=k[3]*L,C+=L}return 0===C?NaN:x/C}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*h,x=this._mercatorZfromZoom(c),C=this._mercatorZfromZoom(this._maxZoom),S=Math.max(x-y,C);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let y;y=c.z<this._camera.position[2]?[h.x,h.y,h.z]:[c.x,c.y,c.z];const x=f.length(f.sub([],this._camera.position,y));return f.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let h=!1;if(c.orientation&&!f.exactEquals(c.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(c.orientation)),c.position){const y=[c.position.x,c.position.y,c.position.z];f.exactEquals$1(y,this._camera.position)||(this._setCameraPosition(y),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,h=new Cy;return h.position=new f.MercatorCoordinate(c[0],c[1],c[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(c){if(!f.length$1(c))return!1;f.normalize$1(c,c);const h=f.transformQuat([],[0,0,-1],c),y=f.transformQuat([],[0,-1,0],c);if(y[2]<0)return!1;const x=Zi(h,y);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(c){const h=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;c[2]=f.clamp(c[2],x/y,x/h),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,h,y){this._unmodified=!1,this._edgeInsets.interpolate(c,h,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const h=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(c){const h=[new f.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const y=this.pointCoordinate(new f.Point(0,0)),x=this.pointCoordinate(new f.Point(this.width,0)),C=this.pointCoordinate(new f.Point(this.width,this.height)),S=this.pointCoordinate(new f.Point(0,this.height)),M=Math.floor(Math.min(y.x,x.x,C.x,S.x)),k=Math.floor(Math.max(y.x,x.x,C.x,S.x)),L=1;for(let N=M-L;N<=k+L;N++)0!==N&&h.push(new f.UnwrappedTileID(N,c))}return h}coveringTiles(c){let h=this.coveringZoomLevel(c);const y=h,x=this.elevation&&!c.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==c.minzoom&&h<c.minzoom)return[];void 0!==c.maxzoom&&h>c.maxzoom&&(h=c.maxzoom);const S=this.locationCoordinate(this.center),M=this.center.lat,k=1<<h,L=[k*S.x,k*S.y,0],N="globe"===this.projection.name,V=!N,K=f.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,V),te=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),re=k*f.mercatorZfromAltitude(1,this.center.lat),ie=this._camera.position[2]/f.mercatorZfromAltitude(1,this.center.lat),se=[k*te.x,k*te.y,ie*(V?1:re)],U=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),J=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,de=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,he=c.isTerrainDEM?-de:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ce=this.projection.isReprojectedInTileSpace?ah(this):1,Se=Be=>{const ct=new f.MercatorCoordinate(Be.x+25e-6,Be.y,Be.z),tt=new f.MercatorCoordinate(Be.x,Be.y+25e-6,Be.z),dt=Be.toLngLat(),Tt=ct.toLngLat(),Ht=tt.toLngLat(),Mt=this.locationCoordinate(dt),Lt=this.locationCoordinate(Tt),Jt=this.locationCoordinate(Ht),wn=Math.hypot(Lt.x-Mt.x,Lt.y-Mt.y),Ot=Math.hypot(Jt.x-Mt.x,Jt.y-Mt.y);return Math.sqrt(wn*Ot)*Ce/25e-6},Ee=Be=>{const Ye=de,ct=he;return{aabb:f.tileAABB(this,k,0,0,0,Be,ct,Ye,this.projection),zoom:0,x:0,y:0,minZ:ct,maxZ:Ye,wrap:Be,fullyVisible:!1}},ce=[];let De=[];const _e=h,Ie=c.reparseOverscaled?y:h,Pe=Be=>Be*Be,Ke=Pe((ie-this._centerAltitude)*re),Ve=Be=>{if(!this._elevation||!Be.tileID||!C)return;const Ye=this._elevation.getMinMaxForTile(Be.tileID),ct=Be.aabb;Ye?(ct.min[2]=Ye.min,ct.max[2]=Ye.max,ct.center[2]=(ct.min[2]+ct.max[2])/2):(Be.shouldSplit=et(Be),Be.shouldSplit||(ct.min[2]=ct.max[2]=ct.center[2]=this._centerAltitude))},et=Be=>{if(Be.zoom<J)return!0;if(Be.zoom===_e)return!1;if(null!=Be.shouldSplit)return Be.shouldSplit;const Ye=Be.aabb.distanceX(se),ct=Be.aabb.distanceY(se);let tt=Ke,dt=1;if(N){tt=Pe(Be.aabb.distanceZ(se));const Mt=Math.pow(2,Be.zoom),Lt=f.latFromMercatorY((Be.y+1)/Mt),Jt=f.latFromMercatorY(Be.y/Mt),wn=Math.min(Math.max(M,Lt),Jt),Ot=f.circumferenceAtLatitude(wn)/f.circumferenceAtLatitude(M);if(dt=wn===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ot/this._mercatorScaleRatio),this.zoom<=f.GLOBE_ZOOM_THRESHOLD_MIN&&Be.zoom===_e-1&&Ot>=.9)return!0}else if(x&&(tt=Pe(Be.aabb.distanceZ(se)*re)),this.projection.isReprojectedInTileSpace&&y<=5){const Mt=Math.pow(2,Be.zoom),Lt=Se(new f.MercatorCoordinate((Be.x+.5)/Mt,(Be.y+.5)/Mt));dt=Lt>.85?1:Lt}const Tt=Ye*Ye+ct*ct+tt;return Tt<Pe((1<<_e-Be.zoom)*U*dt*((Mt,Lt)=>{if(Lt*Pe(.707)<Mt)return 1;const Jt=Math.sqrt(Lt/Mt);return Jt/(1.4144271570014144+(Math.pow(1.1,Jt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(tt,Ke),Tt))};if(this.renderWorldCopies)for(let Be=1;Be<=3;Be++)ce.push(Ee(-Be)),ce.push(Ee(Be));for(ce.push(Ee(0));ce.length>0;){const Be=ce.pop(),Ye=Be.x,ct=Be.y;let tt=Be.fullyVisible;if(!tt){const dt=Be.aabb.intersects(K);if(0===dt)continue;tt=2===dt}if(Be.zoom!==_e&&et(Be))for(let dt=0;dt<4;dt++){const Tt=(Ye<<1)+dt%2,Ht=(ct<<1)+(dt>>1),Mt={aabb:C?Be.aabb.quadrant(dt):f.tileAABB(this,k,Be.zoom+1,Tt,Ht,Be.wrap,Be.minZ,Be.maxZ,this.projection),zoom:Be.zoom+1,x:Tt,y:Ht,wrap:Be.wrap,fullyVisible:tt,tileID:void 0,shouldSplit:void 0,minZ:Be.minZ,maxZ:Be.maxZ};x&&!N&&(Mt.tileID=new f.OverscaledTileID(Be.zoom+1===_e?Ie:Be.zoom+1,Be.wrap,Be.zoom+1,Tt,Ht),Ve(Mt)),ce.push(Mt)}else{const dt=Be.zoom===_e?Ie:Be.zoom;if(c.minzoom&&c.minzoom>dt)continue;const Tt=L[0]-(.5+Ye+(Be.wrap<<Be.zoom))*(1<<h-Be.zoom),Ht=L[1]-.5-ct,Mt=Be.tileID?Be.tileID:new f.OverscaledTileID(dt,Be.wrap,Be.zoom,Ye,ct);De.push({tileID:Mt,distanceSq:Tt*Tt+Ht*Ht})}}if(this.fogCullDistSq){const Be=this.fogCullDistSq,Ye=this.horizonLineFromTop();De=De.filter(ct=>{const tt=[0,0,0,1],dt=[f.EXTENT,f.EXTENT,0,1],Tt=this.calculateFogTileMatrix(ct.tileID.toUnwrapped());f.transformMat4$1(tt,tt,Tt),f.transformMat4$1(dt,dt,Tt);const Ht=f.getAABBPointSquareDist(tt,dt);if(0===Ht)return!0;let Mt=!1;const Lt=this._elevation;if(Lt&&Ht>Be&&0!==Ye){const Jt=this.calculateProjMatrix(ct.tileID.toUnwrapped());let wn;c.isTerrainDEM||(wn=Lt.getMinMaxForTile(ct.tileID)),wn||(wn={min:he,max:de});const Ot=f.furthestTileCorner(this.rotation),Wn=[Ot[0]*f.EXTENT,Ot[1]*f.EXTENT,wn.max];f.transformMat4(Wn,Wn,Jt),Mt=(1-Wn[1])*this.height*.5<Ye}return Ht<Be||Mt})}return De.sort((Be,Ye)=>Be.distanceSq-Ye.distanceSq).map(Be=>Be.tileID)}resize(c,h){this.width=c,this.height=h,this.pixelsToGLUnits=[2/c,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const h=f.clamp(c.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),y=this.projection.project(c.lng,h);return new f.Point(y.x*this.worldSize,y.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/f.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,h){let y,x;const C=this.centerPoint;if("globe"===this.projection.name){const M=this.worldSize;y=(h.x-C.x)/M,x=(h.y-C.y)/M}else{const M=this.pointCoordinate(h),k=this.pointCoordinate(C);y=M.x-k.x,x=M.y-k.y}const S=this.locationCoordinate(c);this.setLocation(new f.MercatorCoordinate(S.x-y,S.y-x))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,h){const y=h?f.mercatorZfromAltitude(h,c.lat):void 0,x=this.projection.project(c.lng,c.lat);return new f.MercatorCoordinate(x.x,x.y,y)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,h){const y=h??this._centerAltitude,x=[c.x,c.y,0,1],C=[c.x,c.y,1,1];f.transformMat4$1(x,x,this.pixelMatrixInverse),f.transformMat4$1(C,C,this.pixelMatrixInverse);const S=C[3];f.scale$1(x,x,1/x[3]),f.scale$1(C,C,1/S);const M=x[2],k=C[2];return{p0:x,p1:C,t:M===k?0:(y-M)/(k-M)}}screenPointToMercatorRay(c){const h=[c.x,c.y,0,1],y=[c.x,c.y,1,1];return f.transformMat4$1(h,h,this.pixelMatrixInverse),f.transformMat4$1(y,y,this.pixelMatrixInverse),f.scale$1(h,h,1/h[3]),f.scale$1(y,y,1/y[3]),h[2]=f.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,y[2]=f.mercatorZfromAltitude(y[2],this._center.lat)*this.worldSize,f.scale$1(h,h,1/this.worldSize),f.scale$1(y,y,1/this.worldSize),new f.Ray([h[0],h[1],h[2]],f.normalize([],f.sub([],y,h)))}rayIntersectionCoordinate(c){const{p0:h,p1:y,t:x}=c,C=f.mercatorZfromAltitude(h[2],this._center.lat),S=f.mercatorZfromAltitude(y[2],this._center.lat);return new f.MercatorCoordinate(f.number(h[0],y[0],x)/this.worldSize,f.number(h[1],y[1],x)/this.worldSize,f.number(C,S,x))}pointCoordinate(c,h=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,h)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let h=this.projection.pointCoordinate3D(this,c.x,c.y);if(h)return new f.MercatorCoordinate(h[0],h[1],h[2]);let y=0,x=this.horizonLineFromTop();if(c.y>x)return this.pointCoordinate(c);const C=.02*x,S=c.clone();for(let M=0;M<10&&x-y>C;M++){S.y=f.number(y,x,.66);const k=this.projection.pointCoordinate3D(this,S.x,S.y);k?(x=S.y,h=k):y=S.y}return h?new f.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=f.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(c);const h=this.pointCoordinate(c);return h.y>=0&&h.y<=1}_coordinatePoint(c,h){const y=h&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,x=[c.x*this.worldSize,c.y*this.worldSize,y+c.toAltitude(),1];return f.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new f.Point(x[0]/x[3],x[1]/x[3]):new f.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:h}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,C=this.pointLocation3D(new f.Point(h,c)),S=this.pointLocation3D(new f.Point(x,c)),M=this.pointLocation3D(new f.Point(x,y)),k=this.pointLocation3D(new f.Point(h,y));let L=Math.min(C.lng,S.lng,M.lng,k.lng),N=Math.max(C.lng,S.lng,M.lng,k.lng),V=Math.min(C.lat,S.lat,M.lat,k.lat),K=Math.max(C.lat,S.lat,M.lat,k.lat);const te=Math.pow(2,-this.zoom)/16*270,re="globe"===this.projection.name?1:4,ie=(se,U,J,de,he)=>{const Ce=(se+J)/2,Se=(U+de)/2,Ee=new f.Point(Ce,Se),{lng:ce,lat:De}=this.pointLocation3D(Ee),_e=Math.max(0,L-ce,V-De,ce-N,De-K);L=Math.min(L,ce),N=Math.max(N,ce),V=Math.min(V,De),K=Math.max(K,De),(he<re||_e>te)&&(ie(se,U,Ce,Se,he+1),ie(Ce,Se,J,de,he+1))};if(ie(h,c,x,c,1),ie(x,c,x,y,1),ie(x,y,h,y,1),ie(h,y,h,c,1),"globe"===this.projection.name){const[se,U]=f.polesInViewport(this);se?(K=90,N=180,L=-180):U&&(V=-90,N=180,L=-180)}return new f.LngLatBounds(new f.LngLat(L,V),new f.LngLat(N,K))}_getBoundsRectangular(c,h){const{top:y,left:x}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,M=new f.Point(x,y),k=new f.Point(S,y),L=new f.Point(S,C),N=new f.Point(x,C);let V=this.pointCoordinate(M,c),K=this.pointCoordinate(k,c);const te=this.pointCoordinate(L,h),re=this.pointCoordinate(N,h),ie=(se,U)=>(U.y-se.y)/(U.x-se.x);return V.y>1&&K.y>=0?V=new f.MercatorCoordinate((1-re.y)/ie(re,V)+re.x,1):V.y<0&&K.y<=1&&(V=new f.MercatorCoordinate(-re.y/ie(re,V)+re.x,0)),K.y>1&&V.y>=0?K=new f.MercatorCoordinate((1-te.y)/ie(te,K)+te.x,1):K.y<0&&V.y<=1&&(K=new f.MercatorCoordinate(-te.y/ie(te,K)+te.x,0)),(new f.LngLatBounds).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(re)).extend(this.coordinateLocation(te))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=c.visibleDemTiles.reduce((y,x)=>{if(x.dem){const C=x.dem.tree;y.min=Math.min(y.min,C.minimums[0]),y.max=Math.max(y.max,C.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*c.exaggeration(),h.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,y=this.height/2-h*(1-this._horizonShift);return c?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-f.MAX_MERCATOR_LATITUDE,this.maxLat=f.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=f.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=f.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=f.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=f.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,h){return this.projection.createTileMatrix(this,h,c)}calculateDistanceTileData(c){const h=c.key,y=this._distanceTileDataCache;if(y[h])return y[h];const x=c.canonical,C=1/this.height,S=this.cameraWorldSize,M=S/this.zoomScale(x.z),k=(x.x+Math.pow(2,x.z)*c.wrap)*M,L=x.y*M,N=this.point;N.x*=S/this.worldSize,N.y*=S/this.worldSize;const V=this.angle,K=Math.sin(-V),te=-Math.cos(-V);return y[h]={bearing:[K,te],center:[(N.x-k)*C,(N.y-L)*C],scale:M/f.EXTENT*C},y[h]}calculateFogTileMatrix(c){const h=c.key,y=this._fogTileMatrixCache;if(y[h])return y[h];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return f.multiply(x,this.worldToFogMatrix,x),y[h]=new Float32Array(x),y[h]}calculateProjMatrix(c,h=!1){const y=c.key,x=h?this._alignedProjMatrixCache:this._projMatrixCache;if(x[y])return x[y];const C=this.calculatePosMatrix(c,this.worldSize);return f.multiply(C,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,C),x[y]=new Float32Array(C),x[y]}calculatePixelsToTileUnitsMatrix(c){const h=c.tileID.key,y=this._pixelsToTileUnitsCache;if(y[h])return y[h];const x=function(C,S){const{scale:M}=C.tileTransform,k=M*f.EXTENT/(C.tileSize*Math.pow(2,S.zoom-C.tileID.overscaledZ+C.tileID.canonical.z));return L=new Float32Array(4),K=(N=S.inverseAdjustmentMatrix)[1],te=N[2],re=N[3],se=(V=[k,k])[1],L[0]=N[0]*(ie=V[0]),L[1]=K*ie,L[2]=te*se,L[3]=re*se,L;var L,N,V,K,te,re,ie,se}(c,this);return y[h]=x,y[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,h=f.fromScaling([],[c,c,c]);return f.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const h=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(h),x=this._camera.forward(),C=f.mercatorZfromAltitude(1,this._center.lat);y[2]/=C,x[2]/=C,f.normalize(x,x);const S=c.raycast(y,x,c.exaggeration());if(S){const M=f.scaleAndAdd([],y,x,S),k=new f.MercatorCoordinate(M[0],M[1],f.mercatorZfromAltitude(M[2],f.latFromMercatorY(M[1]))),L=(k.z+f.length([k.x-y[0],k.y-y[1],k.z-y[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const h=this._elevation,y=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(y),C=h.getAtPointOrZero(new f.MercatorCoordinate(...x)),S=this.pixelsPerMeter/this.worldSize*C,M=this._minimumHeightOverTerrain(),k=x[2]-S;if(k<=M)if(k<0||c){const L=this.locationCoordinate(this._center,this._centerAltitude),N=[x[0],x[1],L.z-x[2]],V=f.length(N);N[2]-=(M-k)/this._pixelsPerMercatorPixel;const K=f.length(N);if(0===K)return;f.scale$2(N,N,V/K*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],L.z*this._pixelsPerMercatorPixel-N[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const K=this.center;return K.lat=f.clamp(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(K.lng=f.clamp(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const h=this._unmodified,{x:y,y:x}=this.point;let C=0,S=y,M=x;const k=this.width/2,L=this.height/2,N=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(x-L<N&&(M=N+L),x+L>V&&(M=V-L),V-N<this.height&&(C=Math.max(C,this.height/(V-N)),M=(V+N)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,te=this.worldMaxX*this.scale,re=this.worldSize/2-(K+te)/2;S=(y+re+this.worldSize)%this.worldSize-re,S-k<K&&(S=K+k),S+k>te&&(S=te-k),te-K<this.width&&(C=Math.max(C,this.width/(te-K)),S=(te+K)/2)}S===y&&M===x||(this.center=this.unproject(new f.Point(S,M))),C&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,h=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=f.mercatorZfromAltitude(1,this.center.lat)/f.mercatorZfromAltitude(1,f.GLOBE_SCALE_MATCH_LATITUDE));const y=ea(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x="meters"===this.projection.zAxisUnit?h:1,C=this._camera.getWorldToCamera(this.worldSize,x),S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);S[8]=2*-c.x/this.width,S[9]=2*c.y/this.height;let M=f.mul([],S,C);if(this.projection.isReprojectedInTileSpace){const Se=this.locationCoordinate(this.center),Ee=f.identity([]);f.translate(Ee,Ee,[Se.x*this.worldSize,Se.y*this.worldSize,0]),f.multiply(Ee,Ee,ur(this)),f.translate(Ee,Ee,[-Se.x*this.worldSize,-Se.y*this.worldSize,0]),f.multiply(M,M,Ee),this.inverseAdjustmentMatrix=function(ce){const De=ur(ce,!0);return ot([],[De[0],De[1],De[4],De[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=f.scale([],M,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=M,this.invProjMatrix=f.invert(new Float64Array(16),this.projMatrix);const k=f.invert([],S);this.frustumCorners=f.FrustumCorners.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height);const L=new Float32Array(16);f.identity(L),f.scale(L,L,[1,-1,1]),f.rotateX(L,L,this._pitch),f.rotateZ(L,L,this.angle);const N=f.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),V=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-c.x/this.width,N[9]=2*(c.y+V)/this.height,this.skyboxMatrix=f.multiply(L,N,L);const K=this.point,te=K.x,re=K.y,ie=this.width%2/2,se=this.height%2/2,U=Math.cos(this.angle),J=Math.sin(this.angle),de=te-Math.round(te)+U*ie+J*se,he=re-Math.round(re)+U*se+J*ie,Ce=new Float64Array(M);if(f.translate(Ce,Ce,[de>.5?de-1:de,he>.5?he-1:he,0]),this.alignedProjMatrix=Ce,M=f.create(),f.scale(M,M,[this.width/2,-this.height/2,1]),f.translate(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=f.create(),f.scale(M,M,[1,-1,1]),f.translate(M,M,[-1,-1,0]),f.scale(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=f.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},M=f.invert(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=f.calculateGlobeMatrix(this);const Se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=f.transformMat4(Se,Se,C),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,y=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,C=[c,c,h];f.scale$2(C,C,x),f.scale$2(y,y,-1),f.multiply$2(y,y,C);const S=f.create();f.translate(S,S,y),f.scale(S,S,C),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,h,x)}_computeCameraPosition(c){const h=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),x=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-c/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-y[0]*C,x.y/this.worldSize-y[1]*C,c/this.worldSize*this._centerAltitude-y[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],x=c[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(C=Math.min((h-y)/x,1)),this._camera.position=f.scaleAndAdd([],this._camera.position,c,C),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,h=this._camera.forward(),{pitch:y,bearing:x}=this._camera.getPitchBearing(),C=f.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(f.degToRad(this._maxPitch)),M=Math.max((c[2]-C)/Math.cos(y),S),k=this._zoomFromMercatorZ(M);f.scaleAndAdd(c,c,h,M),this._pitch=f.clamp(y,f.degToRad(this.minPitch),f.degToRad(this.maxPitch)),this.angle=f.wrap(x,-Math.PI,Math.PI),this._setZoom(f.clamp(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new f.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let h=0,y=f.GLOBE_ZOOM_THRESHOLD_MAX,x=0,C=1/0;for(;y-h>1e-6&&y>h;){const S=h+.5*(y-h),M=this.tileSize*Math.pow(2,S),k=this.getCameraToCenterDistance(this.projection,S,M),L=this.scaleZoom(k/(c*this.tileSize)),N=Math.abs(S-L);N<C&&(C=N,x=S),S<L?h=S:y=S}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(f.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,h){const y=Math.min(c.x,h.x),x=Math.max(c.x,h.x),C=Math.min(c.y,h.y),S=Math.max(c.y,h.y);if(C<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const M=[new f.Point(y,C),new f.Point(x,S),new f.Point(y,S),new f.Point(x,C)],k=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const N of M){const V=this.pointRayIntersection(N);if(V.t<0)return!0;const K=this.rayIntersectionCoordinate(V);if(K.x<k||K.y<0||K.x>L||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+f.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new f.Point(0,0),new f.Point(this.width,this.height))}zoomDeltaToMovement(c,h){const y=f.length(f.sub([],this._camera.position,c)),x=this._zoomFromMercatorZ(y)+h;return y-this._mercatorZfromZoom(x)}getCameraPoint(){if("globe"===this.projection.name){const c=function([h,y,x],C){const S=[h,y,x,1];f.transformMat4$1(S,S,C);const M=S[3]=Math.max(S[3],1e-6);return S[0]/=M,S[1]/=M,S[2]/=M,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new f.Point(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.Point(0,c))}}getCameraToCenterDistance(c,h=this.zoom,y=this.worldSize){const x=ea(c,h,this.width,this.height,1024),C=c.pixelSpaceConversion(this.center.lat,y,x);return.5/Math.tan(.5*this._fov)*this.height*C}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&f.multiply(c,c,this.globeMatrix),c}}function ad(_,c){let h=!1,y=null;const x=()=>{y=null,h&&(_(),y=setTimeout(x,c),h=!1)};return()=>(h=!0,y||x(),y)}class Km{constructor(c){this._hashName=c&&encodeURIComponent(c),f.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ad(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,f.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),f.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const h=Wd(c);if(this._hashName){const y=this._hashName;let x=!1;const C=f.window.location.hash.slice(1).split("&").map(S=>{const M=S.split("=")[0];return M===y?(x=!0,`${M}=${h}`):S}).filter(S=>S);return x||C.push(`${y}=${h}`),`#${C.join("&")}`}return`#${h}`}_getCurrentHash(){const c=f.window.location.hash.replace("#","");if(this._hashName){let h;return c.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(h=y)}),(h&&h[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(y=>isNaN(y))){const y=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(h[3]||0):c.getBearing();return c.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:y,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=f.window.location.href.replace(/(#.+)?$/,this.getHashString());f.window.history.replaceState(f.window.history.state,null,c)}}function Wd(_,c){const h=_.getCenter(),y=Math.round(100*_.getZoom())/100,x=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,x),S=Math.round(h.lng*C)/C,M=Math.round(h.lat*C)/C,k=_.getBearing(),L=_.getPitch();let N=c?`/${S}/${M}/${y}`:`${y}/${M}/${S}`;return(k||L)&&(N+="/"+Math.round(10*k)/10),L&&(N+=`/${Math.round(L)}`),N}const Zd={linearity:.3,easing:f.bezier(0,0,.3,1)},zp=f.extend({deceleration:2500,maxSpeed:1400},Zd),Vp=f.extend({deceleration:20,maxSpeed:1400},Zd),Dt=f.extend({deceleration:1e3,maxSpeed:360},Zd),ta=f.extend({deceleration:1e3,maxSpeed:90},Zd);class Dy{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:f.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,h=f.exported.now();for(;c.length>0&&h-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new f.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)h.zoom+=C.zoomDelta||0,h.bearing+=C.bearingDelta||0,h.pitch+=C.pitchDelta||0,C.panDelta&&h.pan._add(C.panDelta),C.around&&(h.around=C.around),C.pinchAround&&(h.pinchAround=C.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(h.pan.mag()){const C=ch(h.pan.mag(),y,f.extend({},zp,c||{}));x.offset=h.pan.mult(C.amount/h.pan.mag()),x.center=this._map.transform.center,lh(x,C)}if(h.zoom){const C=ch(h.zoom,y,Vp);x.zoom=this._map.transform.zoom+C.amount,lh(x,C)}if(h.bearing){const C=ch(h.bearing,y,Dt);x.bearing=this._map.transform.bearing+f.clamp(C.amount,-179,179),lh(x,C)}if(h.pitch){const C=ch(h.pitch,y,ta);x.pitch=this._map.transform.pitch+C.amount,lh(x,C)}if(x.zoom||x.bearing){const C=void 0===h.pinchAround?h.around:h.pinchAround;x.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function lh(_,c){(!_.duration||_.duration<c.duration)&&(_.duration=c.duration,_.easing=c.easing)}function ch(_,c,h){const{maxSpeed:y,linearity:x,deceleration:C}=h,S=f.clamp(_*x/(c/1e3),-y,y),M=Math.abs(S)/(C*x);return{easing:h.easing,duration:1e3*M,amount:S*(M/2)}}class Ir extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,y,x={}){const C=oo(h.getCanvasContainer(),y),S=h.unproject(C);super(c,f.extend({point:C,lngLat:S,originalEvent:y},x)),this._defaultPrevented=!1,this.target=h}}class dh extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,y){const x="touchend"===c?y.changedTouches:y.touches,C=Us(h.getCanvasContainer(),x),S=C.map(k=>h.unproject(k)),M=C.reduce((k,L,N,V)=>k.add(L.div(V.length)),new f.Point(0,0));super(c,{points:C,point:M,lngLats:S,lngLat:h.unproject(M),originalEvent:y}),this._defaultPrevented=!1}}class jp extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,y){super(c,{originalEvent:y}),this._defaultPrevented=!1}}class Qm{constructor(c,h){this._map=c,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new jp(c.type,this._map,c))}mousedown(c,h){return this._mousedownPos=h,this._firePreventable(new Ir(c.type,this._map,c))}mouseup(c){this._map.fire(new Ir(c.type,this._map,c))}preclick(c){const h=f.extend({},c);h.type="preclick",this._map.fire(new Ir(h.type,this._map,h))}click(c,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(c),this._map.fire(new Ir(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new Ir(c.type,this._map,c))}mouseover(c){this._map.fire(new Ir(c.type,this._map,c))}mouseout(c){this._map.fire(new Ir(c.type,this._map,c))}touchstart(c){return this._firePreventable(new dh(c.type,this._map,c))}touchmove(c){this._map.fire(new dh(c.type,this._map,c))}touchend(c){this._map.fire(new dh(c.type,this._map,c))}touchcancel(c){this._map.fire(new dh(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Up{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new Ir(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ir("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Ir(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $p{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,h){this.isEnabled()&&c.shiftKey&&0===c.button&&(Gn(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(c,h){if(!this._active)return;const y=h,x=this._startPos,C=this._lastPos;if(!x||!C||C.equals(y)||!this._box&&y.dist(x)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=yn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const S=Math.min(x.x,y.x),M=Math.max(x.x,y.x),k=Math.min(x.y,y.y),L=Math.max(x.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${k}px)`,this._box.style.width=M-S+"px",this._box.style.height=L-k+"px")})}mouseupWindow(c,h){if(!this._active)return;const y=this._startPos,x=h;if(y&&0===c.button){if(this.reset(),Gc(),y.x!==x.x||y.y!==x.y)return this._map.fire(new f.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:C=>C.fitScreenCoordinates(y,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Wl(),delete this._startPos,delete this._lastPos}_fireEvent(c,h){return this._map.fire(new f.Event(c,{originalEvent:h}))}}function Yd(_,c){const h={};for(let y=0;y<_.length;y++)h[_[y].identifier]=c[y];return h}class Xd{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,h,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),y.length===this.numTouches&&(this.centroid=function(x){const C=new f.Point(0,0);for(const S of x)C._add(S);return C.div(x.length)}(h),this.touches=Yd(y,h)))}touchmove(c,h,y){if(this.aborted||!this.centroid)return;const x=Yd(y,h);for(const C in this.touches){const S=x[C];(!S||S.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(c,h,y){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===y.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Jm{constructor(c){this.singleTap=new Xd(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,h,y){this.singleTap.touchstart(c,h,y)}touchmove(c,h,y){this.singleTap.touchmove(c,h,y)}touchend(c,h,y){const x=this.singleTap.touchend(c,h,y);if(x){const C=c.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(x)<30;if(C&&S||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class lb{constructor(){this._zoomIn=new Jm({numTouches:1,numTaps:2}),this._zoomOut=new Jm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,h,y){this._zoomIn.touchstart(c,h,y),this._zoomOut.touchstart(c,h,y)}touchmove(c,h,y){this._zoomIn.touchmove(c,h,y),this._zoomOut.touchmove(c,h,y)}touchend(c,h,y){const x=this._zoomIn.touchend(c,h,y),C=this._zoomOut.touchend(c,h,y);return x?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(x)},{originalEvent:c})}):C?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(C)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const _l={0:1,2:2};class dc{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,h){return!1}_move(c,h){return{}}mousedown(c,h){if(this._lastPoint)return;const y=Zl(c);this._correctButton(c,y)&&(this._lastPoint=h,this._eventButton=y)}mousemoveWindow(c,h){const y=this._lastPoint;if(y)if(c.preventDefault(),null!=this._eventButton&&function(x,C){const S=_l[C];return void 0===x.buttons||(x.buttons&S)!==S}(c,this._eventButton))this.reset();else if(this._moved||!(h.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(y,h)}mouseupWindow(c){this._lastPoint&&Zl(c)===this._eventButton&&(this._moved&&Gc(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class e_ extends dc{mousedown(c,h){super.mousedown(c,h),this._lastPoint&&(this._active=!0)}_correctButton(c,h){return 0===h&&!c.ctrlKey}_move(c,h){return{around:h,panDelta:h.sub(c)}}}class Kd extends dc{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const y=.8*(h.x-c.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(c){c.preventDefault()}}class uh extends dc{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const y=-.5*(h.y-c.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(c){c.preventDefault()}}class hh{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),f.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new f.Point(0,0)}touchstart(c,h,y){return this._calculateTransform(c,h,y)}touchmove(c,h,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===y.length&&!f.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,h,y)}}touchend(c,h,y){this._calculateTransform(c,h,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,h,y){y.length>0&&(this._active=!0);const x=Yd(y,h),C=new f.Point(0,0),S=new f.Point(0,0);let M=0;for(const L in x){const N=x[L],V=this._touches[L];V&&(C._add(N),S._add(N.sub(V)),M++,x[L]=N)}if(this._touches=x,M<this._minTouches||!S.mag())return;const k=S.div(M);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(M),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=yn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Qd{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,h,y){return{}}touchstart(c,h,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([h[0],h[1]]))}touchmove(c,h,y){const x=this._firstTwoTouches;if(!x)return;c.preventDefault();const[C,S]=x,M=Jd(y,h,C),k=Jd(y,h,S);if(!M||!k)return;const L=this._aroundCenter?null:M.add(k).div(2);return this._move([M,k],L,c)}touchend(c,h,y){if(!this._firstTwoTouches)return;const[x,C]=this._firstTwoTouches,S=Jd(y,h,x),M=Jd(y,h,C);S&&M||(this._active&&Gc(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Jd(_,c,h){for(let y=0;y<_.length;y++)if(_[y].identifier===h)return c[y]}function t_(_,c){return Math.log(_/c)/Math.LN2}class n_ extends Qd{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,h){const y=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(t_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:t_(this._distance,y),pinchAround:h}}}function is(_,c){return 180*_.angleWith(c)/Math.PI}class eu extends Qd{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,h){const y=this._vector;if(this._vector=c[0].sub(c[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:is(this._vector,y),pinchAround:h}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const h=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const x=is(c,y);return Math.abs(x)<h}}function Mi(_){return Math.abs(_.y)>Math.abs(_.x)}class Hp extends Qd{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,Mi(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,h,y){const x=this._lastPoints;if(!x)return;const C=c[0].sub(x[0]),S=c[1].sub(x[1]);return this._map._cooperativeGestures&&!f.isFullscreen()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(C,S,y.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(C.y+S.y)/2*-.5})}gestureBeginsVertically(c,h,y){if(void 0!==this._valid)return this._valid;const x=c.mag()>=2,C=h.mag()>=2;if(!x&&!C)return;if(!x||!C)return null==this._firstMove&&(this._firstMove=y),y-this._firstMove<100&&void 0;const S=c.y>0==h.y>0;return Mi(c)&&Mi(h)&&S}}const Ey={panStep:100,bearingStep:15,pitchStep:10};class Gp{constructor(){const c=Ey;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let h=0,y=0,x=0,C=0,S=0;switch(c.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:c.shiftKey?y=-1:(c.preventDefault(),C=-1);break;case 39:c.shiftKey?y=1:(c.preventDefault(),C=1);break;case 38:c.shiftKey?x=1:(c.preventDefault(),S=-1);break;case 40:c.shiftKey?x=-1:(c.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(y=0,x=0),{cameraAnimation:M=>{const k=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:ph,zoom:h?Math.round(k)+h*(c.shiftKey?2:1):k,bearing:M.getBearing()+y*this._bearingStep,pitch:M.getPitch()+x*this._pitchStep,offset:[-C*this._panStep,-S*this._panStep],center:M.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ph(_){return _*(2-_)}const ld=4.000244140625;class i_{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,f.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||f.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=c.deltaMode===f.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const y=f.exported.now(),x=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,0!==h&&h%ld==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(x*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),c.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=c,this._delta-=h,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=oo(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const k="wheel"===this._type&&Math.abs(this._delta)>ld?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&0!==L&&(L=1/L);const N=h(),V=Math.pow(2,N),K="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(K*L))),"wheel"===this._type&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._delta=0}const y="number"==typeof this._targetZoom?this._targetZoom:h(),x=this._startZoom,C=this._easing;let S,M=!1;if("wheel"===this._type&&x&&C){const k=Math.min((f.exported.now()-this._lastWheelEventTime)/200,1),L=C(k);S=f.number(x,y,L),k<1?this._frameId||(this._frameId=!0):M=!0}else S=y,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:S-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let h=f.ease;if(this._prevEase){const y=this._prevEase,x=(f.exported.now()-y.start)/y.duration,C=y.easing(x+.01)-y.easing(x),S=.27/Math.sqrt(C*C+1e-4)*.01,M=Math.sqrt(.0729-S*S);h=f.bezier(S,M,.25,1)}return this._prevEase={start:f.exported.now(),duration:c,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=yn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(f.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Ty{constructor(c,h){this._clickZoom=c,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,h){return c.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(c.shiftKey?-1:1),around:y.unproject(h)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qp{constructor(){this._tap=new Jm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,h,y){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=h[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(c,h,y))}touchmove(c,h,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const x=h[0],C=x.y-this._swipePoint.y;return this._swipePoint=x,c.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(c,h,y)}touchend(c,h,y){this._tapTime?this._swipePoint&&0===y.length&&this.reset():this._tap.touchend(c,h,y)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class r_{constructor(c,h,y){this._el=c,this._mousePan=h,this._touchPan=y}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fh{constructor(c,h,y){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=h,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Sy{constructor(c,h,y,x){this._el=c,this._touchZoom=h,this._touchRotate=y,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Cs=_=>_.zoom||_.drag||_.pitch||_.rotate;class My extends f.Event{}class o_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,h){const y=f.sub([],h,c);this.radius=f.length(y[2]<0?f.div([],y,this.constants):[y[0],y[1],0])}projectRay(c){f.div(c,c,this.constants),f.normalize(c,c),f.mul$1(c,c,this.constants);const h=f.scale$2([],c,this.radius);if(h[2]>0){const y=f.scale$2([],[0,0,1],f.dot(h,[0,0,1])),x=f.scale$2([],f.normalize([],[h[0],h[1],0]),this.radius),C=f.add([],h,f.scale$2([],f.sub([],f.add([],x,y),h),2));h[0]=C[0],h[1]=C[1]}return h}}function rs(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class na{constructor(c,h){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Dy(c),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new o_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),f.bindAll(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[f.window.document,"mousemove",{capture:!0}],[f.window.document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[f.window,"blur",void 0]];for(const[x,C,S]of this._listeners)x.addEventListener(C,x===f.window.document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[c,h,y]of this._listeners)c.removeEventListener(h,c===f.window.document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(c){const h=this._map,y=h.getCanvasContainer();this._add("mapEvent",new Qm(h,c));const x=h.boxZoom=new $p(h,c);this._add("boxZoom",x);const C=new lb,S=new Rr;h.doubleClickZoom=new Ty(S,C),this._add("tapZoom",C),this._add("clickZoom",S);const M=new qp;this._add("tapDragZoom",M);const k=h.touchPitch=new Hp(h);this._add("touchPitch",k);const L=new Kd(c),N=new uh(c);h.dragRotate=new fh(c,L,N),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const V=new e_(c),K=new hh(h,c);h.dragPan=new r_(y,V,K),this._add("mousePan",V),this._add("touchPan",K,["touchZoom","touchRotate"]);const te=new eu,re=new n_;h.touchZoomRotate=new Sy(y,re,te,M),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Up(h));const ie=h.scrollZoom=new i_(h,this);this._add("scrollZoom",ie,["mousePan"]);const se=h.keyboard=new Gp;this._add("keyboard",se);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[U]&&h[U].enable(c[U])}_add(c,h,y){this._handlers.push({handlerName:c,handler:h,allowed:y}),this._handlersById[c]=h}stop(c){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Cs(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,h,y){for(const x in c)if(x!==y&&(!h||h.indexOf(x)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const h=[];for(const y of c)this._el.contains(y.target)&&h.push(y);return h}handleEvent(c,h){this._updatingCamera=!0;const y="renderFrame"===c.type,x=y?void 0:c,C={needsRenderFrame:!1},S={},M={},k=c.touches?this._getMapTouches(c.touches):void 0,L=k?Us(this._el,k):y?void 0:oo(this._el,c);for(const{handlerName:K,handler:te,allowed:re}of this._handlers){if(!te.isEnabled())continue;let ie;this._blockedByActive(M,re,K)?te.reset():te[h||c.type]&&(ie=te[h||c.type](c,L,k),this.mergeHandlerResult(C,S,ie,K,x),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()),(ie||te.isActive())&&(M[K]=te)}const N={};for(const K in this._previousActiveHandlers)M[K]||(N[K]=x);this._previousActiveHandlers=M,(Object.keys(N).length||rs(C))&&(this._changes.push([C,S,N]),this._triggerRenderFrame()),(Object.keys(M).length||rs(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=C;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(c,h,y,x,C){if(!y)return;f.extend(c,y);const S={handlerName:x,originalEvent:y.originalEvent||C};void 0!==y.zoomDelta&&(h.zoom=S),void 0!==y.panDelta&&(h.drag=S),void 0!==y.pitchDelta&&(h.pitch=S),void 0!==y.bearingDelta&&(h.rotate=S)}_applyChanges(){const c={},h={},y={};for(const[x,C,S]of this._changes)x.panDelta&&(c.panDelta=(c.panDelta||new f.Point(0,0))._add(x.panDelta)),x.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(c.around=x.around),void 0!==x.aroundCoord&&(c.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(c.pinchAround=x.pinchAround),x.noInertia&&(c.noInertia=x.noInertia),f.extend(h,C),f.extend(y,S);this._updateMapTransform(c,h,y),this._changes=[]}_updateMapTransform(c,h,y){const x=this._map,C=x.transform,S=J=>[J.x,J.y,J.z];if((J=>{const de=this._eventsInProgress.drag;return de&&!this._handlersById[de.handlerName].isActive()})()&&!rs(c)){const J=C.zoom;C.cameraElevationReference="sea",C.recenterOnTerrain(),C.cameraElevationReference="ground",J!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&x._stop(!0),!rs(c))return void this._fireEvents(h,y,!0);let{panDelta:M,zoomDelta:k,bearingDelta:L,pitchDelta:N,around:V,aroundCoord:K,pinchAround:te}=c;C._isCameraConstrained&&(k>0&&(k=0),C._isCameraConstrained=!1),void 0!==te&&(V=te),(k||(J=>h[J]&&!this._eventsInProgress[J])("drag"))&&V&&(this._dragOrigin=S(C.pointCoordinate3D(V)),this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",x._stop(!0),V=V||x.transform.centerPoint,L&&(C.bearing+=L),N&&(C.pitch+=N),C._updateCameraState();const re=[0,0,0];if(M)if("mercator"===C.projection.name){const J=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(V).dir),de=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(V.sub(M)).dir);re[0]=de[0]-J[0],re[1]=de[1]-J[1]}else{const J=C.pointCoordinate(V);if("globe"===C.projection.name){M=M.rotate(-C.angle);const de=C._pixelsPerMercatorPixel/C.worldSize;re[0]=-M.x*f.mercatorScale(f.latFromMercatorY(J.y))*de,re[1]=-M.y*f.mercatorScale(C.center.lat)*de}else{const de=C.pointCoordinate(V.sub(M));J&&de&&(re[0]=de.x-J.x,re[1]=de.y-J.y)}}const ie=C.zoom,se=[0,0,0];if(k){const J=S(K||C.pointCoordinate3D(V)),de={dir:f.normalize([],f.sub([],J,C._camera.position))};if(de.dir[2]<0){const he=C.zoomDeltaToMovement(J,k);f.scale$2(se,de.dir,he)}}const U=f.add(re,re,se);C._translateCameraConstrained(U),k&&Math.abs(C.zoom-ie)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(h,y,!0)}_fireEvents(c,h,y){const x=Cs(this._eventsInProgress),C=Cs(c),S={};for(const N in c){const{originalEvent:V}=c[N];this._eventsInProgress[N]||(S[`${N}start`]=V),this._eventsInProgress[N]=c[N]}!x&&C&&this._fireEvent("movestart",C.originalEvent);for(const N in S)this._fireEvent(N,S[N]);C&&this._fireEvent("move",C.originalEvent);for(const N in c){const{originalEvent:V}=c[N];this._fireEvent(N,V)}const M={};let k;for(const N in this._eventsInProgress){const{handlerName:V,originalEvent:K}=this._eventsInProgress[N];this._handlersById[V].isActive()||(delete this._eventsInProgress[N],k=h[V]||K,M[`${N}end`]=k)}for(const N in M)this._fireEvent(N,M[N]);const L=Cs(this._eventsInProgress);if(y&&(x||C)&&!L){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=K=>0!==K&&-this._bearingSnap<K&&K<this._bearingSnap;N?(V(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:k})):(this._map.fire(new f.Event("moveend",{originalEvent:k})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,h){this._map.fire(new f.Event(c,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new My("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const uc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ci extends f.Evented{constructor(c,h){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=!1!==h.respectPrefersReducedMotion,f.bindAll(["_renderFrameCallback"],this)}getCenter(){return new f.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,h){return this.jumpTo({center:c},h)}panBy(c,h,y){return c=f.Point.convert(c).mult(-1),this.panTo(this.transform.center,f.extend({offset:c},h),y)}panTo(c,h,y){return this.easeTo(f.extend({center:c},h),y)}getZoom(){return this.transform.zoom}setZoom(c,h){return this.jumpTo({zoom:c},h),this}zoomTo(c,h,y){return this.easeTo(f.extend({zoom:c},h),y)}zoomIn(c,h){return this.zoomTo(this.getZoom()+1,c,h),this}zoomOut(c,h){return this.zoomTo(this.getZoom()-1,c,h),this}getBearing(){return this.transform.bearing}setBearing(c,h){return this.jumpTo({bearing:c},h),this}getPadding(){return this.transform.padding}setPadding(c,h){return this.jumpTo({padding:c},h),this}rotateTo(c,h,y){return this.easeTo(f.extend({bearing:c},h),y)}resetNorth(c,h){return this.rotateTo(0,f.extend({duration:1e3},c),h),this}resetNorthPitch(c,h){return this.easeTo(f.extend({bearing:0,pitch:0,duration:1e3},c),h),this}snapToNorth(c,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,h):this}getPitch(){return this.transform.pitch}setPitch(c,h){return this.jumpTo({pitch:c},h),this}cameraForBounds(c,h){c=f.LngLatBounds.convert(c);const y=h&&h.bearing||0,x=h&&h.pitch||0,C=c.getNorthWest(),S=c.getSouthEast();return this._cameraForBounds(this.transform,C,S,y,x,h)}_extendCameraOptions(c){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(c=f.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding){const y=c.padding;c.padding={top:y,bottom:y,right:y,left:y}}return c.padding=f.extend(h,c.padding),c}_minimumAABBFrustumDistance(c,h){const y=h.max[0]-h.min[0],x=h.max[1]-h.min[1];return y/x>c.aspect?y/(2*Math.tan(.5*c.fovX)*c.aspect):x/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,h,y,x,C,S){const M=c.clone(),k=this._extendCameraOptions(S);M.bearing=x,M.pitch=C;const L=f.LngLat.convert(h),N=f.LngLat.convert(y),V=.5*(L.lat+N.lat),K=.5*(L.lng+N.lng),te=f.latLngToECEF(V,K),re=f.normalize([],te),ie=f.normalize([],f.cross([],re,[0,1,0])),se=f.cross([],ie,re),U=[ie[0],ie[1],ie[2],0,se[0],se[1],se[2],0,re[0],re[1],re[2],0,0,0,0,1],J=[te,f.latLngToECEF(L.lat,L.lng),f.latLngToECEF(N.lat,L.lng),f.latLngToECEF(N.lat,N.lng),f.latLngToECEF(L.lat,N.lng),f.latLngToECEF(V,L.lng),f.latLngToECEF(V,N.lng),f.latLngToECEF(L.lat,K),f.latLngToECEF(N.lat,K)];let de=f.Aabb.fromPoints(J.map(tt=>[f.dot(ie,tt),f.dot(se,tt),f.dot(re,tt)]));const he=f.transformMat4([],de.center,U);0===f.squaredLength(he)&&f.set(he,0,0,1),f.normalize(he,he),f.scale$2(he,he,f.GLOBE_RADIUS),M.center=f.ecefToLatLng(he);const Ce=M.getWorldToCameraMatrix(),Se=f.invert(new Float64Array(16),Ce);de=f.Aabb.applyTransform(de,f.multiply([],Ce,U)),f.transformMat4(he,he,Ce);const Ee=.5*(de.max[2]-de.min[2]),ce=this._minimumAABBFrustumDistance(M,de),De=f.scale$2([],[0,0,1],Ee),_e=f.add(De,he,De),Ie=ce+(0===M.pitch?0:f.distance(he,_e)),Pe=M.globeCenterInViewSpace,Ke=f.sub([],he,[Pe[0],Pe[1],Pe[2]]);f.normalize(Ke,Ke),f.scale$2(Ke,Ke,Ie);const Ve=f.add([],he,Ke);f.transformMat4(Ve,Ve,Se);const et=f.earthRadius/f.GLOBE_RADIUS,Be=f.length(Ve),Ye=f.mercatorZfromAltitude(Math.max(Be*et-f.earthRadius,Number.EPSILON),0),ct=Math.min(M.zoomFromMercatorZAdjusted(Ye),k.maxZoom);return ct>.5*(f.GLOBE_ZOOM_THRESHOLD_MIN+f.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"mercator"}),M.zoom=ct,this._cameraForBounds(M,h,y,x,C,S)):{center:M.center,zoom:ct,bearing:x,pitch:C}}queryTerrainElevation(c,h){const y=this.transform.elevation;return y?(h=f.extend({},{exaggerated:!0},h),y.getAtPoint(f.MercatorCoordinate.fromLngLat(c),null,h.exaggerated)):null}_cameraForBounds(c,h,y,x,C,S){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,h,y,x,C,S);const M=c.clone(),k=this._extendCameraOptions(S),L=M.padding;M.bearing=x,M.pitch=C;const N=f.LngLat.convert(h),V=f.LngLat.convert(y),K=new f.LngLat(N.lng,V.lat),te=new f.LngLat(V.lng,N.lat),re=M.project(N),ie=M.project(V),se=this.queryTerrainElevation(N),U=this.queryTerrainElevation(V),J=this.queryTerrainElevation(K),de=this.queryTerrainElevation(te),he=[[re.x,re.y,Math.min(se||0,U||0,J||0,de||0)],[ie.x,ie.y,Math.max(se||0,U||0,J||0,de||0)]];let Ce=f.Aabb.fromPoints(he);const Se=M.getWorldToCameraMatrix(),Ee=f.invert(new Float64Array(16),Se);Ce=f.Aabb.applyTransform(Ce,Se);const ce=f.sub([],Ce.max,Ce.min),De=L.left||0,_e=L.right||0,Ie=L.bottom||0,Pe=L.top||0,{left:Ke,right:Ve,top:et,bottom:Be}=k.padding,Ye=.5*(De+_e),ct=.5*(Pe+Ie),tt=Math.min(M.scaleZoom(M.scale*Math.min((M.width-(De+_e+Ke+Ve))/ce[0],(M.height-(Ie+Pe+Be+et))/ce[1])),k.maxZoom),dt=M.scale/M.zoomScale(tt);Ce=new f.Aabb([Ce.min[0]-(Ke+Ye)*dt,Ce.min[1]-(Be+ct)*dt,Ce.min[2]],[Ce.max[0]+(Ve+Ye)*dt,Ce.max[1]+(et+ct)*dt,Ce.max[2]]);const Tt=.5*ce[2],Ht=this._minimumAABBFrustumDistance(M,Ce),Mt=[0,0,1,0];f.transformMat4$1(Mt,Mt,Se),f.normalize$2(Mt,Mt);const Lt=f.scale$2([],Mt,Ht+Tt),Jt=f.add([],Ce.center,Lt),wn=("number"==typeof k.offset.x&&"number"==typeof k.offset.y?new f.Point(k.offset.x,k.offset.y):f.Point.convert(k.offset)).rotate(-f.degToRad(x));Ce.center[0]-=wn.x*dt,Ce.center[1]+=wn.y*dt,f.transformMat4(Ce.center,Ce.center,Ee),f.transformMat4(Jt,Jt,Ee);const Ot=[Ce.center[0],Ce.center[1],Jt[2]*M.pixelsPerMeter];f.scale$2(Ot,Ot,1/M.worldSize);const Wn=f.lngFromMercatorX(Ot[0]),ni=f.latFromMercatorY(Ot[1]),Yn=Math.min(M._zoomFromMercatorZ(Ot[2]),k.maxZoom),Xn=new f.LngLat(Wn,ni);return M.mercatorFromTransition&&Yn<.5*(f.GLOBE_ZOOM_THRESHOLD_MIN+f.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"globe"}),M.zoom=Yn,this._cameraForBounds(M,h,y,x,C,S)):{center:Xn,zoom:Yn,bearing:x,pitch:C}}fitBounds(c,h,y){const x=this.cameraForBounds(c,h);return this._fitInternal(x,h,y)}fitScreenCoordinates(c,h,y,x,C){const S=f.Point.convert(c),M=f.Point.convert(h),k=new f.Point(Math.min(S.x,M.x),Math.min(S.y,M.y)),L=new f.Point(Math.max(S.x,M.x),Math.max(S.y,M.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(S,M))return this;const N=this.transform.pointLocation3D(k),V=this.transform.pointLocation3D(L),K=this.transform.pointLocation3D(new f.Point(k.x,L.y)),te=this.transform.pointLocation3D(new f.Point(L.x,k.y)),re=[Math.min(N.lng,V.lng,K.lng,te.lng),Math.min(N.lat,V.lat,K.lat,te.lat)],ie=[Math.max(N.lng,V.lng,K.lng,te.lng),Math.max(N.lat,V.lat,K.lat,te.lat)],se=x&&x.pitch?x.pitch:this.getPitch(),U=this._cameraForBounds(this.transform,re,ie,y,se,x);return this._fitInternal(U,x,C)}_fitInternal(c,h,y){return c?(delete(h=f.extend(c,h)).padding,h.linear?this.easeTo(h,y):this.flyTo(h,y)):this}jumpTo(c,h){this.stop();const y=c.preloadOnly?this.transform.clone():this.transform;let x=!1,C=!1,S=!1;return"zoom"in c&&y.zoom!==+c.zoom&&(x=!0,y.zoom=+c.zoom),void 0!==c.center&&(y.center=f.LngLat.convert(c.center)),"bearing"in c&&y.bearing!==+c.bearing&&(C=!0,y.bearing=+c.bearing),"pitch"in c&&y.pitch!==+c.pitch&&(S=!0,y.pitch=+c.pitch),null==c.padding||y.isPaddingEqual(c.padding)||(y.padding=c.padding),c.preloadOnly?(this._preloadTiles(y),this):(this.fire(new f.Event("movestart",h)).fire(new f.Event("move",h)),x&&this.fire(new f.Event("zoomstart",h)).fire(new f.Event("zoom",h)).fire(new f.Event("zoomend",h)),C&&this.fire(new f.Event("rotatestart",h)).fire(new f.Event("rotate",h)).fire(new f.Event("rotateend",h)),S&&this.fire(new f.Event("pitchstart",h)).fire(new f.Event("pitch",h)).fire(new f.Event("pitchend",h)),this.fire(new f.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||f.warnOnce(uc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,h){const y=this.transform;if(!y.projection.supportsFreeCamera)return f.warnOnce(uc),this;this.stop();const x=y.zoom,C=y.pitch,S=y.bearing;y.setFreeCameraOptions(c);const M=x!==y.zoom,k=C!==y.pitch,L=S!==y.bearing;return this.fire(new f.Event("movestart",h)).fire(new f.Event("move",h)),M&&this.fire(new f.Event("zoomstart",h)).fire(new f.Event("zoom",h)).fire(new f.Event("zoomend",h)),L&&this.fire(new f.Event("rotatestart",h)).fire(new f.Event("rotate",h)).fire(new f.Event("rotateend",h)),k&&this.fire(new f.Event("pitchstart",h)).fire(new f.Event("pitch",h)).fire(new f.Event("pitchend",h)),this.fire(new f.Event("moveend",h)),this}easeTo(c,h){this._stop(!1,c.easeId),(!1===(c=f.extend({offset:[0,0],duration:500,easing:f.ease},c)).animate||this._prefersReducedMotion(c))&&(c.duration=0);const y=this.transform,x=this.getZoom(),C=this.getBearing(),S=this.getPitch(),M=this.getPadding(),k="zoom"in c?+c.zoom:x,L="bearing"in c?this._normalizeBearing(c.bearing,C):C,N="pitch"in c?+c.pitch:S,V="padding"in c?c.padding:y.padding,K=f.Point.convert(c.offset);let te,re,ie;if("globe"===y.projection.name){const De=f.MercatorCoordinate.fromLngLat(y.center),_e=K.rotate(-y.angle);De.x+=_e.x/y.worldSize,De.y+=_e.y/y.worldSize;const Ie=De.toLngLat(),Pe=f.LngLat.convert(c.center||Ie);this._normalizeCenter(Pe),te=y.centerPoint.add(_e),re=new f.Point(De.x,De.y).mult(y.worldSize),ie=new f.Point(f.mercatorXfromLng(Pe.lng),f.mercatorYfromLat(Pe.lat)).mult(y.worldSize).sub(re)}else{te=y.centerPoint.add(K);const De=y.pointLocation(te),_e=f.LngLat.convert(c.center||De);this._normalizeCenter(_e),re=y.project(De),ie=y.project(_e).sub(re)}const se=y.zoomScale(k-x);let U,J;c.around&&(U=f.LngLat.convert(c.around),J=y.locationPoint(U));const de=this._zooming||k!==x,he=this._rotating||C!==L,Ce=this._pitching||N!==S,Se=!y.isPaddingEqual(V),Ee=De=>_e=>{if(de&&(De.zoom=f.number(x,k,_e)),he&&(De.bearing=f.number(C,L,_e)),Ce&&(De.pitch=f.number(S,N,_e)),Se&&(De.interpolatePadding(M,V,_e),te=De.centerPoint.add(K)),U)De.setLocationAtPoint(U,J);else{const Ie=De.zoomScale(De.zoom-x),Pe=k>x?Math.min(2,se):Math.max(.5,se),Ke=Math.pow(Pe,1-_e),Ve=De.unproject(re.add(ie.mult(_e*Ke)).mult(Ie));De.setLocationAtPoint(De.renderWorldCopies?Ve.wrap():Ve,te)}return c.preloadOnly||this._fireMoveEvents(h),De};if(c.preloadOnly){const De=this._emulate(Ee,c.duration,y);return this._preloadTiles(De),this}const ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=de,this._rotating=he,this._pitching=Ce,this._padding=Se,this._easeId=c.easeId,this._prepareEase(h,c.noMoveStart,ce),this._ease(Ee(y),De=>{y.recenterOnTerrain(),this._afterEase(h,De)},c),this}_prepareEase(c,h,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||y.moving||this.fire(new f.Event("movestart",c)),this._zooming&&!y.zooming&&this.fire(new f.Event("zoomstart",c)),this._rotating&&!y.rotating&&this.fire(new f.Event("rotatestart",c)),this._pitching&&!y.pitching&&this.fire(new f.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new f.Event("move",c)),this._zooming&&this.fire(new f.Event("zoom",c)),this._rotating&&this.fire(new f.Event("rotate",c)),this._pitching&&this.fire(new f.Event("pitch",c))}_afterEase(c,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,x=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new f.Event("zoomend",c)),x&&this.fire(new f.Event("rotateend",c)),C&&this.fire(new f.Event("pitchend",c)),this.fire(new f.Event("moveend",c))}flyTo(c,h){if(this._prefersReducedMotion(c)){const tt=f.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(tt,h)}this.stop(),c=f.extend({offset:[0,0],speed:1.2,curve:1.42,easing:f.ease},c);const y=this.transform,x=this.getZoom(),C=this.getBearing(),S=this.getPitch(),M=this.getPadding(),k="zoom"in c?f.clamp(+c.zoom,y.minZoom,y.maxZoom):x,L="bearing"in c?this._normalizeBearing(c.bearing,C):C,N="pitch"in c?+c.pitch:S,V="padding"in c?c.padding:y.padding,K=y.zoomScale(k-x),te=f.Point.convert(c.offset);let re=y.centerPoint.add(te);const ie=y.pointLocation(re),se=f.LngLat.convert(c.center||ie);this._normalizeCenter(se);const U=y.project(ie),J=y.project(se).sub(U);let de=c.curve;const he=Math.max(y.width,y.height),Ce=he/K,Se=J.mag();if("minZoom"in c){const tt=f.clamp(Math.min(c.minZoom,x,k),y.minZoom,y.maxZoom),dt=he/y.zoomScale(tt-x);de=Math.sqrt(dt/Se*2)}const Ee=de*de;function ce(tt){const dt=(Ce*Ce-he*he+(tt?-1:1)*Ee*Ee*Se*Se)/(2*(tt?Ce:he)*Ee*Se);return Math.log(Math.sqrt(dt*dt+1)-dt)}function De(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function _e(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const Ie=ce(0);let Pe=function(tt){return _e(Ie)/_e(Ie+de*tt)},Ke=function(tt){return he*((_e(Ie)*(De(dt=Ie+de*tt)/_e(dt))-De(Ie))/Ee)/Se;var dt},Ve=(ce(1)-Ie)/de;if(Math.abs(Se)<1e-6||!isFinite(Ve)){if(Math.abs(he-Ce)<1e-6)return this.easeTo(c,h);const tt=Ce<he?-1:1;Ve=Math.abs(Math.log(Ce/he))/de,Ke=function(){return 0},Pe=function(dt){return Math.exp(tt*de*dt)}}c.duration="duration"in c?+c.duration:1e3*Ve/("screenSpeed"in c?+c.screenSpeed/de:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const et=C!==L,Be=N!==S,Ye=!y.isPaddingEqual(V),ct=tt=>dt=>{const Tt=dt*Ve,Ht=1/Pe(Tt);tt.zoom=1===dt?k:x+tt.scaleZoom(Ht),et&&(tt.bearing=f.number(C,L,dt)),Be&&(tt.pitch=f.number(S,N,dt)),Ye&&(tt.interpolatePadding(M,V,dt),re=tt.centerPoint.add(te));const Mt=1===dt?se:tt.unproject(U.add(J.mult(Ke(Tt))).mult(Ht));return tt.setLocationAtPoint(tt.renderWorldCopies?Mt.wrap():Mt,re),tt._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(h),tt};if(c.preloadOnly){const tt=this._emulate(ct,c.duration,y);return this._preloadTiles(tt),this}return this._zooming=!0,this._rotating=et,this._pitching=Be,this._padding=Ye,this._prepareEase(h,!1),this._ease(ct(y),()=>this._afterEase(h),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,h)}if(!c){const y=this.handlers;y&&y.stop(!1)}return this}_ease(c,h,y){!1===y.animate||0===y.duration?(c(1),h()):(this._easeStart=f.exported.now(),this._easeOptions=y,this._onEaseFrame=c,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((f.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,h){c=f.wrap(c,-180,180);const y=Math.abs(c-h);return Math.abs(c-360-h)<y&&(c-=360),Math.abs(c+360-h)<y&&(c+=360),c}_normalizeCenter(c){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const y=c.lng-h.center.lng;c.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&f.exported.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,h,y){const x=Math.ceil(15*h/1e3),C=[],S=c(y.clone());for(let M=0;M<=x;M++){const k=S(M/x);C.push(k.clone())}return C}}class Et{constructor(c={}){this.options=c,f.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const h=this.options&&this.options.compact;return this._map=c,this._container=yn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=yn("button","mapboxgl-ctrl-attrib-button",this._container),yn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=yn("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,h){const y=this._map._getUIString(`AttributionControl.${h}`);c.setAttribute("aria-label",y),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",y)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||f.config.ACCESS_TOKEN}];if(c){const y=h.reduce((x,C,S)=>(C.value&&(x+=`${C.key}=${C.value}${S<h.length-1?"&":""}`),x),"?");c.href=`${f.config.FEEDBACK_URL}/${y}#${Wd(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const h=this._map.style._sourceCaches;for(const x in h){const C=h[x];if(C.used){const S=C.getSource();S.attribution&&c.indexOf(S.attribution)<0&&c.push(S.attribution)}}c.sort((x,C)=>x.length-C.length),c=c.filter((x,C)=>{for(let S=C+1;S<c.length;S++)if(c[S].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const y=c.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,c.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Wp{constructor(){f.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=yn("div","mapboxgl-ctrl");const h=yn("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const h in c){const y=c[h].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const h=c[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Zp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const h=++this._id;return this._queue.push({callback:c,id:h,cancelled:!1}),h}remove(c){const h=this._currentlyRunning,y=h?this._queue.concat(h):this._queue;for(const x of y)if(x.id===c)return void(x.cancelled=!0)}run(c=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const y of h)if(!y.cancelled&&(y.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function hc(_,c,h){if(_=new f.LngLat(_.lng,_.lat),c){const y=new f.LngLat(_.lng-360,_.lat),x=new f.LngLat(_.lng+360,_.lat),C=360*Math.ceil(Math.abs(_.lng-h.center.lng)/360),S=h.locationPoint(_).distSqr(c),M=c.x<0||c.y<0||c.x>h.width||c.y>h.height;h.locationPoint(y).distSqr(c)<S&&(M||Math.abs(y.lng-h.center.lng)<C)?_=y:h.locationPoint(x).distSqr(c)<S&&(M||Math.abs(x.lng-h.center.lng)<C)&&(_=x)}for(;Math.abs(_.lng-h.center.lng)>180;){const y=h.locationPoint(_);if(y.x>=0&&y.y>=0&&y.x<=h.width&&y.y<=h.height)break;_.lng>h.center.lng?_.lng-=360:_.lng+=360}return _}const gl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class xt extends f.Evented{constructor(c,h){if(super(),(c instanceof f.window.HTMLElement||h)&&(c=f.extend({element:c},h)),f.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=f.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=yn("div");const x=41,C=27,S=un("svg",{display:"block",height:x*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${x}`},this._element),M=un("radialGradient",{id:"shadowGradient"},un("defs",{},S));un("stop",{offset:"10%","stop-opacity":.4},M),un("stop",{offset:"100%","stop-opacity":.05},M),un("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),un("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),un("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),un("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=f.Point.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const y=this._element.classList;for(const x in gl)y.remove(`mapboxgl-marker-anchor-${x}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=f.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const h=c.code,y=c.charCode||c.keyCode;"Space"!==h&&"Enter"!==h&&32!==y&&13!==y||this.togglePopup()}_onMapClick(c){const h=c.originalEvent.target,y=this._element;this._popup&&(h===y||y.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,h=this._pos;if(!c||!h)return!1;const y=c.unproject(h),x=c.getFreeCameraOptions();if(!x.position)return!1;const C=x.position.toLngLat();return C.distanceTo(y)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const h=this._pos;if(!h||h.x<0||h.x>c.transform.width||h.y<0||h.y>c.transform.height)return void this._clearFadeTimer();const y=c.unproject(h);let x;c._showingGlobe()&&f.isLngLatBehindGlobe(c.transform,this._lngLat)?x=0:(x=1-c._queryFogOpacity(y),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${gl[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${h.x}px,${h.y}px)\n        `}_calculateXYTransform(){const c=this._pos,h=this._map,y=this.getPitchAlignment();if(!h||!c||"map"!==y)return"";if(!h._showingGlobe()){const k=h.getPitch();return k?`rotateX(${k}deg)`:""}const x=f.radToDeg(f.globeTiltAtLngLat(h.transform,this._lngLat)),C=c.sub(f.globeCenterToScreenPoint(h.transform)),S=Math.abs(C.x)+Math.abs(C.y);if(0===S)return"";const M=x/S;return`rotateX(${-C.y*M}deg) rotateY(${C.x*M}deg)`}_calculateZTransform(){const c=this._pos,h=this._map;if(!h||!c)return"";let y=0;const x=this.getRotationAlignment();if("map"===x)if(h._showingGlobe()){const C=h.project(new f.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),S=h.project(new f.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(C);y=f.radToDeg(Math.atan2(S.y,S.x))-90}else y=-h.getBearing();else if("horizon"===x){const C=f.smoothstep(4,6,h.getZoom()),S=f.globeCenterToScreenPoint(h.transform);S.y+=C*h.transform.height;const M=c.sub(S),k=f.radToDeg(Math.atan2(M.y,M.x));y=(k>90?k-270:k+90)*(1-C)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(c){f.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=hc(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===c?this._updateFrameId=f.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=f.Point.convert(c),this._update(),this}_onMove(c){const h=this._map;if(!h)return;const y=this._pointerdownPos,x=this._positionDelta;if(y&&x){if(!this._isDragging){const C=this._clickTolerance||h._clickTolerance;if(c.point.dist(y)<C)return;this._isDragging=!0}this._pos=c.point.sub(x),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new f.Event("dragstart"))),this.fire(new f.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new f.Event("dragend")),this._state="inactive"}_addDragHandler(c){const h=this._map,y=this._pos;h&&y&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(y),this._pointerdownPos=c.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const h=this._map;return h&&(c?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const tu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ay=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ds(_=new f.Point(0,0),c="bottom"){if("number"==typeof _){const h=Math.round(Math.sqrt(.5*Math.pow(_,2)));switch(c){case"top":return new f.Point(0,_);case"top-left":return new f.Point(h,h);case"top-right":return new f.Point(-h,h);case"bottom":return new f.Point(0,-_);case"bottom-left":return new f.Point(h,-h);case"bottom-right":return new f.Point(-h,-h);case"left":return new f.Point(_,0);case"right":return new f.Point(-_,0)}return new f.Point(0,0)}return _ instanceof f.Point||Array.isArray(_)?f.Point.convert(_):f.Point.convert(_[c]||[0,0])}class mh{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const h=f.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,h,y){this._start=this.getValue(h),this._end=c,this._startTime=h,this._endTime=h+y}}const Yp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},gi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Iy={showCompass:!0,showZoom:!0,visualizePitch:!1};class _h{constructor(c,h,y=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Kd({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,y&&(this.mousePitch=new uh({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),f.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(c,h){this.mouseRotate.mousedown(c,h),this.mousePitch&&this.mousePitch.mousedown(c,h),Gn()}move(c,h){const y=this.map,x=this.mouseRotate.mousemoveWindow(c,h),C=x&&x.bearingDelta;if(C&&y.setBearing(y.getBearing()+C),this.mousePitch){const S=this.mousePitch.mousemoveWindow(c,h),M=S&&S.pitchDelta;M&&y.setPitch(y.getPitch()+M)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Wl(),f.window.removeEventListener("mousemove",this.mousemove),f.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(f.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),oo(this.element,c)),f.window.addEventListener("mousemove",this.mousemove),f.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,oo(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=Us(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=Us(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const qr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Xp={maxWidth:100,unit:"metric"},gh={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Es={version:f.version,supported:Vr,setRTLTextPlugin:f.setRTLTextPlugin,getRTLTextPluginStatus:f.getRTLTextPluginStatus,Map:class extends Ci{constructor(_){if(f.LivePerformanceUtils.mark(f.PerformanceMarkers.create),null!=(_=f.extend({},gi,_)).minZoom&&null!=_.maxZoom&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=_.minPitch&&null!=_.maxPitch&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=_.minPitch&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=_.maxPitch&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(_.antialias&&f.isSafariWithAntialiasingBug(f.window)&&(_.antialias=!1,f.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new sd(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._useWebGL2=_.useWebGL2,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._collectResourceTiming=_.collectResourceTiming,this._optimizeForTerrain=_.optimizeForTerrain,this._language=this._parseLanguage(_.language),this._worldview=_.worldview,this._renderTaskQueue=new Zp,this._domRenderTaskQueue=new Zp,this._controls=[],this._markers=[],this._popups=[],this._mapId=f.uniqueId(),this._locale=f.extend({},Yp,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._performanceMetricsCollection=_.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new mh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new f.RequestManager(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,"string"==typeof _.container){if(this._container=f.window.document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof f.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&f.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),f.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==f.window&&(f.window.addEventListener("online",this._onWindowOnline,!1),f.window.addEventListener("resize",this._onWindowResize,!1),f.window.addEventListener("orientationchange",this._onWindowResize,!1),f.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),f.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new na(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,_.style&&this.setStyle(_.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),this._hash=_.hash&&new Km("string"==typeof _.hash&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,f.extend({},_.fitBoundsOptions,{duration:0})))),this.resize(),_.attributionControl&&this.addControl(new Et({customAttribution:_.customAttribution})),this._logoControl=new Wp,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new f.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new f.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(_,c){if(void 0===c&&(c=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=_.onAdd(this);this._controls.push(_);const y=this._controlPositions[c];return-1!==c.indexOf("bottom")?y.insertBefore(h,y.firstChild):y.appendChild(h),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(_);return c>-1&&this._controls.splice(c,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new f.Event("movestart",_)).fire(new f.Event("move",_)),this.fire(new f.Event("resize",_)),c&&this.fire(new f.Event("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(f.LngLatBounds.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(_){return"auto"===_?f.window.navigator.language:Array.isArray(_)?0===_.length?void 0:_.map(c=>"auto"===c?f.window.navigator.language:c):_}setLanguage(_){const c=this._parseLanguage(_);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(_){return this.style&&_!==this._worldview?(this._worldview=_,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(_){return this._lazyInitEmptyStyle(),_?"string"==typeof _&&(_={name:_}):_=null,this._useExplicitProjection=!!_,this._prioritizeAndUpdateProjection(_,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const _=this.transform,c=_.projection.name;let h;"globe"===c&&_.zoom>=f.GLOBE_ZOOM_THRESHOLD_MAX?(_.setMercatorFromTransition(),h=!0):"mercator"===c&&_.zoom<f.GLOBE_ZOOM_THRESHOLD_MAX&&(_.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(_,c){return this._updateProjection(_||c||{name:"mercator"})}_updateProjection(_){let c;if(c="globe"===_.name&&this.transform.zoom>=f.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(_),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(_){return this.transform.locationPoint3D(f.LngLat.convert(_))}unproject(_){return this.transform.pointLocation3D(f.Point.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(_,c,h){if("mouseenter"===_||"mouseover"===_){let y=!1;const x=S=>{const M=c.filter(L=>this.getLayer(L)),k=M.length?this.queryRenderedFeatures(S.point,{layers:M}):[];k.length?y||(y=!0,h.call(this,new Ir(_,this,S.originalEvent,{features:k}))):y=!1},C=()=>{y=!1};return{layers:new Set(c),listener:h,delegates:{mousemove:x,mouseout:C}}}if("mouseleave"===_||"mouseout"===_){let y=!1;const x=S=>{const M=c.filter(k=>this.getLayer(k));(M.length?this.queryRenderedFeatures(S.point,{layers:M}):[]).length?y=!0:y&&(y=!1,h.call(this,new Ir(_,this,S.originalEvent)))},C=S=>{y&&(y=!1,h.call(this,new Ir(_,this,S.originalEvent)))};return{layers:new Set(c),listener:h,delegates:{mousemove:x,mouseout:C}}}{const y=x=>{const C=c.filter(M=>this.getLayer(M)),S=C.length?this.queryRenderedFeatures(x.point,{layers:C}):[];S.length&&(x.features=S,h.call(this,x),delete x.features)};return{layers:new Set(c),listener:h,delegates:{[_]:y}}}}on(_,c,h){if(void 0===h)return super.on(_,c);Array.isArray(c)||(c=[c]);const y=this._createDelegatedListener(_,c,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(y);for(const x in y.delegates)this.on(x,y.delegates[x]);return this}once(_,c,h){if(void 0===h)return super.once(_,c);Array.isArray(c)||(c=[c]);const y=this._createDelegatedListener(_,c,h);for(const x in y.delegates)this.once(x,y.delegates[x]);return this}off(_,c,h){if(void 0===h)return super.off(_,c);c=new Set(Array.isArray(c)?c:[c]);const y=(C,S)=>{if(C.size!==S.size)return!1;for(const M of C)if(!S.has(M))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[_]:void 0;return x&&(C=>{for(let S=0;S<C.length;S++){const M=C[S];if(M.listener===h&&y(M.layers,c)){for(const k in M.delegates)this.off(k,M.delegates[k]);return C.splice(S,1),this}}})(x),this}queryRenderedFeatures(_,c){return this.style?(void 0!==c||void 0===_||_ instanceof f.Point||Array.isArray(_)||(c=_,_=void 0),this.style.queryRenderedFeatures(_=_||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(_,c){return this.style.querySourceFeatures(_,c)}isPointOnSurface(_){const{name:c}=this.transform.projection;return"globe"!==c&&"mercator"!==c&&f.warnOnce(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(f.Point.convert(_))}setStyle(_,c){return!1!==(c=f.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&_?(this._diffStyle(_,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(_,c))}_getUIString(_){const c=this._locale[_];if(null==c)throw new Error(`Missing UI string '${_}'`);return c}_updateStyle(_,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),_&&(this.style=new Ys(this,c||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof _?this.style.loadURL(_):this.style.loadJSON(_)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ys(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,c){if("string"==typeof _){const h=this._requestManager.normalizeStyleURL(_),y=this._requestManager.transformRequest(h,f.ResourceType.Style);f.getJSON(y,(x,C)=>{x?this.fire(new f.ErrorEvent(x)):C&&this._updateDiff(C,c)})}else"object"==typeof _&&this._updateDiff(_,c)}_updateDiff(_,c){try{this.style.setState(_)&&this._update(!0)}catch(h){f.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(_,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(f.warnOnce("There is no style added to the map."),!1)}addSource(_,c){return this._lazyInitEmptyStyle(),this.style.addSource(_,c),this._update(!0)}isSourceLoaded(_){return!!this.style&&this.style._isSourceCacheLoaded(_)}areTilesLoaded(){const _=this.style&&this.style._sourceCaches;for(const c in _){const h=_[c]._tiles;for(const y in h){const x=h[y];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(_,c,h){this._lazyInitEmptyStyle(),this.style.addSourceType(_,c,h)}removeSource(_){return this.style.removeSource(_),this._updateTerrain(),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,c,{pixelRatio:h=1,sdf:y=!1,stretchX:x,stretchY:C,content:S}={}){if(this._lazyInitEmptyStyle(),c instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&c instanceof f.window.ImageBitmap){const{width:M,height:k,data:L}=f.exported.getImageData(c);this.style.addImage(_,{data:new f.RGBAImage({width:M,height:k},L),pixelRatio:h,stretchX:x,stretchY:C,content:S,sdf:y,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:k}=c,L=c;this.style.addImage(_,{data:new f.RGBAImage({width:M,height:k},new Uint8Array(L.data)),pixelRatio:h,stretchX:x,stretchY:C,content:S,sdf:y,version:0,userImage:L}),L.onAdd&&L.onAdd(this,_)}}updateImage(_,c){const h=this.style.getImage(_);if(!h)return void this.fire(new f.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=c instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&c instanceof f.window.ImageBitmap?f.exported.getImageData(c):c,{width:x,height:C}=y;void 0!==x&&void 0!==C?x===h.data.width&&C===h.data.height?(h.data.replace(y.data,!(c instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&c instanceof f.window.ImageBitmap)),this.style.updateImage(_,h)):this.fire(new f.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${C})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`))):this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new f.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,c){f.getImage(this._requestManager.transformRequest(_,f.ResourceType.Image),(h,y)=>{c(h,y instanceof f.window.HTMLImageElement?f.exported.getImageData(y):y)})}listImages(){return this.style.listImages()}addLayer(_,c){return this._lazyInitEmptyStyle(),this.style.addLayer(_,c),this._update(!0)}moveLayer(_,c){return this.style.moveLayer(_,c),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}setLayerZoomRange(_,c,h){return this.style.setLayerZoomRange(_,c,h),this._update(!0)}setFilter(_,c,h={}){return this.style.setFilter(_,c,h),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,c,h,y={}){return this.style.setPaintProperty(_,c,h,y),this._update(!0)}getPaintProperty(_,c){return this.style.getPaintProperty(_,c)}setLayoutProperty(_,c,h,y={}){return this.style.setLayoutProperty(_,c,h,y),this._update(!0)}getLayoutProperty(_,c){return this.style.getLayoutProperty(_,c)}setLight(_,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(f.LngLat.convert(_),this.transform):0}setFeatureState(_,c){return this.style.setFeatureState(_,c),this._update()}removeFeatureState(_,c){return this.style.removeFeatureState(_,c),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}_updateContainerDimensions(){if(!this._container)return;const _=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let h,y,x,C=this._container;for(;C&&(!y||!x);){const S=f.window.getComputedStyle(C).transform;S&&"none"!==S&&(h=S.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(y=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(x=h[3])),C=C.parentElement}this._containerWidth=y?Math.abs(_/y):_,this._containerHeight=x?Math.abs(c/x):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==f.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&f.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=yn("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=yn("div","mapboxgl-canvas-container",_);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=yn("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=yn("div","mapboxgl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{y[x]=yn("div",`mapboxgl-ctrl-${x}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,c){const h=f.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(_),this._canvas.height=h*Math.ceil(c),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${c}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const c=this._markers.indexOf(_);-1!==c&&this._markers.splice(c,1)}_addPopup(_){this._popups.push(_)}_removePopup(_){const c=this._popups.indexOf(_);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const _=f.extend({},Vr.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",_),h=c||this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);h?(this._useWebGL2&&!c&&f.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),f.storeAuthState(h,!0),this.painter=new co(h,this.transform,!!c),this.on("data",y=>{"source"===y.dataType&&this.painter.setTileLoadedFlag(!0)}),f.exported$1.testSupport(h)):this.fire(new f.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new f.Event("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new f.Event("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let c;const h=this.painter.context.extTimerQuery,y=f.exported.now();if(this.listens("gpu-timing-frame")&&(c=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],f.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],f.window.performance.now())),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,k=this.transform.pitch,L=f.exported.now(),N=new f.EvaluationParameters(M,{now:L,fadeDuration:x,pitch:k,transition:this.style.getTransition()});this.style.update(N)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(y),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):C=this._updateAverageElevation(y),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new f.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new f.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const M=f.exported.now()-y;h.endQueryEXT(h.TIME_ELAPSED_EXT,c),setTimeout(()=>{const k=h.getQueryObjectEXT(c,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(c),this.fire(new f.Event("gpu-timing-frame",{cpuTime:M,gpuTime:k})),f.window.performance.mark("frame-gpu",{startTime:y,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(M);this.fire(new f.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(M);this.fire(new f.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(S||this._repaint)this.triggerRepaint();else{const M=!this.isMoving()&&this.loaded();if(M&&(C=this._updateAverageElevation(y,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new f.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new f.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,f.LivePerformanceUtils.mark(f.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&f.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(_){for(const c of this._markers)_&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!_||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(_,c=!1){const h=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((c||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const y=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),C=!1;this.transform.elevation&&(C=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=_;const S=Math.abs(y-x);if(S>1){if(this._isInitialLoad||C)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,_,300)}else if(S>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(_)&&h(this._averageElevation.getValue(_))}_authenticate(){f.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===f.AUTH_ERR_MSG||401===_.status)){const c=this.painter.context.gl;f.storeAuthState(c,!1),this._logoControl instanceof Wp&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new f.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),f.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const _=this._isDragging();this.painter.updateTerrain(this.style,_)}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const h=this.painter.context.gl,y=h.createFramebuffer();function x(C){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,C,0);const S=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,S),S}return h.bindFramebuffer(h.FRAMEBUFFER,y),this._canvasPixelComparison(x(_),c.canvasCopies.map(x),c.timeStamps)}_canvasPixelComparison(_,c,h){let y=h[1]-h[0];const x=_.length/4;for(let C=0;C<c.length;C++){const S=c[C];let M=0;for(let k=0;k<S.length;k+=4)S[k]===_[k]&&S[k+1]===_[k+1]&&S[k+2]===_[k+2]&&S[k+3]===_[k+3]&&(M+=1);y+=(h[C+2]-h[C+1])*(1-M/x)}return y}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==f.window&&(f.window.removeEventListener("resize",this._onWindowResize,!1),f.window.removeEventListener("orientationchange",this._onWindowResize,!1),f.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),f.window.removeEventListener("online",this._onWindowOnline,!1),f.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),f.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new f.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=f.exported.frame(c=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(c)}))}_preloadTiles(_){const c=this.style?Object.values(this.style._sourceCaches):[];return f.asyncAll(c,(h,y)=>h._preloadTiles(_,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}_onVisibilityChange(){"hidden"===f.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(_){this._showTileAABBs!==_&&(this._showTileAABBs=_,_&&this._update())}_setCacheLimits(_,c){f.setCacheLimits(_,c)}get version(){return f.version}},NavigationControl:class{constructor(_){this.options=f.extend({},Iy,_),this._container=yn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(f.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),yn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),yn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(f.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:c}):h.resetNorth({},{originalEvent:c}))}),this._compassIcon=yn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const _=this._map;if(!_)return;const c=_.getZoom(),h=c===_.getMaxZoom(),y=c===_.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const _=this._map;if(!_)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(_.transform.pitch*(Math.PI/180)),.5)}) rotateX(${_.transform.pitch}deg) rotateZ(${_.transform.angle*(180/Math.PI)}deg)`:`rotate(${_.transform.angle*(180/Math.PI)}deg)`;_._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),_.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&_.on("pitch",this._rotateCompassArrow),_.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _h(_,this._compass,this.options.visualizePitch)),this._container}onRemove(){const _=this._map;_&&(this._container.remove(),this.options.showZoom&&_.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&_.off("pitch",this._rotateCompassArrow),_.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(_,c){const h=yn("button",_,this._container);return h.type="button",h.addEventListener("click",c),h}_setButtonTitle(_,c){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${c}`);_.setAttribute("aria-label",h),_.firstElementChild&&_.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends f.Evented{constructor(_){super(),this.options=f.extend({geolocation:f.window.navigator.geolocation},qr,_),f.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ad(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(_){return this._map=_,this._container=yn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(_){const c=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,_(h)};void 0!==this._supportsGeolocation?_(this._supportsGeolocation):void 0!==f.window.navigator.permissions?f.window.navigator.permissions.query({name:"geolocation"}).then(h=>c("denied"!==h.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(_){const c=this._map.getMaxBounds(),h=_.coords;return!!c&&(h.longitude<c.getWest()||h.longitude>c.getEast()||h.latitude<c.getSouth()||h.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new f.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(_),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("geolocate",_)),this._finish()}}_updateCamera(_){const c=new f.LngLat(_.coords.longitude,_.coords.latitude),h=_.coords.accuracy,y=this._map.getBearing(),x=f.extend({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(h),x,{geolocateSource:!0})}_updateMarker(_){if(_){const c=new f.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map.transform,c=f.mercatorZfromAltitude(1,_._center.lat)*_.worldSize,h=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(1===_.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===_.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=yn("button","mapboxgl-ctrl-geolocate",this._container),yn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===_){f.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=yn("div","mapboxgl-user-location"),this._dotElement.appendChild(yn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(yn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new xt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=yn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new f.Event("trackuserlocationend")))})}}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:!0===_.absolute&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return f.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new f.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(_={maximumAge:6e5,timeout:0},this._noTimeout=!0):(_=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{f.window.addEventListener("ondeviceorientationabsolute"in f.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==f.window.DeviceMotionEvent&&"function"==typeof f.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&_()}).catch(console.error):_()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),f.window.removeEventListener("deviceorientation",this._onDeviceOrientation),f.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Et,ScaleControl:class{constructor(_){this.options=f.extend({},Xp,_),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),f.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const _=this.options.maxWidth||100,c=this._map,h=c._containerHeight/2,y=c._containerWidth/2-_/2,x=c.unproject([y,h]),C=c.unproject([y+_,h]),S=x.distanceTo(C);if("imperial"===this.options.unit){const M=3.2808*S;M>5280?this._setScale(_,M/5280,"mile"):this._setScale(_,M,"foot")}else"nautical"===this.options.unit?this._setScale(_,S/1852,"nautical-mile"):S>=1e3?this._setScale(_,S/1e3,"kilometer"):this._setScale(_,S,"meter")}_setScale(_,c,h){this._map._requestDomTask(()=>{const y=function(C){const S=Math.pow(10,`${Math.floor(C)}`.length-1);let M=C/S;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(k){const L=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*L)/L}(M),S*M}(c),x=y/c;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(y):`${y}&nbsp;${gh[h]}`,this._container.style.width=_*x+"px"})}onAdd(_){return this._map=_,this._language=_.getLanguage(),this._container=yn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(_){this._language=_,this._update()}setUnit(_){this.options.unit=_,this._update()}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof f.window.HTMLElement?this._container=_.container:f.warnOnce("Full screen control 'container' must be a DOM element.")),f.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in f.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in f.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=yn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",f.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,f.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!f.window.document.fullscreenEnabled&&!f.window.document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=yn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);yn("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),f.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(f.window.document.fullscreenElement||f.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?f.window.document.exitFullscreen?f.window.document.exitFullscreen():f.window.document.webkitCancelFullScreen&&f.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends f.Evented{constructor(_){super(),this.options=f.extend(Object.create(tu),_),f.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&_.on("preclick",this._onClose),this.options.closeOnMove&&_.on("move",this._onClose),_.on("remove",this.remove),this._update(),_._addPopup(this),this._focusFirstElement(),this._trackPointer?(_.on("mousemove",this._onMouseEvent),_.on("mouseup",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")):_.on("move",this._update),this.fire(new f.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const _=this._map;return _&&(_.off("move",this._update),_.off("move",this._onClose),_.off("preclick",this._onClose),_.off("click",this._onClose),_.off("remove",this.remove),_.off("mousemove",this._onMouseEvent),_.off("mouseup",this._onMouseEvent),_.off("drag",this._onMouseEvent),_._canvasContainer&&_._canvasContainer.classList.remove("mapboxgl-track-pointer"),_._removePopup(this),this._map=void 0),this.fire(new f.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(_){this._lngLat=f.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const _=this._map;return _&&(_.off("move",this._update),_.on("mousemove",this._onMouseEvent),_.on("drag",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(f.window.document.createTextNode(_))}setHTML(_){const c=f.window.document.createDocumentFragment(),h=f.window.document.createElement("body");let y;for(h.innerHTML=_;y=h.firstChild,y;)c.appendChild(y);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=yn("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(_),this.options.closeButton){const h=this._closeButton=yn("button","mapboxgl-popup-close-button",c);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let c;return this._classList.delete(_)?c=!1:(this._classList.add(_),c=!0),this._updateClassList(),c}_onMouseEvent(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const c=this._map,h=this._container,y=this._pos;if(!c||!h||!y)return"bottom";const x=h.offsetWidth,C=h.offsetHeight,S=y.x<x/2,M=y.x>c.transform.width-x/2;if(y.y+_<C)return S?"top-left":M?"top-right":"top";if(y.y>c.transform.height-C){if(S)return"bottom-left";if(M)return"bottom-right"}return S?"left":M?"right":"bottom"}_updateClassList(){const _=this._container;if(!_)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),_.className=c.join(" ")}_update(_){const c=this._map,h=this._content;if(!c||!this._lngLat&&!this._trackPointer||!h)return;let y=this._container;if(y||(y=this._container=yn("div","mapboxgl-popup",c.getContainer()),this._tip=yn("div","mapboxgl-popup-tip",y),y.appendChild(h)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hc(this._lngLat,this._pos,c.transform)),!this._trackPointer||_){const x=this._pos=this._trackPointer&&_?_:c.project(this._lngLat),C=Ds(this.options.offset),S=this._anchor=this._getAnchor(C.y),M=Ds(this.options.offset,S),k=x.add(M).round();c._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${gl[S]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&c._showingGlobe()){const x=f.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Ay);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._container&&(this._container.style.opacity=`${_}`),this._content&&(this._content.style.pointerEvents=_?"auto":"none")}},Marker:xt,Style:Ys,LngLat:f.LngLat,LngLatBounds:f.LngLatBounds,Point:f.Point,MercatorCoordinate:f.MercatorCoordinate,FreeCameraOptions:Cy,Evented:f.Evented,config:f.config,prewarm:function(){nn().acquire(ys)},clearPrewarmedResources:function(){const _=xr;_&&(_.isPreloaded()&&1===_.numActive()?(_.release(ys),xr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return f.config.ACCESS_TOKEN},set accessToken(_){f.config.ACCESS_TOKEN=_},get baseApiUrl(){return f.config.API_URL},set baseApiUrl(_){f.config.API_URL=_},get workerCount(){return He.workerCount},set workerCount(_){He.workerCount=_},get maxParallelImageRequests(){return f.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){f.config.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){f.clearTileCache(_)},workerUrl:"",workerClass:null,setNow:f.exported.setNow,restoreNow:f.exported.restoreNow};return Es}),ql}()}},_y=>{_y(_y.s=185)}]);